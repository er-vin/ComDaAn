[{"id": 25936028, "iid": 217, "project_id": 14022, "title": "Missing integration specs: upload-pack and upload-archive", "description": "Noted in https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/346#note_230360210\n\nWe're missing integration-level specs (currently written in Ruby) for two gitlab-shell commands: upload-pack and upload-archive.\n\nWe should add these, not written in Ruby, but in Go. Alternatively, or as well as, we should ensure QA-level testing of these features too: #180", "state": "opened", "created_at": "2019-10-15T05:03:47.785Z", "updated_at": "2019-10-15T05:03:47.785Z", "closed_at": null, "closed_by": null, "labels": ["backend", "backstage", "devops", "golang", "group::source code", "unit testing"], "milestone": null, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/217", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/217", "notes": "https://gitlab.com/api/v4/projects/14022/issues/217/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/217/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 230372032, "type": null, "body": "mentioned in merge request !346", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-15T05:04:30.331Z", "updated_at": "2019-10-15T05:04:30.335Z", "system": true, "noteable_id": 25936028, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 217}]]}, {"id": 25863648, "iid": 216, "project_id": 14022, "title": "Add guidelines for command-line UX patterns", "description": "## Problem\n\nOne of the major touch points with users is on a command-line. Mostly `git pull`/`git push` etc.\n\nE.g.\n\n```\nEnumerating objects: 292, done.\nCounting objects: 100% (292/292), done.\nDelta compression using up to 16 threads\nCompressing objects: 100% (198/198), done.\nWriting objects: 100% (215/215), 33.18 KiB | 4.15 MiB/s, done.\nTotal 215 (delta 190), reused 19 (delta 16)\nremote: Resolving deltas: 100% (190/190), completed with 73 local objects.\nremote: \nremote: View merge request for 10586-geo-file-replication-refactor:\nremote:   https://gitlab.com/gitlab-org/gitlab/merge_requests/15606\nremote: \nTo gitlab.com:gitlab-org/gitlab.git\n + f1c30b681b5...183b4233a88 10586-geo-file-replication-refactor -> 10586-geo-file-replication-refactor (forced update)\n```\n\nIn this example, GitLab has created this portion (The users's `git` client created the rest). `remote: ` is added as the first part of every line, but otherwise there are no other rules:\n\n```\nremote: Resolving deltas: 100% (190/190), completed with 73 local objects.\nremote: \nremote: View merge request for 10586-geo-file-replication-refactor:\nremote:   https://gitlab.com/gitlab-org/gitlab/merge_requests/15606\nremote: \n```\n\nBroadcast messages look like:\n\n```\nremote: \nremote: ========================================================================\nremote: \nremote:   Something will occur on 14 September 2019 that will affect no users\nremote:                   and will have no impact whatsoever.\nremote: \nremote: ========================================================================\n```\n\nThe content is word-wrapped, centered, and encased in blank lines, 72 character-long bars, and a blank line on top.\n\nMany messages are generated during `post-receive`. These are categorized as `alert` (e.g. broadcast message) vs `basic` (e.g. create merge request link message).\n\nAdditional messages are generated elsewhere, and are not standardized along those lines.\n\nE.g. This MR is making this message more consistent with `post-receive` messages: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/334\n\n```\n$ git push\nInternal API unreachable\nfatal: Could not read from remote repository.\n```\n\n**To summarize:**\n\n- GitLab produces console output that is not consistent everywhere\n- It's not clear what new messages should look like\n\n## Proposal\n\n- [ ] Take no more than a day to gather as much GitLab-generated console output as possible\n- [ ] Create a developer guidelines doc for command-line UX patterns\n- [ ] Create issues to resolve existing inconsistencies \n\nSome initial discussion: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/334#note_215842935", "state": "opened", "created_at": "2019-10-11T19:23:09.765Z", "updated_at": "2019-10-11T19:31:17.884Z", "closed_at": null, "closed_by": null, "labels": ["P4", "S4", "UX", "development guidelines", "documentation"], "milestone": null, "assignees": [], "author": {"id": 1144264, "name": "Michael Kozono", "username": "mkozono", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ddaa576b4b6933a6fb7a996088c30f6c?s=80&d=identicon", "web_url": "https://gitlab.com/mkozono"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/216", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 3, "completed_count": 0}, "has_tasks": true, "task_status": "0 of 3 tasks completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/216", "notes": "https://gitlab.com/api/v4/projects/14022/issues/216/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/216/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 2, "epic_iid": null, "discussion": [[{"id": 229522166, "type": null, "body": "changed weight to **2**", "attachment": null, "author": {"id": 1144264, "name": "Michael Kozono", "username": "mkozono", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ddaa576b4b6933a6fb7a996088c30f6c?s=80&d=identicon", "web_url": "https://gitlab.com/mkozono"}, "created_at": "2019-10-11T19:23:09.861Z", "updated_at": "2019-10-11T19:23:09.864Z", "system": true, "noteable_id": 25863648, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 216}], [{"id": 229522301, "type": null, "body": "mentioned in merge request !334", "attachment": null, "author": {"id": 1144264, "name": "Michael Kozono", "username": "mkozono", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ddaa576b4b6933a6fb7a996088c30f6c?s=80&d=identicon", "web_url": "https://gitlab.com/mkozono"}, "created_at": "2019-10-11T19:23:38.962Z", "updated_at": "2019-10-11T19:23:38.965Z", "system": true, "noteable_id": 25863648, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 216}], [{"id": 229524270, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 1144264, "name": "Michael Kozono", "username": "mkozono", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ddaa576b4b6933a6fb7a996088c30f6c?s=80&d=identicon", "web_url": "https://gitlab.com/mkozono"}, "created_at": "2019-10-11T19:31:18.054Z", "updated_at": "2019-10-11T19:31:18.057Z", "system": true, "noteable_id": 25863648, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 216}]]}, {"id": 25743825, "iid": 215, "project_id": 14022, "title": "Follow-up from \"Rewrite `bin/check` in Go\"", "description": "The following discussion from !341 should be addressed:\n\n- [ ] @patrickbajao started a [discussion](https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/341#note_227769016): \n\n    > We can remove this now as we're not using it anymore. :slight_smile:", "state": "closed", "created_at": "2019-10-09T02:55:28.993Z", "updated_at": "2019-10-11T06:30:27.693Z", "closed_at": "2019-10-09T03:14:04.822Z", "closed_by": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "labels": ["group::geo", "technical debt"], "milestone": {"id": 731039, "iid": 38, "group_id": 9970, "title": "12.4", "description": "", "state": "active", "created_at": "2018-12-07T12:41:53.212Z", "updated_at": "2019-09-20T21:21:22.813Z", "due_date": "2019-10-17", "start_date": "2019-09-18", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/38"}, "assignees": [{"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}], "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "assignee": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/215", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 1, "completed_count": 0}, "has_tasks": true, "task_status": "0 of 1 task completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/215", "notes": "https://gitlab.com/api/v4/projects/14022/issues/215/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/215/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 1, "epic_iid": null, "discussion": [[{"id": 227771647, "type": null, "body": "changed milestone to %\"12.4\"", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-10-09T02:55:29.077Z", "updated_at": "2019-10-09T02:55:29.080Z", "system": true, "noteable_id": 25743825, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 215}], [{"id": 227771648, "type": null, "body": "changed weight to **1**", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-10-09T02:55:29.111Z", "updated_at": "2019-10-09T02:55:29.114Z", "system": true, "noteable_id": 25743825, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 215}], [{"id": 227772006, "type": null, "body": "mentioned in merge request !343", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-10-09T02:58:10.062Z", "updated_at": "2019-10-09T02:58:10.066Z", "system": true, "noteable_id": 25743825, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 215}], [{"id": 227774265, "type": null, "body": "closed via commit b981cd5ae307936d0731b91a34aee1801a059ebd", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-10-09T03:14:04.922Z", "updated_at": "2019-10-09T03:14:04.926Z", "system": true, "noteable_id": 25743825, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 215}], [{"id": 229133270, "type": null, "body": "mentioned in commit b981cd5ae307936d0731b91a34aee1801a059ebd", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-10-11T06:30:27.659Z", "updated_at": "2019-10-11T06:30:27.662Z", "system": true, "noteable_id": 25743825, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 215}]]}, {"id": 25743542, "iid": 214, "project_id": 14022, "title": "Investigate rearchitecting `command` and `executable` Go modules", "description": "The following discussion from !341 should be addressed:\n\n- [ ] @nick.thomas started a [discussion](https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/341#note_227443226): \n\n    > Pulling in all of `command` here is probably what makes the binary so much larger than it needs to be. We end up with lots of grpc things that are never used inside it.\n    > \n    > As a follow-up, we might want to look at rearchitecting `command` and `executable` to be more like `database/sql` - i.e., there is a registry, we import specific commands we want to support in `package main`, and they register themselves against that registry, rather than us having large `switch` statements that unconditionally import the code. That might help significantly with overall binary size.\n    > \n    > ```\n    > $ strings bin/check | grep -i grpc | wc -l\n    > 2049\n    > \n    > ```", "state": "opened", "created_at": "2019-10-09T02:22:54.448Z", "updated_at": "2019-10-09T11:07:29.121Z", "closed_at": null, "closed_by": null, "labels": ["backstage", "devops::create", "group::source code", "technical debt"], "milestone": null, "assignees": [], "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/214", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 1, "completed_count": 0}, "has_tasks": true, "task_status": "0 of 1 task completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/214", "notes": "https://gitlab.com/api/v4/projects/14022/issues/214/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/214/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 25582670, "iid": 213, "project_id": 14022, "title": "Remove ruby as a build-time or install-time dependency", "description": "Right now, we have two scripts in gitlab-shell that use Ruby: `bin/compile` and `bin/install`. Once https://gitlab.com/gitlab-org/gitlab-shell/issues/173 is completed, ruby will no longer be a run-time dependency, and it is inefficient and confusing to need Ruby at these earlier stages.\n\nWe should remove or rewrite these dependencies such that both scripts work to completion in a basic `golang:latest` container without Ruby installed.\n\nIdeally, we'd remove `bin/install` entirely, but it's responsible for creating at least one directory that needs to exist on the SSH nodes, and we'll need to ensure that responsibility exists elsewhere - e.g. in omnibus, GDK, CNG, and the install-from-source docs - before we remove it. One possibility is to make https://gitlab.com/gitlab-org/gitlab/blob/master/lib/gitlab/authorized_keys.rb create the directory as well as the `authorized_keys` file if it doesn't exist - that should be safe.\n\n`bin/compile` can be subsumed entirely into the Makefile. This will be a much simpler operation once the Golang code has moved from `gitlab-shell/go` as its top-level.", "state": "opened", "created_at": "2019-10-03T11:41:51.832Z", "updated_at": "2019-10-15T05:09:11.215Z", "closed_at": null, "closed_by": null, "labels": ["devops::create", "group::source code", "technical debt"], "milestone": null, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/213", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/213", "notes": "https://gitlab.com/api/v4/projects/14022/issues/213/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/213/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 225527133, "type": null, "body": "mentioned in issue #173", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T11:43:36.877Z", "updated_at": "2019-10-03T11:43:36.879Z", "system": true, "noteable_id": 25582670, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 213}], [{"id": 225538552, "type": null, "body": "mentioned in merge request gitlab!18059", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T12:08:06.998Z", "updated_at": "2019-10-03T12:08:07.001Z", "system": true, "noteable_id": 25582670, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 213}], [{"id": 225589657, "type": null, "body": "mentioned in merge request !340", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T13:20:14.990Z", "updated_at": "2019-10-03T13:20:14.992Z", "system": true, "noteable_id": 25582670, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 213}], [{"id": 225590759, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T13:21:51.393Z", "updated_at": "2019-10-03T13:21:51.396Z", "system": true, "noteable_id": 25582670, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 213}], [{"id": 225595167, "type": null, "body": "mentioned in merge request gitlab-development-kit!837", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T13:30:02.790Z", "updated_at": "2019-10-03T13:30:02.794Z", "system": true, "noteable_id": 25582670, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 213}], [{"id": 225861416, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-10-04T02:01:29.611Z", "updated_at": "2019-10-04T02:01:29.615Z", "system": true, "noteable_id": 25582670, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 213}], [{"id": 226075603, "type": null, "body": "(Unassigning myself, as I'm focusing on runtime at the moment, not build-time)", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-04T11:45:56.849Z", "updated_at": "2019-10-04T11:45:56.849Z", "system": false, "noteable_id": 25582670, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 213}], [{"id": 226075627, "type": null, "body": "unassigned @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-04T11:45:59.719Z", "updated_at": "2019-10-04T11:45:59.723Z", "system": true, "noteable_id": 25582670, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 213}], [{"id": 228142977, "type": null, "body": "mentioned in merge request !338", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-09T14:09:39.273Z", "updated_at": "2019-10-09T14:09:39.276Z", "system": true, "noteable_id": 25582670, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 213}], [{"id": 230372746, "type": null, "body": "mentioned in merge request !346", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-15T05:09:11.185Z", "updated_at": "2019-10-15T05:09:11.188Z", "system": true, "noteable_id": 25582670, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 213}]]}, {"id": 25251084, "iid": 212, "project_id": 14022, "title": "Remove commandargs.GenericArgs", "description": "The following discussion from !336 should be addressed:\n\n- [ ] @reprazent started a [discussion](https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/336#note_221233310):  (+1 comment)\n\n    > Did we consider removing `commandargs.GenericArgs`? If I understood correctly, those were only really needed for the `fallback_test`. Or do we think they might add value somewhere else?", "state": "opened", "created_at": "2019-09-24T15:29:41.246Z", "updated_at": "2019-09-25T02:20:33.628Z", "closed_at": null, "closed_by": null, "labels": ["devops::create", "group::source code", "technical debt"], "milestone": {"id": 490705, "iid": 14, "group_id": 9970, "title": "Backlog", "description": "Issues that we want to do but are not planned right now. Open for contribution from the community.", "state": "active", "created_at": "2018-03-22T13:09:23.767Z", "updated_at": "2018-10-30T14:56:54.069Z", "due_date": null, "start_date": null, "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/14"}, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 4, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/212", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 1, "completed_count": 0}, "has_tasks": true, "task_status": "0 of 1 task completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/212", "notes": "https://gitlab.com/api/v4/projects/14022/issues/212/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/212/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 221341712, "type": "DiscussionNote", "body": "@igor.drozdov You probably know more about this, should we remove that code as well?", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-09-24T15:43:04.651Z", "updated_at": "2019-09-24T16:10:11.664Z", "system": false, "noteable_id": 25251084, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 212}, {"id": 221354178, "type": "DiscussionNote", "body": "@reprazent according to the code, I think you're right! But I see that @patrickbajao is the one who created it, let's probably ask him to be sure :sweat_smile:", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-09-24T16:10:11.587Z", "updated_at": "2019-09-24T16:10:11.587Z", "system": false, "noteable_id": 25251084, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 212}, {"id": 221611764, "type": "DiscussionNote", "body": "@igor.drozdov @reprazent yup, we can remove it. We'll need to update the `commandargs.Parse` method to return an error (or `nil`) and  `command.New` function to handle that accordingly.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-09-25T02:20:33.571Z", "updated_at": "2019-09-25T02:20:33.571Z", "system": false, "noteable_id": 25251084, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 212}], [{"id": 221341713, "type": null, "body": "changed milestone to %\"Backlog\"", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-09-24T15:43:04.878Z", "updated_at": "2019-09-24T15:43:04.880Z", "system": true, "noteable_id": 25251084, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 212}], [{"id": 221554838, "type": null, "body": "Setting ~\"devops::create\" based on ~\"group::source code\".", "attachment": null, "author": {"id": 1786152, "name": "\ud83e\udd16 GitLab Bot \ud83e\udd16", "username": "gitlab-bot", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1786152/avatar.png", "web_url": "https://gitlab.com/gitlab-bot"}, "created_at": "2019-09-25T00:30:09.352Z", "updated_at": "2019-09-25T00:30:09.352Z", "system": false, "noteable_id": 25251084, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 212}]]}, {"id": 25200986, "iid": 211, "project_id": 14022, "title": "go.mod out-of-date?", "description": "I am updating the [NixOS packaging](https://github.com/NixOS/nixpkgs/pull/69325) of `gitlab-shell` 10.0.0 and am encountering some rather suspicious-looking errors:\r\n```\r\n# gitlab.com/gitlab-org/gitlab-shell/go/internal/handler\r\ngo/src/gitlab.com/gitlab-org/gitlab-shell/go/internal/handler/exec.go:117:20: cannot use \"google.golang.org/grpc\".WithPerRPCCredentials(gitalyauth.RPCCredentialsV2(gc.Token)) (type \"google.golang.org/grpc\".DialOption) as type \"gitlab.com/gitlab-org/gitaly/vendor/google.golang.org/grpc\".DialOption in append:\r\n\t\"google.golang.org/grpc\".DialOption does not implement \"gitlab.com/gitlab-org/gitaly/vendor/google.golang.org/grpc\".DialOption (missing \"gitlab.com/gitlab-org/gitaly/vendor/google.golang.org/grpc\".apply method)\r\ngo/src/gitlab.com/gitlab-org/gitlab-shell/go/internal/handler/exec.go:154:31: cannot use conn (type *\"gitlab.com/gitlab-org/gitaly/vendor/google.golang.org/grpc\".ClientConn) as type *\"google.golang.org/grpc\".ClientConn in field value\r\ngo/src/gitlab.com/gitlab-org/gitlab-shell/go/internal/handler/receive_pack.go:17:27: cannot use conn (type *\"google.golang.org/grpc\".ClientConn) as type *\"gitlab.com/gitlab-org/gitaly/vendor/google.golang.org/grpc\".ClientConn in argument to client.ReceivePack\r\ngo/src/gitlab.com/gitlab-org/gitlab-shell/go/internal/handler/receive_pack.go:17:27: cannot use request (type *\"gitlab.com/gitlab-org/gitaly-proto/go/gitalypb\".SSHReceivePackRequest) as type *\"gitlab.com/gitlab-org/gitaly/vendor/gitlab.com/gitlab-org/gitaly-proto/go/gitalypb\".SSHReceivePackRequest in argument to client.ReceivePack\r\ngo/src/gitlab.com/gitlab-org/gitlab-shell/go/internal/handler/upload_archive.go:17:29: cannot use conn (type *\"google.golang.org/grpc\".ClientConn) as type *\"gitlab.com/gitlab-org/gitaly/vendor/google.golang.org/grpc\".ClientConn in argument to client.UploadArchive\r\ngo/src/gitlab.com/gitlab-org/gitlab-shell/go/internal/handler/upload_archive.go:17:29: cannot use request (type *\"gitlab.com/gitlab-org/gitaly-proto/go/gitalypb\".SSHUploadArchiveRequest) as type *\"gitlab.com/gitlab-org/gitaly/vendor/gitlab.com/gitlab-org/gitaly-proto/go/gitalypb\".SSHUploadArchiveRequest in argument to client.UploadArchive\r\ngo/src/gitlab.com/gitlab-org/gitlab-shell/go/internal/handler/upload_pack.go:17:26: cannot use conn (type *\"google.golang.org/grpc\".ClientConn) as type *\"gitlab.com/gitlab-org/gitaly/vendor/google.golang.org/grpc\".ClientConn in argument to client.UploadPack\r\ngo/src/gitlab.com/gitlab-org/gitlab-shell/go/internal/handler/upload_pack.go:17:26: cannot use request (type *\"gitlab.com/gitlab-org/gitaly-proto/go/gitalypb\".SSHUploadPackRequest) as type *\"gitlab.com/gitlab-org/gitaly/vendor/gitlab.com/gitlab-org/gitaly-proto/go/gitalypb\".SSHUploadPackRequest in argument to client.UploadPack\r\n```\r\n\r\nThis appears to be due to the fact that `go/go.mod` claims to need `gitaly` 1.7.0, which included a vendored `grpc`. However, `go/internal/handler/exec.go` appears to be written with the assumption that `gitaly`'s interface uses the types exposed by unvendored `grpc` (namely `google.golang.org/grpc`).\r\n\r\nGiven that newer `gitaly` releases appear to have moved away from vendoring `grpc` I would guess that the dependency versions given in `go/go.mod` are out-of-date.\r\n\r\nCCing @jacobvosmaer-gitlab", "state": "opened", "created_at": "2019-09-24T01:23:38.160Z", "updated_at": "2019-10-04T18:41:26.930Z", "closed_at": null, "closed_by": null, "labels": ["bug", "devops::create", "group::source code"], "milestone": null, "assignees": [], "author": {"id": 608291, "name": "Ben Gamari", "username": "bgamari", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/974f9a321ceb2dcd06a667a379d176fd?s=80&d=identicon", "web_url": "https://gitlab.com/bgamari"}, "assignee": null, "user_notes_count": 6, "merge_requests_count": 0, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/211", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/211", "notes": "https://gitlab.com/api/v4/projects/14022/issues/211/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/211/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 220937097, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 608291, "name": "Ben Gamari", "username": "bgamari", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/974f9a321ceb2dcd06a667a379d176fd?s=80&d=identicon", "web_url": "https://gitlab.com/bgamari"}, "created_at": "2019-09-24T01:24:35.754Z", "updated_at": "2019-09-24T01:24:35.758Z", "system": true, "noteable_id": 25200986, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 211}], [{"id": 221122040, "type": null, "body": "@bgamari I'm not sure what is going on there. In our CI, we had no issues doing the build with go mod on either Go 1.11 or Go 1.12. https://gitlab.com/gitlab-org/gitlab-shell/-/jobs/287331714", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2019-09-24T10:18:41.208Z", "updated_at": "2019-09-24T10:18:41.208Z", "system": false, "noteable_id": 25200986, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 211}], [{"id": 223598640, "type": "DiscussionNote", "body": "Dear @jacobvosmaer-gitlab I see a similar problem with building gitlab-shell, but on FreeBSD.\nI get the following error message:\n```\n===>  Building for gitlab-shell-10.0.0\n(cd /wrkdirs/usr/ports/devel/gitlab-shell/work/gitlab-shell-996b2e1d44cc671cc60fd4ddacd2c5750b72a025-996b2e1d44cc671cc60fd4ddacd2c5750b72a025; /usr/bin/env GOFLAGS=\"-v -buildmode=exe -mod=vendor\" XDG_DATA_HOME=/wrkdirs/usr/ports/devel/gitlab-shell/work  XDG_CONFIG_HOME=/wrkdirs/usr/ports/devel/gitlab-shell/work  HOME=/wrkdirs/usr/ports/devel/gitlab-shell/work TMPDIR=\"/tmp\" PATH=/usr/local/libexec/ccache:/wrkdirs/usr/ports/devel/gitlab-shell/work/.bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin:/root/bin NO_PIE=yes MK_DEBUG_FILES=no MK_KERNEL_SYMBOLS=no SHELL=/bin/sh NO_LINT=YES PREFIX=/usr/local  LOCALBASE=/usr/local  CC=\"cc\" CFLAGS=\"-O2 -pipe  -fstack-protector-strong -fno-strict-aliasing \"  CPP=\"cpp\" CPPFLAGS=\"\"  LDFLAGS=\" -fstack-protector-strong \" LIBS=\"\"  CXX=\"c++\" CXXFLAGS=\"-O2 -pipe -fstack-protector-strong -fno-strict-aliasing  \"  MANPREFIX=\"/usr/local\" CCACHE_DIR=\"/root/.ccache\" BSD_INSTALL_PROGRAM=\"install  -s -m 555\"  BSD_INSTALL_LIB=\"install  -s -m 0644\"  BSD_INSTALL_SCRIPT=\"install  -m 555\"  BSD_INSTALL_DATA=\"install  -m 0644\"  BSD_INSTALL_MAN=\"install  -m 444\" bin/compile)\nbuild gitlab.com/gitlab-org/gitaly-proto/go/gitalypb: cannot load gitlab.com/gitlab-org/gitaly-proto/go/gitalypb: open /wrkdirs/usr/ports/devel/gitlab-shell/work/gitlab-shell-996b2e1d44cc671cc60fd4ddacd2c5750b72a025-996b2e1d44cc671cc60fd4ddacd2c5750b72a025/go/vendor/gitlab.com/gitlab-org/gitaly-proto/go/gitalypb: no such file or directory\ncommand failed: {\"GOBIN\"=>\"/wrkdirs/usr/ports/devel/gitlab-shell/work/gitlab-shell-996b2e1d44cc671cc60fd4ddacd2c5750b72a025-996b2e1d44cc671cc60fd4ddacd2c5750b72a025/go_build/bin\", \"GO111MODULE\"=>\"on\", \"GOPROXY\"=>\"https://proxy.golang.org\"} go install ./cmd/...\n*** Error code 1\n```\n\nI checked you linked job and saw there some inconsistencies.\nGitlab requires ruby 2.6, see here: https://about.gitlab.com/2019/08/22/gitlab-12-2-released/\nBut you use 2.5.\n\nI use go 1.13, is this maybe a problem?", "attachment": null, "author": {"id": 1200309, "name": "Matthias Fechner", "username": "mfechner", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/aab3e919f7c466b677b7e8f000b1ce3e?s=80&d=identicon", "web_url": "https://gitlab.com/mfechner"}, "created_at": "2019-09-29T22:51:57.961Z", "updated_at": "2019-09-30T10:02:44.913Z", "system": false, "noteable_id": 25200986, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 211}, {"id": 223784361, "type": "DiscussionNote", "body": "It looks like gitlab-shell's CI tests against Go 1.13 https://gitlab.com/gitlab-org/gitlab-shell/blob/master/.gitlab-ci.yml#L94-96\n\nI don't see how the Ruby version would cause a problem here.\n\nFrom your error:\n\n```\nopen /wrkdirs/usr/ports/devel/gitlab-shell/work/gitlab-shell-996b2e1d44cc671cc60fd4ddacd2c5750b72a025-996b2e1d44cc671cc60fd4ddacd2c5750b72a025/go/vendor/gitlab.com/gitlab-org/gitaly-proto/go/gitalypb: no such file or directory\n```\n\nWhy is that using a /vendor path?", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2019-09-30T10:02:44.842Z", "updated_at": "2019-09-30T10:02:44.842Z", "system": false, "noteable_id": 25200986, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 211}], [{"id": 225220900, "type": null, "body": "The problem in the case of NixOS was the vendored copy of `gitaly` present in the `gitlab-shell` tree.  We now work around this by deleting the vendored copy during the build: https://github.com/NixOS/nixpkgs/pull/70216/files#diff-4cb81df288767c7a74685cbd0303c4e9R25.", "attachment": null, "author": {"id": 608291, "name": "Ben Gamari", "username": "bgamari", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/974f9a321ceb2dcd06a667a379d176fd?s=80&d=identicon", "web_url": "https://gitlab.com/bgamari"}, "created_at": "2019-10-02T19:38:11.940Z", "updated_at": "2019-10-02T19:38:11.940Z", "system": false, "noteable_id": 25200986, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 211}], [{"id": 226138622, "type": null, "body": "For FreeBSD it is fixed as well, this issue can maybe be closed?", "attachment": null, "author": {"id": 1200309, "name": "Matthias Fechner", "username": "mfechner", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/aab3e919f7c466b677b7e8f000b1ce3e?s=80&d=identicon", "web_url": "https://gitlab.com/mfechner"}, "created_at": "2019-10-04T13:37:54.836Z", "updated_at": "2019-10-04T13:37:54.836Z", "system": false, "noteable_id": 25200986, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 211}], [{"id": 226261237, "type": null, "body": "Is this fixed in the latest gitlab-shell release / gitlab-shell master?", "attachment": null, "author": {"id": 424592, "name": "Florian Klink", "username": "flokli", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0e621f3de56b799e7efda22eacc55d93?s=80&d=identicon", "web_url": "https://gitlab.com/flokli"}, "created_at": "2019-10-04T18:41:26.912Z", "updated_at": "2019-10-04T18:41:26.912Z", "system": false, "noteable_id": 25200986, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 211}]]}, {"id": 24747528, "iid": 210, "project_id": 14022, "title": "Remove Action::Custom#inform_client once 12.3 has been released", "description": "Remove `inform_client(info_message)` (and related code from https://gitlab.com/gitlab-org/gitlab-shell/blob/master/lib%2Faction%2Fcustom.rb#L27 once 12.3 has been released.\n\nRelated: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/334 & https://gitlab.com/gitlab-org/gitlab-ee/merge_requests/16584", "state": "opened", "created_at": "2019-09-13T05:22:40.735Z", "updated_at": "2019-09-13T05:23:37.474Z", "closed_at": null, "closed_by": null, "labels": ["backstage", "devops::enablement", "group::geo"], "milestone": {"id": 731039, "iid": 38, "group_id": 9970, "title": "12.4", "description": "", "state": "active", "created_at": "2018-12-07T12:41:53.212Z", "updated_at": "2019-09-20T21:21:22.813Z", "due_date": "2019-10-17", "start_date": "2019-09-18", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/38"}, "assignees": [{"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}], "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "assignee": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/210", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/210", "notes": "https://gitlab.com/api/v4/projects/14022/issues/210/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/210/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 1, "epic_iid": null, "discussion": [[{"id": 216592048, "type": null, "body": "changed milestone to %\"12.4\"", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-09-13T05:22:40.798Z", "updated_at": "2019-09-13T05:22:40.801Z", "system": true, "noteable_id": 24747528, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 210}], [{"id": 216592049, "type": null, "body": "changed weight to **1**", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-09-13T05:22:40.844Z", "updated_at": "2019-09-13T05:22:40.847Z", "system": true, "noteable_id": 24747528, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 210}], [{"id": 216592145, "type": null, "body": "mentioned in merge request !334", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-09-13T05:23:13.579Z", "updated_at": "2019-09-13T05:23:13.581Z", "system": true, "noteable_id": 24747528, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 210}], [{"id": 216592205, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-09-13T05:23:37.532Z", "updated_at": "2019-09-13T05:23:37.535Z", "system": true, "noteable_id": 24747528, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 210}]]}, {"id": 24294142, "iid": 209, "project_id": 14022, "title": "Remove legacy bin/authorized_keys script", "description": "As we found out in https://gitlab.com/gitlab-org/gitlab-shell/issues/202#note_209895450, there's a legacy script that behaves the same way as `gitlab-shell-authorized-keys-check` but it only requires the key as parameter.\n\nIt's been replaced by `gitlab-shell-authorized-keys-check` in https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/178.\n\nWe are currently using the legacy script in our infrastructure and most likely self-managed installs are also using the old recommendation as well. We need to find a way for smooth transition for these instances.", "state": "opened", "created_at": "2019-08-29T14:10:28.934Z", "updated_at": "2019-09-05T15:36:58.726Z", "closed_at": null, "closed_by": null, "labels": ["backstage"], "milestone": null, "assignees": [], "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/209", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/209", "notes": "https://gitlab.com/api/v4/projects/14022/issues/209/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/209/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": 706, "discussion": [[{"id": 212439440, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-09-04T15:40:05.681Z", "updated_at": "2019-09-04T15:40:05.684Z", "system": true, "noteable_id": 24294142, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 209}], [{"id": 213023591, "type": null, "body": "mentioned in issue create-stage#22", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-09-05T15:36:58.695Z", "updated_at": "2019-09-05T15:36:58.698Z", "system": true, "noteable_id": 24294142, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 209}]]}, {"id": 23832680, "iid": 208, "project_id": 14022, "title": "GitLab config: Failures in job 'codequality' cannot fail the build", "description": "To fully benefit from the advantages of CI/CD, developers need to follow certain principles. Many of these principles have been introduced in the landmark book [Continuous Delivery: Reliable Software Releases through Build, Test, and Deployment Automation](https://www.oreilly.com/library/view/continuous-delivery-reliable/9780321670250/) and are nowadays widely accepted. One of these principles is:\n\n> Every executed job should be able to fail the build.\nIf not, developers can miss or ignore the underlying issue, which adds technical debt and might result in problems later.\n\n**Problem**: We analyzed your project and found that the file [.gitlab-ci.yml](https://gitlab.com/gitlab-org/gitlab-shell/blob/master/.gitlab-ci.yml#L94) (line 94) violates this principle. Failures of job `codequality` (in stage `test`), cannot fail the build:\n\n```\ncodequality:\n    ...\n    allow_failure: true\n    ...\n```\n\n**Suggested Fix:** To follow the principle, you should set ```allow_failure: false```.\n\n**Disclaimer:**\nThis issue has been automatically reported by [CD-Linter](https://bitbucket.org/sealuzh/cd-linter/), a tool developed at the [University of Zurich](https://www.uzh.ch/) that detects CI/CD violations in the GitLab CI/CD pipeline configuration.\nWe are currently evaluating the effectiveness of our tool and we are monitoring this issue.\n\n*Please up/downvote this issue to indicate whether you agree/disagree with the report.*", "state": "opened", "created_at": "2019-08-16T08:39:51.333Z", "updated_at": "2019-08-23T09:59:33.848Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}], "author": {"id": 2153531, "name": "Sebastian P.", "username": "proksch", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2153531/avatar.png", "web_url": "https://gitlab.com/proksch"}, "assignee": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/208", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/208", "notes": "https://gitlab.com/api/v4/projects/14022/issues/208/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/208/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 207149412, "type": null, "body": "assigned to @ashmckenzie", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-08-23T05:10:53.333Z", "updated_at": "2019-08-23T05:10:53.337Z", "system": true, "noteable_id": 23832680, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 208}], [{"id": 207149413, "type": null, "body": "Thanks for the heads up @proksch \ud83d\ude42  We'll look into it \ud83d\ude42", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-08-23T05:10:54.254Z", "updated_at": "2019-08-23T05:10:54.254Z", "system": false, "noteable_id": 23832680, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 208}], [{"id": 207270253, "type": null, "body": "Great. :) We think that if a project cares about a property of the system, violations of this property should be able to fail the build. However, it is a bit hard to differentiate true and false warning in cases like this, because the judgement depends on the project.  We are looking forward to seeing how you assess the report.", "attachment": null, "author": {"id": 2153531, "name": "Sebastian P.", "username": "proksch", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2153531/avatar.png", "web_url": "https://gitlab.com/proksch"}, "created_at": "2019-08-23T09:59:33.823Z", "updated_at": "2019-08-23T09:59:33.823Z", "system": false, "noteable_id": 23832680, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 208}]]}, {"id": 23830644, "iid": 207, "project_id": 14022, "title": "Add a single binary to reduce binaries size", "description": "We currently have 3 binaries: `gitlab-shell`, `gitlab-shell-authorized-keys-check` and `gitlab-shell-authorized-principals-check`.\n\nThey all have duplicated code found in `go/cmd/gitlab-shell`, `go/cmd/gitlab-shell-authorized-keys-check`, and `go/cmd/gitlab-shell-authorized-principals-check`.\n\nA suggestion from @nick.thomas in https://gitlab.com/gitlab-org/gitlab-shell/issues/206#note_203979135 is to have a single binary that accepts the executable name as an argument. Then we can have 3 small shell scripts that uses that and pass the arguments.", "state": "opened", "created_at": "2019-08-16T08:09:17.162Z", "updated_at": "2019-10-04T03:40:57.168Z", "closed_at": null, "closed_by": null, "labels": ["backstage"], "milestone": null, "assignees": [], "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/207", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/207", "notes": "https://gitlab.com/api/v4/projects/14022/issues/207/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/207/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 204344430, "type": null, "body": "mentioned in issue #206", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-16T08:09:32.290Z", "updated_at": "2019-08-16T08:09:32.295Z", "system": true, "noteable_id": 23830644, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 207}], [{"id": 204803470, "type": null, "body": "mentioned in issue gl-retrospectives/create-stage/source-code#2", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-17T23:39:17.039Z", "updated_at": "2019-08-17T23:39:17.042Z", "system": true, "noteable_id": 23830644, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 207}], [{"id": 204906843, "type": null, "body": "A boring solution for now would be to use [UPX](https://upx.github.io/).  We can save ~45% at the cost of slightly slower startup speeds:\n\n```sh\n$ ls -la gitaly-receive-pack gitaly-upload-archive gitaly-upload-pack gitlab-shell gitlab-shell-authorized-keys-check gitlab-shell-authorized-principals-check\n13.9 MB gitaly-receive-pack\n13.9 MB gitaly-upload-archive\n13.9 MB gitaly-upload-pack\n14.2 MB gitlab-shell\n14.2 MB gitlab-shell-authorized-keys-check\n14.2 MB gitlab-shell-authorized-principals-check\n\n$ upx gitaly-receive-pack gitaly-upload-archive gitaly-upload-pack gitlab-shell gitlab-shell-authorized-keys-check gitlab-shell-authorized-principals-check\n                       Ultimate Packer for eXecutables\n                          Copyright (C) 1996 - 2018\nUPX 3.95        Markus Oberhumer, Laszlo Molnar & John Reiser   Aug 26th 2018\n\n        File size         Ratio      Format      Name\n   --------------------   ------   -----------   -----------\n  14593380 ->   6729744   46.12%   macho/amd64   gitaly-receive-pack\n  14593396 ->   6729744   46.11%   macho/amd64   gitaly-upload-archive\n  14593364 ->   6578192   45.08%   macho/amd64   gitaly-upload-pack\n  14904500 ->   6873104   46.11%   macho/amd64   gitlab-shell\n  14904500 ->   6873104   46.11%   macho/amd64   gitlab-shell-authorized-keys-check\n  14904500 ->   6873104   46.11%   macho/amd64   gitlab-shell-authorized-principals-check\n   --------------------   ------   -----------   -----------\n  88493640 ->  40656992   45.94%                 [ 6 files ]\n\nPacked 6 files.\n\n$ ls -la gitaly-receive-pack gitaly-upload-archive gitaly-upload-pack gitlab-shell gitlab-shell-authorized-keys-check gitlab-shell-authorized-principals-check\n6.4 MB gitaly-receive-pack\n6.4 MB gitaly-upload-archive\n6.3 MB gitaly-upload-pack\n6.6 MB gitlab-shell\n6.6 MB gitlab-shell-authorized-keys-check\n6.6 MB gitlab-shell-authorized-principals-check\n```\n\nI've suggested this for go based binaries in the past but did not receive any interest however.", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-08-19T00:05:44.794Z", "updated_at": "2019-08-19T00:05:44.794Z", "system": false, "noteable_id": 23830644, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 207}], [{"id": 225880358, "type": null, "body": "mentioned in merge request !341", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-10-04T03:40:57.137Z", "updated_at": "2019-10-04T03:40:57.140Z", "system": true, "noteable_id": 23830644, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 207}]]}, {"id": 23801520, "iid": 206, "project_id": 14022, "title": "gitlab-shell-authorized-keys-check and gitlab-shell-authorized-principals-check symlinks wont work correctly on other OS", "description": "As of this writing, we currently have `gitlab-shell-authorized-keys-check` and `gitlab-shell-authorized-principals-check` as symlinks of `gitlab-shell` binary.\n\nIn `Executable`, we [detect the `Name`](https://gitlab.com/gitlab-org/gitlab-shell/blob/master/go/internal/executable/executable.go#L25-42) and use that name for determining what `Command` and `CommandArgs` to build or what ruby fallback executable should be used. We use `os.Executable()` for that.\n\n[`os.Executable()` doc](https://golang.org/pkg/os/#Executable) has a \"fine print\" saying:\n\n> If a symlink was used to start the process, depending on the operating system, the result might be the symlink or the path it pointed to.\n\nSo depending on the OS, the `Executable`'s `Name` can always be `gitlab-shell` which will result to a bug as the correct command won't be built and fallback will fail as it'll always fallback to `gitlab-shell-ruby`.\n\nThis small test code can also confirm this behavior: https://gitlab.com/patrickbajao/symlink-test. When ran on a `golang:alpine` Docker image, it'll print out `test` when `symlink` is executed.", "state": "closed", "created_at": "2019-08-15T09:17:28.392Z", "updated_at": "2019-08-17T23:35:54.653Z", "closed_at": "2019-08-15T11:03:23.313Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["bug"], "milestone": null, "assignees": [], "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "assignee": null, "user_notes_count": 6, "merge_requests_count": 1, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/206", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/206", "notes": "https://gitlab.com/api/v4/projects/14022/issues/206/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/206/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 203944523, "type": null, "body": "@ashmckenzie here's the issue based on our investigation/discussion.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-15T09:17:55.431Z", "updated_at": "2019-08-15T09:17:55.431Z", "system": false, "noteable_id": 23801520, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 206}], [{"id": 203949283, "type": null, "body": "@ashmckenzie @nick.thomas since this means that the symlink approach isn't feasible, WDYT about creating binaries for `gitlab-shell-authorized-keys-check` and `gitlab-shell-authorized-principals-check` instead?\n\nAs a quick fix, we can copy `go/cmd/gitlab-shell` as `go/cmd/gitlab-shell-authorized-keys-check` and `go/cmd/gitlab-shell-authorized-principals-check`. That's duplication galore but I believe this is causing a failure in nightly build. We can improve it afterwards.\n\n@nick.thomas I know you wanted to keep the binary size as small as possible but it seems we can't do that approach anymore. Open for suggestions though.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-15T09:29:22.651Z", "updated_at": "2019-08-15T09:29:22.651Z", "system": false, "noteable_id": 23801520, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 206}], [{"id": 203963404, "type": null, "body": "mentioned in merge request !324", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-15T10:11:31.484Z", "updated_at": "2019-08-15T10:11:31.487Z", "system": true, "noteable_id": 23801520, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 206}], [{"id": 203977640, "type": null, "body": "Oh, that's exciting :( thanks for tracking this down @ashmckenzie @patrickbajao \n\nYeah, I think this means we need to introduce additional go binaries and just take increase in disk space and package size that that implies. Sorry for not spotting the issue!", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-08-15T11:02:01.410Z", "updated_at": "2019-08-15T11:02:01.410Z", "system": false, "noteable_id": 23801520, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 206}], [{"id": 203978013, "type": null, "body": "closed via commit 81f5854513a527c3a00398e91930a12ebad70272", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-08-15T11:03:23.383Z", "updated_at": "2019-08-15T11:03:23.386Z", "system": true, "noteable_id": 23801520, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 206}], [{"id": 203979135, "type": "DiscussionNote", "body": "OK, I've merged the quick fix in question.\n\nI wonder if, in the medium term, we could have a single `gitlab-shell-service` binary and small shell scripts for each of the three functions we want that simply call it with an additional parameter that determines the mode. We don't need to look at it now though.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-08-15T11:07:34.786Z", "updated_at": "2019-08-16T08:05:05.149Z", "system": false, "noteable_id": 23801520, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 206}, {"id": 204341653, "type": "DiscussionNote", "body": "I think that can work. It's somehow the same as my initial thoughts (https://gitlab.com/gitlab-org/gitlab-shell/issues/181#note_189770071) before went with the implementation. The difference is that instead we'll have a more generic executable instead of `gitlab-shell`.\n\nI'll file an issue for this so we won't forget.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-16T08:05:04.853Z", "updated_at": "2019-08-16T08:05:04.853Z", "system": false, "noteable_id": 23801520, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 206}, {"id": 204344333, "type": "DiscussionNote", "body": "Issue filed here: https://gitlab.com/gitlab-org/gitlab-shell/issues/207.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-16T08:09:28.204Z", "updated_at": "2019-08-16T08:09:28.204Z", "system": false, "noteable_id": 23801520, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 206}], [{"id": 204344161, "type": null, "body": "mentioned in issue #207", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-16T08:09:21.784Z", "updated_at": "2019-08-16T08:09:21.788Z", "system": true, "noteable_id": 23801520, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 206}], [{"id": 204803386, "type": null, "body": "mentioned in issue gl-retrospectives/create-stage/source-code#2", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-17T23:35:54.631Z", "updated_at": "2019-08-17T23:35:54.635Z", "system": true, "noteable_id": 23801520, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 206}]]}, {"id": 23726789, "iid": 205, "project_id": 14022, "title": "Add methods to extract values from Arguments", "description": "Currently, `commandargs.AuthorizedKeys` and `commandargs.AuthorizedPrincipals` will get their properties assigned in \ntheir `Parse()` methods.\n\nWe get the values from the `Arguments` property which we also access when validating them in `validate()`.\n\nTo make them a bit DRYer, add methods instead of directly accessing `Arguments`.\n\n---\n\nThe following discussion from !322 should be addressed:\n\nFrom https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/322#note_202968166:\n\n> @patrickbajao:\n>\n> WDYT about applying the same pattern to `commandargs.AuthorizedKeys` too? I can do it in this MR too.\n\n**Context**\n\n    > WDYT about adding `keyIdFromArgs()` & `principalsFromArgs()` and calling instead of accessing `ap.Arguments` directly twice? e.g.\n    > \n    > ```golang\n    > func (ap *AuthorizedPrincipals) Parse() error {\n    >         // ...\n    > \tap.KeyId = ap.keyIdFromArgs()\n    > \tap.Principals = ap.principalsFromArgs()\n    >         // ...\n    > }\n    > \n    > func (ap *AuthorizedPrincipals) keyIdFromArgs() string {\n    > \treturn ap.Arguments[0]\n    > }\n    > \n    > func (ap *AuthorizedPrincipals) principalsFromArgs() []string {\n    > \treturn ap.Arguments[1:]\n    > }\n    > \n    > func (ap *AuthorizedPrincipals) validate() error {\n    >         // ...\n    > \tif ap.keyIdFromArgs() == \"\" {\n    >         // ...\n    > \n    >         for _, principal := range ap.principalsFromArgs() {\n    >         // ...\n    > }\n    > \n    > ```", "state": "opened", "created_at": "2019-08-13T06:35:42.919Z", "updated_at": "2019-08-14T00:36:58.760Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/205", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/205", "notes": "https://gitlab.com/api/v4/projects/14022/issues/205/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/205/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 203410143, "type": null, "body": "mentioned in merge request !322", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-14T00:31:07.898Z", "updated_at": "2019-08-14T00:31:07.903Z", "system": true, "noteable_id": 23726789, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 205}], [{"id": 203410614, "type": null, "body": "changed title from **{-Follow-up from \"Implement AuthorizedPrincipals command\"-}** to **{+Add methods to extract values from arguments+}**", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-14T00:36:10.295Z", "updated_at": "2019-08-14T00:36:10.302Z", "system": true, "noteable_id": 23726789, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 205}], [{"id": 203410615, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-14T00:36:10.352Z", "updated_at": "2019-08-14T00:36:10.359Z", "system": true, "noteable_id": 23726789, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 205}], [{"id": 203410701, "type": null, "body": "changed title from **Add methods to extract values from {-a-}rguments** to **Add methods to extract values from {+A+}rguments**", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-14T00:36:58.966Z", "updated_at": "2019-08-14T00:36:58.975Z", "system": true, "noteable_id": 23726789, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 205}], [{"id": 203410711, "type": null, "body": "Thanks for filing this issue @ashmckenzie. Changed the title and description a bit to add some more context. :slight_smile:", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-14T00:37:08.247Z", "updated_at": "2019-08-14T00:37:08.247Z", "system": false, "noteable_id": 23726789, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 205}]]}, {"id": 23559765, "iid": 204, "project_id": 14022, "title": "Handle errors returned by the API in `gitlab-shell-authorized-keys-check` differently", "description": "As of this writing, when the `/api/v4/internal/authorized_keys` API returns a non-200 response (e.g. 404, 403, 500, etc), the `gitlab-shell-authorized-keys-check` script will treat it as the key wasn't found and write `# No key was found for <insert key ID>\\n` to STDOUT. That will result for the user to be denied.\n\nWe can handle the other errors to print out a different message or exit code (which is related to https://gitlab.com/gitlab-org/gitlab-shell/issues/201).\n\n---\n\nThe following discussion from !321 should be addressed:\n\n- [ ] @reprazent started a [discussion](https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/321#note_200258541):  (+2 comments)\n\n    > Ah, I see now, is that the way we _have_ to deal with this because the ruby implementation does? Or do you think we can do better already?", "state": "opened", "created_at": "2019-08-07T05:45:08.177Z", "updated_at": "2019-08-08T01:00:19.734Z", "closed_at": null, "closed_by": null, "labels": ["Create [DEPRECATED]", "devops::create", "group::source code", "technical debt"], "milestone": {"id": 490705, "iid": 14, "group_id": 9970, "title": "Backlog", "description": "Issues that we want to do but are not planned right now. Open for contribution from the community.", "state": "active", "created_at": "2018-03-22T13:09:23.767Z", "updated_at": "2018-10-30T14:56:54.069Z", "due_date": null, "start_date": null, "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/14"}, "assignees": [], "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 2, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/204", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 1, "completed_count": 0}, "has_tasks": true, "task_status": "0 of 1 task completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/204", "notes": "https://gitlab.com/api/v4/projects/14022/issues/204/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/204/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 201115721, "type": null, "body": "changed milestone to %\"Backlog\"", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-08-07T12:15:48.315Z", "updated_at": "2019-08-07T12:15:48.317Z", "system": true, "noteable_id": 23559765, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 204}]]}, {"id": 23553979, "iid": 203, "project_id": 14022, "title": "gitlab-shell.log doesn't differentiate between deploy keys and user keys", "description": "As part of our increased security monitoring, we have started parsing our on-prem GitLab logs. One of the things we're gathering is the last time a user has accessed the system.\n\nUnfortunately, it appears that gitlab-shell.log associates accesses by deployment keys to the user who created them, even if that user is blocked from accessing gitlab. This makes it impossible to tell the difference between an access from a user key, and access from a deployment key.\n\n```\ntime=\"2019-08-06T16:30:27-04:00\" level=info msg=\"executing git command\" command=\"gitaly-upload-pack unix:/var/opt/gitlab/gitaly/gitaly.socket {\\\"repository\\\":{\\\"storage_name\\\":\\\"default\\\",\\\"relative_path\\\":\\\"MyGroup/MyRepo.git\\\",\\\"git_object_directory\\\":\\\"\\\",\\\"git_alternate_object_directories\\\":[],\\\"gl_repository\\\":\\\"project-437\\\",\\\"gl_project_name\\\":\\\"\\\"},\\\"gl_repository\\\":\\\"project-437\\\",\\\"gl_id\\\":\\\"key-168\\\",\\\"gl_username\\\":\\\"myuser\\\",\\\"git_config_options\\\":[],\\\"git_protocol\\\":null}\" pid=30257 user=\"user with id key-168\"\n```\n\nIn the above example, `key-168` is not one of `myuser`'s keys, but the access is still logged under their name. I suspect that the user may have created this deployment key prior to leaving the company, which is why this association is happening.\n\nIs this intentional, and if so, would it be possible to add another field to the log output that denotes this event was from a deployment key rather than a user key? Without such a field, it looks like terminated/blocked users are accessing our system, which should be impossible.", "state": "opened", "created_at": "2019-08-06T21:09:22.253Z", "updated_at": "2019-09-19T05:00:43.708Z", "closed_at": null, "closed_by": null, "labels": ["Observability"], "milestone": {"id": 731039, "iid": 38, "group_id": 9970, "title": "12.4", "description": "", "state": "active", "created_at": "2018-12-07T12:41:53.212Z", "updated_at": "2019-09-20T21:21:22.813Z", "due_date": "2019-10-17", "start_date": "2019-09-18", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/38"}, "assignees": [{"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}], "author": {"id": 1190363, "name": "Rob Petti", "username": "rpetti", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/fd63c55f558091c2027388ff356058cb?s=80&d=identicon", "web_url": "https://gitlab.com/rpetti"}, "assignee": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "user_notes_count": 1, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/203", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/203", "notes": "https://gitlab.com/api/v4/projects/14022/issues/203/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/203/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 2, "epic_iid": null, "discussion": [[{"id": 200934885, "type": null, "body": "I'll look into this \ud83d\ude42", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-08-07T03:53:00.040Z", "updated_at": "2019-08-07T03:53:00.040Z", "system": false, "noteable_id": 23553979, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 203}], [{"id": 200934886, "type": null, "body": "assigned to @ashmckenzie", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-08-07T03:53:00.154Z", "updated_at": "2019-08-07T03:53:00.157Z", "system": true, "noteable_id": 23553979, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 203}], [{"id": 211174640, "type": null, "body": "mentioned in merge request !332", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-09-02T13:13:55.732Z", "updated_at": "2019-09-02T13:13:55.735Z", "system": true, "noteable_id": 23553979, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 203}], [{"id": 211175316, "type": null, "body": "changed milestone to %\"12.3\"", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-09-02T13:15:19.690Z", "updated_at": "2019-09-02T13:15:19.694Z", "system": true, "noteable_id": 23553979, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 203}], [{"id": 211175336, "type": null, "body": "changed weight to **2**", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-09-02T13:15:22.015Z", "updated_at": "2019-09-02T13:15:22.019Z", "system": true, "noteable_id": 23553979, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 203}], [{"id": 219127656, "type": null, "body": "changed milestone to %\"12.4\"", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-09-19T05:00:43.742Z", "updated_at": "2019-09-19T05:00:43.745Z", "system": true, "noteable_id": 23553979, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 203}]]}, {"id": 23499513, "iid": 202, "project_id": 14022, "title": "Enable more Golang-migrated features on live environments", "description": "Just like what we did in https://gitlab.com/gitlab-org/gitlab-shell/issues/186, we should also enable the Golang-migrated features once this issue is closed: https://gitlab.com/gitlab-org/gitlab-shell/issues/181.\n\nEnable the following features:\n- `gitlab-shell-authorized-keys-check`\n- `gitlab-shell-authorized-principals-check`\n\nEnable and test them first on dev, staging, then production.", "state": "closed", "created_at": "2019-08-05T10:44:40.488Z", "updated_at": "2019-09-16T02:56:28.249Z", "closed_at": "2019-09-16T02:56:28.101Z", "closed_by": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "labels": ["Deliverable", "backend", "backstage", "devops::create", "group::source code"], "milestone": {"id": 731038, "iid": 37, "group_id": 9970, "title": "12.3", "description": "", "state": "closed", "created_at": "2018-12-07T12:40:55.400Z", "updated_at": "2019-09-23T17:14:54.242Z", "due_date": "2019-09-17", "start_date": "2019-08-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/37"}, "assignees": [{"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}], "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "assignee": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "user_notes_count": 19, "merge_requests_count": 0, "upvotes": 2, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/202", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/202", "notes": "https://gitlab.com/api/v4/projects/14022/issues/202/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/202/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 2, "epic_iid": 706, "discussion": [[{"id": 200131248, "type": "DiscussionNote", "body": "@DouweM @nick.thomas @ashmckenzie @reprazent @igor.drozdov \n\nWDYT about doing this first before we actually remove the ruby implementations (https://gitlab.com/gitlab-org/gitlab-shell/issues/173)? It's the same process that we did for the gitlab-shell commands.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-05T10:46:27.972Z", "updated_at": "2019-08-05T11:17:30.572Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}, {"id": 200144074, "type": "DiscussionNote", "body": "@patrickbajao I agree, I think we definitely should enable these features _before_ we remove their previous implementations. At the same time, we can consider removing the Ruby implementation for the features which Golang versions are already up-and-running for a couple of releases and creating a separate issue for removing the features that are to be enabled in the near future, wdyt?", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-08-05T11:17:30.487Z", "updated_at": "2019-08-05T11:17:30.487Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}, {"id": 200228840, "type": "DiscussionNote", "body": "@patrickbajao Good call! I've moved https://gitlab.com/gitlab-org/gitlab-shell/issues/173 to %\"12.4\", and this one into %\"12.3\", alongside https://gitlab.com/gitlab-org/gitlab-ce/issues/60071.\n\n---\n\n> At the same time, we can consider removing the Ruby implementation for the features which Golang versions are already up-and-running for a couple of releases and creating a separate issue for removing the features that are to be enabled in the near future, wdyt?\n\n@igor.drozdov We could, but since it doesn't really hurt to have the Ruby implementations for the up-and-running features around a little longer, I don't think there's much advantage in doing it in two steps instead of all at once.", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-08-05T14:13:38.375Z", "updated_at": "2019-08-05T14:13:38.375Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 200225649, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-08-05T14:07:37.127Z", "updated_at": "2019-08-05T14:07:37.132Z", "system": true, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 200226456, "type": null, "body": "changed weight to **3**", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-08-05T14:08:57.410Z", "updated_at": "2019-08-05T14:08:57.416Z", "system": true, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 200228855, "type": null, "body": "changed milestone to %\"12.3\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-08-05T14:13:40.172Z", "updated_at": "2019-08-05T14:13:40.176Z", "system": true, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 200573615, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-06T08:41:02.252Z", "updated_at": "2019-08-06T08:41:02.261Z", "system": true, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 201315437, "type": null, "body": "mentioned in issue #173", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-08-07T20:20:44.736Z", "updated_at": "2019-08-07T20:20:44.740Z", "system": true, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 201316360, "type": null, "body": "changed weight to **2**", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-08-07T20:23:59.492Z", "updated_at": "2019-08-07T20:23:59.495Z", "system": true, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 201335292, "type": null, "body": "assigned to @patrickbajao", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-08-07T21:53:47.640Z", "updated_at": "2019-08-07T21:53:47.645Z", "system": true, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 205787869, "type": null, "body": "mentioned in merge request !325", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-20T12:58:16.986Z", "updated_at": "2019-08-20T12:58:16.994Z", "system": true, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 207138932, "type": null, "body": "@nick.thomas @ashmckenzie would you know if we have the fast lookup feature (https://docs.gitlab.com/ee/administration/operations/fast_ssh_key_lookup.html) enabled on `dev` and `gstg`? I'm thinking if we can test the `gitlab-shell-authorized-keys-check` works (with feature flag enabled) on those environments. If not, then it might be useless to enable the feature flag on that environment (we should probably skip it and enable it directly on `gprd`).\n\nFor testing `gitlab-shell-authorized-principals-check`, I don't think it's enabled in any of our live environments since we don't have that use case (I could be wrong though). So we won't be able to test that live (I did test it locally).\n\nAlso, I'm looking at metrics to look at when this gets enabled on any of the specified environments. I found these:\n- https://dashboards.gitlab.net/d/-UvftW1iz/ssh-performance?orgId=1&refresh=5m&from=now-7d&to=now (this keeps timing out on me)\n- https://dashboards.gitlab.net/d/mDACpJJiz/gitlab-shell?orgId=1&refresh=1m&var-environment=gprd&from=now-7d&to=now (check if there is unusual increase in 404 or 500 for `authorized_keys` request).\n\nThey don't include the `dev` env but I don't think it's a big deal. If it's confirmed working on dev (assuming I can test the feature there), then we can test it further on staging and get some metrics.\n\n@igor.drozdov since you last did this for the other migrated features, do you know of other metrics we can look at?", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-23T03:57:37.117Z", "updated_at": "2019-08-23T04:01:50.608Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 207279342, "type": "DiscussionNote", "body": "@patrickbajao that feature *must* be enabled on staging (since it's a HA deploy with multiple nodes). I don't know about dev, but I suspect it would be too.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-08-23T10:20:08.826Z", "updated_at": "2019-08-27T07:31:50.137Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}, {"id": 208437722, "type": "DiscussionNote", "body": "Yup, you're right @nick.thomas, it must be enabled on staging since they have the same topology as prod mentioned [here](https://about.gitlab.com/handbook/engineering/infrastructure/environments/#staging).\n\nAbout dev, I also asked it here: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1689#note_31688.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-27T07:31:49.966Z", "updated_at": "2019-08-27T07:31:49.966Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 208406200, "type": null, "body": "MR created to enable features on dev: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1689.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-27T06:10:11.673Z", "updated_at": "2019-08-27T06:10:11.673Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 209118990, "type": null, "body": "Tested SSH features on dev (discover, git clone/push/pull) and they're all working. Not seeing any 500s from logs (https://nonprod-log.gitlab.net/goto/99f054b38bf10da16453b282fbaaba01).\n\nI went ahead and opened an MR to enable features on gstg: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1694.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-28T10:08:49.675Z", "updated_at": "2019-08-28T10:08:49.675Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 209895450, "type": "DiscussionNote", "body": "Just an update, after enabling the features on staging, I am still seeing `Ruby` as UA for requests to `/authorized_keys`. After discussing things with @nick.thomas, there's some legacy setup related to using `AuthorizedKeysCommand` in gstg and gprd.\n\nWe have [this recipe](https://ops.gitlab.net/gitlab-cookbooks/gitlab-openssh/blob/master/recipes/authorized_keys.rb) that sets up sshd's `AuthorizedKeysCommand` and creates a `/opt/gitlab-shell/authorized_keys` wrapper script. The [wrapper script](https://ops.gitlab.net/gitlab-cookbooks/gitlab-openssh/blob/master/files/default/authorized_keys) calls `/opt/gitlab/embedded/service/gitlab-shell/bin/authorized_keys` which is another ruby script in gitlab-shell. That said script is calling the `/authorized_keys` API endpoint using the ruby code.\n\nThat is the reason why I was still seeing `Ruby` as UA.\n\nQuick fix for this is to modify that script to use the new `gitlab-shell-authorized-keys-check` and use `git` as expected and actual username params. That way there's only SSOT for authorized keys request even though there are other entry points.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-29T13:39:37.944Z", "updated_at": "2019-08-29T14:44:24.826Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}, {"id": 209970914, "type": "DiscussionNote", "body": "Opened an MR for the quick fix: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/330.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-29T14:44:24.647Z", "updated_at": "2019-08-29T14:44:24.647Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 209925346, "type": null, "body": "mentioned in issue #209", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-29T14:10:36.912Z", "updated_at": "2019-08-29T14:10:36.939Z", "system": true, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 209936214, "type": null, "body": "mentioned in merge request !330", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-29T14:14:52.560Z", "updated_at": "2019-08-29T14:14:52.577Z", "system": true, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 210223034, "type": null, "body": "mentioned in merge request !331", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-30T06:51:19.881Z", "updated_at": "2019-08-30T06:51:19.885Z", "system": true, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 212809707, "type": null, "body": "mentioned in issue create-stage#22", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-09-05T09:34:56.860Z", "updated_at": "2019-09-05T09:34:56.864Z", "system": true, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 212814931, "type": "DiscussionNote", "body": "Just some update again...\n\ngitlab-shell v9.4.2 (containing the fix mentioned in https://gitlab.com/gitlab-org/gitlab-shell/issues/202#note_209895450) is now up on staging. But I did hit another weird behavior on staging as I'm not always seeing `Go` as UA for `/api/v4/internal/authorized_keys` requests (still investigating how this is happening).\n\nAs of this writing the remaining tasks are:\n1. Once gitlab-shell v9.4.2 or above is deployed to gprd, open a change request to apply the chef changes (MR: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1770) and schedule it. Something like this: https://gitlab.com/gitlab-com/gl-infra/production/issues/866.\n1. After the changes have been applied, test SSH features on production (discover, git clone/push/pull). Must show `Go-http-client/1.1` as UA consistently (for `authorized_keys` requests) and no 500 errors (logs: https://log.gitlab.net/goto/2b867ba9782c3e8416d86565e69dbcc4).", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-09-05T09:45:08.701Z", "updated_at": "2019-09-05T13:22:46.341Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}, {"id": 212821413, "type": "DiscussionNote", "body": "Hi @igor.drozdov, do you think you can take over this issue starting next week? :slight_smile:\n\nAsking because I'll be out next week (will be back on Sep 16). I'll still investigate the weird issue and will do the remaining tasks before I go OOO (will update the task list if ever).", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-09-05T09:57:50.700Z", "updated_at": "2019-09-05T09:57:50.700Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}, {"id": 212826053, "type": "DiscussionNote", "body": "/cc @DouweM", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-09-05T10:07:38.349Z", "updated_at": "2019-09-05T10:07:38.349Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}, {"id": 212931181, "type": "DiscussionNote", "body": "> But I did hit another weird behavior on staging as I'm not always seeing `Go` as UA for `/api/v4/internal/authorized_keys` requests (still investigating how this is happening).\n\nThis has been resolved. Apparently, one of the staging nodes didn't have an up to date config because chef didn't run. All is good now. I was able to test on staging and it's now working! :tada: \n\nI also prepared the MR for enabling features on gprd: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1770.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-09-05T13:22:05.575Z", "updated_at": "2019-09-05T13:22:05.575Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}, {"id": 212998090, "type": "DiscussionNote", "body": "> do you think you can take over this issue starting next week?\n\n@patrickbajao sure! as far as I understand, everything is fine on staging and all the MRs have been created, we only need to supervise whether that everything is fine on prod when these MRs are merged, right?", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-09-05T14:48:57.130Z", "updated_at": "2019-09-05T14:48:57.130Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}, {"id": 213011910, "type": "DiscussionNote", "body": "Thanks a lot @igor.drozdov! Really appreciate it! :bow: \n\nYup, staging is all good.\n\nFor production, I updated the remaining tasks above.\n\nA change request needs to be scheduled to apply the chef changes (https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1770, it's WIP right now to indicate that it's waiting for a change request). The CR can be filed once gitlab-shell version is also updated on production (that'll likely be on next deploy to production, maybe Monday, next week).\n\nOnce chef changes on production are applied, we need to test that SSH (`ssh git@gitlab.com`) and  git clone/push/pull via Git SSH still work as expected.\n\nAfter that, we need to check whether it's not causing any API calls to internal API return a 500 status.\n\nI think that's kind of the same thing you did when you enabled some of the migrated features too. :slight_smile: \n\nHope I was able to explain the remaining tasks clearly. :smile:", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-09-05T15:12:34.971Z", "updated_at": "2019-09-05T15:12:34.971Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 213013405, "type": null, "body": "assigned to @igor.drozdov", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-09-05T15:15:32.449Z", "updated_at": "2019-09-05T15:15:32.454Z", "system": true, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 216592613, "type": null, "body": "Just dropping by to point out this delightful graph from the git front-end servers in production before + after this code was enabled:\n![image](/uploads/eb513d00a7b9911877530e1f1543fde7/image.png)\n\n*Spectacular* result for load, and thus headroom/capacity.  Thanks to all involved.", "attachment": null, "author": {"id": 3623028, "name": "Craig Miskell", "username": "cmiskell", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/852a93b505b1f4a5549595792035f445?s=80&d=identicon", "web_url": "https://gitlab.com/cmiskell"}, "created_at": "2019-09-13T05:25:51.110Z", "updated_at": "2019-09-13T05:25:51.110Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 216652001, "type": null, "body": "You can also see the base line latency (10th quantile) drop by about 250ms. For our 50th quantile request, that's about 20% faster.\n\n![image](/uploads/4ccc19c004072e83b1d2d31968053b54/image.png)", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2019-09-13T08:21:01.678Z", "updated_at": "2019-09-13T08:21:01.678Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 217326375, "type": null, "body": "Closing this as the changes are now up on production and verified working. :tada:\n\nThanks again @igor.drozdov for taking over this issue while I'm out. :bow:", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-09-16T02:56:24.579Z", "updated_at": "2019-09-16T02:56:24.579Z", "system": false, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}], [{"id": 217326382, "type": null, "body": "closed", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-09-16T02:56:28.319Z", "updated_at": "2019-09-16T02:56:28.326Z", "system": true, "noteable_id": 23499513, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 202}]]}, {"id": 23482360, "iid": 201, "project_id": 14022, "title": "Faling calls for authorized-keys and authorized-pricipals should exit with a non-zero exit status", "description": "Currently calling `bin/authorized-keys` and `bin/authorized-principals` could fail, printing out an error message, but still exit with `0`.\n\nPerhaps we should exit with a different status in case of a failure.\n____\nThe following discussion from !318 should be addressed:\n\n- [ ] @ashmckenzie started a [discussion](https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/318#note_199983060): \n\n    > Despite this being the existing behaviour (of exiting with `0`), I feel this is incorrect and should be a non `0`.\n\n* https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/318#note_199983060\n* https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/318#note_199983059\n* https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/318#note_199983058", "state": "opened", "created_at": "2019-08-05T04:55:31.914Z", "updated_at": "2019-08-07T05:45:14.304Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}], "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "assignee": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "user_notes_count": 4, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/201", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 1, "completed_count": 0}, "has_tasks": true, "task_status": "0 of 1 task completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/201", "notes": "https://gitlab.com/api/v4/projects/14022/issues/201/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/201/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 1, "epic_iid": null, "discussion": [[{"id": 199983256, "type": null, "body": "assigned to @ashmckenzie", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-08-05T04:56:06.782Z", "updated_at": "2019-08-05T04:56:06.785Z", "system": true, "noteable_id": 23482360, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 201}], [{"id": 199983281, "type": null, "body": "mentioned in merge request !318", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-08-05T04:56:21.899Z", "updated_at": "2019-08-05T04:56:21.902Z", "system": true, "noteable_id": 23482360, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 201}], [{"id": 199983310, "type": null, "body": "changed weight to **1**", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-08-05T04:56:41.207Z", "updated_at": "2019-08-05T04:56:41.211Z", "system": true, "noteable_id": 23482360, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 201}], [{"id": 199984098, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-08-05T05:02:41.755Z", "updated_at": "2019-08-05T05:02:41.758Z", "system": true, "noteable_id": 23482360, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 201}], [{"id": 199991840, "type": "DiscussionNote", "body": "@ashmckenzie in this MR for migrating `gitlab-shell-authorized-keys-check` to Go (https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/321), it's still implementing the existing behavior of exiting with `0`. I think we should hold off on working on this until that MR is merged?", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-05T05:42:14.259Z", "updated_at": "2019-08-05T05:45:06.533Z", "system": false, "noteable_id": 23482360, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 201}, {"id": 199992308, "type": "DiscussionNote", "body": "Sure, I wasn't going to create an MR any time soon \ud83d\ude42  \n\nPerhaps it's worth even discussing if it's worth doing?  Returning `1` (or non `0`) for the lines linked in the description seems logical but I'd rather like to avoid breaking anything by changing it! \ud83d\ude42", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-08-05T05:45:06.438Z", "updated_at": "2019-08-05T05:45:06.438Z", "system": false, "noteable_id": 23482360, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 201}], [{"id": 200466264, "type": null, "body": "mentioned in merge request !321", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-06T06:16:22.900Z", "updated_at": "2019-08-06T06:16:22.904Z", "system": true, "noteable_id": 23482360, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 201}], [{"id": 200782831, "type": null, "body": "changed title from **F{-ollow-up from \"Support falling back to ruby version of checkers\"-}** to **F{+aling calls for authorized-keys and authorized-pricipals should exit with a non-zero exit status+}**", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-08-06T15:50:17.538Z", "updated_at": "2019-08-06T15:50:17.542Z", "system": true, "noteable_id": 23482360, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 201}], [{"id": 200782832, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-08-06T15:50:17.574Z", "updated_at": "2019-08-06T15:50:17.577Z", "system": true, "noteable_id": 23482360, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 201}], [{"id": 200783556, "type": "DiscussionNote", "body": "@ashmckenzie I've added a bit of info to the issue description, it wasn't quite clear for me what the existing behaviour was versus where we're going without clicking the links. I hope you don't mind. Feel free to update if I got it wrong.\n\nI personally do think it's worth doing, after we've migrated from ruby and we check that the caller doesn't do anything unexpected when we do.", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-08-06T15:52:07.635Z", "updated_at": "2019-08-07T02:45:55.545Z", "system": false, "noteable_id": 23482360, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 201}, {"id": 200925500, "type": "DiscussionNote", "body": "Perfect, thanks @reprazent :bow:", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-08-07T02:45:55.445Z", "updated_at": "2019-08-07T02:45:55.445Z", "system": false, "noteable_id": 23482360, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 201}], [{"id": 200952306, "type": null, "body": "mentioned in issue #204", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-07T05:45:14.177Z", "updated_at": "2019-08-07T05:45:14.183Z", "system": true, "noteable_id": 23482360, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 201}]]}, {"id": 22607663, "iid": 200, "project_id": 14022, "title": "Find out why `internal/allowed` is still receiving calls from Ruby on production", "description": "After https://gitlab.com/gitlab-org/gitlab-shell/issues/195, we would expect to see no more calls to `internal/allowed` with a `Ruby` user agent,   but we are still seeing a small but consistent number of them anyway: https://log.gitlab.net/goto/d8abb7949d58d33764a661fb8485b87f\n\n![Captura_de_pantalla_2019-07-08_a_la_s__18.16.34](/uploads/6c2d041fa88b41c49664edb60e4b17e3/Captura_de_pantalla_2019-07-08_a_la_s__18.16.34.png)\n\nWhy is this still happening?", "state": "closed", "created_at": "2019-07-08T16:17:54.382Z", "updated_at": "2019-07-10T13:55:34.551Z", "closed_at": "2019-07-10T13:55:34.399Z", "closed_by": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "labels": ["Create [DEPRECATED]", "backend", "devops::create", "group::source code"], "milestone": {"id": 693521, "iid": 35, "group_id": 9970, "title": "12.2", "description": "", "state": "closed", "created_at": "2018-10-30T16:48:32.567Z", "updated_at": "2019-08-23T03:57:07.884Z", "due_date": "2019-08-22", "start_date": "2019-07-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/35"}, "assignees": [], "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/200", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/200", "notes": "https://gitlab.com/api/v4/projects/14022/issues/200/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/200/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": 706, "discussion": [[{"id": 189510916, "type": null, "body": "changed milestone to %\"12.2\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-07-08T16:17:54.547Z", "updated_at": "2019-07-08T16:17:54.554Z", "system": true, "noteable_id": 22607663, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 200}], [{"id": 189514254, "type": null, "body": "mentioned in issue #195", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-07-08T16:28:18.890Z", "updated_at": "2019-07-08T16:28:18.898Z", "system": true, "noteable_id": 22607663, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 200}], [{"id": 190382125, "type": null, "body": "It looks like these requests are coming from the `pre-receive` hook. The hooks have been moved to Gitaly, but have not yet been ported to Golang, hence the Ruby user agent (https://gitlab.com/gitlab-org/gitaly/issues/1226)", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-07-10T13:55:33.705Z", "updated_at": "2019-07-10T13:55:33.705Z", "system": false, "noteable_id": 22607663, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 200}], [{"id": 190382142, "type": null, "body": "closed", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-07-10T13:55:34.697Z", "updated_at": "2019-07-10T13:55:34.706Z", "system": true, "noteable_id": 22607663, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 200}]]}, {"id": 22458792, "iid": 199, "project_id": 14022, "title": "enable logging of src IP, user and project for ssh requests in gitlab-shell", "description": "When getting massive amounts of git ssh requests to one project, causing performance degradation on file-servers, we currently can't determine which user is doing those requests or from which src IP they are coming to block them in case of abuse (see https://gitlab.com/gitlab-com/gl-infra/production/issues/932 as an example case).\n\nHAProxy is logging src IPs of ssh requests but no further data. gitlab-shell is logging the ssh keys (from which we can determine the user) but no src IP or project. Rails is only logging the project but not user or src IP. There is no way for a correlation between those and we can't find a user or src IP to block if we see a lot of ssh requests go against a single repository on a file server.\n\nPlease add logging of project, user (and src IP if possible) to gitlab-shell.", "state": "opened", "created_at": "2019-07-02T18:57:04.811Z", "updated_at": "2019-09-03T14:09:07.604Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 3059703, "name": "Henri Philipps", "username": "hphilipps", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3059703/avatar.png", "web_url": "https://gitlab.com/hphilipps"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 2, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/199", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/199", "notes": "https://gitlab.com/api/v4/projects/14022/issues/199/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/199/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 188216247, "type": null, "body": "I'm not quite sure how we can get the IP. `gitlab-shell` is run by `sshd`, which doesn't appear to have a way to hand the IP address. From the `sshd_config`:\n\n```\n             Arguments to AuthorizedKeysCommand may be provided using the following tokens, which will be expanded at runtime: %%\n             is replaced by a literal '%', %u is replaced by the username being authenticated, %h is replaced by the home directory\n             of the user being authenticated, %t is replaced with the key type offered for authentication, %f is replaced with the\n             fingerprint of the key, and %k is replaced with the key being offered for authentication.  If no arguments are speci\u2010\n             fied then the username of the target user will be supplied.\n```\n\nBut perhaps we need better logging for user and project in `/api/v4/internal/allowed` and `/api/v4/internal/authorized_keys`.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2019-07-03T23:37:04.758Z", "updated_at": "2019-07-03T23:37:04.758Z", "system": false, "noteable_id": 22458792, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 199}]]}, {"id": 22322820, "iid": 198, "project_id": 14022, "title": "Update .PHONY to have accurate list of targets", "description": "https://gitlab.com/gitlab-org/gitlab-shell/blob/master/Makefile#L1 currently has:\n\n`.PHONY: test test_ruby test_ruby_rubocop test_ruby_rspec test_go test_go_format test_go_test`\n\nwhich is not accurate as some of the targets no longer exist and there are also new ones.", "state": "closed", "created_at": "2019-06-27T14:35:17.190Z", "updated_at": "2019-07-01T10:26:16.893Z", "closed_at": "2019-07-01T10:26:16.817Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": [], "milestone": {"id": 693520, "iid": 34, "group_id": 9970, "title": "12.1", "description": "", "state": "closed", "created_at": "2018-10-30T16:47:58.826Z", "updated_at": "2019-07-24T03:11:16.593Z", "due_date": "2019-07-22", "start_date": "2019-06-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/34"}, "assignees": [{"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}], "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "assignee": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/198", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/198", "notes": "https://gitlab.com/api/v4/projects/14022/issues/198/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/198/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 1, "epic_iid": null, "discussion": [[{"id": 186144090, "type": null, "body": "changed milestone to %\"12.1\"", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-27T14:35:17.298Z", "updated_at": "2019-06-27T14:35:17.302Z", "system": true, "noteable_id": 22322820, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 198}], [{"id": 186144092, "type": null, "body": "changed weight to **1**", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-27T14:35:17.353Z", "updated_at": "2019-06-27T14:35:17.356Z", "system": true, "noteable_id": 22322820, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 198}], [{"id": 186145354, "type": null, "body": "mentioned in merge request !316", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-27T14:37:48.073Z", "updated_at": "2019-06-27T14:37:48.076Z", "system": true, "noteable_id": 22322820, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 198}], [{"id": 187007558, "type": null, "body": "closed via merge request !316", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-07-01T10:26:17.052Z", "updated_at": "2019-07-01T10:26:17.056Z", "system": true, "noteable_id": 22322820, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 198}], [{"id": 187007600, "type": null, "body": "mentioned in commit 5b8e04fbc8ff4ca866dea4c97c881db7e8b087bb", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-07-01T10:26:23.206Z", "updated_at": "2019-07-01T10:26:23.250Z", "system": true, "noteable_id": 22322820, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 198}]]}, {"id": 22322639, "iid": 197, "project_id": 14022, "title": "Rework or remove `bin/check`", "description": "The following discussion from !310 should be addressed:\n\n- [ ] @nick.thomas started a [discussion](https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/310#note_186118718):  (+2 comments)\n\n    > We don't talk to redis any more. \"redis via internal API\" is a bit of an implementation detail, so I'd just leave this at\n    > \n    > > Checks reachability of the configured GitLab internal API endpoint\n    > \n    > or so", "state": "opened", "created_at": "2019-06-27T14:28:47.286Z", "updated_at": "2019-06-27T14:28:47.286Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/197", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 1, "completed_count": 0}, "has_tasks": true, "task_status": "0 of 1 task completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/197", "notes": "https://gitlab.com/api/v4/projects/14022/issues/197/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/197/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 21877059, "iid": 196, "project_id": 14022, "title": "Go implementation for sshserver", "description": "Go implementation for sshserver which supports publickey and kerberos authorization", "state": "opened", "created_at": "2019-06-13T13:14:29.996Z", "updated_at": "2019-06-17T12:07:31.390Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 4140753, "name": "yanweizhi", "username": "yanweizhi", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/895de3b82ab80466d9c16ae2438d041c?s=80&d=identicon", "web_url": "https://gitlab.com/yanweizhi"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/196", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/196", "notes": "https://gitlab.com/api/v4/projects/14022/issues/196/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/196/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 181261582, "type": null, "body": "https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/314", "attachment": null, "author": {"id": 4140753, "name": "yanweizhi", "username": "yanweizhi", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/895de3b82ab80466d9c16ae2438d041c?s=80&d=identicon", "web_url": "https://gitlab.com/yanweizhi"}, "created_at": "2019-06-14T03:20:58.290Z", "updated_at": "2019-06-14T03:20:58.290Z", "system": false, "noteable_id": 21877059, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 196}], [{"id": 181997172, "type": null, "body": "@yanweizhi as far as I understand it, this is a request for an SSH server process that could replace `openssh`, right? I.e., this issue is essentially a duplicate of https://gitlab.com/gitlab-org/gitlab-shell/issues/165 ?", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-17T12:07:31.349Z", "updated_at": "2019-06-17T12:07:31.349Z", "system": false, "noteable_id": 21877059, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 196}]]}, {"id": 21635970, "iid": 195, "project_id": 14022, "title": "Enable Golang-migrated features on live environments", "description": "With https://gitlab.com/gitlab-org/gitlab-shell/issues/160 https://gitlab.com/gitlab-org/gitlab-shell/issues/161 https://gitlab.com/gitlab-org/gitlab-shell/issues/162 https://gitlab.com/gitlab-org/gitlab-shell/issues/163 closed we can try and enable these features on live envs: dev, staging, canary, and production.\n\nWe should roll the features out across these environments in order, verifying that everything works correctly at each before moving on to the next.", "state": "closed", "created_at": "2019-06-06T10:44:17.235Z", "updated_at": "2019-07-09T07:20:38.452Z", "closed_at": "2019-06-27T12:52:33.012Z", "closed_by": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "labels": ["Create [DEPRECATED]", "Deliverable", "backend", "backstage", "devops::create", "group::source code", "workflow::verification"], "milestone": {"id": 693520, "iid": 34, "group_id": 9970, "title": "12.1", "description": "", "state": "closed", "created_at": "2018-10-30T16:47:58.826Z", "updated_at": "2019-07-24T03:11:16.593Z", "due_date": "2019-07-22", "start_date": "2019-06-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/34"}, "assignees": [{"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}], "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "assignee": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "user_notes_count": 5, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/195", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/195", "notes": "https://gitlab.com/api/v4/projects/14022/issues/195/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/195/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 2, "epic_iid": 706, "discussion": [[{"id": 178540423, "type": null, "body": "changed milestone to %\"12.1\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-06-06T10:56:11.547Z", "updated_at": "2019-06-06T10:56:11.550Z", "system": true, "noteable_id": 21635970, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 195}], [{"id": 178540424, "type": null, "body": "changed weight to **2**", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-06-06T10:56:11.620Z", "updated_at": "2019-06-06T10:56:11.627Z", "system": true, "noteable_id": 21635970, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 195}], [{"id": 178549726, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-06-06T11:21:22.510Z", "updated_at": "2019-06-06T11:21:22.513Z", "system": true, "noteable_id": 21635970, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 195}], [{"id": 178604878, "type": null, "body": "assigned to @igor.drozdov", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-06-06T13:28:24.257Z", "updated_at": "2019-06-06T13:28:24.263Z", "system": true, "noteable_id": 21635970, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 195}], [{"id": 180580234, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-12T14:35:06.863Z", "updated_at": "2019-06-12T14:35:06.868Z", "system": true, "noteable_id": 21635970, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 195}], [{"id": 180581416, "type": null, "body": "Enabled for dev.gitlab.org: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1217", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-12T14:36:13.859Z", "updated_at": "2019-06-12T14:36:13.859Z", "system": false, "noteable_id": 21635970, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 195}], [{"id": 182445091, "type": null, "body": "Enabled for staging.gitlab.com: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1243", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-18T09:24:21.824Z", "updated_at": "2019-06-18T09:24:21.824Z", "system": false, "noteable_id": 21635970, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 195}], [{"id": 186047528, "type": null, "body": "Enabled for gitlab.com: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1302", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-27T11:42:56.111Z", "updated_at": "2019-06-27T11:42:56.111Z", "system": false, "noteable_id": 21635970, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 195}], [{"id": 186081586, "type": null, "body": "Going to monitor it from time to time, but seems fine :tada:  https://log.gitlab.net/goto/2dd10aa78caa5b86284e39f19396bd2a", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-27T12:52:31.852Z", "updated_at": "2019-06-27T12:52:31.852Z", "system": false, "noteable_id": 21635970, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 195}], [{"id": 186081607, "type": null, "body": "closed", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-27T12:52:33.690Z", "updated_at": "2019-06-27T12:52:33.694Z", "system": true, "noteable_id": 21635970, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 195}], [{"id": 189484508, "type": null, "body": "@igor.drozdov We're still seeing a small but constant amount of calls with `json.ua` `Ruby`: https://log.gitlab.net/goto/d8abb7949d58d33764a661fb8485b87f\n\nWhy would that be?\n\nEdit: Let's figure this out in https://gitlab.com/gitlab-org/gitlab-shell/issues/200!", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-07-08T15:41:12.259Z", "updated_at": "2019-07-08T16:28:18.546Z", "system": false, "noteable_id": 21635970, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 195}], [{"id": 189510937, "type": null, "body": "mentioned in issue #200", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-07-08T16:17:58.421Z", "updated_at": "2019-07-08T16:17:58.430Z", "system": true, "noteable_id": 21635970, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 195}], [{"id": 189694098, "type": null, "body": "mentioned in issue gl-retrospectives/create-stage/source-code#1", "attachment": null, "author": {"id": 1786152, "name": "\ud83e\udd16 GitLab Bot \ud83e\udd16", "username": "gitlab-bot", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1786152/avatar.png", "web_url": "https://gitlab.com/gitlab-bot"}, "created_at": "2019-07-09T07:20:38.390Z", "updated_at": "2019-07-09T07:20:38.394Z", "system": true, "noteable_id": 21635970, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 195}]]}, {"id": 21583549, "iid": 194, "project_id": 14022, "title": "Add Makefile to make things easier", "description": "As gitlab-shell moves more into a golang based app than Ruby, I feel the addition of a `Makefile` is worthy.", "state": "closed", "created_at": "2019-06-04T23:57:01.725Z", "updated_at": "2019-06-27T14:45:52.462Z", "closed_at": "2019-06-27T14:30:51.775Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": [], "milestone": {"id": 693520, "iid": 34, "group_id": 9970, "title": "12.1", "description": "", "state": "closed", "created_at": "2018-10-30T16:47:58.826Z", "updated_at": "2019-07-24T03:11:16.593Z", "due_date": "2019-07-22", "start_date": "2019-06-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/34"}, "assignees": [{"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}], "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "assignee": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/194", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/194", "notes": "https://gitlab.com/api/v4/projects/14022/issues/194/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/194/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 1, "epic_iid": null, "discussion": [[{"id": 177990134, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-04T23:57:01.761Z", "updated_at": "2019-06-04T23:57:01.765Z", "system": true, "noteable_id": 21583549, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 194}], [{"id": 177992104, "type": null, "body": "mentioned in merge request !310", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-05T00:09:31.510Z", "updated_at": "2019-06-05T00:09:31.514Z", "system": true, "noteable_id": 21583549, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 194}], [{"id": 181795249, "type": null, "body": "changed milestone to %\"12.1\"", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-16T23:04:58.436Z", "updated_at": "2019-06-16T23:04:58.439Z", "system": true, "noteable_id": 21583549, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 194}], [{"id": 183008469, "type": null, "body": "changed weight to **1**", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-19T11:34:07.145Z", "updated_at": "2019-06-19T11:34:07.148Z", "system": true, "noteable_id": 21583549, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 194}], [{"id": 186141808, "type": null, "body": "closed via merge request !310", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-27T14:30:51.885Z", "updated_at": "2019-06-27T14:30:51.890Z", "system": true, "noteable_id": 21583549, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 194}], [{"id": 186141821, "type": null, "body": "mentioned in commit 7b23c6f01c06de45e97f49ab0557e551a6c1edf0", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-27T14:30:52.725Z", "updated_at": "2019-06-27T14:30:52.729Z", "system": true, "noteable_id": 21583549, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 194}], [{"id": 186149070, "type": null, "body": "mentioned in merge request !316", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-27T14:45:52.426Z", "updated_at": "2019-06-27T14:45:52.430Z", "system": true, "noteable_id": 21583549, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 194}]]}, {"id": 21583365, "iid": 193, "project_id": 14022, "title": "Check whether the root directory is valid in the golang implementation", "description": "The following discussion from !309 should be addressed:\n\n- [ ] @nick.thomas started a [discussion](https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/309#note_177798421):  (+1 comment)\n\n    > I seem to recall making this suggestion before, but we don't validate the directory returned from `findRootDir()` is a valid, existing directory on disk. I feel we should add validation here.", "state": "closed", "created_at": "2019-06-04T23:42:56.916Z", "updated_at": "2019-08-12T00:01:33.596Z", "closed_at": "2019-08-12T00:01:33.519Z", "closed_by": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "labels": [], "milestone": {"id": 693520, "iid": 34, "group_id": 9970, "title": "12.1", "description": "", "state": "closed", "created_at": "2018-10-30T16:47:58.826Z", "updated_at": "2019-07-24T03:11:16.593Z", "due_date": "2019-07-22", "start_date": "2019-06-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/34"}, "assignees": [{"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}], "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "assignee": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/193", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 1, "completed_count": 0}, "has_tasks": true, "task_status": "0 of 1 task completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/193", "notes": "https://gitlab.com/api/v4/projects/14022/issues/193/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/193/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 1, "epic_iid": null, "discussion": [[{"id": 177989612, "type": null, "body": "mentioned in merge request !309", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-04T23:52:32.113Z", "updated_at": "2019-06-04T23:52:32.116Z", "system": true, "noteable_id": 21583365, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 193}], [{"id": 177993322, "type": null, "body": "assigned to @ashmckenzie", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-05T00:12:53.761Z", "updated_at": "2019-06-05T00:12:53.765Z", "system": true, "noteable_id": 21583365, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 193}], [{"id": 177993327, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-05T00:12:58.227Z", "updated_at": "2019-06-05T00:12:58.232Z", "system": true, "noteable_id": 21583365, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 193}], [{"id": 177993828, "type": null, "body": "mentioned in merge request !311", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-05T00:18:38.015Z", "updated_at": "2019-06-05T00:18:38.018Z", "system": true, "noteable_id": 21583365, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 193}], [{"id": 178148083, "type": null, "body": "changed title from **{-Follow-up from \"Respect GITLAB_SHELL_DIR in the Go version\"-}** to **{+Check whether the root directory is valid in the golang implementation+}**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-05T11:24:59.882Z", "updated_at": "2019-06-05T11:24:59.886Z", "system": true, "noteable_id": 21583365, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 193}], [{"id": 181795234, "type": null, "body": "changed milestone to %\"12.1\"", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-16T23:04:39.382Z", "updated_at": "2019-06-16T23:04:39.385Z", "system": true, "noteable_id": 21583365, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 193}], [{"id": 183008515, "type": null, "body": "changed weight to **1**", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-19T11:34:14.846Z", "updated_at": "2019-06-19T11:34:14.851Z", "system": true, "noteable_id": 21583365, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 193}], [{"id": 202421933, "type": null, "body": "closed", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-08-12T00:01:33.639Z", "updated_at": "2019-08-12T00:01:33.643Z", "system": true, "noteable_id": 21583365, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 193}]]}, {"id": 21468379, "iid": 192, "project_id": 14022, "title": "Golang implementation of gitlab-shell should log to gitlab-shell.log, just like the Ruby version", "description": "The following discussion from !300 should be addressed:\n\nIt would be great if we can add logging to `gitlab-shell.log` for the golang implementations of the various git commands :pray:", "state": "opened", "created_at": "2019-05-31T07:57:27.307Z", "updated_at": "2019-09-09T14:33:35.583Z", "closed_at": null, "closed_by": null, "labels": ["Deliverable", "P3", "S3", "backend", "bug", "devops::create", "golang", "group::source code", "repository"], "milestone": {"id": 490705, "iid": 14, "group_id": 9970, "title": "Backlog", "description": "Issues that we want to do but are not planned right now. Open for contribution from the community.", "state": "active", "created_at": "2018-03-22T13:09:23.767Z", "updated_at": "2018-10-30T14:56:54.069Z", "due_date": null, "start_date": null, "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/14"}, "assignees": [], "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/192", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/192", "notes": "https://gitlab.com/api/v4/projects/14022/issues/192/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/192/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 3, "epic_iid": 706, "discussion": [[{"id": 176643596, "type": null, "body": "changed title from **{-Follow-up from \"Go implementation for git-receive-pack\"-}** to **{+Golang implementation of gitlab-shell should log to gitlab-shell.log, just like the Ruby version+}**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-05-31T12:14:19.348Z", "updated_at": "2019-05-31T12:14:19.352Z", "system": true, "noteable_id": 21468379, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 192}], [{"id": 176643597, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-05-31T12:14:19.384Z", "updated_at": "2019-05-31T12:14:19.388Z", "system": true, "noteable_id": 21468379, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 192}], [{"id": 176644452, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-05-31T12:16:07.587Z", "updated_at": "2019-05-31T12:16:07.593Z", "system": true, "noteable_id": 21468379, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 192}], [{"id": 177783580, "type": null, "body": "changed milestone to %\"12.3\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-06-04T14:03:01.263Z", "updated_at": "2019-06-04T14:03:01.267Z", "system": true, "noteable_id": 21468379, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 192}], [{"id": 177828911, "type": null, "body": "changed milestone to %\"12.2\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-06-04T15:39:49.021Z", "updated_at": "2019-06-04T15:39:49.026Z", "system": true, "noteable_id": 21468379, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 192}], [{"id": 197319405, "type": null, "body": "changed weight to **3**", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-07-29T17:57:15.447Z", "updated_at": "2019-07-29T17:57:15.451Z", "system": true, "noteable_id": 21468379, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 192}], [{"id": 197319423, "type": null, "body": "changed milestone to %\"12.3\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-07-29T17:57:19.477Z", "updated_at": "2019-07-29T17:57:19.480Z", "system": true, "noteable_id": 21468379, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 192}], [{"id": 197319884, "type": null, "body": "mentioned in issue create-stage#21", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-07-29T17:58:17.342Z", "updated_at": "2019-07-29T17:58:17.344Z", "system": true, "noteable_id": 21468379, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 192}], [{"id": 200226671, "type": null, "body": "changed milestone to %\"12.4\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-08-05T14:09:23.491Z", "updated_at": "2019-08-05T14:09:23.495Z", "system": true, "noteable_id": 21468379, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 192}], [{"id": 201436894, "type": null, "body": "mentioned in merge request !321", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-08T07:09:53.565Z", "updated_at": "2019-08-08T07:09:53.568Z", "system": true, "noteable_id": 21468379, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 192}], [{"id": 201455034, "type": null, "body": "In https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/321#note_201429279, @ashmckenzie noted to log when the expected and actual username trying to login via `gitlab-shell-authorized-keys-check` aren't the same. The user will be denied at that point but it's good to log these kind of events for debugging.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-08T07:56:08.623Z", "updated_at": "2019-08-08T07:56:08.623Z", "system": false, "noteable_id": 21468379, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 192}], [{"id": 211304097, "type": null, "body": "mentioned in issue create-stage#22", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-09-02T19:26:18.030Z", "updated_at": "2019-09-02T19:26:18.034Z", "system": true, "noteable_id": 21468379, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 192}], [{"id": 214254459, "type": null, "body": "changed milestone to %\"Backlog\"", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2019-09-09T14:33:35.622Z", "updated_at": "2019-09-09T14:33:35.625Z", "system": true, "noteable_id": 21468379, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 192}]]}, {"id": 21433795, "iid": 191, "project_id": 14022, "title": "Pass gitaly part of /allowed response as raw json straight to Gitaly requests", "description": "The following discussion from !300 should be addressed:\n\n- [ ] @nick.thomas started a [discussion](https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/300#note_175933261):  (+1 comment)\n\n    > @igor.drozdov @reprazent so here we decode the `Gitaly` response from `/internal/allowed`, only to pack it up again into an `SSHReceivePackRequest` protobuf message. We have a TODO in the Ruby code:\n    > \n    > ```ruby\n    >     # TODO: instead of building from pieces here in gitlab-shell, build the\n    >     # entire gitaly_request in gitlab-ce and pass on as-is here.\n    > ```\n    > \n    > This Go code works, but it's a lot more painful to do this kind of thing in Go than it is to do it in Ruby, and we run a risk - if a new field is added to the internal API response, it's easy to forget to add it here too, whereas in ruby, it would be passed straight through. In short, we're embedding knowledge about Gitaly into gitlab-shell that wasn't previously there.\n    > \n    > I'm wondering what you think about it. Perhaps we can use `json.RawMessage` in a few places here to get raw JSON blobs that we can pass down to the point where we want to build a `pb.SSHReceivePackRequest`, to avoid some of the deserialization here? Should we address this TODO now and start sending a pre-constructed `pb.SSHReceivePackRequest` alongside the existing data, and have gitlab-shell-go only consult that? Or do you think we're OK as-is and this can be deferred to a follow-up issue?\n    > \n    > I think I'd be tempted to start sending that pre-constructed `pb.SSHReceivePackRequest` now, but it does mean linking this MR to changes in gitlab-ce. We did the same for the `token` request header in an earlier MR.\n\nAs I've mentioned in the discussion above, we might want to implement it after we've migrated the features from Ruby", "state": "opened", "created_at": "2019-05-30T10:43:22.607Z", "updated_at": "2019-07-02T13:00:02.327Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/191", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 1, "completed_count": 0}, "has_tasks": true, "task_status": "0 of 1 task completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/191", "notes": "https://gitlab.com/api/v4/projects/14022/issues/191/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/191/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 176201130, "type": "DiscussionNote", "body": "@igor.drozdov this doesn't need to be confidential, does it?", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-05-30T11:09:06.044Z", "updated_at": "2019-05-30T11:10:37.522Z", "system": false, "noteable_id": 21433795, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 191}, {"id": 176201590, "type": "DiscussionNote", "body": "@nick.thomas Thanks for noticing it, seems I did it accedentally", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-05-30T11:10:37.439Z", "updated_at": "2019-05-30T11:10:37.439Z", "system": false, "noteable_id": 21433795, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 191}], [{"id": 176201358, "type": null, "body": "made the issue visible to everyone", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-05-30T11:09:44.756Z", "updated_at": "2019-05-30T11:09:44.760Z", "system": true, "noteable_id": 21433795, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 191}], [{"id": 177291792, "type": null, "body": "mentioned in merge request !305", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-06-03T12:51:29.355Z", "updated_at": "2019-06-03T12:51:29.358Z", "system": true, "noteable_id": 21433795, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 191}]]}, {"id": 21400878, "iid": 190, "project_id": 14022, "title": "Run the tests against a genuine Gitaly service", "description": "The following discussion from !300 should be addressed:\n\n- [ ] @nick.thomas started a [discussion](https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/300#note_175285554): \n\n    > It's a Gitaly, rather than SSH, server, so I'd rename this.\n    > \n    > Instead of, or even in addition to, this, we could consider using a genuine Gitaly service to run the tests against, in the same way we do for gitlab-workhorse and gitlab-elasticsearch-indexer:  https://gitlab.com/gitlab-org/gitlab-workhorse/blob/master/.gitlab-ci.yml#L8 and https://gitlab.com/gitlab-org/gitlab-workhorse/blob/master/gitaly_integration_test.go#L54 . WDYT?", "state": "opened", "created_at": "2019-05-29T10:18:47.639Z", "updated_at": "2019-05-29T10:18:47.639Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/190", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 1, "completed_count": 0}, "has_tasks": true, "task_status": "0 of 1 task completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/190", "notes": "https://gitlab.com/api/v4/projects/14022/issues/190/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/190/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 21329015, "iid": 189, "project_id": 14022, "title": "Process disallowed commands in Golang version", "description": "The following discussion from !300 should be addressed:\n\n- [ ] @reprazent started a [discussion](https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/300#note_174261261):  (+2 comments)\n\n    > This is invalid because we the quotes are not closed, but we'll eventually need to handle weird stuff like: \n    > \n    > ```\n    > \u276f ssh git@gitlab.com not-a-command\n    > > GitLab: Disallowed command\n    > ```\n    > \n    > Right now we're dealing with that in `Command.New` falling back to ruby. \n    > \n    > Maybe a separate small issue to do that? doen't need to be now.", "state": "closed", "created_at": "2019-05-27T11:16:22.917Z", "updated_at": "2019-09-25T12:55:17.516Z", "closed_at": "2019-09-25T12:55:17.473Z", "closed_by": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "labels": ["Create [DEPRECATED]", "Deliverable", "backend", "backstage", "devops::create", "golang", "group::source code"], "milestone": null, "assignees": [], "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/189", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 1, "completed_count": 0}, "has_tasks": true, "task_status": "0 of 1 task completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/189", "notes": "https://gitlab.com/api/v4/projects/14022/issues/189/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/189/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 1, "epic_iid": null, "discussion": [[{"id": 174825663, "type": null, "body": "changed milestone to %\"12.1\"", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-05-27T11:16:22.992Z", "updated_at": "2019-05-27T11:16:22.996Z", "system": true, "noteable_id": 21329015, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 189}], [{"id": 174825665, "type": null, "body": "changed weight to **1**", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-05-27T11:16:23.053Z", "updated_at": "2019-05-27T11:16:23.056Z", "system": true, "noteable_id": 21329015, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 189}], [{"id": 174827257, "type": null, "body": "mentioned in merge request !300", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-05-27T11:20:52.091Z", "updated_at": "2019-05-27T11:20:52.095Z", "system": true, "noteable_id": 21329015, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 189}], [{"id": 177234058, "type": null, "body": "removed milestone", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-03T10:49:19.889Z", "updated_at": "2019-06-03T10:49:19.892Z", "system": true, "noteable_id": 21329015, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 189}], [{"id": 219728100, "type": null, "body": "mentioned in merge request !336", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-09-20T07:45:51.979Z", "updated_at": "2019-09-20T07:45:51.986Z", "system": true, "noteable_id": 21329015, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 189}], [{"id": 221858779, "type": null, "body": "As I've mentioned here: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/336#note_219728095 this case is covered by the MR", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-09-25T12:55:16.973Z", "updated_at": "2019-09-25T12:55:16.973Z", "system": false, "noteable_id": 21329015, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 189}], [{"id": 221858784, "type": null, "body": "closed", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-09-25T12:55:17.543Z", "updated_at": "2019-09-25T12:55:17.546Z", "system": true, "noteable_id": 21329015, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 189}]]}, {"id": 21200758, "iid": 188, "project_id": 14022, "title": "Default to JSON logging", "description": "[We are moving to make JSON the default configured log format for GitLab Shell in 12.0 Omnibus release](https://gitlab.com/gitlab-org/omnibus-gitlab/issues/4102).\n\nWould we like to make this the source install default as well by changing https://gitlab.com/gitlab-org/gitlab-shell/blob/master/go/internal/config/config.go#L103 ?", "state": "opened", "created_at": "2019-05-22T21:43:31.884Z", "updated_at": "2019-05-22T21:43:31.884Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 2602134, "name": "Robert Marshall", "username": "rmarshall", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/c78f467da196431abcc7aa223fdc1c64?s=80&d=identicon", "web_url": "https://gitlab.com/rmarshall"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/188", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/188", "notes": "https://gitlab.com/api/v4/projects/14022/issues/188/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/188/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 173460156, "type": null, "body": "mentioned in issue omnibus-gitlab#4102", "attachment": null, "author": {"id": 2602134, "name": "Robert Marshall", "username": "rmarshall", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/c78f467da196431abcc7aa223fdc1c64?s=80&d=identicon", "web_url": "https://gitlab.com/rmarshall"}, "created_at": "2019-05-22T21:43:58.012Z", "updated_at": "2019-05-22T21:43:58.015Z", "system": true, "noteable_id": 21200758, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 188}]]}, {"id": 21083949, "iid": 187, "project_id": 14022, "title": "Support the `GITLAB_SHELL_DIR` environment variable in the Golang rewrite", "description": "Original title: SSH clone fails with 'Failed to read config, falling back to gitlab-shell-ruby' error\n\nWe are updating gitlab from 11.8.9 to 11.10.4 in debian (with corresponding updates to gitlab-shell and gitaly). I think this error is related to gitaly#1226 Is there a documentation for handling this migration? \n\n\n```\n$ git clone gitlab@gitlab.lxc:praveen/hello-testing.git\nCloning into 'hello-testing'...\nThe authenticity of host 'gitlab.lxc (192.168.122.154)' can't be established.\nECDSA key fingerprint is SHA256:btiaYziejd3JCqgZ0RXesyFVUgLtnXGJPHRvtDPv3LQ.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added 'gitlab.lxc,192.168.122.154' (ECDSA) to the list of known hosts.\nFailed to read config, falling back to gitlab-shell-ruby\nFailed to exec: no such file or directory\nfatal: Could not read from remote repository.\n\nPlease make sure you have the correct access rights\nand the repository exists.\n```\n\ncc @balasankarc @jacobvosmaer-gitlab", "state": "closed", "created_at": "2019-05-19T08:06:58.034Z", "updated_at": "2019-06-04T23:53:00.734Z", "closed_at": "2019-06-04T23:53:00.696Z", "closed_by": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "labels": ["Create [DEPRECATED]", "P3", "S3", "bug", "devops::create", "golang", "group::source code", "regression", "regression:11.10"], "milestone": {"id": 693518, "iid": 33, "group_id": 9970, "title": "12.0", "description": "", "state": "closed", "created_at": "2018-10-30T16:47:37.975Z", "updated_at": "2019-07-08T20:39:06.020Z", "due_date": "2019-06-22", "start_date": "2019-05-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/33"}, "assignees": [{"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}], "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "assignee": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "user_notes_count": 20, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/187", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/187", "notes": "https://gitlab.com/api/v4/projects/14022/issues/187/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/187/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 2, "epic_iid": 706, "discussion": [[{"id": 172177575, "type": null, "body": "I tried changing gitaly configuration to use embedded copy of gitlab-shell, but it did not work.\n\n```\n [gitlab-shell]\n # The directory where gitlab-shell is installed\n-dir = \"/usr/share/gitlab-shell\"\n+dir = \"/usr/share/gitaly/ruby/gitlab-shell/\"\n```", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2019-05-19T09:23:09.317Z", "updated_at": "2019-05-19T09:23:09.317Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 172177576, "type": null, "body": "Should we add gitlab-shell's config.yml to embedded copy of gitlab-shell?", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2019-05-19T09:40:08.386Z", "updated_at": "2019-05-19T09:40:08.386Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 172177577, "type": null, "body": "I also tried to change gitlab.yml to point to embedded copy of gitlab-shell. But it still fails.", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2019-05-19T09:55:10.561Z", "updated_at": "2019-05-19T09:55:10.561Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 172177578, "type": null, "body": "@pravi I think this is a gitlab-shell issue, not a Gitaly issue. Your clone session fails before it even reaches Gitaly.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2019-05-20T10:29:52.861Z", "updated_at": "2019-05-20T10:29:52.861Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 172177579, "type": null, "body": "moved from gitaly#1667", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2019-05-20T10:30:02.610Z", "updated_at": "2019-05-20T10:30:02.615Z", "system": true, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 172195275, "type": null, "body": "https://gitlab.com/gitlab-org/gitlab-shell/blob/58d8c7691ac52c00dfebe2154e793c8fccc46aa0/go/cmd/gitlab-shell/main.go#L33\n\nThis is where the `Failed to exec:` error comes from.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2019-05-20T11:02:51.998Z", "updated_at": "2019-05-20T11:02:51.998Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 172387892, "type": null, "body": "@jacobvosmaer-gitlab it is working if I downgrade gitlab-shell to 8.4.4 (current version is 9.1.0).", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2019-05-20T17:08:02.826Z", "updated_at": "2019-05-20T17:08:02.826Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 172389984, "type": null, "body": "The gitlab-shell version embedded in gitaly is 8.7.1, could that be an issue? Is it okay to run gitlab-shell 8.4.4 with gitlab 11.10.4 (recommended version is 9.0.0 in GITLAB_SHELL_VERSION)?", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2019-05-20T17:12:01.728Z", "updated_at": "2019-05-20T17:12:01.728Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 174430621, "type": null, "body": "@stanhu can we use gitlab-shell 8.4.4 with gitlab 11.10.4 as a workaround till this issue is fixed?", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2019-05-25T09:49:47.468Z", "updated_at": "2019-05-25T09:49:47.468Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 175514025, "type": null, "body": "@pravi Not sure if that's a good idea. I'd suggest adding debugging to see what the `rootDir` and `os.Args` are trying to execute.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2019-05-28T21:17:54.845Z", "updated_at": "2019-05-28T21:17:54.845Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177772055, "type": null, "body": "@stanhu @jacobvosmaer-gitlab I think the root problem lies in trying to determine root directory from executable. In debian, we have,\n\n```\n# ls /usr/share/gitlab-shell/bin/gitlab-shell -l\nlrwxrwxrwx 1 root root 38 May 15 12:12 /usr/share/gitlab-shell/bin/gitlab-shell -> ../../../lib/gitlab-shell/gitlab-shell\n```\n\nSince we follow FHS we cannot have a architecture independent (ruby part which goes to /usr/share [1]) and architecture dependent binaries (go part which goes to /usr/lib) in same directory.\n\nSo rootDir is determined as /usr/lib. But the actual root directory is /usr/share/gitlab-shell.\n\n[1] http://www.pathname.com/fhs/2.2/fhs-4.11.html", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2019-06-04T13:38:36.826Z", "updated_at": "2019-06-04T13:38:53.088Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177790958, "type": null, "body": "So this is a consequence of the gitlab-shell migration to Golang @igor.drozdov @DouweM @reprazent . @pravi is, unless I'm mistaken, working on the native Debian packages for gitlab!\n\nEssentially, our assumption made here: https://gitlab.com/gitlab-org/gitlab-shell/blob/master/go/cmd/gitlab-shell/main.go#L24 is invalid in this scenario.\n\nWe use the root directory to determine the location of the config file, and also to get the location of the `gitlab-shell-ruby` command.\n\n@pravi I'm interested in what we can provide to help get you back on track. The first thing that comes to mind is an environment variable that could be set in `sshd_config` to point to the gitlab-shell config file. Once we've got that, we can put any other config we need (like the `.gitlab_shell_secret`, or the location of the `ruby` or `gitlab-shell-ruby` binaries, in there). WDYT?", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-04T14:14:20.741Z", "updated_at": "2019-06-04T14:14:20.741Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177791777, "type": null, "body": "Coming at this naively, I'd have expected `gitlab-shell` and `gitlab-shell-ruby` to have both ended up in `/usr/bin`, but perhaps that's unreasonable!", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-04T14:15:58.033Z", "updated_at": "2019-06-04T14:15:58.033Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177791818, "type": null, "body": "changed milestone to %\"Backlog\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-04T14:16:03.367Z", "updated_at": "2019-06-04T14:16:03.374Z", "system": true, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177792496, "type": null, "body": "@nick.thomas we have been using https://salsa.debian.org/ruby-team/gitlab-shell/blob/master/debian/patches/set-root-path.patch and it worked till 8.4.4. Since this package is only useful to gitlab, we did not install it in /usr/bin.", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2019-06-04T14:17:45.206Z", "updated_at": "2019-06-04T14:17:45.206Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177793772, "type": null, "body": "Yes, I'm working on the native debian package. Why can't we use ROOT_PATH like before? Is it because go code does not source/read gitlab_init.rb anymore?", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2019-06-04T14:20:42.077Z", "updated_at": "2019-06-04T14:20:42.077Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177793861, "type": null, "body": "@pravi hmm. I think it's interesting that we don't support `GITLAB_SHELL_DIR` in the Golang version yet - that's definitely something we should add!\n\nThat would allow you to extend your patch to override the Go lookup code as well as the Ruby lookup code, meaning you wouldn't need to set it as an envvar in Debian. WDYT?", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-04T14:20:55.657Z", "updated_at": "2019-06-04T14:20:55.657Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177794965, "type": null, "body": "(some context: we're rewriting gitlab-shell in go over the course of a few releases. `gitlab_init.rb`, being Ruby code, can't be used in the Go version. Eventually, we plan to remove all the ruby code, leaving us with just the Go version)", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-04T14:23:01.826Z", "updated_at": "2019-06-04T14:23:01.826Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177795001, "type": null, "body": "@nick.thomas if there is a place I can set this manually like before that should suffice.", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2019-06-04T14:23:09.072Z", "updated_at": "2019-06-04T14:23:09.072Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177795964, "type": null, "body": "changed title from **S{-SH clone fails with 'Failed to read config, falling back to gitlab-shell-ruby' error-}** to **S{+upport the `GITLAB_SHELL_DIR` environment variable in the Golang rewrite+}**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-04T14:25:00.550Z", "updated_at": "2019-06-04T14:25:00.554Z", "system": true, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177795966, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-04T14:25:00.605Z", "updated_at": "2019-06-04T14:25:00.609Z", "system": true, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177796038, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-04T14:25:10.947Z", "updated_at": "2019-06-04T14:25:10.950Z", "system": true, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177796245, "type": null, "body": "changed milestone to %\"12.3\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-06-04T14:25:35.281Z", "updated_at": "2019-06-04T14:25:35.284Z", "system": true, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177796247, "type": null, "body": "changed weight to **2**", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-06-04T14:25:35.403Z", "updated_at": "2019-06-04T14:25:35.405Z", "system": true, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177796355, "type": null, "body": "Great, I think we need this before we can consider the rewrite complete anyway, and since it unblocks you, and it's quite trivial, hopefully we can get it done quickly!", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-04T14:25:50.439Z", "updated_at": "2019-06-04T14:25:50.439Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177798161, "type": null, "body": "mentioned in merge request !309", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-04T14:29:21.841Z", "updated_at": "2019-06-04T14:29:21.846Z", "system": true, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177798213, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-04T14:29:28.389Z", "updated_at": "2019-06-04T14:29:28.393Z", "system": true, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177798269, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-04T14:29:35.573Z", "updated_at": "2019-06-04T14:29:35.578Z", "system": true, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177807453, "type": null, "body": "@pravi on reflection, I don't think you have to wait for https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/309 - since you're patching anyway, you can just replace `findRootDir()` with, e.g.:\n\n```go\nfunc findRootDir() (string, error) { \n    if path := os.Getenv(\"GITLAB_SHELL_PATH\"); path != \"\" {\n        return path, nil\n    }\n\n    return \"/usr/share/gitlab-shell\", nil\n}\n```", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-04T14:48:58.937Z", "updated_at": "2019-06-04T14:49:21.394Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177814652, "type": null, "body": "@nick.thomas thanks, I had to use `return filepath.FromSlash(\"/usr/share/gitlab-shell\"), nil` though. It is working with this patch, I will also try passing it as environment variable.", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2019-06-04T15:05:11.052Z", "updated_at": "2019-06-04T15:05:11.052Z", "system": false, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177989665, "type": null, "body": "closed via merge request !309", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-04T23:53:00.747Z", "updated_at": "2019-06-04T23:53:00.750Z", "system": true, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}], [{"id": 177989669, "type": null, "body": "mentioned in commit f61185b8a8f8974225a701137ba4b75cf5d4c4ef", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-04T23:53:02.376Z", "updated_at": "2019-06-04T23:53:02.415Z", "system": true, "noteable_id": 21083949, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 187}]]}, {"id": 20499982, "iid": 186, "project_id": 14022, "title": "Enable Golang-migrated features on live environments", "description": "With https://gitlab.com/gitlab-org/omnibus-gitlab/issues/4207, https://gitlab.com/gitlab-org/gitlab-shell/issues/178, and https://gitlab.com/gitlab-org/gitlab-shell/issues/179, we should be able to enable the Golang versions of our `discover` and `2fa_recovery_codes` features on our live environments: dev, staging, canary, and production.\n\nWe should roll the features out across these environments in order, verifying that everything works correctly at each before moving on to the next.", "state": "closed", "created_at": "2019-05-01T13:23:07.138Z", "updated_at": "2019-08-05T10:44:48.971Z", "closed_at": "2019-06-06T10:39:35.590Z", "closed_by": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "labels": ["Create [DEPRECATED]", "Deliverable", "backend", "backstage", "devops::create", "group::source code", "workflow::In dev"], "milestone": {"id": 693518, "iid": 33, "group_id": 9970, "title": "12.0", "description": "", "state": "closed", "created_at": "2018-10-30T16:47:37.975Z", "updated_at": "2019-07-08T20:39:06.020Z", "due_date": "2019-06-22", "start_date": "2019-05-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/33"}, "assignees": [{"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}], "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "assignee": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "user_notes_count": 6, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/186", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/186", "notes": "https://gitlab.com/api/v4/projects/14022/issues/186/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/186/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 3, "epic_iid": 706, "discussion": [[{"id": 165874352, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-01T13:23:07.231Z", "updated_at": "2019-05-01T13:23:07.231Z", "system": true, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}], [{"id": 165874353, "type": null, "body": "changed weight to **3**", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-01T13:23:07.351Z", "updated_at": "2019-05-01T13:23:07.351Z", "system": true, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}], [{"id": 165874410, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-01T13:23:24.789Z", "updated_at": "2019-05-01T13:23:24.789Z", "system": true, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}], [{"id": 165874495, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-01T13:23:54.669Z", "updated_at": "2019-05-01T13:23:54.669Z", "system": true, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}], [{"id": 167095550, "type": null, "body": "assigned to @igor.drozdov", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-06T12:54:02.609Z", "updated_at": "2019-05-06T12:54:02.609Z", "system": true, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}], [{"id": 174917613, "type": null, "body": "marked this issue as related to gitlab-com/gl-infra/infrastructure#6665", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-27T14:43:25.744Z", "updated_at": "2019-05-27T14:43:25.748Z", "system": true, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}], [{"id": 176630677, "type": null, "body": "The features have been enabled for dev.gitlab.org: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1146", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-05-31T11:46:57.890Z", "updated_at": "2019-05-31T11:46:57.890Z", "system": false, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}], [{"id": 176630817, "type": null, "body": "The features have been enabled for staging.gitlab.com: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1162", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-05-31T11:47:26.054Z", "updated_at": "2019-05-31T11:47:26.054Z", "system": false, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}], [{"id": 176644345, "type": "DiscussionNote", "body": "One thought: it would be nice to enable them *all* by default in GDK. We could just add the list now, before the commands are even implemented. It'd give us immediate feedback from engineers as to whether it works in their dev environment", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-05-31T12:15:52.409Z", "updated_at": "2019-06-03T10:38:37.715Z", "system": false, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}, {"id": 177230323, "type": "DiscussionNote", "body": "@nick.thomas the idea sounds good to me, but currently if a command is enabled and not implemented, a fallback command is not created (`nil` is propagated and we get a crash).\n\nI've created an MR to fix this, could you please have a look? https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/306", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-03T10:38:37.631Z", "updated_at": "2019-06-03T10:38:37.631Z", "system": false, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}], [{"id": 177230124, "type": null, "body": "mentioned in merge request !306", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-03T10:38:01.049Z", "updated_at": "2019-06-03T10:38:01.053Z", "system": true, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}], [{"id": 178530248, "type": null, "body": "The features have been enabled for production: https://ops.gitlab.net/gitlab-cookbooks/chef-repo/merge_requests/1181", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-06T10:27:06.024Z", "updated_at": "2019-06-06T10:27:06.024Z", "system": false, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}], [{"id": 178534717, "type": null, "body": "@nick.thomas I've created a separate issue for your idea https://gitlab.com/gitlab-org/gitlab-ce/issues/62841 so we could close this issue", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-06T10:39:35.094Z", "updated_at": "2019-06-06T10:39:35.094Z", "system": false, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}], [{"id": 178534720, "type": null, "body": "closed", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-06T10:39:35.638Z", "updated_at": "2019-06-06T10:39:35.641Z", "system": true, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}], [{"id": 179305155, "type": null, "body": "mentioned in issue gl-retrospectives/create-team#13", "attachment": null, "author": {"id": 1786152, "name": "\ud83e\udd16 GitLab Bot \ud83e\udd16", "username": "gitlab-bot", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1786152/avatar.png", "web_url": "https://gitlab.com/gitlab-bot"}, "created_at": "2019-06-09T07:24:18.479Z", "updated_at": "2019-06-09T07:24:18.481Z", "system": true, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}], [{"id": 200130433, "type": null, "body": "mentioned in issue #202", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-05T10:44:48.580Z", "updated_at": "2019-08-05T10:44:48.586Z", "system": true, "noteable_id": 20499982, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 186}]]}, {"id": 19894903, "iid": 185, "project_id": 14022, "title": "New trainee maintainers for gitlab-shell", "description": "Much like this equivalent issue in gitlab-workhorse: https://gitlab.com/gitlab-org/gitlab-workhorse/issues/209\n\nCurrently, the list of gitlab-shell maintainers is:\n\n* @DouweM \n* @rspeicher \n* @smcgivern \n* @nick.thomas \n* @ashmckenzie\n\nSo at first glance, it's much healthier than gitlab-workhorse.\n\nHowever.\n\nWe're currently in the middle of an effort to completely rewrite gitlab-shell in Go: https://gitlab.com/groups/gitlab-org/-/epics/706 . Of the maintainers above, only @ashmckenzie and I have significant Go expertise.\n\nSo, we need to think about what maintainership will look like once that's done, and make sure we aren't accidentally creating a small bus factor.\n\nThe way we're conducting the rewrite - gradually, over many releases - naturally means that a number of different people are involved in it already. I honestly think we can just follow @smcgivern's traintainer process with people who are working on gitlab-shell, and get them to review each other's reimplementations of the existing functionality. I know @reprazent and @igor.drozdov already did this for one issue, for instance.\n\nPerhaps by reviewing the new go code, some of the existing maintainers will feel comfortable remaining maintainers once it's done, or perhaps it will be reduced to myself + 2-3 others. I'm happy with either outcome. I wouldn't be happy with gitlab-shell maintainership ending up as being just me and @ashmckenzie !\n\nPeople involved with the rewrite so far:\n\n* @patrickbajao (already volunteered for gitlab-workhorse!)\n* @jacobvosmaer\\-gitlab (already quite busy! Peripheral involvement by moving the hooks to gitaly)\n* @reprazent \n* @igor.drozdov \n* @ashmckenzie (already a maintainer)\n\nAs in the workhorse issue, I'd suggest anyone interested in finishing up a gitlab-shell maintainer should chat about it in their regular EM 1:1, then create an issue with [this template](https://gitlab.com/gitlab-com/www-gitlab-com/blob/master/.gitlab/issue_templates/Trainee%20backend%20maintainer.md). We can continue from there.\n\nNow to create a similar issue in gitlab-pages ;) :trolleybus:\n\n## Trainee maintainers\n\n- [x] [`@ashmckenzie`](https://gitlab.com/gitlab-com/www-gitlab-com/issues/3447)\n- <strike>[`@rymai`]()</strike>\n- [x] [`@igor.drozdov`](https://gitlab.com/gitlab-com/www-gitlab-com/issues/4178)\n- [x] [`@reprazent`](https://gitlab.com/gitlab-com/www-gitlab-com/issues/4201)\n- [x] [`@patrickbajao`](https://gitlab.com/gitlab-com/www-gitlab-com/issues/4581)", "state": "closed", "created_at": "2019-04-09T16:49:53.546Z", "updated_at": "2019-08-22T12:31:57.031Z", "closed_at": "2019-08-22T12:31:56.987Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["Create [DEPRECATED]", "backstage", "devops::create"], "milestone": null, "assignees": [{"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "user_notes_count": 11, "merge_requests_count": 0, "upvotes": 3, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/185", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 4, "completed_count": 4}, "has_tasks": true, "task_status": "4 of 4 tasks completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/185", "notes": "https://gitlab.com/api/v4/projects/14022/issues/185/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/185/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 159050548, "type": null, "body": "mentioned in issue gitlab-pages#215", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-09T16:59:27.593Z", "updated_at": "2019-04-09T16:59:27.593Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159207755, "type": null, "body": "> I think the only one with significant Go expertise is... well, me (do correct if I'm wrong here).\n\nNot sure if you'd call it significant, but worked with Golang in previous role for 6 months :smile:", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-10T06:16:21.287Z", "updated_at": "2019-04-10T06:16:21.287Z", "system": false, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159286370, "type": null, "body": "> I'd suggest anyone interested in finishing up a gitlab-shell maintainer should chat about it in their regular EM 1:1, then create an issue with [this template](https://gitlab.com/gitlab-com/www-gitlab-com/blob/master/.gitlab/issue_templates/Trainee%20backend%20maintainer.md)\n\nI'd be happy to take up this opportunity and I've already got @DouweM's approval after discussing it today. Will create an issue soon!", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-04-10T08:49:08.991Z", "updated_at": "2019-04-10T08:49:08.991Z", "system": false, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159293159, "type": null, "body": "marked this issue as related to gitlab-com/www-gitlab-com#4178", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-04-10T09:03:52.120Z", "updated_at": "2019-04-10T09:03:52.120Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159326485, "type": null, "body": "@nick.thomas I'm willing to help out, though I'm not sure I'm the best candidate as I'm not very fluent in go yet :wink:. How many maintainers are you looking for? \n\nIf you think I could add value, I could create the issue, and summarize reviews I do there, but https://gitlab.com/gitlab-com/www-gitlab-com/issues/3350 would still be my priority, @DouweM  WDYT?", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-04-10T10:19:00.159Z", "updated_at": "2019-04-10T10:19:00.159Z", "system": false, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159427937, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-10T14:20:37.911Z", "updated_at": "2019-04-10T14:20:37.911Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159428087, "type": null, "body": "assigned to @igor.drozdov and @ashmckenzie", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-10T14:20:56.367Z", "updated_at": "2019-04-10T14:20:56.367Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159429024, "type": null, "body": "@reprazent we're aiming to have 4 in gitlab-workhorse. For shell, I think 2-3 would be a reasonable number, it's much more restricted in terms of scope, but the more the better!\n\nI'm not worried about amount of go expertise, it's something that you can level up at the same time as your maintainership skills. We definitely wouldn't be making people maintainers until they felt comfortable with go in general as well as shell/workhorse/pages, but I believe the best way to become comfortable is through exposure to actual code :).", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-10T14:22:51.322Z", "updated_at": "2019-04-10T14:23:23.183Z", "system": false, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159509238, "type": null, "body": "Thanks for creating the issue. I would love to level up in Go so I'm :+1: for being a trainee maintainer here. /cc @meks \n\nAlso, I think at this point I'm not really involved in the current (Ruby) `gitlab-shell` so I will step down from my maintainership role.", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2019-04-10T17:26:28.701Z", "updated_at": "2019-04-10T17:26:28.701Z", "system": false, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159511677, "type": null, "body": "mentioned in merge request gitlab-com/www-gitlab-com!21318", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2019-04-10T17:36:09.343Z", "updated_at": "2019-04-10T17:36:09.343Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159773005, "type": null, "body": "assigned to @rymai", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-11T11:43:10.218Z", "updated_at": "2019-04-11T11:43:10.218Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159773149, "type": null, "body": "Thanks @rymai, sounds good! I guess you'll just create a trainee maintainership issue as with the others?\n\n", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-11T11:43:26.289Z", "updated_at": "2019-04-11T11:43:55.063Z", "system": false, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159773625, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-11T11:44:29.410Z", "updated_at": "2019-04-11T11:44:29.410Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159777464, "type": null, "body": "assigned to @reprazent", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-11T11:52:47.744Z", "updated_at": "2019-04-11T11:52:47.744Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159777600, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-11T11:53:03.629Z", "updated_at": "2019-04-11T11:53:03.629Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159777906, "type": null, "body": "(@reprazent @rymai @ashmckenzie please add your trainee maintainer issues to the issue description once created!)", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-11T11:53:39.725Z", "updated_at": "2019-04-11T11:53:39.725Z", "system": false, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159851409, "type": null, "body": "> (@reprazent @rymai @ashmckenzie please add your trainee maintainer issues to the issue description once created!)\n\n@nick.thomas Actually, now that I think of it, maybe I should start by contributing before being a trainee maintainer? I think I only did the \"Go tutorial\" once, like 5 years ago! :stuck\\_out\\_tongue:", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2019-04-11T14:19:11.480Z", "updated_at": "2019-04-11T14:19:11.480Z", "system": false, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 159863110, "type": "DiscussionNote", "body": "@rymai in these small satellite projects, I think both are about as valuable, and at about the same time - but I'm happy for you to do it in whichever order you prefer :). If you feel like you'd benefit more from writing code than reviewing code at present, that's fine by me! :thumbsup:", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-11T14:45:17.947Z", "updated_at": "2019-08-21T16:34:46.951Z", "system": false, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}, {"id": 206448287, "type": "DiscussionNote", "body": "I just don't have the time for that at the moment. Unassigning myself here. Maybe the issue could be even closed?", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2019-08-21T16:34:46.888Z", "updated_at": "2019-08-21T16:34:46.888Z", "system": false, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}, {"id": 206818743, "type": "DiscussionNote", "body": "I agree - the resolution of this (and the other two traintainer issues I have open) can be the opened traintainer issues. Since all those are now open, I'll close this issue.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-08-22T12:31:54.886Z", "updated_at": "2019-08-22T12:31:54.886Z", "system": false, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 160189678, "type": null, "body": "marked the task **[`@igor.drozdov`](https://gitlab.com/gitlab-com/www-gitlab-com/issues/4178)** as completed", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-12T11:46:14.096Z", "updated_at": "2019-04-12T11:46:14.096Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 160240930, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-04-12T13:43:08.226Z", "updated_at": "2019-04-12T13:43:08.226Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 180795576, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-06-13T04:18:43.608Z", "updated_at": "2019-06-13T04:18:43.611Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 180843376, "type": null, "body": "unassigned @ashmckenzie", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-13T07:48:14.997Z", "updated_at": "2019-06-13T07:48:15.001Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 182708447, "type": null, "body": "marked this issue as related to gitlab-com/www-gitlab-com#3447", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-18T17:06:08.597Z", "updated_at": "2019-06-18T17:06:08.601Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 182708450, "type": null, "body": "marked this issue as related to gitlab-com/www-gitlab-com#4201", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-18T17:06:08.726Z", "updated_at": "2019-06-18T17:06:08.730Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 182708454, "type": null, "body": "marked this issue as related to gitlab-com/www-gitlab-com#4581", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-18T17:06:08.801Z", "updated_at": "2019-06-18T17:06:08.805Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 206448288, "type": null, "body": "unassigned @rymai", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2019-08-21T16:34:47.105Z", "updated_at": "2019-08-21T16:34:47.109Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 206562000, "type": null, "body": "marked the task **[`@ashmckenzie`](https://gitlab.com/gitlab-com/www-gitlab-com/issues/3447)** as incomplete", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-08-22T00:07:54.624Z", "updated_at": "2019-08-22T00:07:54.627Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 206818292, "type": null, "body": "marked the task **[`@ashmckenzie`](https://gitlab.com/gitlab-com/www-gitlab-com/issues/3447)** as completed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-08-22T12:31:09.006Z", "updated_at": "2019-08-22T12:31:09.011Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}], [{"id": 206818779, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-08-22T12:31:57.070Z", "updated_at": "2019-08-22T12:31:57.074Z", "system": true, "noteable_id": 19894903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 185}]]}, {"id": 19753966, "iid": 184, "project_id": 14022, "title": "Investigate sending all comms to the user via `gl_console_messages`", "description": "Currently, we inform the user of broadcast messages and for a Geo cluster, if the secondary has replication lag in different parts of the gitlab, gitlab-shell & gitaly codebases.  \n\nIf would be great to have a single place where all commms bound for the user is located.\n\nContext: \n\n* https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/287#note_157454949\n* https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/26692#note_157453054\n* https://gitlab.com/gitlab-org/gitlab-shell/issues/183\n* https://gitlab.com/gitlab-org/gitlab-ee/issues/9195", "state": "opened", "created_at": "2019-04-04T23:22:46.799Z", "updated_at": "2019-07-26T01:06:53.008Z", "closed_at": null, "closed_by": null, "labels": ["Geo [DEPRECATED]", "devops::enablement", "group::geo", "needs investigation"], "milestone": {"id": 490705, "iid": 14, "group_id": 9970, "title": "Backlog", "description": "Issues that we want to do but are not planned right now. Open for contribution from the community.", "state": "active", "created_at": "2018-03-22T13:09:23.767Z", "updated_at": "2018-10-30T14:56:54.069Z", "due_date": null, "start_date": null, "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/14"}, "assignees": [], "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/184", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/184", "notes": "https://gitlab.com/api/v4/projects/14022/issues/184/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/184/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 157657473, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-05T00:23:26.260Z", "updated_at": "2019-04-05T00:23:26.260Z", "system": true, "noteable_id": 19753966, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 184}], [{"id": 158316436, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-08T08:00:22.027Z", "updated_at": "2019-04-08T08:00:22.027Z", "system": true, "noteable_id": 19753966, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 184}], [{"id": 158316491, "type": null, "body": "changed milestone to %\"11.11\"", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-08T08:00:30.594Z", "updated_at": "2019-04-08T08:00:30.594Z", "system": true, "noteable_id": 19753966, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 184}], [{"id": 158317308, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-08T08:02:50.669Z", "updated_at": "2019-04-08T08:02:50.669Z", "system": true, "noteable_id": 19753966, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 184}], [{"id": 167418705, "type": null, "body": "changed milestone to %\"Backlog\"", "attachment": null, "author": {"id": 2722370, "name": "Rachel Nienaber", "username": "rnienaber", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2722370/avatar.png", "web_url": "https://gitlab.com/rnienaber"}, "created_at": "2019-05-07T09:09:03.313Z", "updated_at": "2019-05-07T09:09:03.317Z", "system": true, "noteable_id": 19753966, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 184}], [{"id": 180843448, "type": null, "body": "unassigned @ashmckenzie", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-06-13T07:48:23.888Z", "updated_at": "2019-06-13T07:48:23.892Z", "system": true, "noteable_id": 19753966, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 184}]]}, {"id": 19724843, "iid": 183, "project_id": 14022, "title": "Display console messages, if available, in the Golang version of gitlab-shell", "description": "The following discussion from !287 should be addressed:\n\n- [ ] @nick.thomas started a [discussion](https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/287#note_157453878): \n\n    > Since this applies to every command, we also need to support it in the golang version of gitlab-shell.\n    > \n    > Since it's feature-flagged and we only support `discover` and `lfs_authenticate` so far, while the CE MR happens to only add messages in the `pull/fetch` case, I'm OK merging this as-is. I'll create a follow-up issue though, and it would be great if you could tackle that too ;)\n\nThis is a feature added to the `/internal/allowed` API response in ruby this release, but not yet supported in the go commands.\n\ncc @ashmckenzie ", "state": "closed", "created_at": "2019-04-04T14:14:34.344Z", "updated_at": "2019-06-09T07:24:18.867Z", "closed_at": "2019-06-03T10:45:31.914Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["Create [DEPRECATED]", "Deliverable", "backend", "backstage", "devops::create", "golang", "group::source code"], "milestone": {"id": 693518, "iid": 33, "group_id": 9970, "title": "12.0", "description": "", "state": "closed", "created_at": "2018-10-30T16:47:37.975Z", "updated_at": "2019-07-08T20:39:06.020Z", "due_date": "2019-06-22", "start_date": "2019-05-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/33"}, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 9, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/183", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 1, "completed_count": 0}, "has_tasks": true, "task_status": "0 of 1 task completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/183", "notes": "https://gitlab.com/api/v4/projects/14022/issues/183/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/183/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 3, "epic_iid": 706, "discussion": [[{"id": 157454441, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:14:48.588Z", "updated_at": "2019-04-04T14:14:48.588Z", "system": true, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 157652564, "type": null, "body": "assigned to @ashmckenzie", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-04T23:23:26.142Z", "updated_at": "2019-04-04T23:23:26.142Z", "system": true, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 157652569, "type": null, "body": "changed milestone to %\"11.11\"", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-04T23:23:30.878Z", "updated_at": "2019-04-04T23:23:30.878Z", "system": true, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 157652631, "type": null, "body": "changed weight to **3**", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-04T23:24:23.829Z", "updated_at": "2019-04-04T23:24:23.829Z", "system": true, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 157801200, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-05T10:58:02.769Z", "updated_at": "2019-04-05T10:58:02.769Z", "system": true, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 158312584, "type": null, "body": "closed", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-08T07:51:10.774Z", "updated_at": "2019-04-08T07:51:10.774Z", "system": true, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 158315727, "type": null, "body": "reopened", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-08T07:58:29.592Z", "updated_at": "2019-04-08T07:58:29.592Z", "system": true, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 158316443, "type": null, "body": "mentioned in issue #184", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-08T08:00:22.414Z", "updated_at": "2019-04-08T08:00:22.414Z", "system": true, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 167418553, "type": "DiscussionNote", "body": "@ashmckenzie Is this related to https://gitlab.com/gitlab-org/gitlab-ee/issues/9195 ?", "attachment": null, "author": {"id": 2722370, "name": "Rachel Nienaber", "username": "rnienaber", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2722370/avatar.png", "web_url": "https://gitlab.com/rnienaber"}, "created_at": "2019-05-07T09:08:43.908Z", "updated_at": "2019-05-30T00:31:01.578Z", "system": false, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}, {"id": 176067745, "type": "DiscussionNote", "body": "It is related yes but not a dependency.", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-05-30T00:31:01.522Z", "updated_at": "2019-05-30T00:31:01.522Z", "system": false, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 167419863, "type": null, "body": "changed milestone to %\"Backlog\"", "attachment": null, "author": {"id": 2722370, "name": "Rachel Nienaber", "username": "rnienaber", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2722370/avatar.png", "web_url": "https://gitlab.com/rnienaber"}, "created_at": "2019-05-07T09:12:14.451Z", "updated_at": "2019-05-07T09:12:14.456Z", "system": true, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 175797115, "type": null, "body": "mentioned in issue #160", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-29T13:19:10.274Z", "updated_at": "2019-05-29T13:19:10.278Z", "system": true, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 176141670, "type": null, "body": "@igor.drozdov When https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/300 is merged, can you please check whether this can be closed as well?", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-30T08:08:31.616Z", "updated_at": "2019-05-30T08:08:31.616Z", "system": false, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 176577194, "type": null, "body": "unassigned @ashmckenzie", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-05-31T09:17:59.819Z", "updated_at": "2019-05-31T09:17:59.822Z", "system": true, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 176578020, "type": null, "body": "changed milestone to %\"12.1\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-31T09:20:14.031Z", "updated_at": "2019-05-31T09:20:14.036Z", "system": true, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 176687361, "type": null, "body": "Since https://gitlab.com/gitlab-org/gitlab-ce/commit/6b7a9b7498a4c91ca9c7324a0e31d8a142fddeef says that console messages are empty at the moment, I hard-coded it on Gitlab side and got those messages on push with our current implementation\n\nI believe this behavior is going to be the same for every command, which performs a request to `/allowed`\n\n@nick.thomas wdyt, can we close this issue then?", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-05-31T13:38:25.971Z", "updated_at": "2019-05-31T13:38:25.971Z", "system": false, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 176691967, "type": "DiscussionNote", "body": "@igor.drozdov do you get the hard-coded messages for the `discover` command? If so, I'm happy to close this :thumbsup:", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-05-31T13:51:04.422Z", "updated_at": "2019-05-31T13:54:14.070Z", "system": false, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}, {"id": 176693245, "type": "DiscussionNote", "body": "> do you get the hard-coded messages for the `discover` command?\n\nNo, because neither `discover` nor `2fa_recovery_codes` are performing a request to `/allowed` path, but we get console messages from the `/allowed` response", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-05-31T13:54:13.928Z", "updated_at": "2019-05-31T13:54:13.928Z", "system": false, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}, {"id": 177224980, "type": "DiscussionNote", "body": "@nick.thomas ^\n\n@igor.drozdov Don't forget to @-mention people in replies to ensure they get a notification and/or todo ;)", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-06-03T10:24:18.103Z", "updated_at": "2019-06-03T10:24:18.103Z", "system": false, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}, {"id": 177225495, "type": "DiscussionNote", "body": "@DouweM will do, thanks :)", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-03T10:25:33.813Z", "updated_at": "2019-06-03T10:25:33.813Z", "system": false, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}, {"id": 177232623, "type": "DiscussionNote", "body": "@igor.drozdov ah, you're right. We don't do this in the Ruby `discover` command either, or `lfs_authenticate`. So, there's nothing to do here and we can just close it :thumbsup:", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-03T10:45:30.142Z", "updated_at": "2019-06-03T10:45:30.142Z", "system": false, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 177232638, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-03T10:45:31.971Z", "updated_at": "2019-06-03T10:45:31.975Z", "system": true, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 177803580, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2019-06-04T14:40:51.507Z", "updated_at": "2019-06-04T14:40:51.513Z", "system": true, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}], [{"id": 179305164, "type": null, "body": "mentioned in issue gl-retrospectives/create-team#13", "attachment": null, "author": {"id": 1786152, "name": "\ud83e\udd16 GitLab Bot \ud83e\udd16", "username": "gitlab-bot", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1786152/avatar.png", "web_url": "https://gitlab.com/gitlab-bot"}, "created_at": "2019-06-09T07:24:18.849Z", "updated_at": "2019-06-09T07:24:18.852Z", "system": true, "noteable_id": 19724843, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 183}]]}, {"id": 19706732, "iid": 182, "project_id": 14022, "title": "lib/gitlab_net.rb:37:in `check_access': uninitialized constant GitlabNet::GitAccessStatus (NameError)", "description": "https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/291/diffs#53b0b184a87f6b3f24b7bd7c17c81f00e5c3c95b_3_0 removed `lib/gitlab_access.rb` which included `require_relative 'gitlab_access_status'`.\n\n`lib/gitlab_net.rb` needs to `require_relative 'gitlab_access_status'` now.\n\n/cc @nick.thomas, @jacobvosmaer\\-gitlab", "state": "closed", "created_at": "2019-04-04T01:53:21.928Z", "updated_at": "2019-08-07T08:33:24.622Z", "closed_at": "2019-04-04T02:20:34.260Z", "closed_by": {"id": 283999, "name": "Douglas Barbosa Alexandre", "username": "dbalexandre", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/283999/avatar.png", "web_url": "https://gitlab.com/dbalexandre"}, "labels": ["Geo [DEPRECATED]", "bug", "devops::enablement", "group::geo"], "milestone": {"id": 655279, "iid": 27, "group_id": 9970, "title": "11.10", "description": "", "state": "closed", "created_at": "2018-09-21T19:08:16.261Z", "updated_at": "2019-05-21T09:17:49.051Z", "due_date": "2019-04-22", "start_date": "2019-03-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/27"}, "assignees": [{"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}], "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "assignee": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "user_notes_count": 2, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/182", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/182", "notes": "https://gitlab.com/api/v4/projects/14022/issues/182/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/182/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 1, "epic_iid": null, "discussion": [[{"id": 157210383, "type": null, "body": "changed milestone to %\"11.10\"", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-04T01:53:31.662Z", "updated_at": "2019-04-04T01:53:31.662Z", "system": true, "noteable_id": 19706732, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 182}], [{"id": 157210392, "type": null, "body": "changed weight to **1**", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-04T01:53:35.035Z", "updated_at": "2019-04-04T01:53:35.035Z", "system": true, "noteable_id": 19706732, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 182}], [{"id": 157211688, "type": null, "body": "mentioned in merge request !292", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-04T02:07:15.541Z", "updated_at": "2019-04-04T02:07:15.541Z", "system": true, "noteable_id": 19706732, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 182}], [{"id": 157212992, "type": null, "body": "closed via merge request !292", "attachment": null, "author": {"id": 283999, "name": "Douglas Barbosa Alexandre", "username": "dbalexandre", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/283999/avatar.png", "web_url": "https://gitlab.com/dbalexandre"}, "created_at": "2019-04-04T02:20:34.310Z", "updated_at": "2019-04-04T02:20:34.310Z", "system": true, "noteable_id": 19706732, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 182}], [{"id": 157212995, "type": null, "body": "mentioned in commit a3bdb3ef8ccbb0601c79882480b48bde85611509", "attachment": null, "author": {"id": 283999, "name": "Douglas Barbosa Alexandre", "username": "dbalexandre", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/283999/avatar.png", "web_url": "https://gitlab.com/dbalexandre"}, "created_at": "2019-04-04T02:20:36.052Z", "updated_at": "2019-04-04T02:20:36.052Z", "system": true, "noteable_id": 19706732, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 182}], [{"id": 157213539, "type": null, "body": "As discussed on Slack, whilst CI was/is green, when actually performing a git pull/push etc from the command line, the error appears.\n\nThanks @dbalexandre :bow:", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-04T02:25:10.461Z", "updated_at": "2019-04-04T02:25:10.461Z", "system": false, "noteable_id": 19706732, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 182}], [{"id": 157346593, "type": null, "body": "Thanks @ashmckenzie @dbalexandre !", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2019-04-04T09:54:36.491Z", "updated_at": "2019-04-04T09:54:36.491Z", "system": false, "noteable_id": 19706732, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 182}]]}, {"id": 19333310, "iid": 181, "project_id": 14022, "title": "Rewrite bin/gitlab-shell-authorized-keys-check and bin/gitlab-shell-authorized-principals-check in Go", "description": "These are two simple wrappers around the GitLab API to generate `authorized_keys` lines in the face of two different configurations:\n\n* \"Fast SSH key lookup\" - sshd is configured with `AuthorizedKeysCommand`: https://docs.gitlab.com/ee/administration/operations/fast_ssh_key_lookup.html#fast-lookup-of-authorized-ssh-keys-in-the-database\n* Certificate-based SSH authentication - sshd is configured with `AuthorizedPrincipalsCommand`: https://docs.gitlab.com/ee/administration/operations/ssh_certificates.html#setting-up-ssh-certificate-lookup-via-gitlab-shell\n\nThey both need to be rewritten if we're to remove all Ruby code from the gitlab-shell project. Since they're invoked per-SSH-session in both of these configurations, *additionally* to the `bin/gitlab-shell` script, there are some latency wins from doing so.", "state": "closed", "created_at": "2019-03-21T10:55:13.025Z", "updated_at": "2019-09-09T07:20:22.150Z", "closed_at": "2019-08-14T03:43:09.612Z", "closed_by": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "labels": ["Create [DEPRECATED]", "Deliverable", "backend", "backstage", "devops::create", "golang", "group::source code", "workflow::In review"], "milestone": {"id": 731038, "iid": 37, "group_id": 9970, "title": "12.3", "description": "", "state": "closed", "created_at": "2018-12-07T12:40:55.400Z", "updated_at": "2019-09-23T17:14:54.242Z", "due_date": "2019-09-17", "start_date": "2019-08-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/37"}, "assignees": [{"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "user_notes_count": 7, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/181", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/181", "notes": "https://gitlab.com/api/v4/projects/14022/issues/181/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/181/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 2, "epic_iid": 706, "discussion": [[{"id": 152834412, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-03-21T10:59:28.922Z", "updated_at": "2019-03-21T10:59:28.922Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 152837533, "type": null, "body": "changed milestone to %\"11.11\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-03-21T11:04:49.268Z", "updated_at": "2019-03-21T11:04:49.268Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 152839250, "type": null, "body": "changed weight to **1**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-03-21T11:05:29.556Z", "updated_at": "2019-03-21T11:05:29.556Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 152841889, "type": null, "body": "@jramsay I'm provisionally adding this one to %11.11 so we can keep our goal of removing all Ruby code in %12.0 - these are very simple scripts, and can be feature-flagged in the same way we do for `bin/gitlab-shell` functionality, so it's low-weight. I think it makes sense to do them both together.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-03-21T11:06:34.632Z", "updated_at": "2019-03-21T11:06:34.632Z", "system": false, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 153026287, "type": null, "body": "Thanks @nick.thomas \u2013 I think 11.11 is pretty full already, but we'll where it lands :slight\\_smile:", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2019-03-21T18:41:43.692Z", "updated_at": "2019-03-21T18:41:53.078Z", "system": false, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 153256887, "type": null, "body": "changed weight to **2**", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-22T12:26:12.238Z", "updated_at": "2019-03-22T12:26:12.238Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 153258416, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-22T12:31:05.627Z", "updated_at": "2019-03-22T12:31:05.627Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 157471020, "type": null, "body": "changed milestone to %\"12.1\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-04-04T14:44:55.322Z", "updated_at": "2019-04-04T14:44:55.322Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 176578162, "type": null, "body": "changed milestone to %\"12.2\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-31T09:20:35.918Z", "updated_at": "2019-05-31T09:20:35.922Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 177804404, "type": null, "body": "changed milestone to %\"12.1\"", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2019-06-04T14:42:34.780Z", "updated_at": "2019-06-04T14:42:34.783Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 178136732, "type": null, "body": "mentioned in issue gitaly#1594", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-05T10:52:08.499Z", "updated_at": "2019-06-05T10:52:08.506Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 178138020, "type": "DiscussionNote", "body": "One disadvantage to doing this is increased disk space usage - per https://gitlab.com/gitlab-org/gitaly/issues/1594#note_178136709 , every additional Go binary we add will increase package size by 10-15MiB (depending on compression). It all adds up!\n\nOnce the migration is complete, assuming we just add 2 Go binaries here, then remove the three `gitaly-*` binaries, gitlab-shell will be overall size-neutral. However, we could save another ~30MiB by taking a busybox-style-binary approach to this problem.\n\nThe short version: `bin/gitlab-shell` would look at `os.Args[0]` and behave differently depending on the value. We then include *symlinks*: `gitlab-shell-authorized-keys-check -> gitlab-shell`, etc, in the package. We get the Go implementation, but the three functions share a single binary (and so Go runtime overhead) on disk, keeping the package, image, etc, sizes small.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-05T10:55:05.262Z", "updated_at": "2019-07-09T09:29:51.994Z", "system": false, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}, {"id": 189770071, "type": "DiscussionNote", "body": "@nick.thomas just want to clarify some things about this plan. Do you mean the following:\n\n1. Add `authorized-keys-check` and `authorized-principals-check` as commands.\n1. Modify `bin/gitlab-shell-authorized-keys-check` and `bin/gitlab-shell-authorized-principals-check` to become simple shell scripts that call `bin/gitlab-shell` with the appropriate arguments (e.g. `./gitlab-shell authorized-keys-check $@`)?", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-07-09T09:29:51.886Z", "updated_at": "2019-07-09T09:29:51.886Z", "system": false, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}, {"id": 189987985, "type": "DiscussionNote", "body": "@patrickbajao That isn't quite it, since it would permit people logging in over SSH to run `gitlab-shell authorized-keys-check ...`, which would be quite weird.\n\nIf `bin/gitlab-shell-authorized-keys-check` is a *symlink* to `bin/gitlab-shell`, then the latter can inspect `os.Executable()` and observe that its basename is `gitlab-shell-authorized-keys-check`, rather than `gitlab-shell`, and behave differently as a result. Does that make sense?\n\nIt's only an idea, and as the implementer, it's very much up to you to decide what's most sensible! If you'd rather go the separate-binaries route, I won't oppose it, I'll just make sad faces about the size of the omnibus package :sweat_smile:", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-07-09T17:02:50.868Z", "updated_at": "2019-07-09T17:02:50.868Z", "system": false, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}, {"id": 190189043, "type": "DiscussionNote", "body": "> That isn't quite it, since it would permit people logging in over SSH to run `gitlab-shell authorized-keys-check ...`, which would be quite weird.\n\nYeah I was thinking the same thing that's why I clarified what you meant because that's how I understood your previous post because `os.Args[0]` was mentioned. All clear now. :smile: \n\n> If `bin/gitlab-shell-authorized-keys-check` is a *symlink* to `bin/gitlab-shell`, then the latter can inspect `os.Executable()` and observe that its basename is `gitlab-shell-authorized-keys-check`, rather than `gitlab-shell`, and behave differently as a result. Does that make sense?\n\nYup, this makes sense and I believe it's inline with what I have in mind. :+1: \n\n> It's only an idea, and as the implementer, it's very much up to you to decide what's most sensible! If you'd rather go the separate-binaries route, I won't oppose it, I'll just make sad faces about the size of the omnibus package\n\n:laughing: Yeah I like to keep a single binary too. I think it's simpler to have a single entry point.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-07-10T07:06:39.063Z", "updated_at": "2019-07-10T07:06:39.063Z", "system": false, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 188106800, "type": null, "body": "changed milestone to %\"12.2\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-07-03T16:07:49.527Z", "updated_at": "2019-07-03T16:07:49.531Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 188809674, "type": null, "body": "assigned to @patrickbajao", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-07-05T13:14:17.908Z", "updated_at": "2019-07-05T13:14:17.913Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 192825241, "type": null, "body": "mentioned in merge request !317", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-07-17T13:43:05.003Z", "updated_at": "2019-07-17T13:43:05.132Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 194308681, "type": null, "body": "mentioned in merge request !318", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-07-22T10:55:12.630Z", "updated_at": "2019-07-22T10:55:12.633Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 194676492, "type": null, "body": "mentioned in merge request !321", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-07-23T08:27:32.043Z", "updated_at": "2019-07-23T08:27:32.088Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 194696605, "type": null, "body": "mentioned in merge request !322", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-07-23T08:57:17.431Z", "updated_at": "2019-07-23T08:57:17.434Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 200130437, "type": null, "body": "mentioned in issue #202", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-05T10:44:49.021Z", "updated_at": "2019-08-05T10:44:49.026Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 201308110, "type": null, "body": "mentioned in issue create-stage#21", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-08-07T19:50:46.102Z", "updated_at": "2019-08-07T19:50:46.105Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 201310831, "type": null, "body": "This is currently ~\"workflow::In review\" and very close to ready, but is not expected to make it in before the end of the %\"12.2\" cycle (EOD August 7), which means it's technically slipping into the %\"12.3\" cycle, so I'm changing the milestone accordingly. However, the remaining work is minimal, and it's expected to make it in this week or early next week, likely in time to end up in the %\"12.2\" release.", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-08-07T20:01:20.118Z", "updated_at": "2019-08-07T20:01:20.118Z", "system": false, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 201310832, "type": null, "body": "changed milestone to %\"12.3\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-08-07T20:01:20.327Z", "updated_at": "2019-08-07T20:01:20.330Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 203439239, "type": null, "body": "closed via merge request !322", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-08-14T03:43:09.716Z", "updated_at": "2019-08-14T03:43:09.720Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 203439241, "type": null, "body": "mentioned in commit f34e2cd5c4194aa8bb049e1ac8aa1b2f002395b5", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-08-14T03:43:10.180Z", "updated_at": "2019-08-14T03:43:10.184Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 204341677, "type": null, "body": "mentioned in issue #206", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-16T08:05:08.604Z", "updated_at": "2019-08-16T08:05:08.608Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 204803385, "type": null, "body": "mentioned in issue gl-retrospectives/create-stage/source-code#2", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-17T23:35:54.555Z", "updated_at": "2019-08-17T23:35:54.561Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}], [{"id": 214005785, "type": null, "body": "mentioned in issue gl-retrospectives/create-stage/source-code#3", "attachment": null, "author": {"id": 1786152, "name": "\ud83e\udd16 GitLab Bot \ud83e\udd16", "username": "gitlab-bot", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1786152/avatar.png", "web_url": "https://gitlab.com/gitlab-bot"}, "created_at": "2019-09-09T07:20:22.130Z", "updated_at": "2019-09-09T07:20:22.133Z", "system": true, "noteable_id": 19333310, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 181}]]}, {"id": 19044874, "iid": 180, "project_id": 14022, "title": "Run gitlab-qa on gitlab-shell branches before merge", "description": "Just as we can test changes to gitlab-ce using gitlab-qa before merging, I think it would be valuable to be able to test changes to gitlab-shell using gitlab-qa before merging.\n\nOnly a subset of gitlab-qa tests make sense in conjunction with gitlab-shell changes - mostly those dealing with git pulls and pushes, especially over ssh (but also over http and changes via the web UI, for as long as the hooks reside within gitaly)\n\nIdeally, I think we'd have a manual `package-qa` job we could trigger for MRs that we want to get some extra certainty on.\n\ncc @meks @mlapierre", "state": "opened", "created_at": "2019-03-12T20:55:05.370Z", "updated_at": "2019-10-15T05:03:51.553Z", "closed_at": null, "closed_by": null, "labels": ["Category:System Testing", "Create [DEPRECATED]", "QA", "Quality", "devops::create"], "milestone": {"id": 693518, "iid": 33, "group_id": 9970, "title": "12.0", "description": "", "state": "closed", "created_at": "2018-10-30T16:47:37.975Z", "updated_at": "2019-07-08T20:39:06.020Z", "due_date": "2019-06-22", "start_date": "2019-05-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/33"}, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 2, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/180", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/180", "notes": "https://gitlab.com/api/v4/projects/14022/issues/180/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/180/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 149852205, "type": null, "body": "mentioned in merge request !280", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-03-12T20:55:21.485Z", "updated_at": "2019-03-12T20:55:21.485Z", "system": true, "noteable_id": 19044874, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 180}], [{"id": 149877438, "type": null, "body": "Thanks @nick.thomas!! I am going to let @at.ramya take the lead on this and factor it into our schedule in the Dev test automation side of things.", "attachment": null, "author": {"id": 2097582, "name": "Mek Stittri", "username": "meks", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2097582/avatar.png", "web_url": "https://gitlab.com/meks"}, "created_at": "2019-03-12T22:52:43.139Z", "updated_at": "2019-03-12T22:52:43.139Z", "system": false, "noteable_id": 19044874, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 180}], [{"id": 149973493, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 2311904, "name": "Ramya Authappan", "username": "at.ramya", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2311904/avatar.png", "web_url": "https://gitlab.com/at.ramya"}, "created_at": "2019-03-13T08:38:52.706Z", "updated_at": "2019-03-13T08:38:52.706Z", "system": true, "noteable_id": 19044874, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 180}], [{"id": 156981170, "type": null, "body": "mentioned in merge request !291", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-03T12:35:16.670Z", "updated_at": "2019-04-03T12:35:16.670Z", "system": true, "noteable_id": 19044874, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 180}], [{"id": 157469811, "type": null, "body": "mentioned in issue #139", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:41:57.018Z", "updated_at": "2019-04-04T14:41:57.018Z", "system": true, "noteable_id": 19044874, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 180}], [{"id": 230157093, "type": null, "body": "mentioned in merge request !338", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-14T16:38:54.381Z", "updated_at": "2019-10-14T16:38:54.384Z", "system": true, "noteable_id": 19044874, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 180}], [{"id": 230371934, "type": null, "body": "mentioned in issue #217", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-15T05:03:51.522Z", "updated_at": "2019-10-15T05:03:51.525Z", "system": true, "noteable_id": 19044874, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 180}]]}, {"id": 18909411, "iid": 179, "project_id": 14022, "title": "Support calling the internal API over HTTPS", "description": "We need to support calling the internal API over HTTPS. \n\nWe need to allow disabling certificate validation: https://gitlab.com/gitlab-org/gitlab-shell/blob/6109b64ed81f80e90bf094ad1f1ded8f5e5f8324/lib/http_helper.rb#L35\n\nWe currently also support specifying a custom certificate file or path: https://gitlab.com/gitlab-org/gitlab-shell/blob/6109b64ed81f80e90bf094ad1f1ded8f5e5f8324/lib/http_helper.rb#L103-116", "state": "closed", "created_at": "2019-03-08T11:18:37.524Z", "updated_at": "2019-05-01T15:31:33.328Z", "closed_at": "2019-05-01T15:31:33.162Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["Create [DEPRECATED]", "Stretch", "backend", "devops::create", "group::source code"], "milestone": {"id": 655280, "iid": 28, "group_id": 9970, "title": "11.11", "description": "", "state": "closed", "created_at": "2018-09-21T19:08:37.027Z", "updated_at": "2019-06-10T14:39:00.009Z", "due_date": "2019-05-22", "start_date": "2019-04-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/28"}, "assignees": [{"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}], "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "assignee": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "user_notes_count": 2, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/179", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/179", "notes": "https://gitlab.com/api/v4/projects/14022/issues/179/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/179/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 2, "epic_iid": 706, "discussion": [[{"id": 148590814, "type": null, "body": "changed weight to **1**", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-03-08T11:18:37.592Z", "updated_at": "2019-03-08T11:18:37.592Z", "system": true, "noteable_id": 18909411, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 179}], [{"id": 148592845, "type": null, "body": "changed weight to **2**", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-03-08T11:26:03.029Z", "updated_at": "2019-03-08T11:26:03.029Z", "system": true, "noteable_id": 18909411, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 179}], [{"id": 148598778, "type": null, "body": "@jacobvosmaer\\-gitlab Mentioned we should consider dropping support of specifying the certificates in the gitlab-shell config directly. But instead figure out a way to count on the certificates configured by omnibus.\n\nhttps://golang.org/pkg/crypto/x509/ mentions\n>>>\nOn UNIX systems the environment variables SSL_CERT_FILE and SSL_CERT_DIR can be used to override the system default locations for the SSL certificate file and SSL certificate files directory, respectively. \n>>>\n\nBut I'm not sure how we can export that variable with the correct info so it's available for the new and improved gitlab-shell.", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-03-08T11:47:37.006Z", "updated_at": "2019-03-08T11:47:37.006Z", "system": false, "noteable_id": 18909411, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 179}], [{"id": 148599150, "type": null, "body": "mentioned in epic &706", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-03-08T11:49:07.813Z", "updated_at": "2019-03-08T11:49:07.813Z", "system": true, "noteable_id": 18909411, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 179}], [{"id": 148621988, "type": null, "body": "I think we may be stuck with having cert file/path settings in config.yml.\n\n- We should not tightly couple gitlab-shell to omnibus-gitlab; gitlab-shell should not \"know\" things about omnibus\n- Reliably injecting environment variables into `bin/gitlab-shell` can be a big pain. Speaking from memories from long ago, I remember that it depended on the Linux distribution and the particular shell configured for the `git` user where and how we could set environment variables. You can't just blindly use `.bashrc` because (a) the shell may not be Bash, and (b) the shell may not be a login shell (`bash -l`). Have fun understanding how shell startup scripts get selected, and which one you need to edit to get an env var into an SSH session. Sometimes we had to edit `/etc/profile`. Or maybe just edit sshd_config. Do we want to force users to do that, if we already have a config file `gitlab-shell/config.yml`?", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2019-03-08T13:12:26.640Z", "updated_at": "2019-03-08T13:13:15.459Z", "system": false, "noteable_id": 18909411, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 179}], [{"id": 149276955, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-11T15:45:40.392Z", "updated_at": "2019-03-11T15:45:40.392Z", "system": true, "noteable_id": 18909411, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 179}], [{"id": 153258368, "type": null, "body": "changed milestone to %\"12.1\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-22T12:30:58.345Z", "updated_at": "2019-03-22T12:30:58.345Z", "system": true, "noteable_id": 18909411, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 179}], [{"id": 157471396, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-04-04T14:45:51.990Z", "updated_at": "2019-04-04T14:45:51.990Z", "system": true, "noteable_id": 18909411, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 179}], [{"id": 161989375, "type": null, "body": "mentioned in merge request !295", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-04-18T07:01:35.937Z", "updated_at": "2019-04-18T07:01:35.937Z", "system": true, "noteable_id": 18909411, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 179}], [{"id": 164197065, "type": null, "body": "assigned to @igor.drozdov", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-04-25T12:22:08.938Z", "updated_at": "2019-04-25T12:22:08.938Z", "system": true, "noteable_id": 18909411, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 179}], [{"id": 164200251, "type": null, "body": "mentioned in merge request !297", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-04-25T12:29:42.207Z", "updated_at": "2019-04-25T12:29:42.207Z", "system": true, "noteable_id": 18909411, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 179}], [{"id": 165211951, "type": null, "body": "changed milestone to %\"11.11\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-04-29T13:48:47.512Z", "updated_at": "2019-04-29T13:48:47.512Z", "system": true, "noteable_id": 18909411, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 179}], [{"id": 165874374, "type": null, "body": "mentioned in issue #186", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-01T13:23:10.265Z", "updated_at": "2019-05-01T13:23:10.265Z", "system": true, "noteable_id": 18909411, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 179}], [{"id": 165902382, "type": null, "body": "mentioned in commit 1f6b19d8d208f696b8227095d741c355d106a11d", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-05-01T15:31:33.266Z", "updated_at": "2019-05-01T15:31:33.266Z", "system": true, "noteable_id": 18909411, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 179}], [{"id": 165902383, "type": null, "body": "closed via merge request !297", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-05-01T15:31:33.275Z", "updated_at": "2019-05-01T15:31:33.275Z", "system": true, "noteable_id": 18909411, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 179}]]}, {"id": 18909316, "iid": 178, "project_id": 14022, "title": "Support calling the gitlab internal api using regular HTTP", "description": "After we finish making requests over a unix socket, we should add support for regular HTTP requests.", "state": "closed", "created_at": "2019-03-08T11:13:46.070Z", "updated_at": "2019-05-09T07:21:35.485Z", "closed_at": "2019-04-24T11:19:20.422Z", "closed_by": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "labels": ["Create [DEPRECATED]", "Deliverable", "backend", "backstage", "devops::create", "group::source code", "repository", "workflow::In review"], "milestone": {"id": 655280, "iid": 28, "group_id": 9970, "title": "11.11", "description": "", "state": "closed", "created_at": "2018-09-21T19:08:37.027Z", "updated_at": "2019-06-10T14:39:00.009Z", "due_date": "2019-05-22", "start_date": "2019-04-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/28"}, "assignees": [{"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}], "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "assignee": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "user_notes_count": 4, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/178", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/178", "notes": "https://gitlab.com/api/v4/projects/14022/issues/178/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/178/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 2, "epic_iid": 706, "discussion": [[{"id": 148589246, "type": null, "body": "changed weight to **1**", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-03-08T11:13:46.124Z", "updated_at": "2019-03-08T11:13:46.124Z", "system": true, "noteable_id": 18909316, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 178}], [{"id": 148589430, "type": null, "body": "After https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/283/ is merged, this could be a simple client implementing the `GitlabClient` interface.", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-03-08T11:14:21.640Z", "updated_at": "2019-03-08T11:14:21.640Z", "system": false, "noteable_id": 18909316, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 178}], [{"id": 148599149, "type": null, "body": "mentioned in epic &706", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-03-08T11:49:07.714Z", "updated_at": "2019-03-08T11:49:07.714Z", "system": true, "noteable_id": 18909316, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 178}], [{"id": 148616378, "type": null, "body": "I don't know _why_ we support setting basic auth headers on internal API requests -- GitLab itself doesn't use basic auth on that API -- but I suspect that when you implement the HTTP client, for completeness sake you would have to support basic auth from the start.\n\nIt's not hard, but something to keep in mind.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2019-03-08T12:52:55.040Z", "updated_at": "2019-03-08T12:52:55.040Z", "system": false, "noteable_id": 18909316, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 178}], [{"id": 149276940, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-11T15:45:39.105Z", "updated_at": "2019-03-11T15:45:39.105Z", "system": true, "noteable_id": 18909316, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 178}], [{"id": 152996545, "type": null, "body": "@DouweM Given that gitlab-shell on `dev.gitlab.org` communicates with unicorn over http, I was wondering if we should move this up. .org would be the first _real_ instance we would like to test this one.", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-03-21T17:06:24.903Z", "updated_at": "2019-03-21T17:06:24.903Z", "system": false, "noteable_id": 18909316, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 178}], [{"id": 153256468, "type": null, "body": "changed weight to **2**", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-22T12:24:54.199Z", "updated_at": "2019-03-22T12:24:54.199Z", "system": true, "noteable_id": 18909316, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 178}], [{"id": 153258423, "type": null, "body": "changed milestone to %\"11.11\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-22T12:31:06.638Z", "updated_at": "2019-03-22T12:31:06.638Z", "system": true, "noteable_id": 18909316, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 178}], [{"id": 158411185, "type": null, "body": "assigned to @igor.drozdov", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-04-08T11:59:08.292Z", "updated_at": "2019-04-08T11:59:08.292Z", "system": true, "noteable_id": 18909316, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 178}], [{"id": 159817962, "type": null, "body": "mentioned in merge request !295", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-04-11T13:22:19.456Z", "updated_at": "2019-04-11T13:22:19.456Z", "system": true, "noteable_id": 18909316, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 178}], [{"id": 163786594, "type": null, "body": "Closing due to https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/295", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-04-24T11:19:18.372Z", "updated_at": "2019-04-24T11:19:18.372Z", "system": false, "noteable_id": 18909316, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 178}], [{"id": 163786603, "type": null, "body": "closed", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-04-24T11:19:20.495Z", "updated_at": "2019-04-24T11:19:20.495Z", "system": true, "noteable_id": 18909316, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 178}], [{"id": 165874373, "type": null, "body": "mentioned in issue #186", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-01T13:23:10.239Z", "updated_at": "2019-05-01T13:23:10.239Z", "system": true, "noteable_id": 18909316, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 178}], [{"id": 168202737, "type": null, "body": "mentioned in issue gl-retrospectives/create-team#12", "attachment": null, "author": {"id": 1786152, "name": "\ud83e\udd16 GitLab Bot \ud83e\udd16", "username": "gitlab-bot", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1786152/avatar.png", "web_url": "https://gitlab.com/gitlab-bot"}, "created_at": "2019-05-09T07:21:35.432Z", "updated_at": "2019-05-09T07:21:35.435Z", "system": true, "noteable_id": 18909316, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 178}]]}, {"id": 18467550, "iid": 177, "project_id": 14022, "title": "HTTP Client Sending Erroneous Content-Length Header", "description": "I use LigHTTPd for my front-end HTTP daemon, and for a while, I was proxying requests through nginx.  I've recently finished a working pure-lighttpd configuration, however, and nixed nginx.  I now notice that I am getting HTTP 400 errors from lighttpd when sending API requests from gitlab-shell.\n\ngitlab-shell.log:\n```\ntime=\"2019-02-21T02:18:02-06:00\" level=info msg=\"finished HTTP request\" duration=0.482453862 method=GET pid=14986 url=\"https://[redacted]/api/v4/internal/check\"\ntime=\"2019-02-21T02:18:02-06:00\" level=error msg=\"Call failed\" body=\"<?xml version=\\\"1.0\\\" encoding=\\\"iso-8859-1\\\"?>\\n<!DOCTYPE html PUBLIC \\\"-//W3C//DTD XHTML 1.0 Transitional//EN\\\"\\n         \\\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\\\">\\n<html xmlns=\\\"http://www.w3.org/1999/xhtml\\\" xml:lang=\\\"en\\\" lang=\\\"en\\\">\\n <head>\\n  <title>400 Bad Request</title>\\n </head>\\n <body>\\n  <h1>400 Bad Request</h1>\\n </body>\\n</html>\\n\" code=400 method=GET pid=14986 url=\"https://[redacted]/api/v4/internal/check\"\n```\n\nlighttpd/error.log:\n```\n2019-02-21 02:31:20: (request.c.1163) GET/HEAD with content-length -> 400\n```\n\nApparently, gitlab-shell is sending a GET or HEAD request with a Content-Length header, which is... [Wrong?](https://redmine.lighttpd.net/issues/2933).  As a result, lighttpd is [triggering an error](https://github.com/lighttpd/lighttpd1.4/blob/f5f221eda837cecb3a52c297ac0ff36665e165e2/src/request.c#L892).", "state": "closed", "created_at": "2019-02-21T08:52:02.867Z", "updated_at": "2019-02-23T02:23:44.727Z", "closed_at": "2019-02-21T19:09:42.040Z", "closed_by": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "labels": [], "milestone": null, "assignees": [], "author": {"id": 57014, "name": "Rob Nelson", "username": "N3X15", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/85b30979271e470ba965725bcb602737?s=80&d=identicon", "web_url": "https://gitlab.com/N3X15"}, "assignee": null, "user_notes_count": 5, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/177", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/177", "notes": "https://gitlab.com/api/v4/projects/14022/issues/177/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/177/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 143529557, "type": null, "body": "I should mention that gitlab is unusable with lighttpd until this is fixed.", "attachment": null, "author": {"id": 57014, "name": "Rob Nelson", "username": "N3X15", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/85b30979271e470ba965725bcb602737?s=80&d=identicon", "web_url": "https://gitlab.com/N3X15"}, "created_at": "2019-02-21T08:52:53.360Z", "updated_at": "2019-02-21T08:52:53.360Z", "system": false, "noteable_id": 18467550, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 177}], [{"id": 143531129, "type": null, "body": "mentioned in merge request gitlab-recipes!81", "attachment": null, "author": {"id": 57014, "name": "Rob Nelson", "username": "N3X15", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/85b30979271e470ba965725bcb602737?s=80&d=identicon", "web_url": "https://gitlab.com/N3X15"}, "created_at": "2019-02-21T08:55:01.209Z", "updated_at": "2019-02-21T08:55:01.209Z", "system": true, "noteable_id": 18467550, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 177}], [{"id": 143667154, "type": null, "body": "This sounds a limitation with lighttpd, although there's a bit of conflicting info. https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.13 says this is allowed:\n\n> The Content-Length entity-header field indicates the size of the entity-body, in decimal number of OCTETs, sent to the recipient or, in the case of the HEAD method, the size of the entity-body that would have been sent had the request been a GET.\n\nBut then in https://tools.ietf.org/html/rfc7231#section-4.3.1:\n\n> A payload within a GET request message has no defined semantics; sending a payload body on a GET request might cause some existing implementations to reject the request.\n\nFor example, the following Ruby code will automatically set the Content-Length:\n\n```ruby\nrequire \"net/http\"\nrequire \"uri\"\n\nuri = URI.parse(\"http://localhost:9123\")\n\nhttp = Net::HTTP.new(uri.host, uri.port)\nreq = Net::HTTP::Get.new(uri.request_uri)\nreq.body = 'testing'\nresponse = http.request(req)\n```\n\nhttps://stackoverflow.com/a/8540951 has more discussion about this. We're only using the body to send the gitlab-shell token at the moment, but we might consider switching these requests to POST.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2019-02-21T14:32:33.337Z", "updated_at": "2019-02-21T14:32:33.337Z", "system": false, "noteable_id": 18467550, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 177}], [{"id": 143769617, "type": null, "body": "Yeah, as seen above, the lighttpd developer is adamant about using the RFC 7231 definition as a justification for just denying the request.\n  \n * https://redmine.lighttpd.net/issues/2933\n * https://redmine.lighttpd.net/boards/2/topics/3346\n * https://redmine.lighttpd.net/issues/2871\n\nI'm going to try and work around this by attempting to just give gitlab-shell direct access to workhorse, even though that's going to be a bit hairy to implement.  We'll see how this goes.", "attachment": null, "author": {"id": 57014, "name": "Rob Nelson", "username": "N3X15", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/85b30979271e470ba965725bcb602737?s=80&d=identicon", "web_url": "https://gitlab.com/N3X15"}, "created_at": "2019-02-21T18:59:20.521Z", "updated_at": "2019-02-21T18:59:43.642Z", "system": false, "noteable_id": 18467550, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 177}], [{"id": 143771669, "type": null, "body": "Note that supporting this would require changing https://gitlab.com/gitlab-org/gitlab-ce/blob/master/lib/api/internal.rb to use POST instead of GET, but that could throw off the `ReadOnlyMiddleware`, which disallows POST requests in the case of a Geo secondary (or some other read-only system). Changing gitlab-shell to use POST would be relatively simple after that.\n\nBut the way we're using GET, while perhaps not completely to the spec, seems to work fine with NGINX and Apache, two Web servers we actually support. I don't foresee us supporting lighttpd in the near future. I'm going to close this for now.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2019-02-21T19:09:41.737Z", "updated_at": "2019-02-21T19:09:41.737Z", "system": false, "noteable_id": 18467550, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 177}], [{"id": 143771670, "type": null, "body": "closed", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2019-02-21T19:09:42.128Z", "updated_at": "2019-02-21T19:09:42.128Z", "system": true, "noteable_id": 18467550, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 177}], [{"id": 143803883, "type": null, "body": "mentioned in commit N3X15/gitlab-recipes@57b77352aeacda5522d454b84fe22cb943ef4757", "attachment": null, "author": {"id": 57014, "name": "Rob Nelson", "username": "N3X15", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/85b30979271e470ba965725bcb602737?s=80&d=identicon", "web_url": "https://gitlab.com/N3X15"}, "created_at": "2019-02-21T20:18:47.507Z", "updated_at": "2019-02-21T20:18:47.507Z", "system": true, "noteable_id": 18467550, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 177}], [{"id": 144223249, "type": null, "body": "I've worked with the lighttpd developers to develop a configuration option around this.  It's still experimental, but it allows GETs with bodies and Content-Length through.\n\nhttps://gitlab.com/N3X15/lighttpd1.4/commit/92b8ce1212bcc1d9748844391ecc2c0b4a5960c4", "attachment": null, "author": {"id": 57014, "name": "Rob Nelson", "username": "N3X15", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/85b30979271e470ba965725bcb602737?s=80&d=identicon", "web_url": "https://gitlab.com/N3X15"}, "created_at": "2019-02-23T02:23:44.710Z", "updated_at": "2019-02-23T02:24:01.175Z", "system": false, "noteable_id": 18467550, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 177}]]}, {"id": 17914439, "iid": 176, "project_id": 14022, "title": "GitLab Shell v8.4.3 fails at compile", "description": "I'm updating source GitLab from 11.5 to 11.6. When I try to update gitlab-shell, the following error comes up at compile step:\n\nsudo -u git -H bin/compile\n\ncommand failed: {\"GOPATH\"=>\"/home/git/gitlab-shell/go_build\", \"GO15VENDOREXPERIMENT\"=>\"1\"} go install gitlab.com/gitlab-org/gitlab-shell/go/cmd/...\n\nMy GO version is \"go version go1.10.5 linux/amd64\". I have managed to do a successful updates since GitLab version 10.6, following your source update guide. This is the first time it failed.", "state": "opened", "created_at": "2019-02-03T08:51:15.275Z", "updated_at": "2019-02-03T08:51:35.110Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 3487317, "name": "Zeljko Jagust", "username": "zjagust", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e2a62576bd11fdd53af5abaf77ef8d06?s=80&d=identicon", "web_url": "https://gitlab.com/zjagust"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/176", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/176", "notes": "https://gitlab.com/api/v4/projects/14022/issues/176/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/176/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 137794131, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 3487317, "name": "Zeljko Jagust", "username": "zjagust", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e2a62576bd11fdd53af5abaf77ef8d06?s=80&d=identicon", "web_url": "https://gitlab.com/zjagust"}, "created_at": "2019-02-03T08:51:35.143Z", "updated_at": "2019-02-03T08:51:35.143Z", "system": true, "noteable_id": 17914439, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 176}]]}, {"id": 17883514, "iid": 175, "project_id": 14022, "title": "Migrate gitlab-shell discover command to Golang", "description": "Migrate the functionality saying hello to users through SSH to Golang:\n\n```\n\u276f ssh git@gitlab.com\nWelcome to GitLab, @reprazent!\nConnection to gitlab.com closed.\n```\n\nThis would include the first API call through unix sockets to `/internal/discover`.\n\nThis will need to support reading the API token from a file, and get optional HTTP Basic Auth username & password from the config.", "state": "closed", "created_at": "2019-02-01T10:52:31.579Z", "updated_at": "2019-07-04T08:49:53.380Z", "closed_at": "2019-03-15T17:16:18.752Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["Create [DEPRECATED]", "Deliverable", "backend", "backstage", "devops::create", "golang", "missed-deliverable", "missed:11.9"], "milestone": {"id": 655279, "iid": 27, "group_id": 9970, "title": "11.10", "description": "", "state": "closed", "created_at": "2018-09-21T19:08:16.261Z", "updated_at": "2019-05-21T09:17:49.051Z", "due_date": "2019-04-22", "start_date": "2019-03-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/27"}, "assignees": [{"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}], "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "assignee": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "user_notes_count": 6, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/175", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/175", "notes": "https://gitlab.com/api/v4/projects/14022/issues/175/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/175/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 5, "epic_iid": 706, "discussion": [[{"id": 137406915, "type": null, "body": "changed milestone to %\"11.9\"", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-02-01T10:52:31.632Z", "updated_at": "2019-02-01T10:52:31.632Z", "system": true, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 137406916, "type": null, "body": "changed weight to **5**", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-02-01T10:52:31.663Z", "updated_at": "2019-02-01T10:52:31.663Z", "system": true, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 137408130, "type": null, "body": "@DouweM @nick.thomas I'd like to propose this as the first user facing functionality to be ported. Some of prep work has been done around https://gitlab.com/gitlab-org/gitlab-shell/issues/158. Mainly https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/270. But I feel like \"Port entire GitLabNet to go\" is not an easy thing to work at as there's no real outcome.", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-02-01T10:55:41.112Z", "updated_at": "2019-02-01T10:55:41.112Z", "system": false, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 137408322, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-02-01T10:56:10.345Z", "updated_at": "2019-02-01T10:56:10.345Z", "system": true, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 137409326, "type": null, "body": "mentioned in epic &706", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-02-01T10:58:56.823Z", "updated_at": "2019-02-01T10:58:56.823Z", "system": true, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 137409900, "type": null, "body": "mentioned in issue #158", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-02-01T11:00:30.530Z", "updated_at": "2019-02-01T11:00:30.530Z", "system": true, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 137410323, "type": null, "body": "I've weighted this quite heavily as it would include some API setup stuff, we might be able to reuse some of https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/234 for that.", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-02-01T11:01:40.378Z", "updated_at": "2019-02-01T11:01:40.378Z", "system": false, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 137480319, "type": null, "body": "changed title from **Migrate gitlab-shell discove{-e-}r command to Golang** to **Migrate gitlab-shell discover command to Golang**", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-02-01T13:55:42.580Z", "updated_at": "2019-02-01T13:55:42.580Z", "system": true, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 137533931, "type": null, "body": "assigned to @reprazent", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-02-01T16:00:28.793Z", "updated_at": "2019-02-01T16:00:28.793Z", "system": true, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 147743704, "type": null, "body": "changed milestone to %\"11.10\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-06T11:02:11.855Z", "updated_at": "2019-03-06T11:02:11.855Z", "system": true, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 148593305, "type": null, "body": "mentioned in issue #159", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-08T11:27:45.660Z", "updated_at": "2019-03-08T11:27:45.660Z", "system": true, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 148599723, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-03-08T11:51:18.819Z", "updated_at": "2019-03-08T11:51:18.819Z", "system": true, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 148623525, "type": null, "body": "> This will need to support reading the API token from a file,\n\nRegarding this, Do I understand it correctly that currently we're mixing that token into the JSON or as form data? https://gitlab.com/gitlab-org/gitlab-shell/blob/6109b64ed81f80e90bf094ad1f1ded8f5e5f8324/lib/http_helper.rb#L49-53\nHow does this work for GET requests?\n\nI wonder if it would make sense to add support for passing this as a header instead. \n\n@nick.thomas @DouweM Any thoughts? I personally prefer the header approach, but we'd need to support both for a while, I think?", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-03-08T13:17:32.551Z", "updated_at": "2019-03-08T13:17:32.551Z", "system": false, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 148803118, "type": null, "body": "mentioned in issue gl-retrospectives/create-team#9", "attachment": null, "author": {"id": 1786152, "name": "\ud83e\udd16 GitLab Bot \ud83e\udd16", "username": "gitlab-bot", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1786152/avatar.png", "web_url": "https://gitlab.com/gitlab-bot"}, "created_at": "2019-03-09T07:21:15.052Z", "updated_at": "2019-03-09T07:21:15.052Z", "system": true, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 148846061, "type": null, "body": "@reprazent I don't mind the header approach, but there's also nothing particularly bad about the body approach. GET requests *can* have bodies. The current RFCs on the matter just state:\n\n>  A payload within a GET request message has no defined semantics; sending a payload body on a GET request might cause some existing implementations to reject the request.\n\nPutting authentication information inside it for a self-declared internal API is absolutely fine. If we want to migrate to a header, I suggest we do so independently of the ruby->go migration.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-03-09T12:40:27.338Z", "updated_at": "2019-03-09T12:40:27.338Z", "system": false, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 148857359, "type": null, "body": "@nick.thomas I don't have anything particular _against_ putting the secret in the body. Though for GETs I think it's a bit weird that the params get mashed together with the querystring on the GitLab-rails side. \n\n> If we want to migrate to a header, I suggest we do so independently of the ruby->go migration.\n\nThe current implementation is a bit weird as we use a different approach for GET & POST: For GETs we add the token to the body encapsulated in a form body. While when POSTing JSON, we add a field to the JSON itself.\n\nHaving it in a header would make passing the token around consistent across both methods, and thus I think the implementation will be simpler. \n\nWhat would you think about adding the support for a header (https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/25924), but keeping both for now (there's more consumers of the internal API than gitlab-shell, I think). While only implementing the header approach in go-gitlab-shell? Or would you recommend implementing the body approach in go, and then migrating it later?", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-03-09T13:32:55.609Z", "updated_at": "2019-03-09T13:32:55.609Z", "system": false, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 148857930, "type": null, "body": "> While only implementing the header approach in go-gitlab-shell\n\n@reprazent as long as the feature flag for go discover is off by default, I think we can merge both into %11.10 while only supporting the header approach in go-gitlab-shell. I don't have a strong opinion here, just a mild preference for not coupling application changes to the go migration ^^", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-03-09T13:40:53.589Z", "updated_at": "2019-03-09T13:41:04.404Z", "system": false, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 150151642, "type": null, "body": "mentioned in merge request !283", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-03-13T15:25:40.433Z", "updated_at": "2019-03-13T15:25:40.433Z", "system": true, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 150987728, "type": null, "body": "closed via merge request !283", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-03-15T17:16:18.811Z", "updated_at": "2019-03-15T17:16:18.811Z", "system": true, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 150987731, "type": null, "body": "mentioned in commit f237aba6df1c1873f1f9d5ba18c3b8924d85cb51", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-03-15T17:16:19.028Z", "updated_at": "2019-03-15T17:16:19.028Z", "system": true, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}], [{"id": 158801272, "type": null, "body": "mentioned in issue gl-retrospectives/create-team#10", "attachment": null, "author": {"id": 1786152, "name": "\ud83e\udd16 GitLab Bot \ud83e\udd16", "username": "gitlab-bot", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1786152/avatar.png", "web_url": "https://gitlab.com/gitlab-bot"}, "created_at": "2019-04-09T09:47:25.189Z", "updated_at": "2019-04-09T09:47:25.189Z", "system": true, "noteable_id": 17883514, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 175}]]}, {"id": 17434682, "iid": 174, "project_id": 14022, "title": "Unable to read config.yml file after upgrade", "description": "After upgrading to 11.6.3, we are unable to pull/clone repos via SSH connections.  We run gitlab as a non-root local user locally.  The /var/opt/gitlab/gitlab-shell/ directory is created correctly with the appropriate user/group.  However, the config.yml file under that directory is owned by root and the group we assign in the gitlab.rb file.  If we manually chown the file to our specific user running gitlab, we are able to pull/push/clone repos as expected.\n\nWe would like to see the gitlab.rb file updated to have a gitlab_shell['username'] and gitlab_shell['group'] option to control the access to the directory and file.", "state": "closed", "created_at": "2019-01-17T12:47:47.585Z", "updated_at": "2019-01-18T20:17:13.452Z", "closed_at": "2019-01-18T20:17:13.364Z", "closed_by": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "labels": [], "milestone": null, "assignees": [], "author": {"id": 914871, "name": "James Neumyer", "username": "Neumsy", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/914871/avatar.png", "web_url": "https://gitlab.com/Neumsy"}, "assignee": null, "user_notes_count": 3, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/174", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/174", "notes": "https://gitlab.com/api/v4/projects/14022/issues/174/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/174/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 132453990, "type": null, "body": "Just to confirm: you're using an Omnibus installation?", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2019-01-17T14:59:35.747Z", "updated_at": "2019-01-17T14:59:35.747Z", "system": false, "noteable_id": 17434682, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 174}], [{"id": 132809252, "type": null, "body": "Yes, we are using Omnibus installation for both Gitlab EE and Gitlab CE", "attachment": null, "author": {"id": 914871, "name": "James Neumyer", "username": "Neumsy", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/914871/avatar.png", "web_url": "https://gitlab.com/Neumsy"}, "created_at": "2019-01-18T16:02:45.649Z", "updated_at": "2019-01-18T16:02:45.649Z", "system": false, "noteable_id": 17434682, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 174}], [{"id": 132886269, "type": null, "body": "Ok, I think this is an omnibus-gitlab issue rather than something inherently with gitlab-shell, so I'll move this accordingly.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2019-01-18T20:17:06.700Z", "updated_at": "2019-01-18T20:17:06.700Z", "system": false, "noteable_id": 17434682, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 174}], [{"id": 132886289, "type": null, "body": "moved to omnibus-gitlab#4054", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2019-01-18T20:17:13.504Z", "updated_at": "2019-01-18T20:17:13.504Z", "system": true, "noteable_id": 17434682, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 174}]]}, {"id": 17360785, "iid": 173, "project_id": 14022, "title": "Remove Ruby implementations of gitlab-shell commands", "description": "Once all the functionality in https://gitlab.com/groups/gitlab-org/-/epics/706 is added and validated, we'll need to remove lots of ruby code from gitlab-shell. Hopefully *all* of it :D\n\nAlso, as mentioned by @reprazent here (https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/318#note_197620284):\n\n> I think at some point after the migration, we would need to have this `buildCommand` call return errors: In case something calls `gitlab-shell` in a way we don't expect.\n>\n> So instead of checking for the `cmd` to be `nil` we should check for an error.\n>\n> Right now, we're counting on the ruby fallback to deal with that, which is okay for now, but could you create an issue to remove the ruby-fallbacks and mention that issue here?\n\nSince we're removing the ruby implementations in this issue, also change the `buildCommand` to return an `error`.\n\nDistinct steps:\n\n- [x] Remove feature flag and fallback code: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/336\n- [x] Decouple build- and install- time code from files in `lib/` \n    - [x] Shell: decouple `bin/compile` and `bin/install` from `lib/`: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/340\n    - [x] Follow-up issue: https://gitlab.com/gitlab-org/gitlab-shell/issues/213\n    - [x] Shell: decouple `bin/check` from `lib/`: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/341\n    - [x] Shell: remove `bin/create-hooks`: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/342\n- [x] Prepare for `bin/compile` to be removed\n    - [x] Omnibus: use `make build`: https://gitlab.com/gitlab-org/omnibus-gitlab/merge_requests/3653\n    - [x] Charts: use `make build`: https://gitlab.com/gitlab-org/build/CNG/merge_requests/277\n    - [x] Install from source: use `make build`: https://gitlab.com/gitlab-org/gitlab/merge_requests/18059\n    - [x] GDK: Use `make build`: https://gitlab.com/gitlab-org/gitlab-development-kit/merge_requests/837\n- [ ] Remove runtime Ruby code: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/346\n- [ ] Ensure any test gaps are filled: !338 or push to #213\n- [ ] Further updates to omnibus?\n- [ ] Further updates to charts?\n- [ ] Further updates to GDK?\n- [ ] Further updates to install-from-source docs?\n- [ ] Move `go/*` up one level (or perhaps mostly to `internal/*`)", "state": "opened", "created_at": "2019-01-15T12:30:35.591Z", "updated_at": "2019-10-14T16:11:56.685Z", "closed_at": null, "closed_by": null, "labels": ["Deliverable", "backend", "backstage", "devops::create", "group::source code", "repository", "workflow::In dev"], "milestone": {"id": 731039, "iid": 38, "group_id": 9970, "title": "12.4", "description": "", "state": "active", "created_at": "2018-12-07T12:41:53.212Z", "updated_at": "2019-09-20T21:21:22.813Z", "due_date": "2019-10-17", "start_date": "2019-09-18", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/38"}, "assignees": [{"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "user_notes_count": 7, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/173", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 18, "completed_count": 11}, "has_tasks": true, "task_status": "11 of 18 tasks completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/173", "notes": "https://gitlab.com/api/v4/projects/14022/issues/173/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/173/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 2, "epic_iid": 706, "discussion": [[{"id": 131721525, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-15T12:30:44.986Z", "updated_at": "2019-01-15T12:30:44.986Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 131721873, "type": null, "body": "changed weight to **1**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-15T12:31:53.468Z", "updated_at": "2019-01-15T12:31:53.468Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 131721902, "type": null, "body": "changed milestone to %\"12.3\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-15T12:31:58.200Z", "updated_at": "2019-01-15T12:31:58.200Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 131722534, "type": null, "body": "mentioned in epic &706", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-15T12:34:31.514Z", "updated_at": "2019-01-15T12:34:31.514Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 153258379, "type": null, "body": "changed milestone to %\"12.1\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-22T12:30:59.510Z", "updated_at": "2019-03-22T12:30:59.510Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 157471074, "type": null, "body": "changed milestone to %\"12.2\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-04-04T14:45:05.122Z", "updated_at": "2019-04-04T14:45:05.122Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 176578512, "type": null, "body": "changed milestone to %\"12.3\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-31T09:21:38.346Z", "updated_at": "2019-05-31T09:21:38.350Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 177804775, "type": null, "body": "changed milestone to %\"12.2\"", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2019-06-04T14:43:28.637Z", "updated_at": "2019-06-04T14:43:28.641Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 188106831, "type": null, "body": "changed milestone to %\"12.3\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-07-03T16:07:58.121Z", "updated_at": "2019-07-03T16:07:58.125Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 197319882, "type": null, "body": "mentioned in issue create-stage#21", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-07-29T17:58:17.257Z", "updated_at": "2019-07-29T17:58:17.260Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 197635377, "type": null, "body": "mentioned in merge request !318", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-07-30T11:15:27.014Z", "updated_at": "2019-07-30T11:15:27.017Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 198024922, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-07-31T03:45:05.790Z", "updated_at": "2019-07-31T03:45:05.793Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 198441065, "type": null, "body": "changed weight to **2**", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-07-31T19:56:59.263Z", "updated_at": "2019-07-31T19:56:59.269Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 200131285, "type": null, "body": "mentioned in issue #202", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-08-05T10:46:31.713Z", "updated_at": "2019-08-05T10:46:31.716Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 200226895, "type": null, "body": "changed milestone to %\"12.4\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-08-05T14:09:51.504Z", "updated_at": "2019-08-05T14:09:51.507Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 200258530, "type": null, "body": "mentioned in merge request !321", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-08-05T15:09:46.604Z", "updated_at": "2019-08-05T15:09:46.607Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 201315412, "type": "DiscussionNote", "body": "This is blocked by https://gitlab.com/gitlab-org/gitlab-shell/issues/202", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-08-07T20:20:40.817Z", "updated_at": "2019-09-05T09:54:45.160Z", "system": false, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}, {"id": 212819820, "type": "DiscussionNote", "body": "Since https://gitlab.com/gitlab-org/gitlab-shell/issues/202 is taking some more time and may still need to be worked on in 12.4, this issue will be affected.\n\nAs @DouweM suggested (chatted with him on Slack), we could still work on this in 12.4 but don't merge until we tested the Go implementation on production. I feel after a week of running on production with feature flag enabled and no problem occurred, we can say that we can remove the Ruby implementations.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-09-05T09:54:44.834Z", "updated_at": "2019-09-05T09:54:44.834Z", "system": false, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}, {"id": 218951780, "type": "DiscussionNote", "body": "@patrickbajao do you think there's more testing that needs to be done?", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-09-18T16:35:19.347Z", "updated_at": "2019-09-18T16:35:19.347Z", "system": false, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}, {"id": 219134490, "type": "DiscussionNote", "body": "@nick.thomas nope, I think all is good since https://gitlab.com/gitlab-org/gitlab-shell/issues/202 is closed now.", "attachment": null, "author": {"id": 1884221, "name": "Patrick Bajao", "username": "patrickbajao", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1884221/avatar.png", "web_url": "https://gitlab.com/patrickbajao"}, "created_at": "2019-09-19T05:39:47.991Z", "updated_at": "2019-09-19T05:39:47.991Z", "system": false, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 211304099, "type": null, "body": "mentioned in issue create-stage#22", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-09-02T19:26:18.152Z", "updated_at": "2019-09-02T19:26:18.155Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 214942459, "type": null, "body": "changed weight to **1**", "attachment": null, "author": {"id": 4554599, "name": "Michelle Gill", "username": "m_gill", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/4554599/avatar.png", "web_url": "https://gitlab.com/m_gill"}, "created_at": "2019-09-10T16:11:01.092Z", "updated_at": "2019-09-10T16:11:01.096Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 218840491, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 4554599, "name": "Michelle Gill", "username": "m_gill", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/4554599/avatar.png", "web_url": "https://gitlab.com/m_gill"}, "created_at": "2019-09-18T13:27:37.641Z", "updated_at": "2019-09-18T13:27:37.645Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 218952352, "type": null, "body": "I'll handle this as two MRs: one that removes the feature-flag and fallback knowledge from the Go code, and one that deletes all the Ruby code.\n\nWe might want to move everything in the `go/` subdirectory up a level as well, which could be a third MR.\n\nSince the feature flags go away, we'll want follow-up cleanup MRs to omnibus and gdk. Possibly also to gitlab-charts? ", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-09-18T16:36:56.113Z", "updated_at": "2019-09-18T16:43:44.743Z", "system": false, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 218965212, "type": null, "body": "mentioned in merge request !336", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-09-18T17:10:48.999Z", "updated_at": "2019-09-18T17:10:49.002Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225077028, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-02T14:12:57.660Z", "updated_at": "2019-10-02T14:12:57.663Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225077209, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-02T14:13:16.021Z", "updated_at": "2019-10-02T14:13:16.024Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225086915, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-02T14:28:50.769Z", "updated_at": "2019-10-02T14:28:50.772Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225087643, "type": null, "body": "mentioned in merge request !338", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-02T14:30:15.319Z", "updated_at": "2019-10-02T14:30:15.321Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225162965, "type": null, "body": "mentioned in merge request !339", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-02T16:39:51.512Z", "updated_at": "2019-10-02T16:39:51.515Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225166983, "type": null, "body": "mentioned in merge request omnibus-gitlab!3653", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-02T16:51:12.966Z", "updated_at": "2019-10-02T16:51:12.968Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225168654, "type": null, "body": "mentioned in merge request gitlab-org/build/CNG!277", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-02T16:56:26.295Z", "updated_at": "2019-10-02T16:56:26.297Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225168867, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-02T16:57:08.355Z", "updated_at": "2019-10-02T16:57:08.359Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225172796, "type": null, "body": "mentioned in merge request gitlab-development-kit!837", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-02T17:08:10.786Z", "updated_at": "2019-10-02T17:08:10.790Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225174337, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-02T17:12:44.150Z", "updated_at": "2019-10-02T17:12:44.156Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225174481, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-02T17:13:12.940Z", "updated_at": "2019-10-02T17:13:12.944Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225482693, "type": null, "body": "mentioned in merge request gitlab!18059", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T10:05:28.210Z", "updated_at": "2019-10-03T10:05:28.213Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225496084, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T10:33:15.962Z", "updated_at": "2019-10-03T10:33:15.965Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225502678, "type": null, "body": "I did want to remove Ruby entirely, but some of the support code needed to build gitlab-shell is in Ruby and relies on some bits in `lib/`.\n\nIn this issue, I'll decouple the two, and have gone around the houses and made everything use the recently-added Makefile (`make build`) to generate binaries, so in a future release, we can consider removing Ruby as a build-time dependency. That can be a separate issue though - here, my focus is on removing it as a *run-time* dependency.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T10:48:05.620Z", "updated_at": "2019-10-03T10:48:05.620Z", "system": false, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225508184, "type": null, "body": "mentioned in merge request !340", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T11:00:56.277Z", "updated_at": "2019-10-03T11:00:56.280Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225515275, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T11:17:06.795Z", "updated_at": "2019-10-03T11:17:06.798Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225524726, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T11:37:56.080Z", "updated_at": "2019-10-03T11:37:56.084Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225526406, "type": null, "body": "mentioned in issue #213", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T11:41:55.889Z", "updated_at": "2019-10-03T11:41:55.894Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225527130, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T11:43:36.523Z", "updated_at": "2019-10-03T11:43:36.526Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225527188, "type": null, "body": "marked the task **Follow-up issue: https://gitlab.com/gitlab-org/gitlab-shell/issues/213** as completed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T11:43:44.580Z", "updated_at": "2019-10-03T11:43:44.583Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225536895, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T12:04:36.124Z", "updated_at": "2019-10-03T12:04:36.128Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225587228, "type": null, "body": "mentioned in merge request !341", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T13:16:28.716Z", "updated_at": "2019-10-03T13:16:28.720Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225592064, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T13:24:05.387Z", "updated_at": "2019-10-03T13:24:05.390Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 225733960, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-03T17:56:19.581Z", "updated_at": "2019-10-03T17:56:19.584Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 227409853, "type": null, "body": "mentioned in merge request !342", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-08T11:19:58.941Z", "updated_at": "2019-10-08T11:19:58.945Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 227411421, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-08T11:23:35.234Z", "updated_at": "2019-10-08T11:23:35.237Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 227411642, "type": null, "body": "changed weight to **2**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-08T11:24:04.171Z", "updated_at": "2019-10-08T11:24:04.181Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 227411849, "type": null, "body": "@m_gill I've bumped this to a `2`, given the extra work involved in rewriting the `bin/check` script in Go (i.e., this MR: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/341)", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-08T11:24:29.801Z", "updated_at": "2019-10-08T11:24:56.000Z", "system": false, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 228123898, "type": null, "body": "marked the task **Shell: decouple `bin/compile` and `bin/install` from `lib/`: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/340** as completed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-09T13:54:47.864Z", "updated_at": "2019-10-09T13:54:47.868Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 228123944, "type": null, "body": "marked the task **Shell: decouple `bin/check` from `lib/`: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/341** as completed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-09T13:54:49.867Z", "updated_at": "2019-10-09T13:54:49.871Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 228124017, "type": null, "body": "marked the task **Shell: remove `bin/create-hooks`: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/342** as completed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-09T13:54:53.083Z", "updated_at": "2019-10-09T13:54:53.087Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 228124125, "type": null, "body": "marked the task **Decouple build- and install- time code from files in `lib/`** as completed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-09T13:54:58.271Z", "updated_at": "2019-10-09T13:54:58.274Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 228124199, "type": null, "body": "marked the task **Prepare for `bin/compile` to be removed** as completed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-09T13:55:01.701Z", "updated_at": "2019-10-09T13:55:01.705Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 228124253, "type": null, "body": "marked the task **Omnibus: use `make build`: https://gitlab.com/gitlab-org/omnibus-gitlab/merge_requests/3653** as completed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-09T13:55:02.691Z", "updated_at": "2019-10-09T13:55:02.695Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 228124275, "type": null, "body": "marked the task **Charts: use `make build`: https://gitlab.com/gitlab-org/build/CNG/merge_requests/277** as completed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-09T13:55:03.716Z", "updated_at": "2019-10-09T13:55:03.718Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 228124323, "type": null, "body": "marked the task **Install from source: use `make build`: https://gitlab.com/gitlab-org/gitlab/merge_requests/18059** as completed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-09T13:55:06.244Z", "updated_at": "2019-10-09T13:55:06.247Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 228124346, "type": null, "body": "marked the task **GDK: Use `make build`: https://gitlab.com/gitlab-org/gitlab-development-kit/merge_requests/837** as completed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-09T13:55:07.980Z", "updated_at": "2019-10-09T13:55:07.984Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 230090675, "type": null, "body": "mentioned in merge request !346", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-14T14:43:46.837Z", "updated_at": "2019-10-14T14:43:46.841Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}], [{"id": 230145984, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-14T16:11:56.845Z", "updated_at": "2019-10-14T16:11:56.848Z", "system": true, "noteable_id": 17360785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 173}]]}, {"id": 16637238, "iid": 172, "project_id": 14022, "title": "Ruby wrapper to allow us to avoid system ruby", "description": "Because `gitlab-shell` is used in a very unique way, we were not able to depend on a ruby installed from a third-party solution like RVM / rbenv or installed as a binary in `/opt/bin`. This is problematic specifically on source-based installs.\n\nIn omnibus, we patch the shebang line to point and use our bundled ruby version, which currently is 2.5.x, while we still need to keep compatibility with versions that are EOL because that's what distros have.\n\nThere are two alternatives here. We should either provide as part of the install process in source, a tool to override the shebang (as we do in omnibus) to point to the correct up-to-date ruby version, avoiding system ruby, or make all `gitlab-shell` related code depends on a wrapper script that would allow the target ruby to be easily changed.\n\nYou can check the previous discussion in slack: https://gitlab.slack.com/archives/C3ER3TQBT/p1544713387424900 (internal link)\n\n# Related issues / MRs\n\n* https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/257#note_124673591\n* https://gitlab.com/gitlab-org/gitlab-shell/issues/164\n* https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/166#note_124589681", "state": "opened", "created_at": "2018-12-13T16:15:10.557Z", "updated_at": "2019-01-31T04:46:22.852Z", "closed_at": null, "closed_by": null, "labels": ["Create [DEPRECATED]", "devops::create"], "milestone": null, "assignees": [], "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "assignee": null, "user_notes_count": 3, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/172", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/172", "notes": "https://gitlab.com/api/v4/projects/14022/issues/172/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/172/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 124756667, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2018-12-13T16:17:30.741Z", "updated_at": "2018-12-13T16:17:30.741Z", "system": true, "noteable_id": 16637238, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 172}], [{"id": 124756719, "type": null, "body": "marked this issue as related to #164", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2018-12-13T16:17:41.515Z", "updated_at": "2018-12-13T16:17:41.515Z", "system": true, "noteable_id": 16637238, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 172}], [{"id": 124757548, "type": null, "body": "@brodock we also have one more option.\n\nSince `gitlab-shell` is now a Go binary, rather than a Ruby executable, we could put the Ruby executable to use in the config file and have the Go binary exec that, rather than the unqualified `ruby`. WDYT?", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-12-13T16:20:54.251Z", "updated_at": "2018-12-13T16:21:42.502Z", "system": false, "noteable_id": 16637238, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 172}], [{"id": 124757722, "type": null, "body": "@nick.thomas That is a good idea!", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2018-12-13T16:21:35.387Z", "updated_at": "2018-12-13T16:21:35.387Z", "system": false, "noteable_id": 16637238, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 172}], [{"id": 124858978, "type": null, "body": "mentioned in merge request !257", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2018-12-14T01:32:28.047Z", "updated_at": "2018-12-14T01:32:28.047Z", "system": true, "noteable_id": 16637238, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 172}], [{"id": 124859105, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2018-12-14T01:34:23.580Z", "updated_at": "2018-12-14T01:34:23.580Z", "system": true, "noteable_id": 16637238, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 172}], [{"id": 124859151, "type": null, "body": "Sounds good :+1:", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-12-14T01:35:12.804Z", "updated_at": "2018-12-14T01:35:12.804Z", "system": false, "noteable_id": 16637238, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 172}], [{"id": 126012192, "type": null, "body": "assigned to @ashmckenzie", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-12-19T00:57:02.218Z", "updated_at": "2018-12-19T00:57:02.218Z", "system": true, "noteable_id": 16637238, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 172}], [{"id": 136817548, "type": null, "body": "unassigned @ashmckenzie", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-01-31T04:46:22.832Z", "updated_at": "2019-01-31T04:46:22.832Z", "system": true, "noteable_id": 16637238, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 172}]]}, {"id": 16421788, "iid": 171, "project_id": 14022, "title": "bin/gitlab-shell -> bin/gitlab-shell-ruby change in a minor version", "description": "Shouldn't this change cause a major version bump? gitlab 11.4.9 works fine with gitlab-shell 8.3.3, but if we update gitlab-shell to 8.4.3, it breaks gitlab. Or should we not aim for SemVer for gitlab-shell?\n\n```\n$ git pull\nsh: 1: /usr/share/gitlab-shell/bin/gitlab-shell: not found\nfatal: Could not read from remote repository.\n\nPlease make sure you have the correct access rights\nand the repository exists.\n```", "state": "closed", "created_at": "2018-12-08T14:50:12.674Z", "updated_at": "2018-12-15T06:43:48.833Z", "closed_at": "2018-12-15T06:43:48.817Z", "closed_by": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "labels": [], "milestone": null, "assignees": [], "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "assignee": null, "user_notes_count": 3, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/171", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/171", "notes": "https://gitlab.com/api/v4/projects/14022/issues/171/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/171/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 124742982, "type": null, "body": "Even with gitlab 11.5.3 this is failing.\n\ncc @balasankarc @joshlambert this is blocking gitlab update to 11.5.x", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2018-12-13T15:29:11.883Z", "updated_at": "2018-12-13T15:29:11.883Z", "system": false, "noteable_id": 16421788, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 171}], [{"id": 125155177, "type": null, "body": "With help from @balasankarc I found gitlab-shell is now rewritten in go. After using go implementation of gitlab-shell, I get this error in gitlab-shell.log, when trying to clone a repo.\n\n```\ntime=\"2018-12-14T19:43:06+00:00\" level=info msg=\"finished HTTP request\" duration=0.005221432 method=POST pid=9953 url=\"http://localhost:8080/api/v4/internal/allowed\"\ntime=\"2018-12-14T19:43:06+00:00\" level=error msg=\"Call failed\" body=\"{\\\"message\\\":\\\"401 Unauthorized\\\"}\" code=401 method=POST pid=9953 url=\"http://localhost:8080/api/v4/internal/allowed\"\ntime=\"2018-12-14T19:43:06+00:00\" level=warn msg=\"Access denied\" command=\"git-upload-pack 'praveen/ghk.git'\" pid=9953 user=\"user with id key-1\"\n```", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2018-12-14T19:44:20.931Z", "updated_at": "2018-12-14T19:44:20.931Z", "system": false, "noteable_id": 16421788, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 171}], [{"id": 125195707, "type": null, "body": "That seems to be caused by an unclean installation leaving an empty .gitlab_shell_secret file. With a clean installation, it is working fine now. Thanks @balasankarc for the help.", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2018-12-15T06:43:48.168Z", "updated_at": "2018-12-15T06:43:48.168Z", "system": false, "noteable_id": 16421788, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 171}], [{"id": 125195708, "type": null, "body": "closed", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2018-12-15T06:43:48.852Z", "updated_at": "2018-12-15T06:43:48.852Z", "system": true, "noteable_id": 16421788, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 171}]]}, {"id": 16230148, "iid": 170, "project_id": 14022, "title": "Add Ash as a maintainer for gitlab-shell", "description": "As well as being a trainee maintainer / 'traintainer' (https://gitlab.com/gitlab-com/www-gitlab-com/issues/3353), I'd  also officially like to be a maintainer for gitlab-shell :pray:\n\nRelated: https://gitlab.com/gitlab-com/www-gitlab-com/issues/3447", "state": "closed", "created_at": "2018-11-30T01:40:22.347Z", "updated_at": "2019-04-11T01:36:03.485Z", "closed_at": "2019-04-11T01:36:03.244Z", "closed_by": {"id": 283999, "name": "Douglas Barbosa Alexandre", "username": "dbalexandre", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/283999/avatar.png", "web_url": "https://gitlab.com/dbalexandre"}, "labels": [], "milestone": null, "assignees": [{"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}], "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "assignee": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "user_notes_count": 8, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/170", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/170", "notes": "https://gitlab.com/api/v4/projects/14022/issues/170/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/170/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 121254595, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-11-30T01:54:25.818Z", "updated_at": "2018-11-30T01:54:25.818Z", "system": true, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 121254606, "type": null, "body": "mentioned in merge request !260", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-11-30T01:54:33.468Z", "updated_at": "2018-11-30T01:54:33.468Z", "system": true, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 121256035, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-11-30T02:12:25.218Z", "updated_at": "2018-11-30T02:12:25.218Z", "system": true, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 121256090, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-11-30T02:13:06.515Z", "updated_at": "2018-11-30T02:13:06.515Z", "system": true, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 121256126, "type": null, "body": "mentioned in issue gitlab-com/www-gitlab-com#3447", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-11-30T02:13:21.295Z", "updated_at": "2018-11-30T02:13:21.295Z", "system": true, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 121256255, "type": null, "body": "@rnienaber, @DouweM - for your consideration :pray:", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-11-30T02:15:29.129Z", "updated_at": "2018-11-30T02:15:29.129Z", "system": false, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 121256256, "type": null, "body": "assigned to @rnienaber and @DouweM", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-11-30T02:15:29.445Z", "updated_at": "2018-11-30T02:15:29.445Z", "system": true, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 121774935, "type": null, "body": "@DouweM I am not sure what the next step is here - can you advise?", "attachment": null, "author": {"id": 2722370, "name": "Rachel Nienaber", "username": "rnienaber", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2722370/avatar.png", "web_url": "https://gitlab.com/rnienaber"}, "created_at": "2018-12-03T09:18:18.421Z", "updated_at": "2018-12-03T09:18:18.421Z", "system": false, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 121775781, "type": null, "body": "There's a few issues/MRs for this..  I've committed to following the process https://about.gitlab.com/handbook/engineering/workflow/code-review/#how-to-become-a-maintainer as mentioned at https://gitlab.com/gitlab-com/www-gitlab-com/merge_requests/16922#note_121361221", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-12-03T09:21:08.721Z", "updated_at": "2019-04-04T23:16:25.842Z", "system": false, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 148018171, "type": null, "body": "Currently focusing on https://gitlab.com/gitlab-com/www-gitlab-com/issues/3353", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-03-06T22:10:35.867Z", "updated_at": "2019-03-06T22:10:35.867Z", "system": false, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 148018278, "type": null, "body": "unassigned @DouweM and @rnienaber", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-03-06T22:11:09.890Z", "updated_at": "2019-03-06T22:11:09.890Z", "system": true, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 157455943, "type": null, "body": "@DouweM @ashmckenzie @rnienaber any thoughts on pushing this forward? For my part, I don't see why we wouldn't make this happen - I got turned into a maintainer of gitlab-shell with much less ceremony, and arguably, experience! :)", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:18:19.269Z", "updated_at": "2019-04-04T14:18:19.269Z", "system": false, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 157783544, "type": null, "body": "@nick.thomas No objections on my part! As the most active maintainer of the project, and the one effectively in charge of the Golang rearchitecture, I'll leave the call to you.\n\nIn fact, once https://gitlab.com/groups/gitlab-org/-/epics/706 is done, I don't feel like I'll be qualified to be a maintainer myself anymore, and I'll give up that responsibility.", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-04-05T10:12:02.655Z", "updated_at": "2019-04-05T10:12:57.677Z", "system": false, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 158661466, "type": null, "body": "I'm happy to become a maintainer here and really keen to become involved in the future related Golang work :+1:", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-04-09T01:36:40.315Z", "updated_at": "2019-04-09T01:36:40.315Z", "system": false, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 158722387, "type": null, "body": "I was waiting to not be the first reply. If there are no objections and @ashmckenzie is keen, then let's get these MR's merged and make it so. :slight\\_smile:", "attachment": null, "author": {"id": 2722370, "name": "Rachel Nienaber", "username": "rnienaber", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2722370/avatar.png", "web_url": "https://gitlab.com/rnienaber"}, "created_at": "2019-04-09T07:37:39.205Z", "updated_at": "2019-04-09T07:37:39.205Z", "system": false, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 159046287, "type": null, "body": "mentioned in issue #185", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-09T16:49:55.776Z", "updated_at": "2019-04-09T16:49:55.776Z", "system": true, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 159595283, "type": null, "body": "closed via merge request !260", "attachment": null, "author": {"id": 283999, "name": "Douglas Barbosa Alexandre", "username": "dbalexandre", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/283999/avatar.png", "web_url": "https://gitlab.com/dbalexandre"}, "created_at": "2019-04-11T01:36:03.295Z", "updated_at": "2019-04-11T01:36:03.295Z", "system": true, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}], [{"id": 159595284, "type": null, "body": "mentioned in commit 1b741a0bcbb5d47e546291a5f2dd538d2928e9ad", "attachment": null, "author": {"id": 283999, "name": "Douglas Barbosa Alexandre", "username": "dbalexandre", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/283999/avatar.png", "web_url": "https://gitlab.com/dbalexandre"}, "created_at": "2019-04-11T01:36:03.435Z", "updated_at": "2019-04-11T01:36:03.435Z", "system": true, "noteable_id": 16230148, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 170}]]}, {"id": 16163861, "iid": 169, "project_id": 14022, "title": "Circular dependency with http_helper.rb and gitlab_net.rb", "description": "Ruby 2.5.3 doesn't like the circular dependency between `HTTPHelper` and `GitlabNet::ApiUnreachableError`:\n\nhttps://gitlab.com/gitlab-org/gitlab-shell/-/jobs/126362702", "state": "closed", "created_at": "2018-11-27T21:31:26.922Z", "updated_at": "2018-11-28T17:12:33.489Z", "closed_at": "2018-11-28T17:12:33.396Z", "closed_by": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "labels": [], "milestone": null, "assignees": [], "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/169", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/169", "notes": "https://gitlab.com/api/v4/projects/14022/issues/169/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/169/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 120537973, "type": null, "body": "mentioned in commit d4c68d1191a671b3cba68ca97b38144fb6d58cc8", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-11-27T21:43:36.450Z", "updated_at": "2018-11-27T21:43:36.450Z", "system": true, "noteable_id": 16163861, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 169}], [{"id": 120538230, "type": null, "body": "mentioned in commit bf93aa5dc58f9baee1f1e0bc853a7a4cd551e448", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-11-27T21:45:21.290Z", "updated_at": "2018-11-27T21:45:21.290Z", "system": true, "noteable_id": 16163861, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 169}], [{"id": 120538309, "type": null, "body": "mentioned in commit a5be7bf7437024f50b7ffc51d50496637ca20794", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-11-27T21:46:02.755Z", "updated_at": "2018-11-27T21:46:02.755Z", "system": true, "noteable_id": 16163861, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 169}], [{"id": 120538421, "type": null, "body": "mentioned in commit b4f6fbd8cba3e7678462e68e6fc63df23b763187", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-11-27T21:46:49.238Z", "updated_at": "2018-11-27T21:46:49.238Z", "system": true, "noteable_id": 16163861, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 169}], [{"id": 120538439, "type": null, "body": "mentioned in merge request !258", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-11-27T21:46:56.616Z", "updated_at": "2018-11-27T21:46:56.616Z", "system": true, "noteable_id": 16163861, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 169}], [{"id": 120819408, "type": null, "body": "closed via merge request !258", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-11-28T17:12:33.580Z", "updated_at": "2018-11-28T17:12:33.580Z", "system": true, "noteable_id": 16163861, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 169}], [{"id": 120819420, "type": null, "body": "mentioned in commit 09cc5b3ab58b0557f6ba8ab54b318579b92235da", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-11-28T17:12:36.359Z", "updated_at": "2018-11-28T17:12:36.359Z", "system": true, "noteable_id": 16163861, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 169}]]}, {"id": 16111242, "iid": 168, "project_id": 14022, "title": "Pass correlation-ids to backend systems for git-ssh", "description": "For tracing requests it would be helpful to use correlation ids for the following:\n\n* Gitaly via GRPC\n* Preauth (Unicorn)\n\nSee https://gitlab.com/groups/gitlab-org/-/epics/547 for other components.\n", "state": "opened", "created_at": "2018-11-26T11:44:07.880Z", "updated_at": "2018-11-26T11:44:50.981Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/168", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/168", "notes": "https://gitlab.com/api/v4/projects/14022/issues/168/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/168/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": 547, "discussion": [[{"id": 120041817, "type": null, "body": "added to epic &547", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-11-26T11:44:22.832Z", "updated_at": "2018-11-26T11:44:22.832Z", "system": true, "noteable_id": 16111242, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 168}], [{"id": 120041889, "type": null, "body": "mentioned in epic &547", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-11-26T11:44:39.180Z", "updated_at": "2018-11-26T11:44:39.180Z", "system": true, "noteable_id": 16111242, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 168}], [{"id": 120041930, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-11-26T11:44:51.081Z", "updated_at": "2018-11-26T11:44:51.081Z", "system": true, "noteable_id": 16111242, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 168}]]}, {"id": 15836570, "iid": 167, "project_id": 14022, "title": "Constants in GitlabNet throw warnings", "description": "When pushing to our gitlab repositories we always get the following messages:\n\n ``` bash\n# git push\nCounting objects: 3, done.\nDelta compression using up to 8 threads.\nCompressing objects: 100% (3/3), done.\nWriting objects: 100% (3/3), 392 bytes | 392.00 KiB/s, done.\nTotal 3 (delta 1), reused 0 (delta 0)\nremote: /opt/dol/var/gitlab/lib/gitlab_net.rb:16: warning: already initialized constant GitlabNet::CHECK_TIMEOUT\nremote: /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_net.rb:16: warning: previous definition of CHECK_TIMEOUT was here\nremote: /opt/dol/var/gitlab/lib/gitlab_net.rb:17: warning: already initialized constant GitlabNet::API_INACCESSIBLE_MESSAGE\nremote: /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_net.rb:17: warning: previous definition of API_INACCESSIBLE_MESSAGE was here\nTo https://gitlab.somedomain.de/me/test-push.git\n   c38d2da..51e40b2  master -> master\n```\n\nThe push nevertheless works.\n\nExpected behavior:\n- Do not get any warning message with code specific information.", "state": "closed", "created_at": "2018-11-14T09:17:28.977Z", "updated_at": "2019-04-04T14:30:23.986Z", "closed_at": "2019-04-04T14:30:23.967Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": [], "milestone": null, "assignees": [], "author": {"id": 384663, "name": "Horatiu Eugen Vlad", "username": "hvlad", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/384663/avatar.png", "web_url": "https://gitlab.com/hvlad"}, "assignee": null, "user_notes_count": 3, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/167", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/167", "notes": "https://gitlab.com/api/v4/projects/14022/issues/167/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/167/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 117145709, "type": null, "body": "mentioned in merge request !256", "attachment": null, "author": {"id": 384663, "name": "Horatiu Eugen Vlad", "username": "hvlad", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/384663/avatar.png", "web_url": "https://gitlab.com/hvlad"}, "created_at": "2018-11-14T09:30:06.428Z", "updated_at": "2018-11-14T09:30:06.428Z", "system": true, "noteable_id": 15836570, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 167}], [{"id": 117192129, "type": null, "body": "Why do you have two versions of `gitlab_net.rb` in `/opt/dol/var/gitlab/lib/gitlab_net.rb` and `/opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_net.rb`?", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-11-14T11:57:34.719Z", "updated_at": "2018-11-14T11:57:34.719Z", "system": false, "noteable_id": 15836570, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 167}], [{"id": 119306686, "type": null, "body": "@hvlad can you make sure that you're using one version of `gitlab_net.rb` and check if this is still happening in %11.6 (see https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/256#note_117397978)?", "attachment": null, "author": {"id": 1474048, "name": "George Tsiolis", "username": "gtsiolis", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1474048/avatar.png", "web_url": "https://gitlab.com/gtsiolis"}, "created_at": "2018-11-22T10:14:48.645Z", "updated_at": "2018-11-22T10:14:48.645Z", "system": false, "noteable_id": 15836570, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 167}], [{"id": 157462774, "type": null, "body": "Closing as the hooks are now in gitaly", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:30:23.518Z", "updated_at": "2019-04-04T14:30:23.518Z", "system": false, "noteable_id": 15836570, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 167}], [{"id": 157462780, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:30:24.010Z", "updated_at": "2019-04-04T14:30:24.010Z", "system": true, "noteable_id": 15836570, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 167}]]}, {"id": 14728894, "iid": 166, "project_id": 14022, "title": "health endpoint for gitlab-shell", "description": "We currently do not have a proper way to healthcheck the git fleet. It seems like it might be the right place to implement a health check endpoint that verifies everything required to handle ssh sessions for GitLab. This, despite that there is no gitlab-shell service. Another option might be to run something alongside ssh and gitlab-shell that does this.\n\nThe problems we encounter for GitLab SSH HA health checking are:\n\n* If we use the ssh port then if rails endpoint isn't running for auth requests will fail. We could use another endpoint for auth but if that starts failing we have the same problem.\n* If we use the rails health check (like we do now) we might fail ssh connections if ssh is not running or misconfigured.\n\nShould we write a service that gives us a better health of everything necessary for git ssh?\n\ncc @jacobvosmaer\\-gitlab @andrewn", "state": "closed", "created_at": "2018-10-05T20:52:31.124Z", "updated_at": "2018-10-16T09:18:57.535Z", "closed_at": "2018-10-16T09:18:57.507Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "assignee": null, "user_notes_count": 5, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/166", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/166", "notes": "https://gitlab.com/api/v4/projects/14022/issues/166/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/166/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 106908315, "type": null, "body": "mentioned in issue gitlab-com/gl-infra/production#496", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-10-05T20:53:13.067Z", "updated_at": "2018-10-05T20:53:13.067Z", "system": true, "noteable_id": 14728894, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 166}], [{"id": 106908415, "type": null, "body": "This is coming from https://gitlab.com/gitlab-com/gl-infra/production/issues/496, where we had a single node where ssh wasn't responding properly, which caused connection problems for a subset of users.", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-10-05T20:53:58.921Z", "updated_at": "2018-10-05T20:53:58.921Z", "system": false, "noteable_id": 14728894, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 166}], [{"id": 106957128, "type": null, "body": "@jarv would `ssh -vT -i PRIVATE_KEY_FOR_BOT_ACCOUNT git@IP_ADDRESS_OF_SERVER` as the health check be sufficient? \n\nSide note: general alerting picked up some git issues (on workhorse and unicorn) over the weekend:\n\n![image](/uploads/806c34b7eb2d2c0499daaed13d81b117/image.png)\n\nhttps://gitlab.slack.com/archives/CD6HFD1L0/p1538823967000100", "attachment": null, "author": {"id": 895869, "name": "Andrew Newdigate", "username": "andrewn", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/895869/avatar.png", "web_url": "https://gitlab.com/andrewn"}, "created_at": "2018-10-06T11:31:43.381Z", "updated_at": "2018-10-06T11:31:43.381Z", "system": false, "noteable_id": 14728894, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 166}], [{"id": 107018670, "type": null, "body": "> @jarv would `ssh -vT -i PRIVATE_KEY_FOR_BOT_ACCOUNT git@IP_ADDRESS_OF_SERVER` as the health check be sufficient?\n\nThis would exercise everything I had in mind. Having a dedicated bot account for a healthcheck is not exactly what I was thinking though. Instead, I was thinking we would check the health of the service and the health of the api every 5 seconds. This would be enough that a git node doesn't start receiving git ssh traffic (on boot for example) until we are sure it is ready.\n\n> Side note: general alerting picked up some git issues (on workhorse and unicorn) over the weekend:\n\nFrom the graphs it looks like workhorse so I don't think it's related to ssh or gitlab-shell. Maybe we should open a new issue to investigate?", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-10-07T09:07:02.687Z", "updated_at": "2018-10-07T09:07:02.687Z", "system": false, "noteable_id": 14728894, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 166}], [{"id": 107025839, "type": null, "body": "mentioned in issue gitlab-com/gl-infra/infrastructure#5236", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-10-07T09:26:01.080Z", "updated_at": "2018-10-07T09:26:01.080Z", "system": true, "noteable_id": 14728894, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 166}], [{"id": 107190682, "type": null, "body": "After discussing this a bit more with @andrewn we think the best course might be to see if it is possible for gitlab-shell to use an internal api fleet, and then change the git server to use the ssh port as the health check.", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-10-08T11:53:56.336Z", "updated_at": "2018-10-08T11:53:56.336Z", "system": false, "noteable_id": 14728894, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 166}], [{"id": 107199449, "type": null, "body": "mentioned in issue gitlab-com/gl-infra/production#499", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-10-08T12:29:59.717Z", "updated_at": "2018-10-08T12:29:59.717Z", "system": true, "noteable_id": 14728894, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 166}], [{"id": 109076206, "type": null, "body": "Sounds good, this is how we did git SSH health checks during the GCP migration too, FWIW.\n\nI'll close this issue, but do feel free to re-open it if it turns out to be inadequate, and you want to explore some sort of dedicated health-checker in more detail.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-16T09:18:55.240Z", "updated_at": "2018-10-16T09:18:55.240Z", "system": false, "noteable_id": 14728894, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 166}], [{"id": 109076234, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-16T09:18:57.562Z", "updated_at": "2018-10-16T09:18:57.562Z", "system": true, "noteable_id": 14728894, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 166}]]}, {"id": 14690334, "iid": 165, "project_id": 14022, "title": "Nautilus: a streamlined shell for GitLab", "description": "This idea (which I know is not original, and occasionally comes around again, this time by me) was originally spawned from this thread: https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/4738#note_106112000\n\n> Perhaps it's time to consider whether we should be using the actual linux login mechanisms to deal with potentially thousands of logins per minute on each host.\n\nThis got me thinking about how we can do this better. Right now, every git+ssh connection will traverse the entire Linux login process, spawn a shell and several other processes along the way. The main process runs for a second or two and then gets shutdown. This happens twenty times a second or so on each git host.\n\nIt reminds me a lot of `cgi-bin` programs in the early days of the web, which were spawned to handle a single incoming request and then shutdown.\n\nA much better approach would be to have a \"GitLab Workhorse for Git+SSH\". A single unprivileged service handling incoming SSH connections doing the following:\n\n* Authentication (via internal API using authorized keys)\n* Authorisation (via internal API)\n* Forwarding the request on to Gitaly\n\nIn an attempt to see how difficult this would be, I put together this proof of concept: it uses Golang's stdlib SSH service, with the Gliderlabs wrapper over the top (see https://godoc.org/github.com/gliderlabs/ssh), which has a far more pleasant API than https://godoc.org/golang.org/x/crypto/ssh package, and makes building SSH servers as straight-forward as building `net/http` servers.\n\nReview the WIP here: https://gitlab.com/andrewn/nautilus/blob/master/cmd/nautilus/main.go\n\n@jacobvosmaer\\-gitlab pointed out that:\n\n1. @nick.thomas is already working on a Golang (spawned) replacement for the existing shell and \n2. on single server installs, if you want to share port 22 between the the real sshd and GitLab-shell you need to stick to building a real shell\n3. There are some features that we probably couldn't support with our own server (although these are not used on GitLab.com)\n\nOne possible workaround would be to build Nautilus as part of the Golang gitlab-shell replacement and make much of the code common to both approaches. This would allow us to use a single process for high-performance instances like GitLab.com but still allow the same code to be used through a traditional ssh login model.\n\nComments?", "state": "opened", "created_at": "2018-10-04T13:25:53.174Z", "updated_at": "2019-06-17T12:12:40.745Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 895869, "name": "Andrew Newdigate", "username": "andrewn", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/895869/avatar.png", "web_url": "https://gitlab.com/andrewn"}, "assignee": null, "user_notes_count": 9, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/165", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/165", "notes": "https://gitlab.com/api/v4/projects/14022/issues/165/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/165/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 106528033, "type": null, "body": "Link to Slack thread is here: https://gitlab.slack.com/archives/C6FBZ5YHL/p1538655969000100", "attachment": null, "author": {"id": 895869, "name": "Andrew Newdigate", "username": "andrewn", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/895869/avatar.png", "web_url": "https://gitlab.com/andrewn"}, "created_at": "2018-10-04T13:27:07.066Z", "updated_at": "2018-10-04T13:27:07.066Z", "system": false, "noteable_id": 14690334, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 165}], [{"id": 106570328, "type": null, "body": "mentioned in merge request gitlab-cookbooks/gitlab-openssh!10", "attachment": null, "author": {"id": 895869, "name": "Andrew Newdigate", "username": "andrewn", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/895869/avatar.png", "web_url": "https://gitlab.com/andrewn"}, "created_at": "2018-10-04T15:29:03.438Z", "updated_at": "2018-10-04T15:29:03.438Z", "system": true, "noteable_id": 14690334, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 165}], [{"id": 106577971, "type": null, "body": "> some features that we probably couldn't support with our own server\n\nThis is referring to authentication via [openssh certificates](https://docs.gitlab.com/ee/administration/operations/ssh_certificates.html) which may not be supported by both x/crypto/ssh and gliderlabs/ssh.\n\nThanks for the write-up @andrewn, and also thanks for the proof of concept. It's good to see we have a sane alternative to `golang.org/x/crypto/ssh` now.\n\nYou could say we're at an architecture crossroads.\n\n- System OpenSSH + Ruby plugins: this is the status quo. By \"plugins\" I mean `bin/gitlab-shell-authorized-keys-check` and friends.\n- System OpenSSH + Go plugins: this is the transformation that @nick.thomas has started working on. A big improvement because the Ruby plugins are slow to start up which hits gitlab.com users twice per session: once for authorized keys and once for bin/gitlab-shell.\n- (NEW) Dedicated OpenSSH + Go plugins: this means running a separate OpenSSH process as user `git`, with a configuration that is locked down to only doing `gitlab-shell`. The advantage is that we can disconnect this from the system's login accounting. If we were to bundle OpenSSH into omnibus we would also gain control over exactly which OpenSSH features we can integrate with (e.g. AuthorizedPrincipalsCommand)\n- (NEW) System OpenSSH + Go plugins + Nautilus hybrid. Small instances, or instances that want AuthorizedPrincipalsCommand, could keep using OpenSSH+plugins as a legacy solution. The Go plugins would be thin network clients that make calls to Nautilus. On gitlab.com we would not use the OpenSSH + plugins part, and route SSH traffic straight into Nautilus. Nautilus would be both a gRPC server (to service the local plugin clients) and an SSH server (to service the real SSH clients).\n\nI like the idea of Nautilus but I don't like that it's the most complex solution in my list. The complexity stems from the desire to be able to install GitLab with SSH out of the box on a standard Linux server. Because port 22 is already taken we must re-use the system OpenSSH service in that case.\n\nMaybe we should think bigger. Git over HTTP used to be the inferior solution but that is no longer true. We could say that out of the box, you only get HTTP clone. If administrators want SSH they should reconfigure their system SSH to use a different port (e.g. 2222) so that Nautilus can go on port 22. Or choose to serve GitLab SSH traffic from port 2222. That's a big decision but it frees us from having to support two architectures.\n\nIn the Kubernetes world the concern about \"we can't run nautilus on port 22\" may also be a non-issue.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-10-04T15:51:42.178Z", "updated_at": "2018-10-04T15:51:42.178Z", "system": false, "noteable_id": 14690334, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 165}], [{"id": 106580665, "type": null, "body": "In my thought experiment above I'm treating Git SSH on the default omnibus install like the 3.5mm headphone jack on recent high-end smartphones. You can still have a headphone jack if you want one, but it's not there by default.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-10-04T16:01:46.248Z", "updated_at": "2018-10-04T16:01:56.619Z", "system": false, "noteable_id": 14690334, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 165}], [{"id": 106596278, "type": null, "body": "I don't have a great deal of time to think about this proposal until after the 7th, but I'd say I'm quite cautious about the idea of moving away from openssh. It's a mature, very well-supported project, and much of the performance and convenience pain we have with it comes from being unable to integrate it into GitLab and control its configuration completely. The only reason why we can't do that is because system openssh runs on port 22.\n\nWhat nautilus would get us *on top* of those benefits is the ability handle things without spawning subprocesses. We can build an `sshd_config` that would get us the remaining claimed benefits of nautilus, I think, and run that on port 2222 quite happily today. We're not doing much other work in gitlab-shell that could be shared if all the current subprocesses became a single process.\n\nThe analogy with `cgi-bin` is somewhat apposite, but it puts a gloss on several *very good* reasons to spawn subprocesses in the first place - and in particular, I'm thinking of security, privilege separation, etc. I think it would only be worthwhile if we were unlocking huge performance gains that we needed, and I'm not convinced that's the case here.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-04T17:18:27.710Z", "updated_at": "2018-10-04T17:26:20.308Z", "system": false, "noteable_id": 14690334, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 165}], [{"id": 106598735, "type": null, "body": "My thought experiment of not supporting SSH out of the box is a non-starter. It would break lots and lots of existing installations. Not an option.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-10-04T17:34:06.991Z", "updated_at": "2018-10-04T17:34:06.991Z", "system": false, "noteable_id": 14690334, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 165}], [{"id": 107264697, "type": null, "body": "@bjk-gitlab and I got to discuss this topic in a call today. Some notes from my point of view:\n\n- We can approach the metrics problem by fixing mtail (https://gitlab.com/gitlab-org/gitlab-shell/issues/121#note_107244492)\n- The functionality of the shims as they are now is sane, they don't do too much\n- We are using OpenSSH to handle a high volume of SSH sessions. We may reach a point where OpenSSH becomes a bottleneck for gitlab.com. But right now we don't know if OpenSSH is a bottleneck, nor do we know if nautilus would fare better.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-10-08T15:33:19.989Z", "updated_at": "2018-10-08T15:34:00.628Z", "system": false, "noteable_id": 14690334, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 165}], [{"id": 107269368, "type": null, "body": "We will need mtail, or some other real-time logs parser, in all implementations. There is no other reasonable way to get metrics out of OpenSSH and a few other components.", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2018-10-08T15:46:48.168Z", "updated_at": "2018-10-08T15:46:48.168Z", "system": false, "noteable_id": 14690334, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 165}], [{"id": 109650454, "type": null, "body": "A timely CVE in the server side of libssh: https://www.libssh.org/2018/10/16/libssh-0-8-4-and-0-7-6-security-and-bugfix-release/\n\nObviously, this class of bug could be found in *any* ssh server protocol implementation, but openssh has the adoption and longevity that means a higher proportion of them will have already been found.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-17T19:19:25.438Z", "updated_at": "2018-10-17T19:19:25.438Z", "system": false, "noteable_id": 14690334, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 165}], [{"id": 132147599, "type": null, "body": "I just wanted to add a note about TinySSH existing: https://github.com/janmojzis/tinyssh\n\nThis doesn't bind to port 22 but instead relies on stdio being connected to a socket by an external tcp server. Overall though, I'm still in favour of integrating with the system sshd, certainly for omnibus.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-16T16:59:59.976Z", "updated_at": "2019-01-16T16:59:59.976Z", "system": false, "noteable_id": 14690334, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 165}], [{"id": 181997228, "type": null, "body": "mentioned in issue #196", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-17T12:07:34.015Z", "updated_at": "2019-06-17T12:07:34.019Z", "system": true, "noteable_id": 14690334, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 165}], [{"id": 181999332, "type": null, "body": "mentioned in merge request !314", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-17T12:12:40.707Z", "updated_at": "2019-06-17T12:12:40.711Z", "system": true, "noteable_id": 14690334, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 165}]]}, {"id": 14688535, "iid": 164, "project_id": 14022, "title": "gitlab-shell doesn't work on Ruby v2.0", "description": "This Ruby version is used on some macs, so we see this in development: \n\n```\n`require': /Users/james/Development/gdk/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_shell.rb:185: syntax error, unexpected ',' (SyntaxError)\n  def exec_cmd(executable, gitaly_address:, token:, json_args:)\n```\n\nIt works in Ruby 2.1, but not 2.0\n\nWe're rewriting all of gitlab-shell into go to avoid these kinds of problems, but in the meantime, is it worthwhile ensuring that gitlab-shell works with all versions of ruby we're likely to see in the wild? For me, that's 1.9.3+\n\ncc @rspeicher @DouweM @jameslopez ", "state": "closed", "created_at": "2018-10-04T11:57:55.483Z", "updated_at": "2019-08-07T08:01:48.736Z", "closed_at": "2019-05-23T23:25:10.083Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["Create [DEPRECATED]", "P3", "S3", "bug", "devops::create", "regression", "regression:11.3"], "milestone": null, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 7, "merge_requests_count": 1, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/164", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/164", "notes": "https://gitlab.com/api/v4/projects/14022/issues/164/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/164/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 106497633, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-04T11:58:09.150Z", "updated_at": "2018-10-04T11:58:09.150Z", "system": true, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}], [{"id": 106504866, "type": null, "body": "mentioned in merge request !249", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-04T12:08:24.157Z", "updated_at": "2018-10-04T12:08:24.157Z", "system": true, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}], [{"id": 106506536, "type": null, "body": "1.9 would require an older version of rake: https://gitlab.com/nick.thomas/gitlab-shell/-/jobs/104646171 and I only included it because it was new in my fairly early Ruby days. I've no idea if it's still deployed anywhere, so I'll drop it for now.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-04T12:11:31.398Z", "updated_at": "2018-10-04T12:11:31.398Z", "system": false, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}], [{"id": 106517172, "type": null, "body": "[The README](https://gitlab.com/gitlab-org/gitlab-shell/blob/master/README.md#requirements) says:\n\n>>>\n**GitLab shell will always use your system ruby (normally located at /usr/bin/ruby) and will not use the ruby your installed with a ruby version manager (such as RVM).**\nIt requires ruby 2.0 or higher.\nPlease uninstall any old ruby versions from your system:\n>>>\n\nSo we should definitely be testing on Ruby 2.0 to match that.\n\n@nick.thomas Do you think 2.0 is good enough, or do you think we should support 1.9.3?\n\nHonestly, I'd prefer to just have people uninstall their system Ruby and install a more recent one, so that we can use newer-Ruby tricks :) Although with us moving to Go, this is going to be a non-issue soon anyway.", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-10-04T12:46:08.589Z", "updated_at": "2018-10-04T12:46:08.589Z", "system": false, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}], [{"id": 106526870, "type": null, "body": "OK, it's definitely a bug that it's not working on ruby2.0 right now then!", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-04T13:23:07.555Z", "updated_at": "2018-10-04T13:23:07.555Z", "system": false, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}], [{"id": 106526913, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-04T13:23:17.013Z", "updated_at": "2018-10-04T13:23:17.013Z", "system": true, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}], [{"id": 106526927, "type": null, "body": "changed milestone to %\"11.4\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-04T13:23:19.909Z", "updated_at": "2018-10-04T13:23:19.909Z", "system": true, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}], [{"id": 106527846, "type": null, "body": "I think we should leave off on 1.9.3 support unless someone asks us for it.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-04T13:26:22.553Z", "updated_at": "2018-10-04T13:26:22.553Z", "system": false, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}], [{"id": 106533633, "type": null, "body": "unassigned @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-04T13:46:01.399Z", "updated_at": "2018-10-04T13:46:01.399Z", "system": true, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}], [{"id": 106533664, "type": null, "body": "removed milestone", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-04T13:46:07.307Z", "updated_at": "2018-10-04T13:46:07.307Z", "system": true, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}], [{"id": 106535328, "type": null, "body": "The Gemfile dependencies don't cleanly install on Ruby 2.0, and this turns into dependency hell. I was hopeful it would be a quick fix, but since it's not, I'm leaving it to the usual scheduling mechanisms.\n\nOnly development and install-from-source users will be affected, so the pain this causes isn't widespread.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-04T13:51:34.126Z", "updated_at": "2018-10-04T13:51:34.126Z", "system": false, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}], [{"id": 106854130, "type": null, "body": "Don't we have a higher Ruby requirement for GitLab itself? Why can't we have the same requirement in gitlab-shell?", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-10-05T15:51:54.267Z", "updated_at": "2018-10-05T15:51:54.267Z", "system": false, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}], [{"id": 124756672, "type": null, "body": "mentioned in issue #172", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2018-12-13T16:17:31.035Z", "updated_at": "2018-12-13T16:17:31.035Z", "system": true, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}], [{"id": 124756720, "type": null, "body": "marked this issue as related to #172", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2018-12-13T16:17:41.542Z", "updated_at": "2018-12-13T16:17:41.542Z", "system": true, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}], [{"id": 173968006, "type": null, "body": "gitlab-shell runs with the system ruby; gitlab does not.\n\nSince the rewrite to go is well advanced now, I'm happy to just close this issue.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-05-23T23:25:09.674Z", "updated_at": "2019-05-23T23:25:09.674Z", "system": false, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}], [{"id": 173968007, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-05-23T23:25:10.130Z", "updated_at": "2019-05-23T23:25:10.139Z", "system": true, "noteable_id": 14688535, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 164}]]}, {"id": 14600045, "iid": 163, "project_id": 14022, "title": "Migrate git lfs-authenticate support to Golang", "description": "Follow up from #74\n\nWhen someone runs `git push git@gitlab.com:foo/bar.git` on an LFS-enabled repository, under the hood, a `git lfs-authenticate` command is run as well. gitlab-shell checks permissions against the internal API, and returns the authentication information to the client in the format it expects.\n\nThe implementation for this is currently in Ruby; we'd like to add a parallel Golang implementation that we can switch to using feature flags. Once the implementation has been enabled for a release without problems, we can remove the Ruby implementation.\n\nTo an extent, this issue relies on the work in #158, but the two can be worked on in parallel.", "state": "closed", "created_at": "2018-10-01T12:44:14.288Z", "updated_at": "2019-06-12T14:35:07.553Z", "closed_at": "2019-06-06T16:02:07.328Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["Create [DEPRECATED]", "Stretch", "backend", "backstage", "devops::create", "golang", "group::source code", "workflow::In review"], "milestone": {"id": 693518, "iid": 33, "group_id": 9970, "title": "12.0", "description": "", "state": "closed", "created_at": "2018-10-30T16:47:37.975Z", "updated_at": "2019-07-08T20:39:06.020Z", "due_date": "2019-06-22", "start_date": "2019-05-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/33"}, "assignees": [{"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/163", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/163", "notes": "https://gitlab.com/api/v4/projects/14022/issues/163/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/163/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 3, "epic_iid": 706, "discussion": [[{"id": 105530346, "type": null, "body": "mentioned in issue #74", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:44:31.605Z", "updated_at": "2018-10-01T12:44:31.605Z", "system": true, "noteable_id": 14600045, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 163}], [{"id": 130524123, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-10T14:03:52.356Z", "updated_at": "2019-01-10T14:03:52.356Z", "system": true, "noteable_id": 14600045, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 163}], [{"id": 131721104, "type": null, "body": "changed weight to **3**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-15T12:29:26.707Z", "updated_at": "2019-01-15T12:29:26.707Z", "system": true, "noteable_id": 14600045, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 163}], [{"id": 131721787, "type": null, "body": "changed milestone to %\"12.2\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-15T12:31:35.731Z", "updated_at": "2019-01-15T12:31:35.731Z", "system": true, "noteable_id": 14600045, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 163}], [{"id": 137494475, "type": null, "body": "changed milestone to %\"11.10\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-02-01T14:26:33.429Z", "updated_at": "2019-02-01T14:26:33.429Z", "system": true, "noteable_id": 14600045, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 163}], [{"id": 147845760, "type": null, "body": "changed milestone to %\"11.11\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-06T15:21:50.528Z", "updated_at": "2019-03-06T15:21:50.528Z", "system": true, "noteable_id": 14600045, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 163}], [{"id": 157465689, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-04-04T14:32:01.924Z", "updated_at": "2019-04-04T14:32:01.924Z", "system": true, "noteable_id": 14600045, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 163}], [{"id": 157466058, "type": null, "body": "mentioned in epic &706", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-04-04T14:33:01.767Z", "updated_at": "2019-04-04T14:33:01.767Z", "system": true, "noteable_id": 14600045, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 163}], [{"id": 165286965, "type": null, "body": "changed milestone to %\"12.1\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-04-29T16:27:19.796Z", "updated_at": "2019-04-29T16:27:19.796Z", "system": true, "noteable_id": 14600045, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 163}], [{"id": 176577971, "type": null, "body": "changed milestone to %\"12.2\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-31T09:20:05.099Z", "updated_at": "2019-05-31T09:20:05.103Z", "system": true, "noteable_id": 14600045, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 163}], [{"id": 177576298, "type": null, "body": "mentioned in merge request !308", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-04T07:28:09.233Z", "updated_at": "2019-06-04T07:28:09.237Z", "system": true, "noteable_id": 14600045, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 163}], [{"id": 177780108, "type": null, "body": "assigned to @igor.drozdov", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-06-04T13:55:47.670Z", "updated_at": "2019-06-04T13:55:47.676Z", "system": true, "noteable_id": 14600045, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 163}], [{"id": 177804099, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2019-06-04T14:41:55.159Z", "updated_at": "2019-06-04T14:41:55.162Z", "system": true, "noteable_id": 14600045, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 163}], [{"id": 178684942, "type": null, "body": "closed via commit 86dc733108e490a23d768b31e6c7119ce5a4dcff", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-06T16:02:07.468Z", "updated_at": "2019-06-06T16:02:07.471Z", "system": true, "noteable_id": 14600045, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 163}], [{"id": 180580246, "type": null, "body": "mentioned in issue #195", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-12T14:35:07.446Z", "updated_at": "2019-06-12T14:35:07.466Z", "system": true, "noteable_id": 14600045, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 163}]]}, {"id": 14599995, "iid": 162, "project_id": 14022, "title": "Migrate gitlab-shell git archive support to Golang", "description": "Follow-up from #74\n\nWhen someone runs `git archive git@gitlab.com:foo/bar.git`, gitlab-shell checks permissions against the internal API, then spawns a separate (golang!) binary to service the git archive via gitaly if the user is authorized.\n\nThe implementation for this is currently in Ruby; we'd like to add a parallel Golang implementation that we can switch to using feature flags. Once the implementation has been enabled for a release without problems, we can remove the Ruby implementation.\n\nTo an extent, this issue relies on the work in #158, but the two can be worked on in parallel.\n\nAs part of this issue, we should avoid spawning the separate golang binary, in favour of talking to gitaly in the same process as the one doing the internal API checks. The less process management we have to do, the better.", "state": "closed", "created_at": "2018-10-01T12:41:50.225Z", "updated_at": "2019-06-06T10:44:23.024Z", "closed_at": "2019-06-05T15:53:36.001Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["Create [DEPRECATED]", "Stretch", "backend", "backstage", "devops::create", "golang", "group::source code", "workflow::In review"], "milestone": {"id": 693518, "iid": 33, "group_id": 9970, "title": "12.0", "description": "", "state": "closed", "created_at": "2018-10-30T16:47:37.975Z", "updated_at": "2019-07-08T20:39:06.020Z", "due_date": "2019-06-22", "start_date": "2019-05-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/33"}, "assignees": [{"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/162", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/162", "notes": "https://gitlab.com/api/v4/projects/14022/issues/162/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/162/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 2, "epic_iid": 706, "discussion": [[{"id": 105529845, "type": null, "body": "mentioned in issue #74", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:42:26.633Z", "updated_at": "2018-10-01T12:42:26.633Z", "system": true, "noteable_id": 14599995, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 162}], [{"id": 130524047, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-10T14:03:40.675Z", "updated_at": "2019-01-10T14:03:40.675Z", "system": true, "noteable_id": 14599995, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 162}], [{"id": 131721130, "type": null, "body": "changed weight to **3**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-15T12:29:29.980Z", "updated_at": "2019-01-15T12:29:29.980Z", "system": true, "noteable_id": 14599995, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 162}], [{"id": 131721832, "type": null, "body": "changed milestone to %\"12.2\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-15T12:31:45.996Z", "updated_at": "2019-01-15T12:31:45.996Z", "system": true, "noteable_id": 14599995, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 162}], [{"id": 153258383, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-22T12:31:00.202Z", "updated_at": "2019-03-22T12:31:00.202Z", "system": true, "noteable_id": 14599995, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 162}], [{"id": 157470904, "type": null, "body": "changed milestone to %\"12.1\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-04-04T14:44:42.733Z", "updated_at": "2019-04-04T14:44:42.733Z", "system": true, "noteable_id": 14599995, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 162}], [{"id": 176141695, "type": null, "body": "changed weight to **2**", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-30T08:08:35.894Z", "updated_at": "2019-05-30T08:08:35.897Z", "system": true, "noteable_id": 14599995, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 162}], [{"id": 177381640, "type": null, "body": "assigned to @igor.drozdov", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-03T16:12:11.335Z", "updated_at": "2019-06-03T16:12:11.340Z", "system": true, "noteable_id": 14599995, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 162}], [{"id": 177381689, "type": null, "body": "mentioned in merge request !307", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-03T16:12:17.324Z", "updated_at": "2019-06-03T16:12:17.345Z", "system": true, "noteable_id": 14599995, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 162}], [{"id": 177803882, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2019-06-04T14:41:27.309Z", "updated_at": "2019-06-04T14:41:27.312Z", "system": true, "noteable_id": 14599995, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 162}], [{"id": 178262133, "type": null, "body": "closed via merge request !307", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-05T15:53:36.401Z", "updated_at": "2019-06-05T15:53:36.505Z", "system": true, "noteable_id": 14599995, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 162}], [{"id": 178262147, "type": null, "body": "mentioned in commit eb2b186f7d209a638b7523c674bc79cbafe764b6", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-05T15:53:39.203Z", "updated_at": "2019-06-05T15:53:39.292Z", "system": true, "noteable_id": 14599995, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 162}], [{"id": 178536406, "type": null, "body": "mentioned in issue #195", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-06T10:44:23.004Z", "updated_at": "2019-06-06T10:44:23.007Z", "system": true, "noteable_id": 14599995, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 162}]]}, {"id": 14599960, "iid": 161, "project_id": 14022, "title": "Migrate gitlab-shell git push support to Golang", "description": "Follow up from #74\n\nWhen someone runs `git push git@gitlab.com:foo/bar.git`, gitlab-shell checks permissions against the internal API, then spawns a separate (golang!) binary to service the git push via gitaly if the user is authorized.\n\nThe implementation for this is currently in Ruby; we'd like to add a parallel Golang implementation that we can switch to using feature flags. Once the implementation has been enabled for a release without problems, we can remove the Ruby implementation.\n\nTo an extent, this issue relies on the work in #158, but the two can be worked on in parallel.\n\nAs part of this issue, we should avoid spawning the separate golang binary, in favour of talking to gitaly in the same process as the one doing the internal API checks. The less process management we have to do, the better.\n\nNote that in the Geo case, a `git push` to the secondary might be (from the end user's point of view) transparently proxied to the Geo primary. This involves some cooperation from gitlab-shell, using \"custom actions\", but I'm not 100% on what they look like in gitlab-shell at present.", "state": "closed", "created_at": "2018-10-01T12:39:59.421Z", "updated_at": "2019-06-09T07:24:19.464Z", "closed_at": "2019-05-31T12:08:55.900Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["Create [DEPRECATED]", "Deliverable", "backend", "backstage", "devops::create", "golang", "group::source code", "workflow::In review"], "milestone": {"id": 693518, "iid": 33, "group_id": 9970, "title": "12.0", "description": "", "state": "closed", "created_at": "2018-10-30T16:47:37.975Z", "updated_at": "2019-07-08T20:39:06.020Z", "due_date": "2019-06-22", "start_date": "2019-05-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/33"}, "assignees": [{"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "user_notes_count": 1, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/161", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/161", "notes": "https://gitlab.com/api/v4/projects/14022/issues/161/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/161/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 5, "epic_iid": 706, "discussion": [[{"id": 105529062, "type": null, "body": "mentioned in issue #74", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:40:17.659Z", "updated_at": "2018-10-01T12:40:17.659Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 105529794, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:42:14.914Z", "updated_at": "2018-10-01T12:42:14.914Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 105531177, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:46:45.768Z", "updated_at": "2018-10-01T12:46:45.768Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 130523995, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-10T14:03:34.843Z", "updated_at": "2019-01-10T14:03:34.843Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 131719834, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-15T12:25:25.346Z", "updated_at": "2019-01-15T12:25:25.346Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 131719875, "type": null, "body": "changed weight to **5**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-15T12:25:34.042Z", "updated_at": "2019-01-15T12:25:34.042Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 131720130, "type": null, "body": "One option if the \"custom actions\" stuff is too difficult to replicate or replace would be to fall back to Ruby if it's detected in the Go case. They're only used when Geo pushes to a secondary, so it's not a large performance issue, and until it's implemented, we could always recommend disabling the `push` feature on the secondary site.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-15T12:26:39.973Z", "updated_at": "2019-01-15T12:26:39.973Z", "system": false, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 137494252, "type": null, "body": "changed milestone to %\"11.10\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-02-01T14:26:04.312Z", "updated_at": "2019-02-01T14:26:04.312Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 147779927, "type": null, "body": "changed milestone to %\"11.11\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-06T12:50:26.870Z", "updated_at": "2019-03-06T12:50:26.870Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 157465686, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-04-04T14:32:00.998Z", "updated_at": "2019-04-04T14:32:00.998Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 157466057, "type": null, "body": "mentioned in epic &706", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-04-04T14:33:01.711Z", "updated_at": "2019-04-04T14:33:01.711Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 167095534, "type": null, "body": "assigned to @igor.drozdov", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-06T12:54:00.553Z", "updated_at": "2019-05-06T12:54:00.553Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 171242780, "type": null, "body": "mentioned in merge request !300", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-05-17T01:14:08.017Z", "updated_at": "2019-05-17T01:14:08.021Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 175804615, "type": null, "body": "mentioned in issue #160", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-05-29T13:33:58.675Z", "updated_at": "2019-05-29T13:33:58.678Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 176640666, "type": null, "body": "closed via merge request !300", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-05-31T12:08:55.942Z", "updated_at": "2019-05-31T12:08:55.944Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 176640669, "type": null, "body": "mentioned in commit 4342831aa40c64e0af3624b934ba0610c22345ba", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-05-31T12:08:56.117Z", "updated_at": "2019-05-31T12:08:56.121Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 178536405, "type": null, "body": "mentioned in issue #195", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-06T10:44:22.932Z", "updated_at": "2019-06-06T10:44:22.936Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}], [{"id": 179305181, "type": null, "body": "mentioned in issue gl-retrospectives/create-team#13", "attachment": null, "author": {"id": 1786152, "name": "\ud83e\udd16 GitLab Bot \ud83e\udd16", "username": "gitlab-bot", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1786152/avatar.png", "web_url": "https://gitlab.com/gitlab-bot"}, "created_at": "2019-06-09T07:24:19.445Z", "updated_at": "2019-06-09T07:24:19.448Z", "system": true, "noteable_id": 14599960, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 161}]]}, {"id": 14599934, "iid": 160, "project_id": 14022, "title": "Migrate gitlab-shell git fetch support to Golang", "description": "Follow up from https://gitlab.com/gitlab-org/gitlab-shell/issues/74\n\nWhen someone runs `git fetch git@gitlab.com:foo/bar.git` (or a git clone), gitlab-shell checks permissions against the internal API, then spawns a separate (golang!) binary to service the git fetch via gitaly if the user is authorized.\n\nThe implementation for this is currently in Ruby; we'd like to add a parallel Golang implementation that we can switch to using feature flags. Once the implementation has been enabled for a release without problems, we can remove the Ruby implementation.\n\nTo an extent, this issue relies on the work in #158, but the two can be worked on in parallel.\n\nAs part of this issue, we should avoid spawning the separate golang binary, in favour of talking to gitaly in the same process as the one doing the internal API checks. The less process management we have to do, the better.", "state": "closed", "created_at": "2018-10-01T12:38:12.273Z", "updated_at": "2019-06-09T07:24:19.492Z", "closed_at": "2019-06-03T15:21:26.701Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["Create [DEPRECATED]", "Deliverable", "backend", "backstage", "devops::create", "golang", "group::source code"], "milestone": {"id": 693518, "iid": 33, "group_id": 9970, "title": "12.0", "description": "", "state": "closed", "created_at": "2018-10-30T16:47:37.975Z", "updated_at": "2019-07-08T20:39:06.020Z", "due_date": "2019-06-22", "start_date": "2019-05-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/33"}, "assignees": [{"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "user_notes_count": 3, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/160", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/160", "notes": "https://gitlab.com/api/v4/projects/14022/issues/160/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/160/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 2, "epic_iid": 706, "discussion": [[{"id": 105528624, "type": null, "body": "mentioned in issue #74", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:38:26.762Z", "updated_at": "2018-10-01T12:38:26.762Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 105528844, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:39:28.300Z", "updated_at": "2018-10-01T12:39:28.300Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 130523951, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-10T14:03:30.119Z", "updated_at": "2019-01-10T14:03:30.119Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 131720536, "type": null, "body": "changed milestone to %\"12.1\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-15T12:27:59.039Z", "updated_at": "2019-01-15T12:27:59.039Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 131720989, "type": null, "body": "changed weight to **5**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-15T12:29:08.509Z", "updated_at": "2019-01-15T12:29:08.509Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 137494261, "type": null, "body": "changed milestone to %\"11.11\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-02-01T14:26:05.494Z", "updated_at": "2019-02-01T14:26:05.494Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 153258387, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-22T12:31:00.860Z", "updated_at": "2019-03-22T12:31:00.860Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 157470882, "type": null, "body": "changed milestone to %\"12.1\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-04-04T14:44:40.240Z", "updated_at": "2019-04-04T14:44:40.240Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 175797094, "type": null, "body": "@nick.thomas Does this depend on https://gitlab.com/gitlab-org/gitlab-shell/issues/183?", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-29T13:19:07.459Z", "updated_at": "2019-05-29T13:19:07.459Z", "system": false, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 175802296, "type": null, "body": "@DouweM yes - but we could work on the two at the same time. It's not strictly the case that we need to finish that one before we start work on this.\n\nThe part that's **unique** to #183 is adding support to the discover, lfs_authenticate, etc, commands, so they'll display console messages if we start requesting them when those commands are used. At present, we happen to only do that for git pull/push commands.\n\n@igor.drozdov  does the `git push` MR you're working on for %12.0 introduce code to handle and display any console messages returned by the `/internal/allowed` endpoint?", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-05-29T13:29:49.390Z", "updated_at": "2019-05-29T13:29:49.390Z", "system": false, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 175804600, "type": null, "body": "@nick.thomas yes, https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/300/diffs#3eb3b34b164a90cfe8e612da2432d21272a1776d_0_31\n\n@DouweM I'd say this issue depends on https://gitlab.com/gitlab-org/gitlab-shell/issues/161. After it's merged, adding fetch and archive should be relatively simple", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-05-29T13:33:55.761Z", "updated_at": "2019-05-29T13:33:55.761Z", "system": false, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 176141715, "type": null, "body": "changed weight to **2**", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-05-30T08:08:40.824Z", "updated_at": "2019-05-30T08:08:40.827Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 176691444, "type": null, "body": "mentioned in merge request !305", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-05-31T13:49:44.729Z", "updated_at": "2019-05-31T13:49:44.734Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 177362448, "type": null, "body": "closed via merge request !305", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-03T15:21:26.762Z", "updated_at": "2019-06-03T15:21:26.765Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 177362464, "type": null, "body": "mentioned in commit 5ee3270e07b0f7cca8c2352816ea86a3b640a772", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-06-03T15:21:28.620Z", "updated_at": "2019-06-03T15:21:28.657Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 177759876, "type": null, "body": "changed milestone to %\"12.0\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-06-04T13:15:04.130Z", "updated_at": "2019-06-04T13:15:04.133Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 177759878, "type": null, "body": "assigned to @igor.drozdov", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-06-04T13:15:04.270Z", "updated_at": "2019-06-04T13:15:04.274Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 178536404, "type": null, "body": "mentioned in issue #195", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-06-06T10:44:22.813Z", "updated_at": "2019-06-06T10:44:22.819Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}], [{"id": 179305182, "type": null, "body": "mentioned in issue gl-retrospectives/create-team#13", "attachment": null, "author": {"id": 1786152, "name": "\ud83e\udd16 GitLab Bot \ud83e\udd16", "username": "gitlab-bot", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1786152/avatar.png", "web_url": "https://gitlab.com/gitlab-bot"}, "created_at": "2019-06-09T07:24:19.473Z", "updated_at": "2019-06-09T07:24:19.476Z", "system": true, "noteable_id": 14599934, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 160}]]}, {"id": 14599821, "iid": 159, "project_id": 14022, "title": "Migrate gitlab-shell two-factor-auth recovery codes command to Golang", "description": "Follow up from https://gitlab.com/gitlab-org/gitlab-shell/issues/74\n\nWhen someone runs `ssh git@gitlab.com 2fa_recovery_codes`, gitlab-shell permits the 2FA recovery codes to be reset. The implementation for this is currently in Ruby; we'd like to add a parallel Golang implementation that we can switch to using feature flags. Once the implementation has been enabled for a release without problems, we can remove the Ruby implementation.\n\nTo an extent, this issue relies on the work in #158, but the two can be worked on in parallel.", "state": "closed", "created_at": "2018-10-01T12:33:21.440Z", "updated_at": "2019-08-07T08:01:51.220Z", "closed_at": "2019-03-21T17:51:11.586Z", "closed_by": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "labels": ["Create [DEPRECATED]", "Deliverable", "backend", "backstage", "devops::create", "golang", "workflow::In review"], "milestone": {"id": 655279, "iid": 27, "group_id": 9970, "title": "11.10", "description": "", "state": "closed", "created_at": "2018-09-21T19:08:16.261Z", "updated_at": "2019-05-21T09:17:49.051Z", "due_date": "2019-04-22", "start_date": "2019-03-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/27"}, "assignees": [{"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "user_notes_count": 4, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/159", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/159", "notes": "https://gitlab.com/api/v4/projects/14022/issues/159/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/159/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 3, "epic_iid": 706, "discussion": [[{"id": 105527318, "type": null, "body": "mentioned in issue #74", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:33:51.795Z", "updated_at": "2018-10-01T12:33:51.795Z", "system": true, "noteable_id": 14599821, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 159}], [{"id": 126118824, "type": null, "body": "@jacobvosmaer\\-gitlab Mentioned this would make a good candidate to start with for https://gitlab.com/gitlab-org/gitlab-shell/issues/158. I'll see where that takes me.", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2018-12-19T10:58:16.038Z", "updated_at": "2018-12-19T10:58:16.038Z", "system": false, "noteable_id": 14599821, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 159}], [{"id": 130523914, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-10T14:03:24.155Z", "updated_at": "2019-01-10T14:03:24.155Z", "system": true, "noteable_id": 14599821, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 159}], [{"id": 131720559, "type": null, "body": "changed milestone to %\"12.1\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-15T12:28:03.473Z", "updated_at": "2019-01-15T12:28:03.473Z", "system": true, "noteable_id": 14599821, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 159}], [{"id": 131720911, "type": null, "body": "changed weight to **3**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-15T12:28:55.995Z", "updated_at": "2019-01-15T12:28:55.995Z", "system": true, "noteable_id": 14599821, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 159}], [{"id": 148593298, "type": null, "body": "@igor.drozdov You will likely want to wait to start on this until @reprazent is (almost) done with https://gitlab.com/gitlab-org/gitlab-shell/issues/175, which will cover some of the groundwork for this issue. I suggest chatting about it with him :)", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-08T11:27:44.317Z", "updated_at": "2019-03-08T11:27:44.317Z", "system": false, "noteable_id": 14599821, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 159}], [{"id": 148593300, "type": null, "body": "assigned to @igor.drozdov", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-03-08T11:27:44.595Z", "updated_at": "2019-03-08T11:27:44.595Z", "system": true, "noteable_id": 14599821, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 159}], [{"id": 149228085, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-03-11T14:03:50.364Z", "updated_at": "2019-03-11T14:03:50.364Z", "system": true, "noteable_id": 14599821, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 159}], [{"id": 152992525, "type": null, "body": "@igor.drozdov I think we can close this now, right?", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-03-21T16:53:06.394Z", "updated_at": "2019-03-21T16:53:06.394Z", "system": false, "noteable_id": 14599821, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 159}], [{"id": 153014447, "type": null, "body": "Closing due to https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/285", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-03-21T17:51:10.834Z", "updated_at": "2019-03-21T17:51:10.834Z", "system": false, "noteable_id": 14599821, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 159}], [{"id": 153014448, "type": null, "body": "closed", "attachment": null, "author": {"id": 1161495, "name": "Igor", "username": "igor.drozdov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1161495/avatar.png", "web_url": "https://gitlab.com/igor.drozdov"}, "created_at": "2019-03-21T17:51:11.681Z", "updated_at": "2019-03-21T17:51:11.681Z", "system": true, "noteable_id": 14599821, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 159}], [{"id": 158801288, "type": null, "body": "mentioned in issue gl-retrospectives/create-team#10", "attachment": null, "author": {"id": 1786152, "name": "\ud83e\udd16 GitLab Bot \ud83e\udd16", "username": "gitlab-bot", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1786152/avatar.png", "web_url": "https://gitlab.com/gitlab-bot"}, "created_at": "2019-04-09T09:47:25.795Z", "updated_at": "2019-04-09T09:47:25.795Z", "system": true, "noteable_id": 14599821, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 159}]]}, {"id": 14514295, "iid": 158, "project_id": 14022, "title": "Allow enabling separate pieces of functionality using feature flags in the configuration", "description": "We should be able to enable/disable specific commands as \"feature flags\", these feature flags are configured in a yaml config file. \n\nIf the feature is not enabled, we fall back to ruby. If the config can't be read, we fall back to ruby.\n___\nOriginal:\n\nSplit out from https://gitlab.com/gitlab-org/gitlab-shell/issues/74\n\nWe have an ambition to start rewriting gitlab-shell in Go. We intend to do this in an incremental fashion, instead of as a big bang.\n\nOne important component that all the gitlab-shell tasks depend on is an API client to the internal GitLab API endpoints. This is being tackled as a component of its own by @reprazent and @zj at present, so needs to be its own issue.", "state": "closed", "created_at": "2018-09-27T10:44:16.505Z", "updated_at": "2019-02-09T07:22:49.027Z", "closed_at": "2019-02-01T14:30:48.661Z", "closed_by": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "labels": ["Create [DEPRECATED]", "Deliverable", "P2", "backend", "devops::create", "golang", "missed-deliverable", "missed:11.6", "workflow::In dev"], "milestone": {"id": 581391, "iid": 23, "group_id": 9970, "title": "11.8", "description": "", "state": "closed", "created_at": "2018-06-26T15:15:18.359Z", "updated_at": "2019-03-08T17:33:19.162Z", "due_date": "2019-02-22", "start_date": "2019-01-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/23"}, "assignees": [{"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "user_notes_count": 3, "merge_requests_count": 0, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/158", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/158", "notes": "https://gitlab.com/api/v4/projects/14022/issues/158/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/158/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 3, "epic_iid": 706, "discussion": [[{"id": 104730345, "type": null, "body": "mentioned in issue #74", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-27T10:45:06.976Z", "updated_at": "2018-09-27T10:45:06.976Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 104731287, "type": null, "body": "changed milestone to %\"11.5\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-09-27T10:47:54.561Z", "updated_at": "2018-09-27T10:47:54.561Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 104731288, "type": null, "body": "changed weight to **3**", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-09-27T10:47:54.602Z", "updated_at": "2018-09-27T10:47:54.602Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 104750782, "type": null, "body": "I'm open to help in any way possible @reprazent, if it would take longer than 11.5, its probably something I might implement myself though, as it might be needed for porting the hooks to go", "attachment": null, "author": {"id": 101578, "name": "Zeger-Jan van de Weg", "username": "zj-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/101578/avatar.png", "web_url": "https://gitlab.com/zj-gitlab"}, "created_at": "2018-09-27T12:00:02.962Z", "updated_at": "2018-09-27T12:00:02.962Z", "system": false, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 105527190, "type": null, "body": "mentioned in issue #159", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:33:22.312Z", "updated_at": "2018-10-01T12:33:22.312Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 105528559, "type": null, "body": "mentioned in issue #160", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:38:13.616Z", "updated_at": "2018-10-01T12:38:13.616Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 105528981, "type": null, "body": "mentioned in issue #161", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:40:00.461Z", "updated_at": "2018-10-01T12:40:00.461Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 105529718, "type": null, "body": "mentioned in issue #162", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:41:54.786Z", "updated_at": "2018-10-01T12:41:54.786Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 105530276, "type": null, "body": "mentioned in issue #163", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:44:15.139Z", "updated_at": "2018-10-01T12:44:15.139Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 107152160, "type": null, "body": "assigned to @reprazent", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-10-08T09:15:47.630Z", "updated_at": "2018-10-08T09:15:47.630Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 114583587, "type": null, "body": "changed milestone to %\"11.6\"", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2018-11-05T13:55:45.804Z", "updated_at": "2018-11-05T13:55:45.804Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 122128844, "type": null, "body": "changed milestone to %\"11.7\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-12-04T11:19:40.624Z", "updated_at": "2018-12-04T11:19:40.624Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 123484422, "type": null, "body": "mentioned in issue gl-retrospectives/create-team#6", "attachment": null, "author": {"id": 1786152, "name": "\ud83e\udd16 GitLab Bot \ud83e\udd16", "username": "gitlab-bot", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1786152/avatar.png", "web_url": "https://gitlab.com/gitlab-bot"}, "created_at": "2018-12-09T07:22:46.049Z", "updated_at": "2018-12-09T07:22:46.049Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 128940765, "type": null, "body": "mentioned in merge request !270", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-01-04T11:30:45.753Z", "updated_at": "2019-01-04T11:30:45.753Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 129682966, "type": null, "body": "changed milestone to %\"11.8\"", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-01-08T10:20:42.801Z", "updated_at": "2019-01-08T10:20:42.801Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 130523862, "type": null, "body": "added to epic &706", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-01-10T14:03:11.202Z", "updated_at": "2019-01-10T14:03:11.202Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 137408176, "type": null, "body": "mentioned in issue #175", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-02-01T10:55:49.501Z", "updated_at": "2019-02-01T10:55:49.501Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 137409889, "type": null, "body": "I think we should close this as \"prep work done\", and replacing it by functionality that we can actually call (fe. https://gitlab.com/gitlab-org/gitlab-shell/issues/175). \n\n@DouweM @nick.thomas ", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-02-01T11:00:29.148Z", "updated_at": "2019-02-01T11:00:53.519Z", "system": false, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 137480447, "type": null, "body": "@reprazent Sounds good to me; can you update the title and close? :)", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2019-02-01T13:55:59.479Z", "updated_at": "2019-02-01T13:55:59.479Z", "system": false, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 137496436, "type": null, "body": "changed title from **A{-dd a Golang implementation of `GitlabNet`-}** to **A{+llow enabling separate pieces of functionality using feature flags in the configuration+}**", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-02-01T14:30:42.258Z", "updated_at": "2019-02-01T14:30:42.258Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 137496438, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-02-01T14:30:42.283Z", "updated_at": "2019-02-01T14:30:42.283Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 137496476, "type": null, "body": "closed", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-02-01T14:30:48.948Z", "updated_at": "2019-02-01T14:30:48.948Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}], [{"id": 139732143, "type": null, "body": "mentioned in issue gl-retrospectives/create-team#8", "attachment": null, "author": {"id": 1786152, "name": "\ud83e\udd16 GitLab Bot \ud83e\udd16", "username": "gitlab-bot", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1786152/avatar.png", "web_url": "https://gitlab.com/gitlab-bot"}, "created_at": "2019-02-09T07:22:49.011Z", "updated_at": "2019-02-09T07:22:49.011Z", "system": true, "noteable_id": 14514295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 158}]]}, {"id": 14289661, "iid": 157, "project_id": 14022, "title": "configure sshd with ClientAliveInterval", "description": "Pushing large repositories fails with: \n```\n==> /var/log/gitlab-shell/ssh.log <==\nReceived disconnect from 10.244.9.113 port 35550:11: disconnected by user\nDisconnected from 10.244.9.113 port 35550\n```\nclient side message is:\n```\n fatal: The remote end hung up unexpectedly\n```\nI've worked around this by specifying a ```ServerAliveInterval``` on the client side.\n\nThank you", "state": "opened", "created_at": "2018-09-19T10:27:38.685Z", "updated_at": "2018-09-19T10:27:38.685Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 2217736, "name": "Jan Smets", "username": "jansmets", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0717120fa64bf1b41a5724096c308390?s=80&d=identicon", "web_url": "https://gitlab.com/jansmets"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/157", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/157", "notes": "https://gitlab.com/api/v4/projects/14022/issues/157/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/157/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 14239058, "iid": 156, "project_id": 14022, "title": "install fails: no such file or directory - config.yml", "description": "I followed the install instructions according to the readme, but I get this error:\n```\n$ ./bin/install\n/System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/psych.rb:299:in `initialize': No such file or directory - /Users/rob/projects/sandbox/gitlab-shell/config.yml (Errno::ENOENT)\n\tfrom /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/psych.rb:299:in `open'\n\tfrom /System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/lib/ruby/2.0.0/psych.rb:299:in `load_file'\n\tfrom /Users/rob/projects/sandbox/gitlab-shell/lib/gitlab_config.rb:7:in `initialize'\n\tfrom ./bin/install:9:in `new'\n\tfrom ./bin/install:9:in `<main>'\n```\n\n`macOS Sierra 10.12.6`\n```\n$ ruby --version\nruby 2.0.0p648 (2015-12-16 revision 53162) [universal.x86_64-darwin16]\n```\n```\n$ go version\ngo version go1.10.3 darwin/amd64\n```\n\nThe readme makes no mention of a config.yml. Are the instructions incomplete?", "state": "opened", "created_at": "2018-09-18T09:29:57.762Z", "updated_at": "2018-09-18T09:29:57.762Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 2262358, "name": "Rob", "username": "rm-rf-etc", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2262358/avatar.png", "web_url": "https://gitlab.com/rm-rf-etc"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/156", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/156", "notes": "https://gitlab.com/api/v4/projects/14022/issues/156/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/156/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 14141198, "iid": 155, "project_id": 14022, "title": "Wrong commit on v8.3.2 tag", "description": "Hey,\n\nThe current commit on v8.3.2 tag is ffd55318, shouldn't it be 71b6faa6?\n\n:smile:", "state": "closed", "created_at": "2018-09-13T23:27:37.923Z", "updated_at": "2018-09-14T13:02:42.989Z", "closed_at": "2018-09-14T13:02:42.961Z", "closed_by": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "labels": [], "milestone": null, "assignees": [{"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}], "author": {"id": 591561, "name": "Adrien Brignon", "username": "adrienbrignon", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/591561/avatar.png", "web_url": "https://gitlab.com/adrienbrignon"}, "assignee": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "user_notes_count": 3, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/155", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/155", "notes": "https://gitlab.com/api/v4/projects/14022/issues/155/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/155/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 101309611, "type": null, "body": "Yes, it should. I think we're better off tagging 8.3.3 here.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-09-13T23:32:39.155Z", "updated_at": "2018-09-13T23:32:39.155Z", "system": false, "noteable_id": 14141198, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 155}], [{"id": 101310175, "type": null, "body": "Hmm, there have been changes on `master` since 8.3.2. Maybe we're better off fixing the tag. What do you think @nick.thomas?", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-09-13T23:40:08.334Z", "updated_at": "2018-09-13T23:40:08.334Z", "system": false, "noteable_id": 14141198, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 155}], [{"id": 101382242, "type": null, "body": "@stanhu hmm, how'd that happen? :confused:\n\nI'll create an `8-3-stable` branch and tag v8.3.3 off that. Deleting and re-issuing tags counts as rewriting history, and causes problems.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-14T09:19:30.070Z", "updated_at": "2018-09-14T09:20:25.153Z", "system": false, "noteable_id": 14141198, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 155}], [{"id": 101382259, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-14T09:19:32.071Z", "updated_at": "2018-09-14T09:19:32.071Z", "system": true, "noteable_id": 14141198, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 155}], [{"id": 101383464, "type": null, "body": "mentioned in merge request !245", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-14T09:24:32.401Z", "updated_at": "2018-09-14T09:24:32.401Z", "system": true, "noteable_id": 14141198, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 155}], [{"id": 101433113, "type": null, "body": "closed via merge request !245", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-09-14T13:02:43.015Z", "updated_at": "2018-09-14T13:02:43.015Z", "system": true, "noteable_id": 14141198, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 155}], [{"id": 101433115, "type": null, "body": "mentioned in commit dd54651b987c473fc42ae6c81daf0a47a92f9dca", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-09-14T13:02:43.178Z", "updated_at": "2018-09-14T13:02:43.178Z", "system": true, "noteable_id": 14141198, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 155}]]}, {"id": 13970236, "iid": 154, "project_id": 14022, "title": "Add missing specs for handled HTTP status codes", "description": "**Add missing specs for handled HTTP status codes**\n\nhttps://gitlab.com/gitlab-org/gitlab-shell/blob/master/lib/gitlab_net.rb#L39\n\n```ruby\nresp = post(url, params)\n\ncase resp.code.to_s\n  when HTTP_SUCCESS, HTTP_UNAUTHORIZED, HTTP_NOT_FOUND\n    GitAccessStatus.create_from_json(resp.body)\n...\n```", "state": "closed", "created_at": "2018-09-07T02:27:32.782Z", "updated_at": "2019-08-07T08:34:47.852Z", "closed_at": "2018-09-11T11:05:24.633Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["Geo [DEPRECATED]", "P4", "S4", "devops::enablement", "group::geo", "technical debt", "workflow::In dev"], "milestone": {"id": 502939, "iid": 17, "group_id": 9970, "title": "11.3", "description": "", "state": "closed", "created_at": "2018-04-09T17:59:35.838Z", "updated_at": "2018-11-06T19:17:11.721Z", "due_date": "2018-09-22", "start_date": "2018-08-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/17"}, "assignees": [{"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}], "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "assignee": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "user_notes_count": 3, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/154", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/154", "notes": "https://gitlab.com/api/v4/projects/14022/issues/154/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/154/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 99557674, "type": null, "body": "changed title from **Ensure HTTP status codes are integers & add missing specs for {-various handled HTTP status code-}** to **Ensure HTTP status codes are integers & add missing specs for {+handled HTTP status codes+}**", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-09-07T02:31:12.976Z", "updated_at": "2018-09-07T02:31:12.976Z", "system": true, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}], [{"id": 99557675, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-09-07T02:31:13.018Z", "updated_at": "2018-09-07T02:31:13.018Z", "system": true, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}], [{"id": 99557685, "type": null, "body": "mentioned in merge request !237", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-09-07T02:31:22.625Z", "updated_at": "2018-09-07T02:31:22.625Z", "system": true, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}], [{"id": 99597429, "type": null, "body": "changed title from **{-Ensure HTTP status codes are integers & a-}dd missing specs for handled HTTP status codes** to **{+A+}dd missing specs for handled HTTP status codes**", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-09-07T06:32:20.701Z", "updated_at": "2018-09-07T06:32:20.701Z", "system": true, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}], [{"id": 99597430, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-09-07T06:32:20.742Z", "updated_at": "2018-09-07T06:32:20.742Z", "system": true, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}], [{"id": 99597446, "type": null, "body": "created branch [`154-ensure-http-status-codes-are-integers-add-missing-specs-for-various-handled-http-status-code`](https://gitlab.com/gitlab-org/gitlab-shell/compare/master...154-ensure-http-status-codes-are-integers-add-missing-specs-for-various-handled-http-status-code)", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-09-07T06:32:24.553Z", "updated_at": "2018-09-07T06:32:24.553Z", "system": true, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}], [{"id": 99597452, "type": null, "body": "mentioned in merge request !239", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-09-07T06:32:25.727Z", "updated_at": "2018-09-07T06:32:25.727Z", "system": true, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}], [{"id": 99629395, "type": null, "body": "@ash.mckenzie @stanhu I'm a little worried that we may now pass `text/plain` or `text/html` 401 or 404 responses to `GitAccessStatus.create_from_json`, which will raise a JSON parser error. This may happen when a front-end load-balancer is misconfigured, for instance. \n\nIt needn't block the 8.2.1 release, but I think it's something that !239 should also fix.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-07T08:51:03.031Z", "updated_at": "2018-09-07T08:51:03.031Z", "system": false, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}], [{"id": 99631067, "type": null, "body": "mentioned in merge request !238", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-07T08:58:18.763Z", "updated_at": "2018-09-07T08:58:18.763Z", "system": true, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}], [{"id": 99728545, "type": null, "body": "@nick.thomas Good point! I thought I flagged all invalid JSON parsing code in my gitlab-shell reviews, but I didn't see that one.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-09-07T14:15:00.884Z", "updated_at": "2018-09-07T14:15:00.884Z", "system": false, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}], [{"id": 99754820, "type": null, "body": "Ah, that's an interesting scenario.. nice pickup, thanks :+1:", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-09-07T15:25:39.103Z", "updated_at": "2018-09-07T15:25:39.103Z", "system": false, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}], [{"id": 99834861, "type": null, "body": "added ~3857543 ~3713900 labels", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-09-08T05:22:00.497Z", "updated_at": "2018-09-08T05:22:00.497Z", "system": true, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}], [{"id": 99834880, "type": null, "body": "added ~2526320 label", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-09-08T05:22:29.165Z", "updated_at": "2018-09-08T05:22:29.165Z", "system": true, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}], [{"id": 100340012, "type": null, "body": "closed via merge request !239", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-11T11:05:24.685Z", "updated_at": "2018-09-11T11:05:24.685Z", "system": true, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}], [{"id": 100340013, "type": null, "body": "mentioned in commit 181b9b0924d9d137d5c4b611d2d7271e7c81b437", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-11T11:05:24.843Z", "updated_at": "2018-09-11T11:05:24.843Z", "system": true, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}], [{"id": 100759538, "type": null, "body": "mentioned in merge request !243", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-12T09:56:30.999Z", "updated_at": "2018-09-12T09:56:30.999Z", "system": true, "noteable_id": 13970236, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 154}]]}, {"id": 13922314, "iid": 153, "project_id": 14022, "title": "Release gitlab-shell v8.2.0", "description": "Included in CHANGELOG:\n\n```\n- Pass custom git_config_options to Gitaly !221\n- Add missing require statement in create-hooks !225\n```\n\nNot included in CHANGELOG:\n\n```\n- Refactor that focuses on SRP improvements !214\n- Revert \"Refactor that focuses on SRP improvements\" !228 \n- Update to RSpec 3 !229\n- Remove repo_path from GitlabShell !231\n- Cleanup `git-upload-*` and `git-receive-*` related code !232\n- Fix handling non 200 response codes !235\n```", "state": "closed", "created_at": "2018-09-05T12:23:56.065Z", "updated_at": "2018-09-05T17:29:29.487Z", "closed_at": "2018-09-05T17:29:29.465Z", "closed_by": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "labels": ["Create [DEPRECATED]", "devops::create"], "milestone": {"id": 502939, "iid": 17, "group_id": 9970, "title": "11.3", "description": "", "state": "closed", "created_at": "2018-04-09T17:59:35.838Z", "updated_at": "2018-11-06T19:17:11.721Z", "due_date": "2018-09-22", "start_date": "2018-08-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/17"}, "assignees": [{"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/153", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/153", "notes": "https://gitlab.com/api/v4/projects/14022/issues/153/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/153/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 99073280, "type": null, "body": "mentioned in merge request !236", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-05T12:26:45.560Z", "updated_at": "2018-09-05T12:26:45.560Z", "system": true, "noteable_id": 13922314, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 153}], [{"id": 99182784, "type": null, "body": "closed via merge request !236", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-09-05T17:29:29.504Z", "updated_at": "2018-09-05T17:29:29.504Z", "system": true, "noteable_id": 13922314, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 153}], [{"id": 99182786, "type": null, "body": "mentioned in commit 493646938cad8f99f5420ec578689e112515c5d7", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-09-05T17:29:29.801Z", "updated_at": "2018-09-05T17:29:29.801Z", "system": true, "noteable_id": 13922314, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 153}]]}, {"id": 13865425, "iid": 152, "project_id": 14022, "title": "When API is unavailable, GitAccessStatus.new fails", "description": "**Description**\n\nWhen the API is unavailable, a `GitAccessStatus.new` is attempted but includes an attribute that has been removed and so throws an exception:\n\nhttps://gitlab.com/gitlab-org/gitlab-shell/blob/master/lib/gitlab_net.rb#L41-49\n\n```\nGitAccessStatus.new(false,\n                          'API is not accessible',\n                          gl_repository: nil,\n                          gl_id: nil,\n                          gl_username: nil,\n                          git_config_options: nil,\n                          repository_path: nil,  # <-- problem\n                          gitaly: nil,\n                          git_protocol: nil)\n```\n\n**Example**\n\n```\nLocking support detected on remote \"primary\". Consider enabling it with:\n  $ git config lfs.https://localhost/root/test.git/info/lfs.locksverify true\nConsider unlocking your own locked files: (`git lfs unlock <path>`)\nUploading LFS objects: 100% (145/145), 116 MB | 0 B/s, done\n* 1532061284.lfs\nEnumerating objects: 6, done.\nCounting objects: 100% (6/6), done.\nDelta compression using up to 8 threads.\nCompressing objects: 100% (4/4), done.\nWriting objects: 100% (4/4), 1.11 KiB | 1.11 MiB/s, done.\nTotal 4 (delta 2), reused 0 (delta 0)\nremote: /Users/ash/src/gdk/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_access_status.rb:6:in `initialize': unknown keyword: repository_path (ArgumentError)\nremote: \tfrom /Users/ash/src/gdk/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_net.rb:41:in `new'\nremote: \tfrom /Users/ash/src/gdk/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_net.rb:41:in `check_access'\nremote: \tfrom /Users/ash/src/gdk/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_access.rb:27:in `block in exec'\nremote: \tfrom /Users/ash/src/gdk/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_metrics.rb:50:in `measure'\nremote: \tfrom /Users/ash/src/gdk/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_access.rb:26:in `exec'\nremote: \tfrom hooks/pre-receive:26:in `<main>'\nTo ssh://localhost:2221/root/test.git\n ! [remote rejected] master -> master (pre-receive hook declined)\nerror: failed to push some refs to 'ssh://ash@localhost:2221/root/test.git'\n```\n\n**Fix**\n\n* Remove https://gitlab.com/gitlab-org/gitlab-shell/blob/master/lib/gitlab_net.rb#L47 \n* Remove `:repository_path` from https://gitlab.com/gitlab-org/gitlab-shell/blob/master/lib/gitlab_access_status.rb#L4", "state": "closed", "created_at": "2018-09-03T12:48:02.509Z", "updated_at": "2018-09-05T12:12:30.489Z", "closed_at": "2018-09-05T12:12:30.439Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["Create [DEPRECATED]", "bug", "devops::create", "regression"], "milestone": null, "assignees": [{"id": 101578, "name": "Zeger-Jan van de Weg", "username": "zj-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/101578/avatar.png", "web_url": "https://gitlab.com/zj-gitlab"}], "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "assignee": {"id": 101578, "name": "Zeger-Jan van de Weg", "username": "zj-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/101578/avatar.png", "web_url": "https://gitlab.com/zj-gitlab"}, "user_notes_count": 2, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/152", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/152", "notes": "https://gitlab.com/api/v4/projects/14022/issues/152/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/152/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 98507433, "type": null, "body": "/cc @zj, @nick.thomas", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-09-03T12:49:25.572Z", "updated_at": "2018-09-03T12:49:25.572Z", "system": false, "noteable_id": 13865425, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 152}], [{"id": 98509947, "type": null, "body": "added ~7156613 ~3103452 labels", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-03T12:59:41.464Z", "updated_at": "2018-09-03T12:59:41.464Z", "system": true, "noteable_id": 13865425, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 152}], [{"id": 98511871, "type": null, "body": "added ~7262327 label", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-03T13:07:15.097Z", "updated_at": "2018-09-03T13:07:15.097Z", "system": true, "noteable_id": 13865425, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 152}], [{"id": 98511935, "type": null, "body": "Thanks @ash.mckenzie, good spot! @zj are you available to look into this, or should I jump on it?", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-03T13:07:29.335Z", "updated_at": "2018-09-03T13:07:29.335Z", "system": false, "noteable_id": 13865425, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 152}], [{"id": 98511983, "type": null, "body": "removed ~7262327 label", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-03T13:07:39.770Z", "updated_at": "2018-09-03T13:07:39.770Z", "system": true, "noteable_id": 13865425, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 152}], [{"id": 98529030, "type": null, "body": "assigned to @zj", "attachment": null, "author": {"id": 101578, "name": "Zeger-Jan van de Weg", "username": "zj-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/101578/avatar.png", "web_url": "https://gitlab.com/zj-gitlab"}, "created_at": "2018-09-03T14:15:37.069Z", "updated_at": "2018-09-03T14:15:37.069Z", "system": true, "noteable_id": 13865425, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 152}], [{"id": 98986719, "type": null, "body": "mentioned in commit 22c6951d64e8b2c3a9e05306c52cd861c9c23ec7", "attachment": null, "author": {"id": 101578, "name": "Zeger-Jan van de Weg", "username": "zj-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/101578/avatar.png", "web_url": "https://gitlab.com/zj-gitlab"}, "created_at": "2018-09-05T07:34:21.710Z", "updated_at": "2018-09-05T07:34:21.710Z", "system": true, "noteable_id": 13865425, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 152}], [{"id": 98986783, "type": null, "body": "mentioned in merge request !235", "attachment": null, "author": {"id": 101578, "name": "Zeger-Jan van de Weg", "username": "zj-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/101578/avatar.png", "web_url": "https://gitlab.com/zj-gitlab"}, "created_at": "2018-09-05T07:34:40.973Z", "updated_at": "2018-09-05T07:34:40.973Z", "system": true, "noteable_id": 13865425, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 152}], [{"id": 99068415, "type": null, "body": "closed via merge request !235", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-05T12:12:30.510Z", "updated_at": "2018-09-05T12:12:30.510Z", "system": true, "noteable_id": 13865425, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 152}], [{"id": 99068427, "type": null, "body": "mentioned in commit d5306c9535fc5d1a5711a8b0a613904db308bc65", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-05T12:12:31.758Z", "updated_at": "2018-09-05T12:12:31.758Z", "system": true, "noteable_id": 13865425, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 152}]]}, {"id": 13479275, "iid": 151, "project_id": 14022, "title": "Can we remove the support for `gitlab-shell user-123` invocations?", "description": "The `bin/gitlab-shell` executable is meant to be invoked by SSHd. There are three ways I know that it can be invoked:\n\n- via `~git/.ssh/authorized_keys` -- invocation looks like `gitlab-shell key-456`\n- via `AuthorizedKeysCommand` -- also, `gitlab-shell key-456`\n- via `AuthorizedPrincipalsCommand` -- `gitlab-shell username-someuser`\n\nSo what do we support `gitlab-shell user-123` for? If it has no use we should remove it.", "state": "closed", "created_at": "2018-08-16T13:09:58.434Z", "updated_at": "2019-03-21T10:50:28.412Z", "closed_at": "2018-10-01T12:51:05.159Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": [], "milestone": null, "assignees": [{"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}], "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "assignee": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "user_notes_count": 9, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/151", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/151", "notes": "https://gitlab.com/api/v4/projects/14022/issues/151/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/151/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 94911885, "type": null, "body": "assigned to @nick.thomas and @rspeicher", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-08-16T13:10:51.651Z", "updated_at": "2018-08-16T13:10:51.651Z", "system": true, "noteable_id": 13479275, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 151}], [{"id": 94911910, "type": null, "body": "unassigned @nick.thomas", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-08-16T13:10:59.019Z", "updated_at": "2018-08-16T13:10:59.019Z", "system": true, "noteable_id": 13479275, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 151}], [{"id": 94911955, "type": null, "body": "@rspeicher do you know what this is for?", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-08-16T13:11:12.359Z", "updated_at": "2018-08-16T13:11:12.359Z", "system": false, "noteable_id": 13479275, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 151}], [{"id": 98239310, "type": null, "body": "@jacobvosmaer\\-gitlab None. Can we find the first commit that added it, find the first Git tag that contains that commit (via `git tag --contains SHA`) and then check commits in CE/EE around the time of the commit to bump the `GITLAB_SHELL_VERSION` to that tag? :thinking:", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-09-01T00:44:56.061Z", "updated_at": "2018-09-01T00:44:56.061Z", "system": false, "noteable_id": 13479275, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 151}], [{"id": 98239383, "type": null, "body": "> find the first commit that added it\n\nLooks like b29a61ebe0d6bcade65d397569b5ffe9089010fd to me.\n\n> find the first Git tag that contains that commit\n\nLooks like `v1.9.0` to me.\n\n> check commits in CE/EE around the time of the commit to bump the `GITLAB_SHELL_VERSION` to that tag?\n\nThat tag predates the version file, whose first entry was 1.9.5: gitlab-org/gitlab-ce@6384344f156ccec0de746be68b168a745bdf73ae\n\nSo in that case @dzaporozhets might very well be the only person who knows :laughing: ", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-09-01T00:47:21.134Z", "updated_at": "2018-09-01T00:50:06.467Z", "system": false, "noteable_id": 13479275, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 151}], [{"id": 98423388, "type": null, "body": "@rspeicher @jacobvosmaer\\-gitlab from my memory we had `key-123` for ssh requests and `user-123` for git over http requests. In both git over ssh and git over http requests we executed pre-receive & update hooks and we needed a way to identify the actor. Back in time, it was necessary. Not sure how gitlab-shell changed since then so it might be irrelevant now", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2018-09-03T08:12:28.520Z", "updated_at": "2018-09-03T08:12:28.520Z", "system": false, "noteable_id": 13479275, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 151}], [{"id": 99962465, "type": null, "body": "@jacobvosmaer\\-gitlab @dzaporozhets So maybe in this case let's add some logging to the condition that handles `user-123`, and then based on the (lack of) usage after a month or two, we can decide whether or not it can be removed entirely?", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-09-09T20:41:08.880Z", "updated_at": "2018-09-09T20:41:08.880Z", "system": false, "noteable_id": 13479275, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 151}], [{"id": 100065587, "type": null, "body": "@rspeicher great idea!", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2018-09-10T10:43:00.018Z", "updated_at": "2018-09-10T10:43:00.018Z", "system": false, "noteable_id": 13479275, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 151}], [{"id": 100184577, "type": null, "body": "I've actually just discovered a situation where the `user-123` form is used.\n\nA commit via the web UI triggers a call to `/internal/pre-receive` and `/internal/post-receive` from the gitlab-shell hooks, using this syntax. Offending line of code is here: https://gitlab.com/gitlab-org/gitlab-ce/blob/master/lib/gitlab/gitaly_client/operation_service.rb#L321\n\n```ruby\n          user: Gitlab::Git::User.from_gitlab(user).to_gitaly,\n```\n\nThe call translates a `::User` to a `gl_id` via https://gitlab.com/gitlab-org/gitlab-ce/blob/master/lib/gitlab/gl_id.rb which uses the `user-x` syntax.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-10T18:35:55.165Z", "updated_at": "2018-09-10T18:36:42.879Z", "system": false, "noteable_id": 13479275, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 151}], [{"id": 101944631, "type": null, "body": "@nick.thomas the question is not whether `user-123` means something: it does, in GL_ID.\n\nThe question is when we ever pass `user-123` as an argument to `bin/gitlab-shell`. I expect the answer to be \"never\".", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-09-17T15:17:45.776Z", "updated_at": "2018-09-17T15:17:45.776Z", "system": false, "noteable_id": 13479275, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 151}], [{"id": 101953699, "type": null, "body": "@rspeicher https://gitlab.com/gitlab-org/gitlab-shell/commit/b29a61ebe0d6bcade65d397569b5ffe9089010fd is not the commit you're looking for. That is about our use of GL_ID (which may be set to `user-123`) during Git hooks.\n\nIt seems that the idea that `bin/gitlab-shell` accepts a `user-123` argument comes from https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/226 (by @nick.thomas). My suspicion is that this was a misunderstanding.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-09-17T15:26:02.019Z", "updated_at": "2018-09-17T15:26:02.019Z", "system": false, "noteable_id": 13479275, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 151}], [{"id": 104998057, "type": null, "body": "mentioned in merge request !247", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-09-28T08:53:45.009Z", "updated_at": "2018-09-28T08:53:45.009Z", "system": true, "noteable_id": 13479275, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 151}], [{"id": 105532209, "type": null, "body": "closed via merge request !247", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:51:05.228Z", "updated_at": "2018-10-01T12:51:05.228Z", "system": true, "noteable_id": 13479275, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 151}], [{"id": 105532210, "type": null, "body": "mentioned in commit 8bf88fba3cbb4837058431ffa5224536513a830d", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:51:05.346Z", "updated_at": "2018-10-01T12:51:05.346Z", "system": true, "noteable_id": 13479275, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 151}], [{"id": 152831251, "type": null, "body": "mentioned in merge request !285", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-03-21T10:50:28.365Z", "updated_at": "2019-03-21T10:50:28.365Z", "system": true, "noteable_id": 13479275, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 151}]]}, {"id": 13477697, "iid": 150, "project_id": 14022, "title": "Comments in `gitlab_shell_authorized_principals_check` are inaccurate", "description": "Noted in #gitlab-shell on Slack by @jacobvosmaer\\-gitlab - thanks! https://gitlab.slack.com/archives/C6FBZ5YHL/p1534419991000100\n\n(description significantly updated to reflect reality)\n\nThe `bin/gitlab-shell-authorized-principals-check` script was mostly copied from the `gitlab-shell-authorized-keys-check` script, and I did a bad job of reviewing comments in it. Consider:\n\n```\n#\n# GitLab shell authorized principals helper. Emits the same sort of\n# command=\"...\" line as gitlab-shell-authorized-principals-check, with\n# the right options.\n#\n# Ex.\n#   bin/gitlab-shell-authorized-keys-check <key-id> <principal1> [<principal2>...]\n#\n# Returns one line per principal passed in, e.g.:\n#   command=\"/bin/gitlab-shell username-{KEY_ID}\",no-port-forwarding,no-X11-forwarding,no-agent-forwarding,no-pty {PRINCIPAL}\n#   [command=\"/bin/gitlab-shell username-{KEY_ID}\",no-port-forwarding,no-X11-forwarding,no-agent-forwarding,no-pty {PRINCIPAL2}]\n#\n# Expects to be called by the SSH daemon, via configuration like:\n#     AuthorizedPrincipalsCommandUser root\n#     AuthorizedPrincipalsCommand /bin/gitlab-shell-authorized-principals-check git %i sshUsers\n\n```\n\nAll this needs to be updated to reflect the *actual* invocation of this command.\n\nKey points:\n\n* It expects to be run inside a `Match user git` block, so unlike `gitlab_shell_authorized_keys_check`, we don't need to pass `git`\n* We need to call it by its real name\n* ...", "state": "opened", "created_at": "2018-08-16T11:58:08.901Z", "updated_at": "2019-07-26T01:15:25.145Z", "closed_at": null, "closed_by": null, "labels": ["Create [DEPRECATED]", "devops::create"], "milestone": null, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 4, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/150", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/150", "notes": "https://gitlab.com/api/v4/projects/14022/issues/150/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/150/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 94896474, "type": null, "body": "changed milestone to %\"11.2\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-16T12:03:32.807Z", "updated_at": "2018-08-16T12:03:32.807Z", "system": true, "noteable_id": 13477697, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 150}], [{"id": 94896531, "type": null, "body": "added ~7156613 ~2779335 labels", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-16T12:03:45.172Z", "updated_at": "2018-08-16T12:03:45.172Z", "system": true, "noteable_id": 13477697, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 150}], [{"id": 94896858, "type": null, "body": "@nick.thomas can't we use `Match` in sshd_config to limit for which system users AuthorizedPrincipalsCommand gets invoked in the first place? In other words we can defer this check to sshd via sshd_config.\n\nI'm not sure why we didn't do this with our AuthorizedKeysCommand integration, perhaps as defense in depth or to simplify deployment?", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-08-16T12:05:47.625Z", "updated_at": "2018-08-16T12:05:47.625Z", "system": false, "noteable_id": 13477697, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 150}], [{"id": 94897084, "type": null, "body": "In fact, the documentation at https://docs.gitlab.com/ee/administration/operations/ssh_certificates.html already uses `Match User git`.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-08-16T12:07:06.542Z", "updated_at": "2018-08-16T12:07:06.542Z", "system": false, "noteable_id": 13477697, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 150}], [{"id": 94898227, "type": null, "body": "@jacobvosmaer\\-gitlab ah, OK. That provides the same security as doing the check in the `authorized_principals_check` command. So if people follow the docs, we're OK.\n\nFor `AuthorizedKeysCommand`, we don't recommend the `Match` segment, which is where I got confused, I guess!", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-16T12:12:24.331Z", "updated_at": "2018-08-16T12:12:24.331Z", "system": false, "noteable_id": 13477697, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 150}], [{"id": 94898286, "type": null, "body": "removed milestone", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-16T12:12:38.569Z", "updated_at": "2018-08-16T12:12:38.569Z", "system": true, "noteable_id": 13477697, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 150}], [{"id": 94898318, "type": null, "body": "removed ~2779335 label", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-16T12:12:46.887Z", "updated_at": "2018-08-16T12:12:46.887Z", "system": true, "noteable_id": 13477697, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 150}], [{"id": 94899712, "type": null, "body": "changed title from **{-Ensure SSH certificate support only checks if people are logging in as git@example.org (or other appropriate username)-}** to **{+Comments in `gitlab_shell_authorized_keys_check` are inaccurate+}**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-16T12:19:13.778Z", "updated_at": "2018-08-16T12:19:13.778Z", "system": true, "noteable_id": 13477697, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 150}], [{"id": 94899713, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-16T12:19:13.803Z", "updated_at": "2018-08-16T12:19:13.803Z", "system": true, "noteable_id": 13477697, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 150}], [{"id": 94899949, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-16T12:20:02.650Z", "updated_at": "2018-08-16T12:20:02.650Z", "system": true, "noteable_id": 13477697, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 150}], [{"id": 94900025, "type": null, "body": "changed title from **Comments in `gitlab_shell_authorized_{-key-}s_check` are inaccurate** to **Comments in `gitlab_shell_authorized_{+principal+}s_check` are inaccurate**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-16T12:20:21.206Z", "updated_at": "2018-08-16T12:20:21.206Z", "system": true, "noteable_id": 13477697, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 150}], [{"id": 94900655, "type": null, "body": "made the issue visible to everyone", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-16T12:23:10.844Z", "updated_at": "2018-08-16T12:23:10.844Z", "system": true, "noteable_id": 13477697, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 150}], [{"id": 94902889, "type": null, "body": "> I'm not sure why we didn't do this with our AuthorizedKeysCommand integration\n\nThere is a historical explanation. OpenSSH 6.2 introduced AuthorizedKeysCommand but until OpenSSH 6.5, it [did not work](https://bugzilla.mindrot.org/show_bug.cgi?id=2161) with `Match User git`. So at the time we started using AuthorizedKeysCommand, the \"manual\" actual user / expected user comparison was probably necessary.\n\nBut you can't use `AuthorizedPrincipalsCommand` unless you're on OpenSSH 6.8 and we have no indication there is a Match User bug affecting it.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-08-16T12:33:05.411Z", "updated_at": "2018-08-16T12:53:28.952Z", "system": false, "noteable_id": 13477697, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 150}]]}, {"id": 13463974, "iid": 149, "project_id": 14022, "title": "gitlab-shell needs end-to-end tests of bin/gitlab-shell being called, it calling APIs, and then calling custom hooks", "description": "@nick.thomas @ashmckenzie : Makes sense with all the relevant issues / MRs to clean this up now closed, to have an issue to track how we recover from this and re-merge some version of !214.\n\nAs noted in https://gitlab.com/gitlab-org/gitlab-shell/issues/147#note_93464123 !214 (since reverted in !228) introduced some regressions to the newly added SSH certificate support in 11.2.\n\nAs \"Work on improving the test coverage for gitlab-shell...\" in the linked comment says, this got past review because there's no end-to-end testing of invoking `gitlab-shell`, it then invoking some APIs, and finally invoking some custom hooks and passing the right `GL_ID` to them in the various modes (key, user, username).\n\nThere should also be a test in there somewhere to test for how invalid API responses are handled. See https://gitlab.com/gitlab-org/gitlab-shell/commit/cce62b3571617e2df3aee8df4b3b1908191dc495#02444758fa500fe5b5772b37af6b802533ef221a_212_211", "state": "opened", "created_at": "2018-08-15T20:06:58.973Z", "updated_at": "2019-03-12T00:33:09.781Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 2, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/149", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/149", "notes": "https://gitlab.com/api/v4/projects/14022/issues/149/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/149/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 94763242, "type": null, "body": "mentioned in merge request !230", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-15T20:07:37.514Z", "updated_at": "2018-08-15T20:07:37.514Z", "system": true, "noteable_id": 13463974, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 149}], [{"id": 94779902, "type": null, "body": "mentioned in issue #74", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-15T21:44:49.428Z", "updated_at": "2018-08-15T21:44:49.428Z", "system": true, "noteable_id": 13463974, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 149}], [{"id": 148317144, "type": null, "body": "Small note. Custom hooks have nothing to do with `bin/gitlab-shell`. After all, they should also run when you edit a file via GitLab's web UI. This sounds more like something we should test in Gitaly.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2019-03-07T14:54:31.555Z", "updated_at": "2019-03-07T14:54:31.555Z", "system": false, "noteable_id": 13463974, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 149}], [{"id": 149438736, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2019-03-12T00:33:09.852Z", "updated_at": "2019-03-12T00:33:09.852Z", "system": true, "noteable_id": 13463974, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 149}]]}, {"id": 13371493, "iid": 148, "project_id": 14022, "title": "gitlab-shell 8.1.1 not on master", "description": "Nightly builds and the GDK use `master`, but `GITLAB_SHELL_VERSION` is pointing at 8.1.1 in CE. We are seeing warnings relating to this.\n\n@nick.thomas I know I asked this before, but do we need to bring in https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/226 to `master` somehow?", "state": "closed", "created_at": "2018-08-11T00:16:05.266Z", "updated_at": "2018-08-15T19:52:43.530Z", "closed_at": "2018-08-15T19:52:43.492Z", "closed_by": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "labels": [], "milestone": null, "assignees": [{"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}], "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "assignee": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "user_notes_count": 5, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/148", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/148", "notes": "https://gitlab.com/api/v4/projects/14022/issues/148/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/148/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 93877356, "type": null, "body": "@stanhu we do. I envisioned doing so by fixing the conflicts in !222 and merging it to master. However, I've not had time to allocate to it so far :/", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-11T07:50:16.846Z", "updated_at": "2018-08-11T07:50:16.846Z", "system": false, "noteable_id": 13371493, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 148}], [{"id": 93877376, "type": null, "body": "(We also need to bring the 8.1.1 changelog commit to master from the 8-1-stable branch)", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-11T07:50:32.896Z", "updated_at": "2018-08-11T07:50:32.896Z", "system": false, "noteable_id": 13371493, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 148}], [{"id": 94135519, "type": null, "body": "@nick.thomas: As noted in my https://gitlab.com/gitlab-org/gitlab-shell/issues/147#note_93464123 it's much tricker than just resolving a conflict, since the ssh certificate feature as a whole is now broken in master. I still think the plan there of just reverting & retrying makes more sense...", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-13T10:32:09.478Z", "updated_at": "2018-08-13T10:32:09.478Z", "system": false, "noteable_id": 13371493, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 148}], [{"id": 94166687, "type": null, "body": "@avar yes, I need to look more closely at the code. I'm hopeful that I can fix it without reverting the refactor, but will certainly do so if it turns out to be more than a few hours of work.\n\nReleasing 8.1.1 took the time pressure off, is all :)", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-13T12:21:29.252Z", "updated_at": "2018-08-13T12:21:29.252Z", "system": false, "noteable_id": 13371493, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 148}], [{"id": 94291136, "type": null, "body": "If we revert !214 then we don't need !222 . We can just merge the 8-1-stable branch to master, which should apply cleanly.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-13T23:51:25.928Z", "updated_at": "2018-08-13T23:51:25.928Z", "system": false, "noteable_id": 13371493, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 148}], [{"id": 94292064, "type": null, "body": "mentioned in merge request !228", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-14T00:08:36.690Z", "updated_at": "2018-08-14T00:08:36.690Z", "system": true, "noteable_id": 13371493, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 148}], [{"id": 94567993, "type": null, "body": "mentioned in merge request !230", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-14T21:50:10.993Z", "updated_at": "2018-08-14T21:50:10.993Z", "system": true, "noteable_id": 13371493, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 148}], [{"id": 94639223, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-15T09:34:29.584Z", "updated_at": "2018-08-15T09:34:29.584Z", "system": true, "noteable_id": 13371493, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 148}], [{"id": 94761342, "type": null, "body": "closed via merge request !230", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-08-15T19:52:43.557Z", "updated_at": "2018-08-15T19:52:43.557Z", "system": true, "noteable_id": 13371493, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 148}], [{"id": 94761343, "type": null, "body": "mentioned in commit 122d84a403d3534dea743d94aa23d4115cc804a8", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-08-15T19:52:43.724Z", "updated_at": "2018-08-15T19:52:43.724Z", "system": true, "noteable_id": 13371493, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 148}]]}, {"id": 13326926, "iid": 147, "project_id": 14022, "title": "Regressions in gitlab-shell due to merging !214", "description": "(ping: @ash.mckenzie & @rspeicher)\n\nI'm working on !222 to fix some regressions I caused (see #145). Part of working on that fix was adding tests for `bin/gitlab-shell`. There were no end-to-end tests for it before. When rebasing those tests on `master` you can see that a lot is broken since v8.1.0.\n\nTo reproduce, check out my !222, then apply this patch:\n\n```\ndiff --git a/lib/gitlab_shell.rb b/lib/gitlab_shell.rb\nindex c6b28ce..78fdfe8 100644\n--- a/lib/gitlab_shell.rb\n+++ b/lib/gitlab_shell.rb\n@@ -208,7 +208,7 @@ class GitlabShell # rubocop:disable Metrics/ClassLength\n     begin\n       if defined?(@who)\n         @user = api.discover(@who)\n-        @gl_id = \"user-#{@user['id']}\" if @user\n+        @gl_id = \"user-#{@user['id']}\"\n       else\n         @user = api.discover(@gl_id)\n       end\n```\n\nThat undoes a fix for an existing bug in v8.1.0. I have no idea how to fix that bug on the new master, but let's leave that aside for now. Then when you run the tests I've added in `spec/gitlab_shell_gitlab_shell_spec.rb` you can see that just one test fails (the test spotting that particular regression).\n\nNow rebase on master with that change, for convenience here's rebased commit: https://gitlab.com/avar/gitlab-shell/commits/214-regression-demo\n\nA few tests now fail, and this is all stuff that'll be broken due to !214, since it's testing the existing gitlab-shell behavior (there just weren't any tests before): https://gitlab.com/avar/gitlab-shell/pipelines/27465637\n\nI'm also concerned (but have not confirmed or denied), that the new code is going to be making extra API calls in some cases that we weren't doing before. As noted in my 2e8b670 (\"Add support for SSH certificate authentication\", 2018-06-14) I was bending over backwards with the \"username\" support to not have it be less efficient than the other endpoints, and one of the tricky bits to get that right is the part I had a merge conflict with above.", "state": "closed", "created_at": "2018-08-08T19:36:04.322Z", "updated_at": "2018-08-15T20:07:00.385Z", "closed_at": "2018-08-14T18:49:16.509Z", "closed_by": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "labels": [], "milestone": null, "assignees": [{"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}], "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "assignee": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "user_notes_count": 9, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/147", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/147", "notes": "https://gitlab.com/api/v4/projects/14022/issues/147/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/147/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 93372740, "type": null, "body": "mentioned in merge request !222", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-08T19:37:09.577Z", "updated_at": "2018-08-08T19:37:09.577Z", "system": true, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 93389930, "type": null, "body": "assigned to @ash.mckenzie", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-08-08T21:54:37.364Z", "updated_at": "2018-08-08T21:54:37.364Z", "system": true, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 93389967, "type": null, "body": "My apologies @avar , I'll jump on this first thing today", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-08-08T21:54:56.615Z", "updated_at": "2018-08-08T21:54:56.615Z", "system": false, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 93391414, "type": null, "body": "@ash.mckenzie : No worries, but just in terms of releasing a good GitLab 11.2, your !214 is marked for 11.3, which as-is has a regression (noted in #145) that needs to be fixed.\n\nI don't care what happens here as long as stuff works when I upgrade and my SSH certificates patch doesn't break stuff for other users, but this is something to think about. Either your merge needs to be reverted + my fix merged in for 11.2, or your refactoring (with fixes) + my fixes need to be in 11.2.", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-08T22:08:44.749Z", "updated_at": "2018-08-08T22:09:32.309Z", "system": false, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 93395583, "type": null, "body": "Thanks @avar :+1:", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-08-08T23:02:34.060Z", "updated_at": "2018-08-08T23:02:34.060Z", "system": false, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 93408961, "type": null, "body": "https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/224 addresses regressions.", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-08-09T01:08:18.053Z", "updated_at": "2018-08-09T01:08:18.053Z", "system": false, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 93455724, "type": null, "body": "mentioned in merge request !224", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-09T08:05:12.722Z", "updated_at": "2018-08-09T08:05:12.722Z", "system": true, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 93464123, "type": null, "body": "As noted in !224 some of these issues have been solved there.\n\n(Disclaimer: I haven't actually run any of the code on master, don't have a end-to-end test setup for that here. Just read it, I may be wrong about some of the below)\n\nBut replying to my own \"I'm also concerned...\" in the initial report, it looks like this merge (and confusingly, the relevant code was changed in the merge commit 2bdf08e) broke the new \"username\" mode for SSH certificates.\n\nThe reason, as noted in 2e8b670:\n\n```\n         c) Once we have the \"user id\", the GL_ID gets passed down to\n            e.g. user-authored hooks. I don't want to have those all break\n            by having to handle a third GL_ID mode of \"username\" in\n            addition to the current \"key id\" and \"user id\".\n```\n\nBut that seems to be exactly what we're doing now. I.e. when we make git requests (which result in hooks being executed) you're freezing a GL_ID as `actor.identifier`: https://gitlab.com/gitlab-org/gitlab-shell/blob/2fb6ea3e6ffc8706d36a2c728678ebc35153c299/lib/action/gitaly.rb#L88-101\n\nWhich, as shown here: https://gitlab.com/gitlab-org/gitlab-shell/blob/2fb6ea3e6ffc8706d36a2c728678ebc35153c299/lib/actor/base.rb#L18-32 and here: https://gitlab.com/gitlab-org/gitlab-shell/blob/2fb6ea3e6ffc8706d36a2c728678ebc35153c299/lib/actor/username.rb#L6-12 is now set to `username`, **not** `user`.\n\nThis breaks the SSH certificate mode, because you've removed the code where we \"bounce off\" the `/allowed` call and discover the user id (and set the `GL_ID`) if a username is provided. The relevant parts of the code were:\n\n* Initializer not getting a GL_ID at the beginning: https://gitlab.com/gitlab-org/gitlab-shell/blob/2e8b67027067761034f36dadb3c2208ce66d2552/lib/gitlab_shell.rb#L26-30\n* Us **maybe** doing a /allowed API call early on: https://gitlab.com/gitlab-org/gitlab-shell/blob/2e8b67027067761034f36dadb3c2208ce66d2552/lib/gitlab_shell.rb#L46-47\n* If so, bootstrap the GL_ID from what we got from there, if it wasn't defined and we were in the `username` mode: https://gitlab.com/gitlab-org/gitlab-shell/blob/2e8b67027067761034f36dadb3c2208ce66d2552/lib/gitlab_shell.rb#L123-125\n* Otherwise, call the user() method: https://gitlab.com/gitlab-org/gitlab-shell/blob/2e8b67027067761034f36dadb3c2208ce66d2552/lib/gitlab_shell.rb#L49-53\n* That method would then do the discovery via the /discover API call (e.g. in the case of the handling the 2fa method): https://gitlab.com/gitlab-org/gitlab-shell/blob/2e8b67027067761034f36dadb3c2208ce66d2552/lib/gitlab_shell.rb#L207-209\n\nHere's notes for specific parts in the code (this is the tip of !224)\nthat still look broken. Should be read in order of A(1), then A(2), B(1) etc.\n\nThis isn't an exhaustive list, I stopped reading after `C` since it seems clear we don't have a valid GL_ID at that point, so other downstream stuff may be broken too:\n\n```\ndiff --git a/lib/action/api_2fa_recovery.rb b/lib/action/api_2fa_recovery.rb\nindex 06f8057..221d3e4 100644\n--- a/lib/action/api_2fa_recovery.rb\n+++ b/lib/action/api_2fa_recovery.rb\n@@ -34,6 +34,8 @@ module Action\n         return\n       end\n \n+      # B(2): ... which results in this API call, with the actor\n+      # object.\n       resp = api.two_factor_recovery_codes(actor)\n       if resp['success']\n         codes = resp['recovery_codes'].join(\"\\n\")\ndiff --git a/lib/actor/base.rb b/lib/actor/base.rb\nindex c0697dd..fac1a85 100644\n--- a/lib/actor/base.rb\n+++ b/lib/actor/base.rb\n@@ -40,6 +40,9 @@ module Actor\n     end\n \n     def username\n+      # A(2): ...and aren't we going to here be making an API call in\n+      # the username mode just to discover the username, which we know\n+      # already?\n       @username ||= begin\n         user = GitlabNet.new.discover(self)\n         user ? \"@#{user['username']}\" : ANONYMOUS_USER\ndiff --git a/lib/gitlab_net.rb b/lib/gitlab_net.rb\nindex 9ea18aa..f6e7e3b 100644\n--- a/lib/gitlab_net.rb\n+++ b/lib/gitlab_net.rb\n@@ -78,6 +78,8 @@ class GitlabNet\n   end\n \n   def two_factor_recovery_codes(actor)\n+    # B(3): ... where you pass \"username => NAME\", which this API\n+    # doesn't support.\n     params = { actor.identifier_key.to_sym => actor.id }\n     resp = post(\"#{internal_api_endpoint}/two_factor_recovery_codes\", params)\n     JSON.parse(resp.body) if resp.code == HTTP_SUCCESS\ndiff --git a/lib/gitlab_shell.rb b/lib/gitlab_shell.rb\nindex bd7b783..f9c1cda 100644\n--- a/lib/gitlab_shell.rb\n+++ b/lib/gitlab_shell.rb\n@@ -28,6 +28,8 @@ class GitlabShell\n   # 'evil command'.\n   def exec(origin_cmd)\n     if !origin_cmd || origin_cmd.empty?\n+      # A(1): Here we'll call actor.username in the username mode (and\n+      # other modes)....\n       puts \"Welcome to GitLab, #{actor.username}!\"\n       return true\n     end\n@@ -95,6 +97,7 @@ class GitlabShell\n   end\n \n   def determine_action(parsed_command)\n+    # B(1): Here you're making a 2fa API request...\n     return Action::API2FARecovery.new(actor) if parsed_command.command == API_2FA_RECOVERY_CODES_COMMAND\n \n     GitlabMetrics.measure('verify-access') do\n@@ -106,6 +109,10 @@ class GitlabShell\n         actor,\n         '_any'\n       )\n+      # C(1): Here we've called /allowed in \"username\" mode, so we\n+      # don't know the user id, but there's nothing like the \"@gl_id =\n+      # status.gl_id\" bootstrapping line removed in 2bdf08e anymore,\n+      # so we proceed without knowing it.\n \n       case parsed_command.command\n       when GIT_LFS_AUTHENTICATE_COMMAND\n```\n\nI think that perhaps [re: my comment above](https://gitlab.com/gitlab-org/gitlab-shell/issues/147#note_93391414) and with the imminent 11.2 release it's worth considering:\n\n1. Ejecting !214 out of master\n2. Merging in my !222, and release 11.2 with that\n3. Work on improving the test coverage for gitlab-shell, similarly to there being no basic end-to-end tests for running `gitlab-shell` itself before my !222 there's no end-to-end tests to see how hooks are run, which is why this `GL_ID` issue noted above went unspotted. There should also be some tests asserting that all the actions `gitlab-shell` can do in various modes (key, user, username) will only result in X amount of API calls.\n4. Rebase !214 on that new master (so e.g. there aren't major behavior changes in the conflict resolution in merge commits) as now in 2bdf08e\n\nWhat do you think?", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-09T08:43:20.129Z", "updated_at": "2018-08-09T11:00:12.151Z", "system": false, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 94135524, "type": null, "body": "mentioned in issue #148", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-13T10:32:10.791Z", "updated_at": "2018-08-13T10:32:10.791Z", "system": true, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 94291073, "type": null, "body": "mentioned in merge request !228", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-13T23:49:53.524Z", "updated_at": "2018-08-13T23:49:53.524Z", "system": true, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 94291207, "type": null, "body": "OK @avar, @ash.mckenzie, @rspeicher, @DouweM, I've pulled !224 and !222 together into !227 to better understand how they interact together.\n\n@avar's note about breaking 2FA is definitely correct. A possible fix is to always convert the `Username` actor to a `User` actor, so taking it out of the picture. However, I see more-fundamental problems with the `Key` and `User` actors , and I'm having a lot of trouble even seeing how the pattern of API requests has changed, and so my confidence in !227, even with the additional fixes I've been playing with, is really low.\n\nMaster is moving on, so we need to resolve this quickly - there are already some revert conflicts with !214, and it's only going to grow - so I've bowed to @avar's wisdom and created a revert MR: !228 .", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-13T23:52:31.759Z", "updated_at": "2018-08-13T23:52:31.759Z", "system": false, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 94372965, "type": null, "body": "@nick.thomas @ash.mckenzie : One thing that occurred to me that we could do to make sure this SSH certificate mode keeps working / being tested, but I'm not 100% sure this would be acceptable, so chime in.\n\nRight now when you upload a key to your profile we give that key an ID, and we call gitlab-shell with a `key-ID` and it resolves a user from that.\n\nI can't see a reason for why we wouldn't just do a user lookup when we generate the `authorized_keys` file, and instead of `key-ID` we'd write `username-NAME` in the `authorized_keys` file.\n\nWe would lose logging information about which specific key the user used, but does anyone care? If you upload 10 keys to your profile, they all give you the same access.\n\nOne minor disadvantage of this is if it's done via `bin/gitlab-shell-authorized-keys-check` it will require an extra DB lookup. Right now we just get a record from the `keys` table which has a `user_id`, but we would need to do an extra lookup to get the `username`:\n\n```\nirb(main):003:0> k = Key.find_by(id: 120)\n=> #<DeployKey id: 120, user_id: 2025, [...]\nirb(main):004:0> u = User.find_by(id: 2025)\n=> #<User id:2025 @gitlab-gitslave-robot>\n```\n\nWe would still need `key-ID` in the file for deploy keys, because those **don't** give the same access even if multiple deploy keys are owned by the same user. So there the `key-ID` is critical.\n\nWhat this would accomplish would be:\n\n* `key-ID` mode: Always used & tested by deploy keys\n* `user-ID` mode: Either unused (as it is now), or if we want to skip an extra (primary key) lookup in the `/authorized_keys` API call we would use this from `gitlab-shell-authorized-keys-check`.\n* `username-NAME` mode: Used by both the SSH certificate mode, and by the code that would generate the `~/.ssh/authorized_keys` file on-disk (since that's not interactive, so nobody would care about an extra primary key lookup or `JOIN`).\n\nAs opposed to the current situation:\n\n* `key-ID` mode: Always used unless you use SSH certificates\n* `user-ID` mode: Not used at all (unless someone wrote a strange custom `AuthorizedKeysCommand` or `AuthorizedPrincipalsCommand`.\n* `username-NAME` mode: Only used if you use SSH certificates & `bin/gitlab-shell-authorized-principals-check`", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-14T09:48:16.092Z", "updated_at": "2018-08-14T09:48:16.092Z", "system": false, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 94417449, "type": null, "body": "I wouldn't mind being able to rationalize `GL_ID`, but rewriting `authorized_keys` would be quite a task (it's incrementally updated over time). It's not something I'd want to plan in the very short term.\n\nWhat we really, really need is a good set of tests that run gitlab-shell against gitlab-ce for all SSH functionality. This is what gitlab-qa is for, and I think putting effort in there will reap rewards, however we decide to move forward with the interface between gitlab-shell and gitlab-ce.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-14T12:53:48.326Z", "updated_at": "2018-08-14T12:53:48.326Z", "system": false, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 94497649, "type": null, "body": "closed via merge request !228", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-08-14T18:49:16.712Z", "updated_at": "2018-08-14T18:49:16.712Z", "system": true, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 94497651, "type": null, "body": "mentioned in commit 02457041814fe4497b3df00e0e45edbee107c823", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-08-14T18:49:16.950Z", "updated_at": "2018-08-14T18:49:16.950Z", "system": true, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 94583575, "type": null, "body": "I'd like to see only one value type used for `gl_id` as it's even more overloaded now.", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-08-15T01:06:09.540Z", "updated_at": "2018-08-15T01:06:09.540Z", "system": false, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}], [{"id": 94763144, "type": null, "body": "mentioned in issue #149", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-15T20:07:00.317Z", "updated_at": "2018-08-15T20:07:00.317Z", "system": true, "noteable_id": 13326926, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 147}]]}, {"id": 13276766, "iid": 146, "project_id": 14022, "title": "Soft link custom hooks are not supported in gitlab_custom_hook.rb - match_hook_files()", "description": "gitlab-shell/lib/gitlab_custom_hook.rb - match_hook_files()  does not support soft links as custom hooks.  specifically I was testing the pre-recieve.d folder option.\n\nFor my testing, I made some ugly changes to the match_hook_files() function to check the target of the soft links and add the targets to the returned hook list to make it work.  Unfortunately I'm not a ruby programmer and it was really messy.\n\nI found I had to add the target of the soft link to the list otherwise the spawn would fail.  Hopefully there is a cleaner way?", "state": "closed", "created_at": "2018-08-07T03:14:40.455Z", "updated_at": "2019-04-04T14:39:59.116Z", "closed_at": "2019-04-04T14:39:59.026Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": [], "milestone": null, "assignees": [], "author": {"id": 2669382, "name": "master5597", "username": "master5597", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2669382/avatar.png", "web_url": "https://gitlab.com/master5597"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/146", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/146", "notes": "https://gitlab.com/api/v4/projects/14022/issues/146/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/146/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 93025115, "type": null, "body": "This is the code I used.  I'm not creating a merge request as I know there has to be a better way as I'm not a ruby programmer.  I don't think this code, in this form, should be merged in.  I'm just posting it to help in understanding what I'm trying to fix. (and unfortunately causing some self embarrassment in showing this ugly code)\n\n```\n  def match_hook_files(path)\n    return [] unless Dir.exist?(path)\n\n    retval = []\n    Dir[\"#{path}/*\"].each do |f|\n      if File.symlink?(f)\n        f=File.reaslink(f)\n      end\n      \n      if !f.end_with?('~') && File.executable?(f)\n        retval.push(f)\n      end\n    end\n    retval.sort\n    return retval\n  end\n```", "attachment": null, "author": {"id": 2669382, "name": "master5597", "username": "master5597", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2669382/avatar.png", "web_url": "https://gitlab.com/master5597"}, "created_at": "2018-08-07T14:59:19.291Z", "updated_at": "2018-08-07T14:59:19.291Z", "system": false, "noteable_id": 13276766, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 146}], [{"id": 157468995, "type": null, "body": "moved to gitaly#1598", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:39:59.180Z", "updated_at": "2019-04-04T14:39:59.180Z", "system": true, "noteable_id": 13276766, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 146}]]}, {"id": 13268919, "iid": 145, "project_id": 14022, "title": "key-x is invalid! (ArgumentError)", "description": "Hello,   \nI have upgraded gitlab-shell from `7.1.5` to `8.1.0` on Arch and I can no longer connect through SSH with a key.\n\n**Trace**\n```\n/usr/share/webapps/gitlab-shell/lib/gitlab_net.rb:168:in `parse_who': who='-c/usr/share/webapps/gitlab-shell/bin/gitlab-shell key-8' is invalid! (ArgumentError)\n        from /usr/share/webapps/gitlab-shell/lib/gitlab_shell.rb:25:in `initialize'\n        from /usr/share/webapps/gitlab-shell/bin/gitlab-shell:20:in `new'\n        from /usr/share/webapps/gitlab-shell/bin/gitlab-shell:20:in `<main>'\n```\n\n\n**sshd_config**\n```\nAuthorizedKeysCommand /var/lib/gitlab/gitlab-shell/bin/gitlab-shell-authorized-keys-check gitlab %u %k\nAuthorizedKeysCommandUser gitlab\n```\n\n\n**Check**\n```\n$ sudo -u gitlab -s /bin/sh -c \"cd '/usr/share/webapps/gitlab'; bundle-2.3 exec rake gitlab:gitlab_shell:check RAILS_ENV=production\"\nChecking GitLab Shell ...\n\nGitLab Shell version >= 7.1.4 ? ... OK (8.1.0)\nRepo base directory exists?\ndefault... yes\nRepo storage directories are symlinks?\ndefault... no\nRepo paths owned by gitlab:root, or gitlab:gitlab?\ndefault... yes\nRepo paths access is drwxrws---?\ndefault... yes\nhooks directories in repos are links: ...\n[redacted]\nRunning /usr/share/webapps/gitlab-shell/bin/check\nCheck GitLab API access: OK\nRedis available via internal API: OK\n\nAccess to /var/lib/gitlab/.ssh/authorized_keys: OK\ngitlab-shell self-check successful\n\nChecking GitLab Shell ... Finished\n```\n\n:slight\\_smile:", "state": "closed", "created_at": "2018-08-06T20:41:50.394Z", "updated_at": "2019-08-07T07:56:52.570Z", "closed_at": "2018-08-15T19:52:43.713Z", "closed_by": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "labels": ["Manage [DEPRECATED]", "devops::manage", "regression", "regression:11.2"], "milestone": {"id": 494367, "iid": 15, "group_id": 9970, "title": "11.2", "description": "", "state": "closed", "created_at": "2018-03-27T19:26:05.990Z", "updated_at": "2018-11-06T19:16:51.951Z", "due_date": "2018-08-22", "start_date": "2018-07-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/15"}, "assignees": [{"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}], "author": {"id": 591561, "name": "Adrien Brignon", "username": "adrienbrignon", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/591561/avatar.png", "web_url": "https://gitlab.com/adrienbrignon"}, "assignee": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "user_notes_count": 22, "merge_requests_count": 1, "upvotes": 5, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/145", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/145", "notes": "https://gitlab.com/api/v4/projects/14022/issues/145/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/145/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 93037201, "type": null, "body": "Thanks for reporting @Ethaligan - I suspect this is a regression introduced by https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/207 /cc @avar\n\nWe should definitely fix this for the 11.2 release. For gitlab-ce 11.1.x, you can downgrade gitlab-shell back to the last 7.x release - only 11.2 will require gitlab-shell 8.x", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-07T15:27:44.640Z", "updated_at": "2018-08-07T15:27:44.640Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93038444, "type": null, "body": "added ~3630472 ~7262326 labels", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-07T15:30:56.895Z", "updated_at": "2018-08-07T15:30:56.895Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93038468, "type": null, "body": "changed milestone to %\"11.2\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-07T15:31:01.012Z", "updated_at": "2018-08-07T15:31:01.012Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93038623, "type": null, "body": "added ~7161201 label", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-07T15:31:13.845Z", "updated_at": "2018-08-07T15:31:13.845Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93039178, "type": null, "body": "/cc @jeremy_ this is a regression introduced by the SSH certificate support merged in !207", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-07T15:32:37.661Z", "updated_at": "2018-08-07T15:32:37.661Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93048623, "type": null, "body": "Sorry. I'll fix this.", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-07T16:01:07.526Z", "updated_at": "2018-08-07T16:01:07.526Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93065224, "type": null, "body": "Downgrading gitlab-shell to 7.x solves the problem, thx.", "attachment": null, "author": {"id": 511444, "name": "Harm Endres", "username": "harm.endres", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/511444/avatar.png", "web_url": "https://gitlab.com/harm.endres"}, "created_at": "2018-08-07T17:12:54.140Z", "updated_at": "2018-08-07T17:12:54.140Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93118232, "type": null, "body": "I see why this happened. In my change I changed [this line](https://gitlab.com/gitlab-org/gitlab-shell/commit/2e8b670#5bef375eccb44aa79baa035c4cf3b1981b29fb8a_8_8) which takes the ARGV in `bin/gitlab-shell`, and instead centralized the parsing [in this utility function](https://gitlab.com/gitlab-org/gitlab-shell/commit/2e8b670#a7adaf7b743bcb71d77bbd080d651151a0e04cb3_143_155).\n\nBut what the existing line was doing was finding key-* anywhere in ARGV. So this would fix it:\n\n```\ndiff --git a/bin/gitlab-shell b/bin/gitlab-shell\nindex 1016570..e76894e 100755\n--- a/bin/gitlab-shell\n+++ b/bin/gitlab-shell\n@@ -17,7 +17,8 @@ require_relative '../lib/gitlab_init'\n #\n require File.join(ROOT_PATH, 'lib', 'gitlab_shell')\n \n-if GitlabShell.new(ARGV.join).exec(original_cmd)\n+who = /(?:(?:key|user)-[0-9]+|username-\\S+)/.match(ARGV.join).to_s;\n+if GitlabShell.new(who).exec(original_cmd)\n   exit 0\n else\n   exit 1\n```\n\nI.e. handle stuff like this:\n\n```\n$ ruby -e 'who = /(?:(?:key|user)-[0-9]+|username-\\S+)/.match(ARGV.join).to_s; puts who' -- \"-cpath key-123\"\nkey-123\n$ ruby -e 'who = /(?:(?:key|user)-[0-9]+|username-\\S+)/.match(ARGV.join).to_s; puts who' -- \"-cpath username-whatever\"\nusername-whatever\n```\n\nBut what I totally don't get is how we end up with `-c/usr/share/webapps/gitlab-shell/bin/gitlab-shell key-8` at this point. In your sshd_config you're calling `gitlab-shell-authorized-keys-check` which finds the key in the DB and [emits a command=\"*\" line here](https://gitlab.com/gitlab-org/gitlab-shell/blob/master/bin/gitlab-shell-authorized-keys-check#L37-42), that [goes through this code](https://gitlab.com/gitlab-org/gitlab-shell/blob/master/lib/gitlab_keys.rb#L12-27).\n\nI can't see any way that would ever emit anything except `command=\"<path to gitlab-shell> {key|username}-{key id,username}\"`, but clearly I'm missing something.", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-07T20:19:26.898Z", "updated_at": "2018-08-07T20:19:45.301Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93143458, "type": null, "body": "I tried the fix you provided and I'm glad to say that it works.   \nI'm not very familiar with Ruby so, though I've tried, can't help you further on discovering the real issue, sorry.\n\nThanks for your time :smiley:", "attachment": null, "author": {"id": 591561, "name": "Adrien Brignon", "username": "adrienbrignon", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/591561/avatar.png", "web_url": "https://gitlab.com/adrienbrignon"}, "created_at": "2018-08-07T23:46:41.551Z", "updated_at": "2018-08-07T23:46:48.825Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93229091, "type": null, "body": "mentioned in commit avar/gitlab-shell@64b53e7c679df24e8b70af808872746672127ac5", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-08T09:45:19.187Z", "updated_at": "2018-08-08T09:45:19.187Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93229107, "type": null, "body": "mentioned in commit avar/gitlab-shell@574572911f7161cb5afd3745a3083286e3fce6ce", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-08T09:45:22.048Z", "updated_at": "2018-08-08T09:45:22.048Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93232320, "type": null, "body": "mentioned in merge request !222", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-08T09:58:16.134Z", "updated_at": "2018-08-08T09:58:16.134Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93232814, "type": null, "body": "@nick.thomas @Ethaligan : I've submitted https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/222 which fixes this, and one other issue I saw I broke in !207.\n\nThere's no tests in that commit because I couldn't get them to work, they're WIP in https://gitlab.com/avar/gitlab-shell/commit/64b53e7c679df24e8b70af808872746672127ac5\n\nIt's some issue with the Ruby webserver mocking I can't figure out.", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-08T10:00:11.805Z", "updated_at": "2018-08-08T10:00:11.805Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93258834, "type": null, "body": "Thanks for looking into it @avar - there's no extreme time pressure, but if you think you'll need additional help to get it merged before the end of next week, just let me know and I'll jump in! I've made a couple of comments on the test commit.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-08T11:40:38.073Z", "updated_at": "2018-08-08T11:40:38.073Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93258968, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-08T11:40:46.131Z", "updated_at": "2018-08-08T11:40:46.131Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93263551, "type": null, "body": "@nick.thomas : Thanks, if you could check out and look at why those tests are failing that would be awesome (I also enabled pushes from you to the source branch). Yeah maybe it's not reading the config, but looking at the diff output between my new file & the existing (and passing) authorized keys file it looks like I'm doing all the same sort of setup.", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-08T11:52:39.514Z", "updated_at": "2018-08-08T11:52:39.514Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93333709, "type": null, "body": "Progress: https://gitlab.com/avar/gitlab-shell/commit/64b53e7c679df24e8b70af808872746672127ac5#note_93332161 - it looks like a genuine spec failure. The config is getting run, and the mock HTTP server is acting as expected.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-08T15:43:01.988Z", "updated_at": "2018-08-08T15:43:01.988Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93368548, "type": null, "body": "mentioned in commit avar/gitlab-shell@26a50e6c2bd8eee5134bcf4a1e674d5432eca940", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-08T19:05:54.964Z", "updated_at": "2018-08-08T19:05:54.964Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93368805, "type": null, "body": "mentioned in commit avar/gitlab-shell@c4b5a076040a6f6156c26f66cdc47610fc267db2", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-08T19:07:57.120Z", "updated_at": "2018-08-08T19:07:57.120Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93371892, "type": null, "body": "mentioned in commit avar/gitlab-shell@961e875d38a834c1b001cc3abcc89d1610e45285", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-08T19:30:46.451Z", "updated_at": "2018-08-08T19:30:46.451Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93372583, "type": null, "body": "mentioned in issue #147", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-08T19:36:05.575Z", "updated_at": "2018-08-08T19:36:05.575Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93486446, "type": null, "body": "It looks like the above [fix][1] by @avar fixes ssh connections made by user (`git-push`, `git-pull`, `ssh git@example.com`, etc.). But neither that fix, nor downgrading to gitlab-shell v7.1.5[^1] do not save me from failing when I try to create new project on self-hosted GitLab instance (neither via GitLab site interface, nor `git-push` to unexisting remote project). Any idea how to fix this issue? Please do not propose me to wait for v.11.2 release.\n\n[^1]: I have only downgrade gitlab-shell. gitlab itself was v11.1.4.\n\n[1]: https://gitlab.com/gitlab-org/gitlab-shell/issues/145#note_93118232", "attachment": null, "author": {"id": 1664856, "name": "Ruslan Garipov", "username": "ruslangaripov", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e2363f32305322128423a5fd7014e4c4?s=80&d=identicon", "web_url": "https://gitlab.com/ruslangaripov"}, "created_at": "2018-08-09T10:01:40.833Z", "updated_at": "2018-08-09T10:01:40.833Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93521987, "type": null, "body": "@ruslangaripov : Whatever issue you have with v7.1.5 is unrelated to this issue, since it concerns a regression in a commit that wasn't part of v7.1.5, but was first released in v8.0.0.\n\nFurthermore it sounds like you're describing some bug in gitlab-ce, not gitlab-shell, since you're talking about something failing when you create new projects, gitlab-shell has no ability to create projects, you do that via the API or web UI.", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-09T12:12:27.376Z", "updated_at": "2018-08-09T12:12:27.376Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93547493, "type": null, "body": "> you're describing some bug in gitlab-ce, not gitlab-shell, since you're talking about something failing when you create new projects, gitlab-shell has no ability to create projects, you do that via the API or web UI.\n\nAm I? Really? Am I blind? When GitLab site had failed to create a new project via its user interface, it printed out two errors, one of those **is about gitlab-shell**! Unfortunately, I has no access now to that GitLab instance, therefore, I can't show you exact text of the errors.\n\nAnd creating new projects via `git-push` (via API, as you called it) also fails, stating about inaccessible or unavailable APIs.\n\n*Almost* all other functions in our GitLab v11.1.4 continue to work. Oh, I am ready to close my eyes to the fact that viewing some markdown documents in GitLab v11.1.4 (gitlab-ce) has started to end up with HTTP 500; this is something absented in v11.1.3 for sure. I believe we have to wait again while this HTTP 500 will go \"*unnoticed*\" again, just like we were waiting at gitlab-org/gitlab-ce#44129. It's a quote of @gitlab-bot: \"*unnoticed*\", this is how the gitlab-org/gitlab-ce#44129 was fixed.\n\nGitLab v11.1.4 has no changes since v11.1.3 (if we can believe to the changelog). Therefore, if creating of new projects started to fail in v11.1.3, that's now a gitlab-ce's fail. If the issue started earlier, than... we have a plenty to talk about.", "attachment": null, "author": {"id": 1664856, "name": "Ruslan Garipov", "username": "ruslangaripov", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e2363f32305322128423a5fd7014e4c4?s=80&d=identicon", "web_url": "https://gitlab.com/ruslangaripov"}, "created_at": "2018-08-09T13:28:46.505Z", "updated_at": "2018-08-09T13:30:32.637Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93554917, "type": null, "body": "@ruslangaripov : I'm not saying you don't have some sort of issue with GitLab, I'm saying it shouldn't be discussed in this bug report, which concerns a regression in a feature that's in no release version of GitLab, and is only in gitlab-shell v8.0.0.\n\nBy your own account you're having issues with gitlab-shell v7.1.5, and GitLab v11.1.4, neither of which incorporate the patch/bug being discussed here.", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-09T13:56:02.353Z", "updated_at": "2018-08-09T13:56:02.353Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93556207, "type": null, "body": "Also @ruslangaripov  (just to help you find where to file this):\n\n> And creating new projects via `git-push` (via API, as you called it)\n\ngit-push does not create new projects, it pushes git data to an existing project, the API I'm referring to is https://gitlab.com/help/api/projects.md#create-project", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-09T14:01:03.208Z", "updated_at": "2018-08-09T14:01:03.208Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93559489, "type": null, "body": "@ruslangaripov : Ah, I see https://docs.gitlab.com/ee/gitlab-basics/create-project.html#push-to-create-a-new-project (didn't know about that feature).\n\nIn any case, due to the version mismatch I don't think this is the report you're looking for, the issue also wouldn't manifest in the way you're describing.", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-09T14:12:48.985Z", "updated_at": "2018-08-09T14:12:48.985Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93561476, "type": null, "body": "> git-push does not create new projects\n\n:angry: [Push to create a new project][1].\n\nFor the rest: :speak\\_no\\_evil: Okay, may be I will try to create a dedicated ticket with detailed description of the issue. If I won't simply rollback the virtual machine tomorrow to the last known-good snapshot, where GL works somehow.\n\n[1]: https://gitlab.com/help/gitlab-basics/create-project#push-to-create-a-new-project", "attachment": null, "author": {"id": 1664856, "name": "Ruslan Garipov", "username": "ruslangaripov", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e2363f32305322128423a5fd7014e4c4?s=80&d=identicon", "web_url": "https://gitlab.com/ruslangaripov"}, "created_at": "2018-08-09T14:20:42.580Z", "updated_at": "2018-08-09T14:20:42.580Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93593986, "type": null, "body": "mentioned in merge request !226", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-09T16:43:30.818Z", "updated_at": "2018-08-09T16:43:30.818Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93664630, "type": null, "body": "@ruslangaripov please ping me in the new issue you raise so I can assist :)", "attachment": null, "author": {"id": 2187482, "name": "Ash McKenzie", "username": "ashmckenzie", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2187482/avatar.png", "web_url": "https://gitlab.com/ashmckenzie"}, "created_at": "2018-08-10T03:04:55.464Z", "updated_at": "2018-08-10T03:04:55.464Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93677515, "type": null, "body": "Thanks for tagging the fix for this in a new release ASAP, that was the right call. Forcing users to downgrade packages when regressions happen is a huge pain and quick upstream releases give a way forward without leaving a mess behind.", "attachment": null, "author": {"id": 16876, "name": "Caleb Maclennan", "username": "alerque", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/1d84382865c6c3378c04a35348fdfa07?s=80&d=identicon", "web_url": "https://gitlab.com/alerque"}, "created_at": "2018-08-10T05:44:23.766Z", "updated_at": "2018-08-10T05:44:23.766Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93678841, "type": null, "body": "> I don't think this is the report you're looking for\n\nAfter I had updated gitlab-shell to 8.1.1, our local GitLab instance became able to create new projects via its UI. **Nothing else was changed** in the system. So. My problem wasn't related to this ticket, was it? :angry:", "attachment": null, "author": {"id": 1664856, "name": "Ruslan Garipov", "username": "ruslangaripov", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e2363f32305322128423a5fd7014e4c4?s=80&d=identicon", "web_url": "https://gitlab.com/ruslangaripov"}, "created_at": "2018-08-10T05:58:44.451Z", "updated_at": "2018-08-10T05:58:44.451Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93699670, "type": null, "body": "@ruslangaripov: I don't know at this point, your reports are so vague and hard to pin down that I don't know what's going on with whatever bug you're looking at. Can you please paste specific errors that you're getting, and also you updated gitlab-shell to 8.1.1 from what? 8.1.0? Something else?", "attachment": null, "author": {"id": 1424505, "name": "\u00c6var Arnfj\u00f6r\u00f0 Bjarmason", "username": "avar", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/57332d67a86eb51e06bf78d2baf42c3c?s=80&d=identicon", "web_url": "https://gitlab.com/avar"}, "created_at": "2018-08-10T08:05:56.941Z", "updated_at": "2018-08-10T08:05:56.941Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 93708604, "type": null, "body": "> Can you please paste specific errors\n\nNo, now I can't. Because I have to rollback the production server where users are online. They were ready to kill me yesterday, that's enough to me \ud83d\ude31\n\n> you updated gitlab-shell to 8.1.1 from what? 8.1.0?\n\n1. Updating gitlab-shell from v7.1.5 to v8.1.0[^1]: we receive the errors on creation of new projects (and also ssh access error from the topic).\n\n2. Downgrading gitlab-shell to v7.1.5 (downgrade gitlab-shell only, not gitlab) or applying \"patch\" from above to v8.1.0: we still can't create new projects via GitLab UI, but ssh access is fine.\n\n3. Update gitlab-shell to v8.1.0 and apply patch: this is where we stop yesterday :cry: \n\n4. Update gitlab-shell to v8.1.1: we are able now to create new projects via GitLab UI and ssh access is also fine.\n\n> your reports are so vague and hard to pin down\n\nMay be, but try to understand me: no one likes when a production server is falling down, and then people come and call you asking questions for which you have no answers.\n\n[^1]: GitLab itself was also updated to v11.1.4 from v11.1.3 (nothing had changed there if we look to the changelog)", "attachment": null, "author": {"id": 1664856, "name": "Ruslan Garipov", "username": "ruslangaripov", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e2363f32305322128423a5fd7014e4c4?s=80&d=identicon", "web_url": "https://gitlab.com/ruslangaripov"}, "created_at": "2018-08-10T08:47:23.180Z", "updated_at": "2018-08-10T08:47:23.180Z", "system": false, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 94650854, "type": null, "body": "mentioned in merge request !230", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-15T10:35:03.484Z", "updated_at": "2018-08-15T10:35:03.484Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 94761344, "type": null, "body": "closed via merge request !230", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-08-15T19:52:43.771Z", "updated_at": "2018-08-15T19:52:43.771Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 94761345, "type": null, "body": "mentioned in commit 122d84a403d3534dea743d94aa23d4115cc804a8", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-08-15T19:52:43.774Z", "updated_at": "2018-08-15T19:52:43.774Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}], [{"id": 129020113, "type": null, "body": "mentioned in merge request !270", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2019-01-04T16:32:09.590Z", "updated_at": "2019-01-04T16:32:09.590Z", "system": true, "noteable_id": 13268919, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 145}]]}, {"id": 13147981, "iid": 144, "project_id": 14022, "title": "Improve error message when 2FA codes are wiped but fail to regenerate", "description": "The following discussion from !214 should be addressed:\n\n- [ ] @rspeicher started a [discussion](https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/214#note_91356898):  (+1 comment)\n\n    > Unrelated to your MR but do we know what happens in this case? Are the old codes possibly removed without generating new ones? Should we inform the user of their current codes' statuses?", "state": "opened", "created_at": "2018-07-31T22:37:33.686Z", "updated_at": "2018-07-31T22:37:33.686Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/144", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 1, "completed_count": 0}, "has_tasks": true, "task_status": "0 of 1 task completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/144", "notes": "https://gitlab.com/api/v4/projects/14022/issues/144/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/144/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 12727780, "iid": 143, "project_id": 14022, "title": "GDK update is not updating gitlab-shell", "description": "I was getting the following warning at the end of running `gdk update`:\n\n```shell\nWARNING: This version of GitLab depends on gitlab-shell 7.1.5, but you're running 7.1.4. Please update gitlab-shell.\n```\n\nI also tried running `make gitlab-shell-update` but didn't work. Shouldn't `gdk update` update `gitlab-shell`, too (see https://gitlab.com/gitlab-org/gitlab-development-kit/blob/master/doc/howto/gdk_commands.md#update-gitlab-and-gitlab-shell-repositories)?\n\n`GITLAB_SHELL_VERSION` includes `7.1.5` (see https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/20545) but `../gitlab-shell/VERSION` includes `7.1.4` and hasn't fetched tag `v7.1.5`.", "state": "closed", "created_at": "2018-07-13T10:21:52.403Z", "updated_at": "2018-07-13T14:54:24.111Z", "closed_at": "2018-07-13T14:49:50.720Z", "closed_by": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1474048, "name": "George Tsiolis", "username": "gtsiolis", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1474048/avatar.png", "web_url": "https://gitlab.com/gtsiolis"}, "assignee": null, "user_notes_count": 7, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/143", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/143", "notes": "https://gitlab.com/api/v4/projects/14022/issues/143/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/143/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 87828898, "type": null, "body": "/cc @jacobvosmaer\\-gitlab @axil", "attachment": null, "author": {"id": 1474048, "name": "George Tsiolis", "username": "gtsiolis", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1474048/avatar.png", "web_url": "https://gitlab.com/gtsiolis"}, "created_at": "2018-07-13T10:22:09.352Z", "updated_at": "2018-07-13T10:22:09.352Z", "system": false, "noteable_id": 12727780, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 143}], [{"id": 87828903, "type": null, "body": "I think the problem here is that `make gitlab-shell-update` in GDK grabs the `master` branch of gitlab-shell, which is still on 7.1.4. https://gitlab.com/gitlab-org/gitlab-shell/blob/master/VERSION\n\nIn other words this is a gitlab-shell problem not a GDK problem. If I may be so blunt. :)\n\nWhat do you think @DouweM ?", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-07-13T10:28:37.407Z", "updated_at": "2018-07-13T10:28:37.407Z", "system": false, "noteable_id": 12727780, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 143}], [{"id": 87828906, "type": null, "body": "> In other words this is a gitlab-shell problem not a GDK problem.\n\n@jacobvosmaer\\-gitlab this sounds right, I was tempted to open this in gitlab-shell project but wasn't sure about it. Feel free to move this issue if needed. I can probably fix this warning easily by running `git pull` within `gitlab-shell` directory but I was curious if there was a better approach for this.", "attachment": null, "author": {"id": 1474048, "name": "George Tsiolis", "username": "gtsiolis", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1474048/avatar.png", "web_url": "https://gitlab.com/gtsiolis"}, "created_at": "2018-07-13T10:42:49.305Z", "updated_at": "2018-07-13T10:42:49.305Z", "system": false, "noteable_id": 12727780, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 143}], [{"id": 87828911, "type": null, "body": "No, `git pull` won't fix it. Not until https://gitlab.com/gitlab-org/gitlab-shell/blob/master/VERSION contains `7.1.5` which it doesn't right now (gitlab-shell@b0b8627d1e1ee0748f1468ce9489357dab482fbb).", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-07-13T10:58:30.083Z", "updated_at": "2018-07-13T10:58:30.083Z", "system": false, "noteable_id": 12727780, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 143}], [{"id": 87828912, "type": null, "body": "moved from gitlab-development-kit#369", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-07-13T10:58:50.346Z", "updated_at": "2018-07-13T10:58:50.346Z", "system": true, "noteable_id": 12727780, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 143}], [{"id": 87832189, "type": null, "body": "> No, `git pull` won't fix it.\n\nIndeed, you're right! I thought this (https://gitlab.com/gitlab-org/gitlab-shell/commit/6413c4bec177d8d2f10fe4513cf7ab339aeb68f0) was already on master. :duck:", "attachment": null, "author": {"id": 1474048, "name": "George Tsiolis", "username": "gtsiolis", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1474048/avatar.png", "web_url": "https://gitlab.com/gtsiolis"}, "created_at": "2018-07-13T11:16:31.205Z", "updated_at": "2018-07-13T11:16:31.205Z", "system": false, "noteable_id": 12727780, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 143}], [{"id": 87891778, "type": null, "body": "Sorry, I pushed to `master` now, so I think it should be working now?", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-07-13T14:49:50.059Z", "updated_at": "2018-07-13T14:49:50.059Z", "system": false, "noteable_id": 12727780, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 143}], [{"id": 87891780, "type": null, "body": "closed", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-07-13T14:49:50.787Z", "updated_at": "2018-07-13T14:49:50.787Z", "system": true, "noteable_id": 12727780, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 143}], [{"id": 87892863, "type": null, "body": "This is working just fine now! The warning no longer appears. Thanks @stanhu! :watermelon:", "attachment": null, "author": {"id": 1474048, "name": "George Tsiolis", "username": "gtsiolis", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1474048/avatar.png", "web_url": "https://gitlab.com/gtsiolis"}, "created_at": "2018-07-13T14:54:24.061Z", "updated_at": "2018-07-13T14:54:24.061Z", "system": false, "noteable_id": 12727780, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 143}]]}, {"id": 12423841, "iid": 142, "project_id": 14022, "title": "gitlab-shell syntax error in gitlab_access_status.rb when pushing changes to repo", "description": "### Summary\r\n\r\ngitlab-shell syntax error in gitlab_access_status.rb when pushing changes to repo\r\n\r\n### Steps to reproduce\r\n\r\nQuick background: This is a test installation (CE from source) used to test upgrades before upgrading our prod \r\ninstallation. We have been upgrading this version with incremental updates since version 7.0.\r\nThis bug became an issue during upgrades somewhere between version 10.4 and 10.6. I didn't test pushes to the\r\nrepo during versions 10.4 and 10.5, I just verified the app was running properly in version 10.4,10.5.\r\n\r\n### What is the current *bug* behavior?\r\n\r\nWhen pushing changes 'git push origin master' to GitLab version 10.6, the following error occurs during the push:\r\n```\r\nCounting objects: 15, done.\r\nDelta compression using up to 8 threads.\r\nCompressing objects: 100% (10/10), done.\r\nWriting objects: 100% (15/15), 1.17 KiB | 599.00 KiB/s, done.\r\nTotal 15 (delta 3), reused 0 (delta 0)\r\nremote: /opt/git/gitlab-shell/lib/gitlab_access.rb:3:in `require_relative': /opt/git/gitlab-shell/lib/gitlab_access_status.rb:6: syntax error, unexpected ',' (SyntaxError)\r\nremote: ...tatus, message, gl_repository:, gl_username:, repository_pat...\r\nremote: ...                               ^\r\nremote: /opt/git/gitlab-shell/lib/gitlab_access_status.rb:28: syntax error, unexpected keyword_end, expecting end-of-input\r\nremote: \tfrom /opt/git/gitlab-shell/lib/gitlab_access.rb:3:in `<top (required)>'\r\nremote: \tfrom hooks/pre-receive:19:in `require_relative'\r\nremote: \tfrom hooks/pre-receive:19:in `<main>'\r\ndebug1: client_input_channel_req: channel 0 rtype exit-status reply 0\r\ndebug1: channel 0: free: client-session, nchannels 1\r\ndebug1: fd 0 clearing O_NONBLOCK\r\ndebug1: fd 1 clearing O_NONBLOCK\r\nTransferred: sent 5712, received 5168 bytes, in 2.4 seconds\r\nBytes per second: sent 2358.3, received 2133.7\r\ndebug1: Exit status 0\r\nTo host.domain.tld:user/testhost.git\r\n ! [remote rejected] master -> master (pre-receive hook declined)\r\n\r\n\r\n### What is the expected *correct* behavior?\r\n\r\nsuccessful push\r\n\r\n#### Results of GitLab environment info\r\n\r\n<details>\r\n<summary>Expand for output related to GitLab environment info</summary>\r\n<pre>\r\n\r\nSystem information\r\nSystem:\t\t\r\nCurrent User:\tgit\r\nUsing RVM:\tno\r\nRuby Version:\t2.3.6p384\r\nGem Version:\t2.5.2.2\r\nBundler Version:1.16.2\r\nRake Version:\t12.3.0\r\nRedis Version:\t3.2.10\r\nGit Version:\t2.10.1.502.\r\nSidekiq Version:5.0.5\r\nGo Version:\tgo1.8.3 linux/amd64\r\n\r\nGitLab information\r\nVersion:\t10.6.6\r\nRevision:\t16f9faa\r\nDirectory:\t/opt/git/gitlab\r\nDB Adapter:\tmysql2\r\nURL:\t\thttps://host.domain.tld\r\nHTTP Clone URL:\thttps://host.domain.tld/some-group/some-project.git\r\nSSH Clone URL:\tgit@host.domain.tld:some-group/some-project.git\r\nUsing LDAP:\tno\r\nUsing Omniauth:\tyes\r\nOmniauth Providers: shibboleth\r\n\r\nGitLab Shell\r\nVersion:\t6.0.4\r\nRepository storage paths:\r\n- default: \t/opt/git/repositories\r\nHooks:\t\t/opt/git/gitlab-shell/hooks\r\nGit:\t\t/opt/git/bin/git\r\n\r\n</pre>\r\n</details>\r\n\r\n#### Results of GitLab application Check\r\n\r\n<details>\r\n<summary>Expand for output related to the GitLab application check</summary>\r\n<pre>\r\n\r\nChecking GitLab Shell ...\r\n\r\nGitLab Shell version >= 6.0.4 ? ... OK (6.0.4)\r\nRepo base directory exists?\r\ndefault... yes\r\nRepo storage directories are symlinks?\r\ndefault... no\r\nRepo paths owned by git:root, or git:git?\r\ndefault... yes\r\nRepo paths access is drwxrws---?\r\ndefault... yes\r\nhooks directories in repos are links: ... \r\n1513/23 ... repository is empty\r\n1513/131 ... repository is empty\r\n1627/157 ... repository is empty\r\n1627/170 ... repository is empty\r\n1513/188 ... repository is empty\r\n1513/189 ... repository is empty\r\n1513/190 ... repository is empty\r\n1513/198 ... repository is empty\r\n1627/250 ... repository is empty\r\n1627/266 ... repository is empty\r\n1513/274 ... repository is empty\r\n1627/323 ... repository is empty\r\n1513/326 ... repository is empty\r\n1513/339 ... repository is empty\r\n1627/351 ... repository is empty\r\n1627/354 ... repository is empty\r\n1513/417 ... repository is empty\r\n1627/421 ... repository is empty\r\n1627/434 ... repository is empty\r\n1513/488 ... repository is empty\r\n1627/495 ... repository is empty\r\n1513/501 ... repository is empty\r\n1513/502 ... repository is empty\r\n1513/505 ... repository is empty\r\n1513/518 ... repository is empty\r\n1627/522 ... repository is empty\r\n1627/523 ... repository is empty\r\n1627/524 ... repository is empty\r\n1906/592 ... ok\r\n1907/593 ... repository is empty\r\n1513/648 ... repository is empty\r\n1627/680 ... repository is empty\r\n1627/681 ... repository is empty\r\n1513/725 ... repository is empty\r\n1627/727 ... repository is empty\r\n1513/739 ... repository is empty\r\n1627/771 ... repository is empty\r\n1627/780 ... repository is empty\r\n1627/869 ... repository is empty\r\n1513/897 ... repository is empty\r\n1513/905 ... repository is empty\r\n1513/926 ... repository is empty\r\n1627/969 ... repository is empty\r\n1627/983 ... repository is empty\r\n1627/990 ... repository is empty\r\n1513/1016 ... repository is empty\r\n4/1051 ... repository is empty\r\n2203/1054 ... ok\r\n2216/1066 ... ok\r\n4/1067 ... ok\r\nRunning /opt/git/gitlab-shell/bin/check\r\nCheck GitLab API access: OK\r\nRedis available via internal API: OK\r\n\r\nAccess to /opt/git/.ssh/authorized_keys: OK\r\ngitlab-shell self-check successful\r\n\r\nChecking GitLab Shell ... Finished\r\n\r\nChecking Sidekiq ...\r\n\r\nRunning? ... yes\r\nNumber of Sidekiq processes ... 1\r\n\r\nChecking Sidekiq ... Finished\r\n\r\nReply by email is disabled in config/gitlab.yml\r\nChecking LDAP ...\r\n\r\nLDAP is disabled in config/gitlab.yml\r\n\r\nChecking LDAP ... Finished\r\n\r\nChecking GitLab ...\r\n\r\nGit configured correctly? ... yes\r\nDatabase config exists? ... yes\r\nAll migrations up? ... yes\r\nDatabase contains orphaned GroupMembers? ... no\r\nGitLab config exists? ... yes\r\nGitLab config up to date? ... yes\r\nLog directory writable? ... yes\r\nTmp directory writable? ... yes\r\nUploads directory exists? ... yes\r\nUploads directory has correct permissions? ... yes\r\nUploads directory tmp has correct permissions? ... skipped (no tmp uploads folder yet)\r\nInit script exists? ... yes\r\nInit script up-to-date? ... yes\r\nProjects have namespace: ... \r\n1513/23 ... yes\r\n1513/131 ... yes\r\n1627/157 ... yes\r\n1627/170 ... yes\r\n1513/188 ... yes\r\n1513/189 ... yes\r\n1513/190 ... yes\r\n1513/198 ... yes\r\n1627/250 ... yes\r\n1627/266 ... yes\r\n1513/274 ... yes\r\n1627/323 ... yes\r\n1513/326 ... yes\r\n1513/339 ... yes\r\n1627/351 ... yes\r\n1627/354 ... yes\r\n1513/417 ... yes\r\n1627/421 ... yes\r\n1627/434 ... yes\r\n1513/488 ... yes\r\n1627/495 ... yes\r\n1513/501 ... yes\r\n1513/502 ... yes\r\n1513/505 ... yes\r\n1513/518 ... yes\r\n1627/522 ... yes\r\n1627/523 ... yes\r\n1627/524 ... yes\r\n1906/592 ... yes\r\n1907/593 ... yes\r\n1513/648 ... yes\r\n1627/680 ... yes\r\n1627/681 ... yes\r\n1513/725 ... yes\r\n1627/727 ... yes\r\n1513/739 ... yes\r\n1627/771 ... yes\r\n1627/780 ... yes\r\n1627/869 ... yes\r\n1513/897 ... yes\r\n1513/905 ... yes\r\n1513/926 ... yes\r\n1627/969 ... yes\r\n1627/983 ... yes\r\n1627/990 ... yes\r\n1513/1016 ... yes\r\n4/1051 ... yes\r\n2203/1054 ... yes\r\n2216/1066 ... yes\r\n4/1067 ... yes\r\nRedis version >= 2.8.0? ... yes\r\nRuby version >= 2.3.5 ? ... yes (2.3.6)\r\nGit version >= 2.9.5 ? ... yes (2.10.1)\r\nGit user has default SSH configuration? ... yes\r\nActive users: ... 7\r\n\r\nChecking GitLab ... Finished\r\n```\r\n</pre>\r\n</details>", "state": "opened", "created_at": "2018-06-28T15:15:24.873Z", "updated_at": "2018-06-28T16:09:55.879Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 2506486, "name": "Lars Avery", "username": "neurontoad", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/bd2675194725c0cf1ad51b5e04f29d7a?s=80&d=identicon", "web_url": "https://gitlab.com/neurontoad"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/142", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/142", "notes": "https://gitlab.com/api/v4/projects/14022/issues/142/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/142/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 84836556, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-06-28T16:06:25.034Z", "updated_at": "2018-06-28T16:06:25.034Z", "system": true, "noteable_id": 12423841, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 142}], [{"id": 84837167, "type": null, "body": "This looks like a custom build of GitLab. The syntax error here suggests the wrong version of Ruby is being used. Named arguments were introduced in Ruby 2.0. Is it possible your system is is loading an old version here?", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-06-28T16:09:55.863Z", "updated_at": "2018-06-28T16:09:55.863Z", "system": false, "noteable_id": 12423841, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 142}]]}, {"id": 12180019, "iid": 141, "project_id": 14022, "title": "sast job reports an error", "description": "The job is marked `allowed to fail`, and is failing on every pipeline. I think we should fix or remove it.\n\nExample failure: https://gitlab.com/gitlab-org/gitlab-shell/-/jobs/76131233\n\n```\nRunning with gitlab-runner 10.8.0-rc3 (5470b911)\n  on docker-auto-scale 4e4528ca\nUsing Docker executor with image docker:stable ...\nStarting service docker:stable-dind ...\nPulling docker image docker:stable-dind ...\nUsing docker image sha256:824b0ae8cb2720f6720011514c89e50c51164a55bc1ae7455957f8c9ba68e782 for docker:stable-dind ...\nWaiting for services to be up and running...\nPulling docker image docker:stable ...\nUsing docker image sha256:c51a2cac7341fe55d38feb70157eb12d56b2039977d4175229432de09bd18896 for docker:stable ...\nRunning on runner-4e4528ca-project-14022-concurrent-0 via runner-4e4528ca-srm-1529486336-f958cacd...\nCloning repository...\nCloning into '/builds/gitlab-org/gitlab-shell'...\nChecking out 9a21ee91 as go-ci-version...\nSkipping Git submodules setup\n$ export SP_VERSION=$(echo \"$CI_SERVER_VERSION\" | sed 's/^\\([0-9]*\\)\\.\\([0-9]*\\).*/\\1-\\2-stable/')\n$ docker run --env SAST_CONFIDENCE_LEVEL=\"${SAST_CONFIDENCE_LEVEL:-3}\" --volume \"$PWD:/code\" --volume /var/run/docker.sock:/var/run/docker.sock \"registry.gitlab.com/gitlab-org/security-products/sast:$SP_VERSION\" /app/bin/run /code\nUnable to find image 'registry.gitlab.com/gitlab-org/security-products/sast:11-0-stable' locally\n11-0-stable: Pulling from gitlab-org/security-products/sast\n34455e2f5555: Pulling fs layer\n34455e2f5555: Download complete\n34455e2f5555: Pull complete\nDigest: sha256:9cb1f21d82425eeff488c453cde2376fa81a115d45349fef73fc56fcddfe818a\nStatus: Downloaded newer image for registry.gitlab.com/gitlab-org/security-products/sast:11-0-stable\n2018/06/20 09:21:05 Copy project directory to containers\n2018/06/20 09:21:05 [bandit] Detect project using plugin\n2018/06/20 09:21:05 [bandit] Project not compatible\n2018/06/20 09:21:05 [brakeman] Detect project using plugin\n2018/06/20 09:21:05 [brakeman] Project not compatible\n2018/06/20 09:21:05 [find-sec-bugs] Detect project using plugin\n2018/06/20 09:21:05 [find-sec-bugs] Project not compatible\n2018/06/20 09:21:05 [find-sec-bugs-gradle] Detect project using plugin\n2018/06/20 09:21:05 [find-sec-bugs-gradle] Project not compatible\n2018/06/20 09:21:05 [find-sec-bugs-sbt] Detect project using plugin\n2018/06/20 09:21:05 [find-sec-bugs-sbt] Project not compatible\n2018/06/20 09:21:05 [flawfinder] Detect project using plugin\n2018/06/20 09:21:05 [flawfinder] Project not compatible\n2018/06/20 09:21:05 [go-ast-scanner] Detect project using plugin\n2018/06/20 09:21:05 [go-ast-scanner] Project not compatible\n2018/06/20 09:21:05 [phpcs-security-audit] Detect project using plugin\n2018/06/20 09:21:05 [phpcs-security-audit] Project not compatible\n2018/06/20 09:21:05 [security-code-scan] Detect project using plugin\n2018/06/20 09:21:05 [security-code-scan] Project not compatible\nNo compatible analyzer can be found\nERROR: Job failed: exit code 3\n```\n\nIt's a ruby+go project. Surely it's compatible?", "state": "opened", "created_at": "2018-06-20T11:15:04.148Z", "updated_at": "2018-06-20T20:24:38.826Z", "closed_at": null, "closed_by": null, "labels": ["test"], "milestone": null, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/141", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/141", "notes": "https://gitlab.com/api/v4/projects/14022/issues/141/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/141/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 82868318, "type": null, "body": "added ~3011691 label", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-06-20T11:15:26.232Z", "updated_at": "2018-06-20T11:15:26.232Z", "system": true, "noteable_id": 12180019, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 141}], [{"id": 82996133, "type": null, "body": "@nick.thomas I got confused by this distinction on release-tools recently. The only Ruby scanner in this group is `brakeman`, which is specifically a _Rails_ scanner. I can't speak to the `go-ast-scanner`.\n\nI think all we want for this project is [Dependency Scanning](https://docs.gitlab.com/ee/user/project/merge_requests/dependency_scanning.html).", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-06-20T20:24:38.790Z", "updated_at": "2018-06-20T20:24:38.790Z", "system": false, "noteable_id": 12180019, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 141}]]}, {"id": 12042421, "iid": 140, "project_id": 14022, "title": "standardize logging timestamp format", "description": "It would be great for gitlab.com, but honestly probably nice for everyone who uses our product if we could standardize on logging timestamps. `%Y-%m-%dT%H:%M:%S.%N%Z` is the dominant format.\n\n* Gitaly 2018-05-23T13:41:10Z\n* Pages 2018-05-23T11:14:50Z\n* production_json 2018-05-23T15:24:23.915Z\n* geo 2018-05-23T16:04:23.624Z\n* sidekiq: 2018-05-23T14:40:00.808Z\n* api_json: 2018-05-23T15:47:07.471Z\n* gitlab-shell: 2018-05-23T15:45:56+00:00\n* application.log May 23, 2018 09:56\n\nThis issue is for changing the timestamp format of gitlab-shell to the same as the rails production json log. See https://gitlab.com/gitlab-org/gitlab-ce/issues/47981 .", "state": "opened", "created_at": "2018-06-15T10:27:04.891Z", "updated_at": "2018-06-15T10:27:04.891Z", "closed_at": null, "closed_by": null, "labels": ["production request"], "milestone": null, "assignees": [], "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/140", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/140", "notes": "https://gitlab.com/api/v4/projects/14022/issues/140/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/140/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 11981178, "iid": 139, "project_id": 14022, "title": "Git integration tests", "description": "Follow-up to https://gitlab.com/gitlab-org/gitlab-shell/issues/138\n\nCurrently, our `pre-receive`, `update` and `post-receive` hooks are not well-tested. Perhaps not tested at all - I can't get the suite to fail even by introducing syntax errors into `hooks/pre-receive`.\n\nWe should introduce a small suite of tests that stub a gitlab API and process actual `git push` and `git pull` commands, to help prevent regressions.\n\nThere is some coverage of these things in `gitlab-qa`, but we can do a much more thorough job here, and prevent regressions from being merged at-all\n\n/cc @DouweM @jramsay @meks", "state": "closed", "created_at": "2018-06-13T11:43:13.508Z", "updated_at": "2019-04-04T14:41:55.482Z", "closed_at": "2019-04-04T14:41:55.445Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["Create [DEPRECATED]", "Quality", "backend", "repository", "technical debt", "test"], "milestone": null, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 6, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/139", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/139", "notes": "https://gitlab.com/api/v4/projects/14022/issues/139/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/139/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 81298477, "type": null, "body": "added ~2492649 ~3081817 labels", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2018-06-13T12:08:22.085Z", "updated_at": "2018-06-13T12:08:22.085Z", "system": true, "noteable_id": 11981178, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 139}], [{"id": 92070837, "type": null, "body": "@nick.thomas somewhat related,  I think these hooks need to be moved after the gitaly migration project is done: gitlab-org/gitaly#1226. \n\nOnce they're in Gitaly it might be easier to do an end to end test.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-08-02T10:21:39.709Z", "updated_at": "2018-08-02T10:21:39.709Z", "system": false, "noteable_id": 11981178, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 139}], [{"id": 92102362, "type": null, "body": "Makes sense :thumbsup:", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-02T12:39:57.318Z", "updated_at": "2018-08-02T12:39:57.318Z", "system": false, "noteable_id": 11981178, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 139}], [{"id": 92119937, "type": null, "body": "/cc @mlapierre for `g_create` overall test strategy, coverage and risk ownership.", "attachment": null, "author": {"id": 2097582, "name": "Mek Stittri", "username": "meks", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2097582/avatar.png", "web_url": "https://gitlab.com/meks"}, "created_at": "2018-08-02T13:42:17.179Z", "updated_at": "2018-08-02T13:42:17.179Z", "system": false, "noteable_id": 11981178, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 139}], [{"id": 92431823, "type": null, "body": "added ~7156613 label", "attachment": null, "author": {"id": 655908, "name": "Mark Lapierre", "username": "mlapierre", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/655908/avatar.png", "web_url": "https://gitlab.com/mlapierre"}, "created_at": "2018-08-03T19:52:24.226Z", "updated_at": "2018-08-03T19:52:24.226Z", "system": true, "noteable_id": 11981178, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 139}], [{"id": 92432966, "type": null, "body": "I'm still not sure about the changes to the products/teams/stages. Is ~Platform now obsolete, or does it still cover everything that doesn't fall under one of the other teams? And if this is ~Create, should ~Platform be removed?", "attachment": null, "author": {"id": 655908, "name": "Mark Lapierre", "username": "mlapierre", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/655908/avatar.png", "web_url": "https://gitlab.com/mlapierre"}, "created_at": "2018-08-03T20:02:56.635Z", "updated_at": "2018-08-03T20:02:56.635Z", "system": false, "noteable_id": 11981178, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 139}], [{"id": 98690367, "type": null, "body": "We would probably have to clean up the labels. From the summit, I recalled @jramsay asking if we can use gitlab triage ops to clean this up as well. \n\n@james do we want to follow up on that in triage project https://gitlab.com/gitlab-org/gitlab-triage ?", "attachment": null, "author": {"id": 2097582, "name": "Mek Stittri", "username": "meks", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2097582/avatar.png", "web_url": "https://gitlab.com/meks"}, "created_at": "2018-09-04T08:02:31.843Z", "updated_at": "2018-09-04T08:02:31.843Z", "system": false, "noteable_id": 11981178, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 139}], [{"id": 157469802, "type": null, "body": "I think we can close this in favour of https://gitlab.com/gitlab-org/gitlab-shell/issues/180", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:41:54.957Z", "updated_at": "2019-04-04T14:41:54.957Z", "system": false, "noteable_id": 11981178, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 139}], [{"id": 157469805, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:41:55.534Z", "updated_at": "2019-04-04T14:41:55.534Z", "system": true, "noteable_id": 11981178, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 139}]]}, {"id": 11963206, "iid": 138, "project_id": 14022, "title": "NoMethodError for nil in pre-receive hook", "description": "Seen during today's outage / performance degradation, when GitLab.com was returning 500 / 502 errors.\n\n```\nlupine@gitlab-t470p:~/dev/gitlab.com/gitlab-com/migration$ git push --set-upstream upstream 437-reconciliation-runbooks\nCounting objects: 5, done.\nDelta compression using up to 8 threads.\nCompressing objects: 100% (5/5), done.\nWriting objects: 100% (5/5), 1.74 KiB | 1.74 MiB/s, done.\nTotal 5 (delta 3), reused 0 (delta 0)\nremote: hooks/pre-receive:19:in `increase_reference_counter': undefined method `[]' for nil:NilClass (NoMethodError)\nremote: \tfrom hooks/pre-receive:32:in `<main>'\nTo gitlab.com:gitlab-com/migration\n ! [remote rejected] 437-reconciliation-runbooks -> 437-reconciliation-runbooks (pre-receive hook declined)\nerror: failed to push some refs to 'git@gitlab.com:gitlab-com/migration'\n```\n\nHere's the code in the hook:\n\n```ruby\ndef increase_reference_counter(gl_repository, repo_path)\n  result = GitlabNet.new.pre_receive(gl_repository)\n\n  result['reference_counter_increased']\nend\n```\n\nAnd that call to `pre_receive`:\n\n```ruby\n  def pre_receive(gl_repository)\n    resp = post(\"#{host}/pre_receive\", gl_repository: gl_repository)\n\n    raise NotFound if resp.code == '404'\n\n    JSON.parse(resp.body) if resp.code == '200'\n  end\n```\n\nWe should fix this by not assuming that `pre_receive` returns a Hash. We should abort if the result is nil, instead.\n\nIt's possible that other calls to `GitlabNet` methods suffer from similar problems, so we should do a quick audit of them at the same time.", "state": "closed", "created_at": "2018-06-12T15:38:34.538Z", "updated_at": "2018-06-13T11:43:14.735Z", "closed_at": "2018-06-13T08:25:31.171Z", "closed_by": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "labels": ["Platform [DEPRECATED]", "bug"], "milestone": null, "assignees": [{"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/138", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/138", "notes": "https://gitlab.com/api/v4/projects/14022/issues/138/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/138/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 81107392, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-06-12T17:13:36.450Z", "updated_at": "2018-06-12T17:13:36.450Z", "system": true, "noteable_id": 11963206, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 138}], [{"id": 81108331, "type": null, "body": "mentioned in merge request !206", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-06-12T17:22:15.755Z", "updated_at": "2018-06-12T17:22:15.755Z", "system": true, "noteable_id": 11963206, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 138}], [{"id": 81231015, "type": null, "body": "closed via merge request !206", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-06-13T08:25:31.534Z", "updated_at": "2018-06-13T08:25:31.534Z", "system": true, "noteable_id": 11963206, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 138}], [{"id": 81231019, "type": null, "body": "mentioned in commit 71b7eac256218a499e35244b457efa354a8ea328", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-06-13T08:25:31.926Z", "updated_at": "2018-06-13T08:25:31.926Z", "system": true, "noteable_id": 11963206, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 138}], [{"id": 81293026, "type": null, "body": "mentioned in issue #139", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-06-13T11:43:14.710Z", "updated_at": "2018-06-13T11:43:14.710Z", "system": true, "noteable_id": 11963206, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 138}]]}, {"id": 11963139, "iid": 137, "project_id": 14022, "title": "Shell command behaviour in custom hook differs between versions 10.4.1 and 10.8.4.", "description": "**Problem**: When setting up the custom hook (post-receive) in GitLab, shell command behaviour is different between version `v10.4.1` and `vv10.8.4`.\n\nCustom hook setup location: `/var/opt/gitlab/git-data/repositories/root/awesome-project.git/custom_hooks/post-receive`\n\npost-receive hook script:\n\n```\n#!/usr/bin/env bash\n\necho \"Hello world!\" \nparallel --no-run-if-empty --silent --joblog \"/tmp/job.log\" -j 8 --will-cite ::: \"sleep 20 && echo toto\" \"sleep 30 && echo titi\" > \"/tmp/parallel.log\" 2>&1 &\np_pid=$! \necho \"pid=${p_pid}\" >> \"/tmp/metadata.ini\" \necho \"Goodbye world!\"\n```\n\nWhen pushed to repo `awesome-project` custom hook is triggered.\n\n```\nCounting objects: 2, done.\nDelta compression using up to 8 threads.\nCompressing objects: 100% (2/2), done.\nWriting objects: 100% (2/2), 213 bytes | 213.00 KiB/s, done.\nTotal 2 (delta 1), reused 0 (delta 0)\nremote: Hello world!\nremote: Goodbye world!\nTo 167.99.137.7:root/awesome-project.git\n   af0a00d..da3ddca  master -> master\n```\n\nI am able to see hello & goodbye in my push in both versions.\n\nIn `v10.4.1` result:\nChecking /tmp directory both files job.log and parallel.log are present.\n\n```\nroot@mrjkc-test002:~# cat /tmp/job.log\ntoto\ntiti\nroot@mrjkc-test002:~# cat /tmp/parallel.log\nparallel: Warning: $SHELL not set. Using /bin/sh.\ntoto\ntiti\nroot@mrjkc-test002:~#\n```\n\nIn `v10.8.4` result:\n\n```\nroot@mrjkc-test002:~# cat /tmp/parallel.log\nroot@mrjkc-test002:~#\nroot@mrjkc-test002:~# cat /tmp/job.log\ncat: /tmp/job.log: No such file or directory\n```\n \nCustomer ZD: https://gitlab.zendesk.com/agent/tickets/97883 (Internal Only)", "state": "closed", "created_at": "2018-06-12T15:20:25.078Z", "updated_at": "2018-07-10T13:34:29.647Z", "closed_at": "2018-07-09T19:24:00.002Z", "closed_by": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "labels": ["bug", "customer"], "milestone": null, "assignees": [], "author": {"id": 1917618, "name": "Julius Kvedaras", "username": "mrjkc", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d3e584486e9fd2c0db555061566b18c8?s=80&d=identicon", "web_url": "https://gitlab.com/mrjkc"}, "assignee": null, "user_notes_count": 11, "merge_requests_count": 0, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/137", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/137", "notes": "https://gitlab.com/api/v4/projects/14022/issues/137/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/137/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 81106313, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 1917618, "name": "Julius Kvedaras", "username": "mrjkc", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d3e584486e9fd2c0db555061566b18c8?s=80&d=identicon", "web_url": "https://gitlab.com/mrjkc"}, "created_at": "2018-06-12T15:23:36.541Z", "updated_at": "2018-06-12T15:23:36.541Z", "system": true, "noteable_id": 11963139, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 137}], [{"id": 81106533, "type": null, "body": "added ~1672341 label", "attachment": null, "author": {"id": 1917618, "name": "Julius Kvedaras", "username": "mrjkc", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d3e584486e9fd2c0db555061566b18c8?s=80&d=identicon", "web_url": "https://gitlab.com/mrjkc"}, "created_at": "2018-06-12T15:40:05.144Z", "updated_at": "2018-06-12T15:40:05.144Z", "system": true, "noteable_id": 11963139, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 137}], [{"id": 81312030, "type": null, "body": "NB (i'm the customer): we already try nohup, subshell (), trap but doesn't fix the problem.\n\nIt's like the \"worker\" who runs the hooks `/opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_custom_hook.rb` stop the process.\n\nI try to find changes in code no luck.\n\nIt's probably not in the code and more in the app (unicorn changes?)\n\nIf you remove `&` it's ok, it's only when the process go in background.", "attachment": null, "author": {"id": 1646194, "name": "Ahmet Demir", "username": "ahmet2mir", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1646194/avatar.png", "web_url": "https://gitlab.com/ahmet2mir"}, "created_at": "2018-06-13T13:01:57.224Z", "updated_at": "2018-06-13T13:02:47.201Z", "system": false, "noteable_id": 11963139, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 137}], [{"id": 81315206, "type": null, "body": "I have another Gitlab EE instance in 10.5.1 and the bug exists.", "attachment": null, "author": {"id": 1646194, "name": "Ahmet Demir", "username": "ahmet2mir", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1646194/avatar.png", "web_url": "https://gitlab.com/ahmet2mir"}, "created_at": "2018-06-13T13:15:10.917Z", "updated_at": "2018-06-13T13:15:10.917Z", "system": false, "noteable_id": 11963139, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 137}], [{"id": 81389305, "type": null, "body": "/cc @rspeicher", "attachment": null, "author": {"id": 790854, "name": "Harish Ramachandran", "username": "harishsr", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/668a43b1e7eb48458ce81dbf2a22e595?s=80&d=identicon", "web_url": "https://gitlab.com/harishsr"}, "created_at": "2018-06-13T18:49:15.272Z", "updated_at": "2018-06-13T18:49:15.272Z", "system": false, "noteable_id": 11963139, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 137}], [{"id": 81389308, "type": null, "body": "added ~2278648 label", "attachment": null, "author": {"id": 790854, "name": "Harish Ramachandran", "username": "harishsr", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/668a43b1e7eb48458ce81dbf2a22e595?s=80&d=identicon", "web_url": "https://gitlab.com/harishsr"}, "created_at": "2018-06-13T18:49:15.640Z", "updated_at": "2018-06-13T18:49:15.640Z", "system": true, "noteable_id": 11963139, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 137}], [{"id": 84262910, "type": null, "body": "Follow up ticker from the [customer](https://gitlab.my.salesforce.com/0016100000W3BAW?srPos=0&srKp=001): https://gitlab.zendesk.com/agent/tickets/99237 (GitLab internal-only links).\n\n@rspeicher can you please take a look at this one?", "attachment": null, "author": {"id": 729699, "name": "Collen", "username": "collen", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/851083251c4f8fbbe1baa52c98fd0707?s=80&d=identicon", "web_url": "https://gitlab.com/collen"}, "created_at": "2018-06-26T13:59:07.485Z", "updated_at": "2018-06-26T13:59:07.485Z", "system": false, "noteable_id": 11963139, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 137}], [{"id": 84631001, "type": null, "body": "@harishsr @collen Sorry, I'm not sure. I asked for some more eyes on this [in Slack](https://gitlab.slack.com/archives/C02PF508L/p1530039166000471).", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-06-27T20:03:50.429Z", "updated_at": "2018-06-27T20:03:50.429Z", "system": false, "noteable_id": 11963139, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 137}], [{"id": 86902318, "type": null, "body": "If it's true that this bug popped up between GitLab 10.4.3 and 10.5.1, then the shell changes at play are between version 5.11.0 and 6.0.3 (https://gitlab.com/gitlab-org/gitlab-shell/compare/v5.11.0...v6.0.3)", "attachment": null, "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "created_at": "2018-07-09T16:16:52.426Z", "updated_at": "2018-07-09T16:16:52.426Z", "system": false, "noteable_id": 11963139, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 137}], [{"id": 86902565, "type": null, "body": "I don't see anything related to custom hooks in that comparison.", "attachment": null, "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "created_at": "2018-07-09T16:18:28.762Z", "updated_at": "2018-07-09T16:18:28.762Z", "system": false, "noteable_id": 11963139, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 137}], [{"id": 86931598, "type": null, "body": "I suspect the difference here is that Gitaly is calling the post-receive hooks. If you attach an `strace` to the `gitaly` process, you can see this:\n\n```\n10593 19:08:18.298233 execve(\"/usr/bin/parallel\", [\"parallel\", \"--no-run-if-empty\", \"--silent\", \"--joblog\", \"/tmp/job.log\", \"-j\", \"8\", \":::\", \"sleep 20 && echo toto\", \"sleep 30 && echo titi\"], [/* 13 vars */] <unfinished ...>\n10593 19:08:18.299232 <... execve resumed> ) = 0\n```\n\nThe program ultimately gets killed by `SIGTERM`:\n\n```\n10593 19:08:18.323441 --- SIGTERM {si_signo=SIGTERM, si_code=SI_USER, si_pid=23690, si_uid=998} ---\n10593 19:08:18.323930 +++ killed by SIGTERM +++\n```\n\nPID 23690 is the gitaly process, so I suspect it's killing all child processes upon exit here: https://gitlab.com/gitlab-org/gitaly/blob/29dc41dd0cdd4e141921f3eb03cd37a1689aa773/internal/command/command.go#L169\n\nThis is likely done because you don't want any stale processes leaking when the session terminates. \n\nOne way I was able to work around this is to launch screen:\n\n```bash\nscreen -m -d parallel --no-run-if-empty --silent --joblog \"/tmp/job.log\" -j 8 ::: \"sleep 20 && echo toto\" \"sleep 30 && echo titi\" > \"/tmp/parallel.log\" 2>&1\n```", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-07-09T19:22:13.060Z", "updated_at": "2018-07-09T19:22:13.060Z", "system": false, "noteable_id": 11963139, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 137}], [{"id": 86931849, "type": null, "body": "I'm going to close this issue because I think I don't think we can guarantee that any subprocess that is launched in these post-receive hooks will stick around after the session terminates when the user logs out. If you really want to do this, you could use `screen` or `tmux`, but that's at your own risk.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-07-09T19:23:59.496Z", "updated_at": "2018-07-09T19:23:59.496Z", "system": false, "noteable_id": 11963139, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 137}], [{"id": 86931851, "type": null, "body": "closed", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-07-09T19:24:00.076Z", "updated_at": "2018-07-09T19:24:00.076Z", "system": true, "noteable_id": 11963139, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 137}], [{"id": 86931866, "type": null, "body": "Thanks @stanhu That makes more sense. It wasn't a gitlab-shell change - it was Gitaly coming into the mix.", "attachment": null, "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "created_at": "2018-07-09T19:24:11.962Z", "updated_at": "2018-07-09T19:24:11.962Z", "system": false, "noteable_id": 11963139, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 137}], [{"id": 87105337, "type": null, "body": "Hello,\n\nFYI:\n\nKO\n```\nme@gitlab$ screen -m -d parallel --no-run-if-empty --silent --joblog \"/tmp/job.log\" -j 8 ::: \"sleep 2 && echo toto\" \"sleep 3 && echo titi\" > \"/tmp/parallel.log\" 2>&1\nme@gitlab$ cat /tmp/parallel.log\n```\n\nOK\n\n```\nme@gitlab$ screen -m -d  bash -c 'parallel --no-run-if-empty --silent --joblog \"/tmp/job.log\" -j 8 ::: \"sleep 2 && echo toto\" \"sleep 3 && echo titi\" > \"/tmp/parallel.log\" 2>&1'\nme@gitlab$ cat /tmp/parallel.log\ntoto\ntiti\n```\n\nThe workaround works, but this is very ugly ...\n\nThanks for the debug!", "attachment": null, "author": {"id": 1646194, "name": "Ahmet Demir", "username": "ahmet2mir", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1646194/avatar.png", "web_url": "https://gitlab.com/ahmet2mir"}, "created_at": "2018-07-10T13:34:29.620Z", "updated_at": "2018-07-10T13:34:29.620Z", "system": false, "noteable_id": 11963139, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 137}]]}, {"id": 11069659, "iid": 136, "project_id": 14022, "title": "UNIX socket connection breaks when http_proxy environment variable set", "description": "We have GitLab installed in a secure environment with a HTTP proxy. I was trying to get gitlab-shell to communicate with GitLab via a UNIX socket but the \"check\" tool kept reporting a 400 status and a \"broken pipe\" error. I worked out how to replicate the call with curl and that worked. It took me several hours and some help from strace to figure out that it was trying to connect via the proxy!\n\nAs a workaround, unsetting `http_proxy` works but I wasn't sure whether gitlab-shell would need to make other HTTP connections elsewhere. A better work around is to set `no_proxy` to the socket path, as bizarre as this seems.", "state": "closed", "created_at": "2018-05-28T16:33:23.989Z", "updated_at": "2019-01-08T20:28:46.001Z", "closed_at": "2019-01-08T20:28:45.982Z", "closed_by": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "labels": [], "milestone": null, "assignees": [], "author": {"id": 2345904, "name": "James Le Cuirot", "username": "chewi", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/570ee005a5d5af0dcc6a92ccfb7d1be1?s=80&d=identicon", "web_url": "https://gitlab.com/chewi"}, "assignee": null, "user_notes_count": 6, "merge_requests_count": 0, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/136", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/136", "notes": "https://gitlab.com/api/v4/projects/14022/issues/136/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/136/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 128121935, "type": null, "body": "I experienced a similar problem after I upgraded GitLab from version 11.5.5 to 11.6.0. I couldn't access projects from the web interface anymore. GitLab tried to connect to a local UNIX socket via the proxy server. I added \"unix\" to the `no_proxy` environment variable in order to work around this problem.\n\nHere are excerpts from the proxy server's and GitLab's logs:\n\n```\n1546236752.122 0 192.168.1.2 TAG_NONE/503 0 CONNECT unix:443 - HIER_NONE/- -\n```\n\n```\n==> /var/log/gitlab/gitlab-rails/production.log <==\nStarted GET \"/mygroup/myproject\" for 127.0.0.1 at 2018-12-31 06:13:45 +0100\n\n==> /var/log/gitlab/gitlab-rails/production.log <==\nGitlab::Git::CommandError (4:Deadline Exceeded):\n  lib/gitlab/git/wraps_gitaly_errors.rb:13:in `rescue in wrapped_gitaly_errors'\n  lib/gitlab/git/wraps_gitaly_errors.rb:6:in `wrapped_gitaly_errors'\n  lib/gitlab/git/blob.rb:79:in `batch_lfs_pointers'\n  lib/extracts_path.rb:146:in `lfs_blob_ids'\n  lib/gitlab/i18n.rb:55:in `with_locale'\n  lib/gitlab/i18n.rb:61:in `with_user_locale'\n  app/controllers/application_controller.rb:420:in `set_locale'\n  lib/gitlab/middleware/multipart.rb:103:in `call'\n  lib/gitlab/request_profiler/middleware.rb:16:in `call'\n  lib/gitlab/middleware/go.rb:19:in `call'\n  lib/gitlab/etag_caching/middleware.rb:13:in `call'\n  lib/gitlab/middleware/correlation_id.rb:16:in `block in call'\n  lib/gitlab/correlation_id.rb:15:in `use_id'\n  lib/gitlab/middleware/correlation_id.rb:15:in `call'\n  lib/gitlab/middleware/rails_queue_duration.rb:24:in `call'\n  lib/gitlab/metrics/rack_middleware.rb:17:in `block in call'\n  lib/gitlab/metrics/transaction.rb:55:in `run'\n  lib/gitlab/metrics/rack_middleware.rb:17:in `call'\n  lib/gitlab/middleware/read_only/controller.rb:40:in `call'\n  lib/gitlab/middleware/read_only.rb:18:in `call'\n  lib/gitlab/middleware/basic_health_check.rb:25:in `call'\n  lib/gitlab/request_context.rb:20:in `call'\n  lib/gitlab/metrics/requests_rack_middleware.rb:29:in `call'\n  lib/gitlab/middleware/release_env.rb:13:in `call'\n\nCompleted 503 Service Unavailable in 30081ms (Views: 12.3ms | ActiveRecord: 2.9ms)\n```", "attachment": null, "author": {"id": 2911796, "name": "Andreas V\u00f6gele", "username": "voegelas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5dfdecb4e5c2792bba5434a7b7f88693?s=80&d=identicon", "web_url": "https://gitlab.com/voegelas"}, "created_at": "2018-12-31T06:57:23.740Z", "updated_at": "2018-12-31T06:57:23.740Z", "system": false, "noteable_id": 11069659, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 136}], [{"id": 128122565, "type": null, "body": "@voegelas Is this really a gitlab-shell error? This sounds like an error with Rails connecting to Gitaly over an HTTP proxy. This sounds like this should have been fixed in https://gitlab.com/gitlab-org/gitlab-ce/issues/38333 and https://github.com/grpc/grpc/issues/12543, but perhaps it's back in another form.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-12-31T07:08:54.924Z", "updated_at": "2018-12-31T07:10:01.389Z", "system": false, "noteable_id": 11069659, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 136}], [{"id": 128128486, "type": null, "body": "@stanhu You are right; my issue is not a gitlab-shell error. It's a problem in GitLab 11.6.0.", "attachment": null, "author": {"id": 2911796, "name": "Andreas V\u00f6gele", "username": "voegelas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5dfdecb4e5c2792bba5434a7b7f88693?s=80&d=identicon", "web_url": "https://gitlab.com/voegelas"}, "created_at": "2018-12-31T08:27:56.861Z", "updated_at": "2018-12-31T08:27:56.861Z", "system": false, "noteable_id": 11069659, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 136}], [{"id": 128130163, "type": null, "body": "@voegelas Please create an issue in https://gitlab.com/gitlab-org/gitlab-ce/issues if you are having trouble with CE. I just tested with an HTTP proxy and Gitaly on a UNIX socket and had no issues.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-12-31T08:51:57.749Z", "updated_at": "2018-12-31T08:53:14.609Z", "system": false, "noteable_id": 11069659, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 136}], [{"id": 128130990, "type": null, "body": "Regarding my issue, I'm afraid I'm unable to provide any further details as I no longer work for the company that was facing this.", "attachment": null, "author": {"id": 2345904, "name": "James Le Cuirot", "username": "chewi", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/570ee005a5d5af0dcc6a92ccfb7d1be1?s=80&d=identicon", "web_url": "https://gitlab.com/chewi"}, "created_at": "2018-12-31T09:01:57.417Z", "updated_at": "2018-12-31T09:01:57.417Z", "system": false, "noteable_id": 11069659, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 136}], [{"id": 129815262, "type": null, "body": "mentioned in issue gitaly#1447", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2019-01-08T14:53:26.005Z", "updated_at": "2019-01-08T14:53:26.005Z", "system": true, "noteable_id": 11069659, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 136}], [{"id": 129930265, "type": null, "body": "I'm going to close this issue because I think https://gitlab.com/gitlab-org/gitaly/issues/1447 has more discussion about the root cause of this problem.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2019-01-08T20:28:45.593Z", "updated_at": "2019-01-08T20:28:45.593Z", "system": false, "noteable_id": 11069659, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 136}], [{"id": 129930272, "type": null, "body": "closed", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2019-01-08T20:28:46.068Z", "updated_at": "2019-01-08T20:28:46.068Z", "system": true, "noteable_id": 11069659, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 136}]]}, {"id": 11029815, "iid": 135, "project_id": 14022, "title": "Remove 'repo_path' from lib/gitlab_shell.rb", "description": "Follow-up to https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/203. As of gitlab 10.8, the repo path value returned by gitlab-rails is ignored, yet we still validate it in gitlab-shell.\n\nWe should remove all support for this field. It should NOT be an error if gitlab-rails passes the field anyway (for backwards compat).", "state": "closed", "created_at": "2018-05-25T11:55:19.525Z", "updated_at": "2019-03-12T16:27:39.108Z", "closed_at": "2018-08-17T10:39:30.667Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["technical debt"], "milestone": null, "assignees": [{"id": 101578, "name": "Zeger-Jan van de Weg", "username": "zj-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/101578/avatar.png", "web_url": "https://gitlab.com/zj-gitlab"}], "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "assignee": {"id": 101578, "name": "Zeger-Jan van de Weg", "username": "zj-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/101578/avatar.png", "web_url": "https://gitlab.com/zj-gitlab"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/135", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/135", "notes": "https://gitlab.com/api/v4/projects/14022/issues/135/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/135/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 94889784, "type": null, "body": "mentioned in commit 91dd4fb6af432a6ed70d3ad77d1bcebe1d041f4a", "attachment": null, "author": {"id": 101578, "name": "Zeger-Jan van de Weg", "username": "zj-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/101578/avatar.png", "web_url": "https://gitlab.com/zj-gitlab"}, "created_at": "2018-08-16T11:31:52.800Z", "updated_at": "2018-08-16T11:31:52.800Z", "system": true, "noteable_id": 11029815, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 135}], [{"id": 94889875, "type": null, "body": "mentioned in merge request !231", "attachment": null, "author": {"id": 101578, "name": "Zeger-Jan van de Weg", "username": "zj-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/101578/avatar.png", "web_url": "https://gitlab.com/zj-gitlab"}, "created_at": "2018-08-16T11:32:18.780Z", "updated_at": "2018-08-16T11:32:18.780Z", "system": true, "noteable_id": 11029815, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 135}], [{"id": 94911048, "type": null, "body": "mentioned in commit 2d212e401e099543f7612e67ff35b4e8b10593c0", "attachment": null, "author": {"id": 101578, "name": "Zeger-Jan van de Weg", "username": "zj-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/101578/avatar.png", "web_url": "https://gitlab.com/zj-gitlab"}, "created_at": "2018-08-16T13:07:20.264Z", "updated_at": "2018-08-16T13:07:20.264Z", "system": true, "noteable_id": 11029815, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 135}], [{"id": 94911129, "type": null, "body": "assigned to @zj", "attachment": null, "author": {"id": 101578, "name": "Zeger-Jan van de Weg", "username": "zj-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/101578/avatar.png", "web_url": "https://gitlab.com/zj-gitlab"}, "created_at": "2018-08-16T13:07:42.701Z", "updated_at": "2018-08-16T13:07:42.701Z", "system": true, "noteable_id": 11029815, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 135}], [{"id": 95106822, "type": null, "body": "closed via merge request !231", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-17T10:39:30.703Z", "updated_at": "2018-08-17T10:39:30.703Z", "system": true, "noteable_id": 11029815, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 135}], [{"id": 95106847, "type": null, "body": "mentioned in commit abb55c839ceedeb8f32f9af4ad791d349ab03f8c", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-17T10:39:33.408Z", "updated_at": "2018-08-17T10:39:33.408Z", "system": true, "noteable_id": 11029815, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 135}], [{"id": 95435767, "type": null, "body": "mentioned in commit dd3b613778ed0896da9e2cdfd742a6c997458d77", "attachment": null, "author": {"id": 101578, "name": "Zeger-Jan van de Weg", "username": "zj-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/101578/avatar.png", "web_url": "https://gitlab.com/zj-gitlab"}, "created_at": "2018-08-20T07:43:29.575Z", "updated_at": "2018-08-20T07:43:29.575Z", "system": true, "noteable_id": 11029815, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 135}], [{"id": 148887683, "type": null, "body": "mentioned in commit fapapa/gitlab-ce@6fa9b589da7b878a01006ac629b7559665758836", "attachment": null, "author": {"id": 3597568, "name": "Fabio Papa", "username": "fapapa", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3597568/avatar.png", "web_url": "https://gitlab.com/fapapa"}, "created_at": "2019-03-09T19:51:25.633Z", "updated_at": "2019-03-09T19:51:25.633Z", "system": true, "noteable_id": 11029815, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 135}], [{"id": 149392704, "type": null, "body": "mentioned in commit fapapa/gitlab-ce@7f58636956979bee9301381f1203cd61e1dbe2c4", "attachment": null, "author": {"id": 3597568, "name": "Fabio Papa", "username": "fapapa", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3597568/avatar.png", "web_url": "https://gitlab.com/fapapa"}, "created_at": "2019-03-11T21:07:39.465Z", "updated_at": "2019-03-11T21:07:39.465Z", "system": true, "noteable_id": 11029815, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 135}]]}, {"id": 10367147, "iid": 131, "project_id": 14022, "title": "Output the actual username for test command", "description": "Support uses the test command a lot to determine whether the correct public key is being used to authenticate the correct user.\n\n```\nssh -vT git@gitlab.com\n```\n\nCurrently, this displays a welcome message is authentication was successful and an associated user was discovered:\n\n```\n\"Welcome to GitLab, #{username}!\"\n```\n\nRight now, the `username` helper returns the user's actual name. \n\n```\nWelcome to GitLab, Mark Fletcher!\n```\n\nIt would be more helpful to display the unique username (e.g. `@markglenfletcher`) because there could be multiple accounts with the same actual name. And in the case where a user has multiple accounts and they are using the incorrect key for authentication, it's more than likely that the other account will have an identical name which makes this more difficult to debug.\n\nIf the username was returned and displayed it would provide a definitive, unique identifier to determine which account the current, authenticating, public key is associated to.\n\nExample scenario where this would be useful:\n\n- User contacts support when git access is denied stating that the user does not have access to the project\n- Support asks for output of the above command to determine the offered public key and the identity of the authenticated user\n- Support notices 'Joe Bloggs' was authenticated and searches for a 'Joe Bloggs' in the ~\"admin dashboard\" to check their access to that project is correct\n- Multiple 'Joe Bloggs' may be in the system\n- If the output returned a username, Support can directly access the account at '/admin/users/:username' and quickly identify the access that the account has\n\n/cc @arihantar @dblessing", "state": "closed", "created_at": "2018-04-17T14:48:28.989Z", "updated_at": "2018-08-08T15:33:33.952Z", "closed_at": "2018-05-28T09:52:13.732Z", "closed_by": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "labels": ["Platform [DEPRECATED]", "feature", "user management"], "milestone": null, "assignees": [{"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}], "author": {"id": 419655, "name": "Mark Fletcher", "username": "markglenfletcher", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/419655/avatar.png", "web_url": "https://gitlab.com/markglenfletcher"}, "assignee": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 3, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/131", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/131", "notes": "https://gitlab.com/api/v4/projects/14022/issues/131/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/131/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 68852334, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 419655, "name": "Mark Fletcher", "username": "markglenfletcher", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/419655/avatar.png", "web_url": "https://gitlab.com/markglenfletcher"}, "created_at": "2018-04-17T14:54:22.590Z", "updated_at": "2018-04-17T14:54:22.590Z", "system": true, "noteable_id": 10367147, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 131}], [{"id": 74603444, "type": null, "body": "mentioned in commit 4396367ac4194f0d1ed04db8bbd2121d6d8a3fef", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2018-05-23T15:34:13.969Z", "updated_at": "2018-05-23T15:34:13.969Z", "system": true, "noteable_id": 10367147, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 131}], [{"id": 74604002, "type": null, "body": "mentioned in merge request !204", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2018-05-23T15:36:46.439Z", "updated_at": "2018-05-23T15:36:46.439Z", "system": true, "noteable_id": 10367147, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 131}], [{"id": 74607349, "type": null, "body": "mentioned in commit aa10b70f2a37c45bc2551f2a0d34a835dc7189f9", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2018-05-23T15:55:07.333Z", "updated_at": "2018-05-23T15:55:07.333Z", "system": true, "noteable_id": 10367147, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 131}], [{"id": 74766806, "type": null, "body": "assigned to @reprazent", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2018-05-24T09:23:08.877Z", "updated_at": "2018-05-24T09:23:08.877Z", "system": true, "noteable_id": 10367147, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 131}], [{"id": 75329469, "type": null, "body": "closed via merge request !204", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-05-28T09:52:14.630Z", "updated_at": "2018-05-28T09:52:14.630Z", "system": true, "noteable_id": 10367147, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 131}], [{"id": 75329470, "type": null, "body": "closed via commit 4bc16881347b53709c0f28a3ac2ed3a96d7051b9", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-05-28T09:52:15.009Z", "updated_at": "2018-05-28T09:52:15.009Z", "system": true, "noteable_id": 10367147, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 131}], [{"id": 75329471, "type": null, "body": "closed via commit aa10b70f2a37c45bc2551f2a0d34a835dc7189f9", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2018-05-28T09:52:15.523Z", "updated_at": "2018-05-28T09:52:15.523Z", "system": true, "noteable_id": 10367147, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 131}], [{"id": 93326113, "type": null, "body": "mentioned in commit nick.thomas/gitlab-shell-mirror@4bc16881347b53709c0f28a3ac2ed3a96d7051b9", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-08-08T15:33:33.637Z", "updated_at": "2018-08-08T15:33:33.637Z", "system": true, "noteable_id": 10367147, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 131}]]}, {"id": 10181242, "iid": 130, "project_id": 14022, "title": "undefined method `error' for #<GitlabLogger:0x00007ffbbb8aac28>", "description": "@jacobvosmaer-gitlab I've received the following error when testing locally on the latest of `master`:\n\n```\nremote: /Users/ruben/projects/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_net.rb:213:in `request': undefined method `error' for #<GitlabLogger:0x00007ffbbb8aac28> (NoMethodError)\nremote: \tfrom /Users/ruben/projects/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_net.rb:224:in `post'\nremote: \tfrom /Users/ruben/projects/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_net.rb:37:in `check_access'\nremote: \tfrom /Users/ruben/projects/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_access.rb:27:in `block in exec'\nremote: \tfrom /Users/ruben/projects/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_metrics.rb:50:in `measure'\nremote: \tfrom /Users/ruben/projects/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_access.rb:26:in `exec'\nremote: \tfrom hooks/pre-receive:26:in `<main>'\n```\n\nLooking into [lib/gitlab_logger.rb](https://gitlab.com/gitlab-org/gitlab-shell/blob/69941f9075b64e8ed518a33e87b00c52169f4dbf/lib/gitlab_logger.rb) I don't see the definition for the `error` method.", "state": "closed", "created_at": "2018-04-07T15:54:34.778Z", "updated_at": "2018-06-12T17:47:47.981Z", "closed_at": "2018-04-09T12:05:32.085Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}], "author": {"id": 280339, "name": "Rub\u00e9n D\u00e1vila", "username": "rdavila", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/280339/avatar.png", "web_url": "https://gitlab.com/rdavila"}, "assignee": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "user_notes_count": 1, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/130", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/130", "notes": "https://gitlab.com/api/v4/projects/14022/issues/130/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/130/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 67449843, "type": null, "body": "OK, then we should add it!", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-04-09T10:53:20.216Z", "updated_at": "2018-04-09T10:53:20.216Z", "system": false, "noteable_id": 10181242, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 130}], [{"id": 67450302, "type": null, "body": "assigned to @jacobvosmaer-gitlab", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-04-09T10:57:10.030Z", "updated_at": "2018-04-09T10:57:10.030Z", "system": true, "noteable_id": 10181242, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 130}], [{"id": 67450676, "type": null, "body": "mentioned in merge request !200", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-04-09T10:59:11.697Z", "updated_at": "2018-04-09T10:59:11.697Z", "system": true, "noteable_id": 10181242, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 130}], [{"id": 67463725, "type": null, "body": "closed via commit 3a83767f650f996ef37382a21d05d8ed99873aa1", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-04-09T12:05:32.091Z", "updated_at": "2018-04-09T12:05:32.091Z", "system": true, "noteable_id": 10181242, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 130}], [{"id": 67463726, "type": null, "body": "closed via merge request !200", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-04-09T12:05:32.144Z", "updated_at": "2018-04-09T12:05:32.144Z", "system": true, "noteable_id": 10181242, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 130}], [{"id": 81112340, "type": null, "body": "mentioned in commit nick.thomas/gitlab-shell-mirror@3a83767f650f996ef37382a21d05d8ed99873aa1", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-06-12T17:47:47.837Z", "updated_at": "2018-06-12T17:47:47.837Z", "system": true, "noteable_id": 10181242, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 130}]]}, {"id": 10010495, "iid": 129, "project_id": 14022, "title": "Invalid clock in GitlabMetrics on Solaris", "description": "gitlab-shell fails on solaris with \"Invalid argument - clock_gettime (Errno::EINVAL)\", the reason is, the test for CLOCK_THREAD_CPUTIME_ID gives true however (might be a bug in ruby23)\n\n```\n$ ruby -e 'p Process.const_defined?(:CLOCK_THREAD_CPUTIME_ID)'                             \ntrue\n$ ruby -e 'p Process.clock_gettime(Process::CLOCK_THREAD_CPUTIME_ID, :millisecond)'        \n-e:1:in `clock_gettime': Invalid argument - clock_gettime (Errno::EINVAL)\n        from -e:1:in `<main>'\n$ ruby -e 'p Process.clock_gettime(Process::CLOCK_PROCESS_CPUTIME_ID, :millisecond)'       \n-e:1:in `clock_gettime': Invalid argument - clock_gettime (Errno::EINVAL)\n        from -e:1:in `<main>'\n```\n\nusing Process::CLOCK_MONOTONIC for now as workarround, don't care to much for the mesurements anyway. Would be nice to optionally disable them", "state": "opened", "created_at": "2018-03-29T22:15:42.721Z", "updated_at": "2018-03-29T22:15:42.721Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 2166277, "name": "vtoc", "username": "vtoc", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3565f761ab2d5a136f739b7b508d3927?s=80&d=identicon", "web_url": "https://gitlab.com/vtoc"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/129", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/129", "notes": "https://gitlab.com/api/v4/projects/14022/issues/129/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/129/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 9926486, "iid": 128, "project_id": 14022, "title": "gitlab-shell.log file update frequency", "description": "Hi all,\n\nHow frequently gitlab-shell.log file zips and stores the previous records. Is it depends size or time interval? Can I change this activity setting in gitlab code? The reason I am asking because I am extracting required information from gitlab-shell.log file..To keep track of all the activity details I would like to know how frequently gitlab-shell.log file updates. Depending on that I will be working on script to extract the details. I have searched about this on forum but I didn't find anywhere. Please let me know If anyone knows.\n\nI appreciate your help", "state": "closed", "created_at": "2018-03-25T23:51:12.368Z", "updated_at": "2018-03-26T22:08:55.614Z", "closed_at": "2018-03-26T22:08:55.608Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1091446, "name": "PRS", "username": "pashi12", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/052a2552ff721196d9b8053ef4d00adb?s=80&d=identicon", "web_url": "https://gitlab.com/pashi12"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/128", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/128", "notes": "https://gitlab.com/api/v4/projects/14022/issues/128/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/128/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 65004046, "type": null, "body": "changed title from **gitlab-shell.log** to **gitlab-shell.log{+ file update frequency+}**", "attachment": null, "author": {"id": 1091446, "name": "PRS", "username": "pashi12", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/052a2552ff721196d9b8053ef4d00adb?s=80&d=identicon", "web_url": "https://gitlab.com/pashi12"}, "created_at": "2018-03-25T23:51:36.227Z", "updated_at": "2018-03-25T23:51:36.227Z", "system": true, "noteable_id": 9926486, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 128}], [{"id": 65195867, "type": null, "body": "@DouweM  Can you help in right direction", "attachment": null, "author": {"id": 1091446, "name": "PRS", "username": "pashi12", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/052a2552ff721196d9b8053ef4d00adb?s=80&d=identicon", "web_url": "https://gitlab.com/pashi12"}, "created_at": "2018-03-26T20:17:43.503Z", "updated_at": "2018-03-26T20:17:43.503Z", "system": false, "noteable_id": 9926486, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 128}], [{"id": 65207328, "type": null, "body": "This is all managed by the built-in logrotate tool shipped with GitLab:\n\n* https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-cookbooks/gitlab/templates/default/logrotate.conf.erb\n* https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/files/gitlab-cookbooks/gitlab/templates/default/logrotate-service.erb\n\nPlease feel free to open an issue in the omnibus-gitlab tracker if you need to tune this more.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-03-26T22:08:44.884Z", "updated_at": "2018-03-26T22:08:44.884Z", "system": false, "noteable_id": 9926486, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 128}], [{"id": 65207342, "type": null, "body": "closed", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-03-26T22:08:55.739Z", "updated_at": "2018-03-26T22:08:55.739Z", "system": true, "noteable_id": 9926486, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 128}]]}, {"id": 9925038, "iid": 127, "project_id": 14022, "title": "bin/check returns error", "description": "Whenever I run bin/check over gitlab-shell it returns `undefined method `error'`. I'm using 7.1.1 gitlab-shell on 10.6 gitlab.\n\n\nError Log:\n```\n[git@dev gitlab-shell]$ bin/check\nCheck GitLab API access: /home/git/gitlab-shell/lib/gitlab_net.rb:213:in `request': undefined method `error' for #<GitlabLogger:0x00005591a73a5690> (NoMethodError)\n        from /home/git/gitlab-shell/lib/gitlab_net.rb:220:in `get'\n        from /home/git/gitlab-shell/lib/gitlab_net.rb:92:in `check'\n        from bin/check:12:in `<main>'\n```", "state": "opened", "created_at": "2018-03-25T18:58:30.317Z", "updated_at": "2018-03-25T18:58:30.317Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 5766, "name": "MrKeiKun", "username": "MrKeiKun", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3d05b760e98afb1c694cd990ec99cd3d?s=80&d=identicon", "web_url": "https://gitlab.com/MrKeiKun"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/127", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/127", "notes": "https://gitlab.com/api/v4/projects/14022/issues/127/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/127/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 9440735, "iid": 126, "project_id": 14022, "title": "How to run a script by gitlab-shell", "description": "I have a script which I am expecting it to be executed by gitlab-shell. Can you please let me know how to do that??\n\nExample: If user access a gitlab repo using ssh , as soon as ssh verified and user gets git-shell access, then my script should be executed. \n\nI want this script to be run by gitlab-shell every time for all users.\n\nThanks you all", "state": "closed", "created_at": "2018-02-26T03:40:58.266Z", "updated_at": "2018-02-26T15:22:26.386Z", "closed_at": "2018-02-26T15:22:26.357Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1091446, "name": "PRS", "username": "pashi12", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/052a2552ff721196d9b8053ef4d00adb?s=80&d=identicon", "web_url": "https://gitlab.com/pashi12"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/126", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/126", "notes": "https://gitlab.com/api/v4/projects/14022/issues/126/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/126/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 60636729, "type": null, "body": "@pashi12 This isn't something that's supported as far as I know. Sorry!", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-02-26T15:22:25.264Z", "updated_at": "2018-02-26T15:22:25.264Z", "system": false, "noteable_id": 9440735, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 126}], [{"id": 60636736, "type": null, "body": "closed", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-02-26T15:22:26.506Z", "updated_at": "2018-02-26T15:22:26.506Z", "system": true, "noteable_id": 9440735, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 126}]]}, {"id": 9421225, "iid": 125, "project_id": 14022, "title": "Custom post-receive hooks don't have access to GL_REPOSITORY environment variable", "description": "Custom post-receive hooks doesn't get access to the GL_REPOSITORY environment variable. \n\nIt gets deleted `gl_repository = ENV.delete('GL_REPOSITORY')` (https://gitlab.com/gitlab-org/gitlab-shell/blob/master/hooks/post-receive#L8)\n\nI'm not sure if there's a reason for doing this that I'm missing but if it's changed to `gl_repository = ENV['GL_REPOSITORY']` it is available.", "state": "closed", "created_at": "2018-02-24T01:06:14.617Z", "updated_at": "2018-06-12T17:47:40.728Z", "closed_at": "2018-03-01T21:25:11.718Z", "closed_by": null, "labels": ["Accepting merge requests"], "milestone": null, "assignees": [], "author": {"id": 607087, "name": "Ben", "username": "benmag", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a810e6b48b634d160f747bdc411c24ee?s=80&d=identicon", "web_url": "https://gitlab.com/benmag"}, "assignee": null, "user_notes_count": 3, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/125", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/125", "notes": "https://gitlab.com/api/v4/projects/14022/issues/125/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/125/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 60405816, "type": null, "body": "mentioned in merge request !191", "attachment": null, "author": {"id": 607087, "name": "Ben", "username": "benmag", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a810e6b48b634d160f747bdc411c24ee?s=80&d=identicon", "web_url": "https://gitlab.com/benmag"}, "created_at": "2018-02-24T01:10:44.632Z", "updated_at": "2018-02-24T01:10:44.632Z", "system": true, "noteable_id": 9421225, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 125}], [{"id": 60647581, "type": null, "body": "This got added in https://gitlab.com/gitlab-org/gitlab-shell/commit/ee259653e7a00359740ca36cef606f9c3cc1a7cb, but I'm not seeing a reason we need to specifically delete it. Can you comment @eReGeBe?", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-02-26T16:20:01.124Z", "updated_at": "2018-02-26T16:20:13.022Z", "system": false, "noteable_id": 9421225, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 125}], [{"id": 60653094, "type": null, "body": "@rspeicher I think I just followed the line above as a template (`key_id  = ENV.delete('GL_ID')`), but I see the mistake. Yes, let's change to `gl_repository = ENV['GL_REPOSITORY']` :+1:", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2018-02-26T16:52:35.320Z", "updated_at": "2018-02-26T16:52:35.320Z", "system": false, "noteable_id": 9421225, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 125}], [{"id": 60657341, "type": null, "body": "Cool, thanks! :+1: \n\n@benmag Feel free to open a merge request to restore the proper behavior.", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-02-26T17:18:34.427Z", "updated_at": "2018-02-26T17:18:34.427Z", "system": false, "noteable_id": 9421225, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 125}], [{"id": 60657342, "type": null, "body": "added ~1890178 label", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-02-26T17:18:34.864Z", "updated_at": "2018-02-26T17:18:34.864Z", "system": true, "noteable_id": 9421225, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 125}], [{"id": 61266420, "type": null, "body": "closed via merge request !191", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-03-01T21:25:11.720Z", "updated_at": "2018-03-01T21:25:11.720Z", "system": true, "noteable_id": 9421225, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 125}], [{"id": 61266421, "type": null, "body": "closed via commit 2b74470282e478aa7912ed370c4028e6f50498d1", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-03-01T21:25:11.776Z", "updated_at": "2018-03-01T21:25:11.776Z", "system": true, "noteable_id": 9421225, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 125}], [{"id": 81112319, "type": null, "body": "mentioned in commit nick.thomas/gitlab-shell-mirror@2b74470282e478aa7912ed370c4028e6f50498d1", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-06-12T17:47:40.375Z", "updated_at": "2018-06-12T17:47:40.375Z", "system": true, "noteable_id": 9421225, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 125}]]}, {"id": 9391794, "iid": 124, "project_id": 14022, "title": "Add json logging for gitlab shell", "description": "It would be helpful if we could have a json logging option for gitlab-shell so we won't need to use a regex parser for sending logs to elasticsearch.", "state": "closed", "created_at": "2018-02-22T11:45:01.908Z", "updated_at": "2018-03-27T11:56:41.127Z", "closed_at": "2018-03-27T11:56:41.119Z", "closed_by": null, "labels": ["logging", "production request"], "milestone": null, "assignees": [{"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}], "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "assignee": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "user_notes_count": 6, "merge_requests_count": 0, "upvotes": 2, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/124", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/124", "notes": "https://gitlab.com/api/v4/projects/14022/issues/124/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/124/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 61746604, "type": null, "body": "added ~3121573 ~3608049 labels", "attachment": null, "author": {"id": 895869, "name": "Andrew Newdigate", "username": "andrewn", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/895869/avatar.png", "web_url": "https://gitlab.com/andrewn"}, "created_at": "2018-03-05T20:06:45.950Z", "updated_at": "2018-03-05T20:06:45.950Z", "system": true, "noteable_id": 9391794, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 124}], [{"id": 62019729, "type": null, "body": "assigned to @jacobvosmaer-gitlab", "attachment": null, "author": {"id": 895869, "name": "Andrew Newdigate", "username": "andrewn", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/895869/avatar.png", "web_url": "https://gitlab.com/andrewn"}, "created_at": "2018-03-07T09:11:38.483Z", "updated_at": "2018-03-07T09:11:38.483Z", "system": true, "noteable_id": 9391794, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 124}], [{"id": 62019784, "type": null, "body": "Spoke briefly to @jacobvosmaer-gitlab about this yesterday and he's going to take a look at it.", "attachment": null, "author": {"id": 895869, "name": "Andrew Newdigate", "username": "andrewn", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/895869/avatar.png", "web_url": "https://gitlab.com/andrewn"}, "created_at": "2018-03-07T09:11:55.770Z", "updated_at": "2018-03-07T09:11:55.770Z", "system": false, "noteable_id": 9391794, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 124}], [{"id": 62757761, "type": null, "body": "It's a bit of a mess. In the Ruby part of gitlab-shell we use the Ruby stdlib logger. We would either need to vendor in a structured logging gem, or write a small structured logging class ourselves. In the Go part we should use logrus like we do in our other go projects.\n\nAll the structured logging gems I found look complex and big so I'm leaning towards writing a structured logging class in Ruby.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-03-12T14:33:51.898Z", "updated_at": "2018-03-12T14:33:51.898Z", "system": false, "noteable_id": 9391794, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 124}], [{"id": 62758836, "type": null, "body": "FYI, Geo uses a simple JSON logger that we created: https://gitlab.com/gitlab-org/gitlab-ee/blob/master/ee/lib/gitlab/json_logger.rb", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-03-12T14:38:52.659Z", "updated_at": "2018-03-12T14:38:52.659Z", "system": false, "noteable_id": 9391794, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 124}], [{"id": 62760284, "type": null, "body": "Thanks @stanhu . I do think we need a little more than that class for gitlab-shell. What I want is something where I can call `log.info(foo: 'bar', message: 'hello')` which should then emit either json or text.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-03-12T14:45:56.603Z", "updated_at": "2018-03-12T14:45:56.603Z", "system": false, "noteable_id": 9391794, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 124}], [{"id": 62790713, "type": null, "body": "mentioned in merge request !193", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-03-12T17:20:36.748Z", "updated_at": "2018-03-12T17:20:36.748Z", "system": true, "noteable_id": 9391794, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 124}], [{"id": 63004411, "type": null, "body": "mentioned in merge request !197", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-03-13T15:04:14.688Z", "updated_at": "2018-03-13T15:04:14.688Z", "system": true, "noteable_id": 9391794, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 124}], [{"id": 64537127, "type": null, "body": "Omnibus MR: https://gitlab.com/gitlab-org/omnibus-gitlab/merge_requests/2385\n\ngitlab-ce master already points to gitlab-shell 7.1.0, which supports structured logging.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-03-22T14:15:36.158Z", "updated_at": "2018-03-22T14:15:36.158Z", "system": false, "noteable_id": 9391794, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 124}], [{"id": 65316318, "type": null, "body": "Created https://gitlab.com/gitlab-com/infrastructure/issues/3940 for the next steps.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-03-27T11:56:40.375Z", "updated_at": "2018-03-27T11:56:40.375Z", "system": false, "noteable_id": 9391794, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 124}], [{"id": 65316321, "type": null, "body": "closed", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-03-27T11:56:41.328Z", "updated_at": "2018-03-27T11:56:41.328Z", "system": true, "noteable_id": 9391794, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 124}]]}, {"id": 9058650, "iid": 123, "project_id": 14022, "title": "Remove all support for passing repository paths as absolute paths on disk", "description": "gitlab-shell has fallback support in a number of places that uses `Dir.pwd` to determine the repository path.\n\nHowever, with the introduction of both gitaly and hashed storage, these code paths are legacy. We use the project `full_path` (lfs authentication, for instance) or the `gl_repository` key instead, to communicate to Gitaly or GitLab which repository we want to take action on.\n\nI propose we modify gitlab-shell to remove all sites that might fall back to an absolute path on disk. They should be dead code at this point. We can then modify gitlab-rails and gitaly (if necessary) to remove legacy support for parameters of this form.\n\nAn example:\n\nhttps://gitlab.com/gitlab-org/gitlab-shell/blob/master/hooks/pre-receive#L9\n\nIn all places, the `repo_path` is shadowed by the value that was in `GL_REPOSITORY`. It should be an error to run without this envvar being set.\n\nSimplifying the Ruby code now will also simplify any future rewrite into something that starts up more quickly, as there will be fewer code paths to replicate.\n\n/cc @DouweM @eReGeBe", "state": "closed", "created_at": "2018-02-05T15:04:41.109Z", "updated_at": "2019-08-07T08:03:19.805Z", "closed_at": "2018-10-01T12:10:29.162Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["Create [DEPRECATED]", "backend", "devops::create", "repository", "technical debt"], "milestone": null, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 3, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/123", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/123", "notes": "https://gitlab.com/api/v4/projects/14022/issues/123/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/123/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 62065922, "type": null, "body": "added ~3081817 label", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2018-03-07T12:57:25.899Z", "updated_at": "2018-03-07T12:57:25.899Z", "system": true, "noteable_id": 9058650, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 123}], [{"id": 99069331, "type": null, "body": "We've made significant progress on this in !231 and !235 - thanks @zj!\n\nI see the hooks still reference `repo_path` in a few places, so perhaps there's a tiny bit more to do? In any event, the hooks are being moved to Gitaly.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-05T12:16:09.968Z", "updated_at": "2018-09-05T12:16:09.968Z", "system": false, "noteable_id": 9058650, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 123}], [{"id": 105504124, "type": null, "body": "@nick.thomas Is this still relevant?", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-10-01T11:28:28.481Z", "updated_at": "2018-10-01T11:28:28.481Z", "system": false, "noteable_id": 9058650, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 123}], [{"id": 105521453, "type": null, "body": "@DouweM once the hooks are moved to Gitaly, this will be done. Since that's being tracked as a separate effort, I think we can close this.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:10:28.698Z", "updated_at": "2018-10-01T12:10:28.698Z", "system": false, "noteable_id": 9058650, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 123}], [{"id": 105521454, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:10:29.210Z", "updated_at": "2018-10-01T12:10:29.210Z", "system": true, "noteable_id": 9058650, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 123}]]}, {"id": 8920785, "iid": 122, "project_id": 14022, "title": "User is unable to be logged in via ssh.", "description": "Hi guys, thanks for your perfect work.\n\nUnfortunately, recently I've faced with strange bug.\n\nExisting external user finally was unable to push something via ssh today, but https works well.\nWe've got `git@git.fefelovgroup.com: Permission denied (publickey).` on any try, I did checks on gitlab-shell, read log and found only normal working message:\n`I, [2018-01-29T18:37:49.566205 #6689]  INFO -- : POST http://localhost:8080/api/v4/internal/allowed 0.01675`\n\nI tried to add new user, and faced with exactly the same problem. We are running:\n\n```\nGitLab 10.4.1\nGitLab Shell 5.11.0\nGitLab Workhorse v3.3.1\nGitLab API v4\nGitaly 0.66.0\nGit 2.16.1\nRuby 2.3.6p384\nRails 4.2.10\npostgresql 9.6.3\n```\n\nPlease, let me know where to go atm?\n\nThanks", "state": "closed", "created_at": "2018-01-29T13:46:36.786Z", "updated_at": "2018-02-01T08:59:36.519Z", "closed_at": "2018-02-01T08:59:36.513Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1972276, "name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u0424\u0435\u0444\u0435\u043b\u043e\u0432", "username": "andrew.fefelov", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3da2eb7d319b79f4a1d5c7f9d2589c57?s=80&d=identicon", "web_url": "https://gitlab.com/andrew.fefelov"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/122", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/122", "notes": "https://gitlab.com/api/v4/projects/14022/issues/122/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/122/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 57079209, "type": null, "body": "Unable to reproduce atm.", "attachment": null, "author": {"id": 1972276, "name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u0424\u0435\u0444\u0435\u043b\u043e\u0432", "username": "andrew.fefelov", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3da2eb7d319b79f4a1d5c7f9d2589c57?s=80&d=identicon", "web_url": "https://gitlab.com/andrew.fefelov"}, "created_at": "2018-02-01T08:59:36.137Z", "updated_at": "2018-02-01T08:59:36.137Z", "system": false, "noteable_id": 8920785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 122}], [{"id": 57079211, "type": null, "body": "closed", "attachment": null, "author": {"id": 1972276, "name": "\u0410\u043d\u0434\u0440\u0435\u0439 \u0424\u0435\u0444\u0435\u043b\u043e\u0432", "username": "andrew.fefelov", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3da2eb7d319b79f4a1d5c7f9d2589c57?s=80&d=identicon", "web_url": "https://gitlab.com/andrew.fefelov"}, "created_at": "2018-02-01T08:59:36.593Z", "updated_at": "2018-02-01T08:59:36.593Z", "system": true, "noteable_id": 8920785, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 122}]]}, {"id": 8687990, "iid": 121, "project_id": 14022, "title": "Prometheus metrics for gitlab-shell", "description": "We currently have very limited visibility into gitlab-shell:\n\nSome examples of useful metrics:\n\n* Counter for API calls to `internal/authorized_keys` \n* Authentication, failures\n* Connections to gitaly, failures", "state": "opened", "created_at": "2018-01-18T11:46:57.736Z", "updated_at": "2019-10-09T14:50:58.518Z", "closed_at": null, "closed_by": null, "labels": ["GitLab Self-Monitoring", "devops::monitor", "feature", "group::apm"], "milestone": null, "assignees": [], "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "assignee": null, "user_notes_count": 25, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/121", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/121", "notes": "https://gitlab.com/api/v4/projects/14022/issues/121/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/121/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 55147611, "type": null, "body": "added ~2391246 label", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-01-18T16:01:38.358Z", "updated_at": "2018-01-18T16:01:38.358Z", "system": true, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 55147641, "type": null, "body": "/cc: @joshlambert, @bjk-gitlab", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-01-18T16:01:46.567Z", "updated_at": "2018-01-18T16:01:46.567Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 55151165, "type": null, "body": "It might be that there is not much to do here except using mtail, not great but it could give us some of these metrics.", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-01-18T16:25:55.884Z", "updated_at": "2018-01-18T16:25:55.884Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 55203846, "type": null, "body": "I think we should use Prometheus push metrics here, since gitlab-shell is a short-lived process.\n", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-01-18T23:10:09.266Z", "updated_at": "2018-01-18T23:10:22.327Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 55263714, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-01-19T09:58:56.372Z", "updated_at": "2018-01-19T09:58:56.372Z", "system": true, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 55545439, "type": null, "body": "assigned to @pcarranza", "attachment": null, "author": {"id": 274314, "name": "Pablo Carranza [GitLab]", "username": "pcarranza-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/69cd9eb49317e1207ce3ee115f28a9ad?s=80&d=identicon", "web_url": "https://gitlab.com/pcarranza-gitlab"}, "created_at": "2018-01-22T11:45:37.614Z", "updated_at": "2018-01-22T11:45:37.614Z", "system": true, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 56306384, "type": null, "body": "This is done and deployed into production, some sample graphs are:\n\nhttps://prometheus.gitlab.com/graph?g0.range_input=1h&g0.expr=histogram_quantile(0.99%2C%20sum(rate(gitlab_shell_authorized_keys_requests_completed_seconds_bucket%7Benvironment%3D%22prd%22%7D%5B1m%5D))%20by%20(le))&g0.tab=0&g1.range_input=1h&g1.expr=histogram_quantile(0.99%2C%20sum(rate(gitlab_shell_allowed_requests_completed_seconds_bucket%7Benvironment%3D%22prd%22%7D%5B1m%5D))%20by%20(le))&g1.tab=0\n\nhttps://prometheus.gitlab.com/graph?g0.range_input=1h&g0.expr=sum(rate(gitlab_shell_git_command_completed_by_shard_total%7Benvironment%3D%22prd%22%7D%5B1m%5D))%20by%20(command)&g0.tab=0&g1.range_input=1h&g1.expr=sum(rate(gitlab_shell_git_command_completed_by_shard_total%7Benvironment%3D%22prd%22%7D%5B1m%5D))%20by%20(shard)&g1.tab=0\n\nand\n\nhttps://prometheus.gitlab.com/graph?g0.range_input=1h&g0.expr=sum(rate(gitlab_shell_git_command_access_denied%5B1m%5D))&g0.tab=0&g1.range_input=1h&g1.expr=sum(rate(gitlab_shell_server_errors%5B1m%5D))&g1.tab=0", "attachment": null, "author": {"id": 274314, "name": "Pablo Carranza [GitLab]", "username": "pcarranza-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/69cd9eb49317e1207ce3ee115f28a9ad?s=80&d=identicon", "web_url": "https://gitlab.com/pcarranza-gitlab"}, "created_at": "2018-01-26T14:10:45.900Z", "updated_at": "2018-01-26T14:10:45.900Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 56306386, "type": null, "body": "closed", "attachment": null, "author": {"id": 274314, "name": "Pablo Carranza [GitLab]", "username": "pcarranza-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/69cd9eb49317e1207ce3ee115f28a9ad?s=80&d=identicon", "web_url": "https://gitlab.com/pcarranza-gitlab"}, "created_at": "2018-01-26T14:10:46.485Z", "updated_at": "2018-01-26T14:10:46.485Z", "system": true, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 56307029, "type": null, "body": "@pcarranza Thanks for working on this. I'm not sure if we should close this issue until this data is also shipping with the package, though.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-01-26T14:14:51.203Z", "updated_at": "2018-01-26T14:27:32.215Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 56317811, "type": null, "body": "@stanhu I think we want to open an issue to package this in omnibus.\n\nFor reference, we want to integrate [this mtail script](https://gitlab.com/gitlab-cookbooks/gitlab-mtail/blob/master/files/default/mtail/gitlab-shell.mtail)", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2018-01-26T15:22:37.870Z", "updated_at": "2018-01-26T15:22:37.870Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 56318275, "type": null, "body": "marked this issue as related to omnibus-gitlab#3117", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2018-01-26T15:25:28.364Z", "updated_at": "2018-01-26T15:25:28.364Z", "system": true, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 56323659, "type": null, "body": "@bjk-gitlab I think you should be picking all the scripts we have laying around for mtail, there's a lot of really valuable data.", "attachment": null, "author": {"id": 274314, "name": "Pablo Carranza [GitLab]", "username": "pcarranza-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/69cd9eb49317e1207ce3ee115f28a9ad?s=80&d=identicon", "web_url": "https://gitlab.com/pcarranza-gitlab"}, "created_at": "2018-01-26T15:56:21.094Z", "updated_at": "2018-01-26T15:56:21.094Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 56337137, "type": null, "body": "Maybe not all, but some of them I was already thinking about integrating into omnibus.  Some of them we should be able to get from \"normal\" metrics sources, like unicorn metrics.", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2018-01-26T17:28:21.393Z", "updated_at": "2018-01-26T17:28:21.393Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 106125913, "type": null, "body": "reopened", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-10-03T12:43:39.520Z", "updated_at": "2018-10-03T12:43:39.520Z", "system": true, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 106126660, "type": null, "body": "I am going to re-open this issue as since json logging we have lost a lot of visibility into gitlab-shell since mtail parsing is broken. We could try parsing json with mtail, which is not great but I think it would be so much nicer if we had another way to get metrics. We have an outstanding item for setting up a pushgateway so we can go that route, or we record metrics on disk and use the file exporter.\n\ngit-ssh is one of the most critical components of gitlab.com and it feels like we are bit blind in this area.\n\ncc @jacobvosmaer\\-gitlab  @andrewn", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-10-03T12:46:12.854Z", "updated_at": "2018-10-03T12:46:12.854Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 106134486, "type": null, "body": "mentioned in issue omnibus-gitlab#3117", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-10-03T13:15:15.783Z", "updated_at": "2018-10-03T13:15:15.783Z", "system": true, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 106160873, "type": null, "body": "I didn't know we were using mtail. Why is it broken now? Anything we can do about that?\n\nNot sure if prometheus pushgateway is meant to handle high volume (a push for each SSH session).\n\nWhat metrics do we want that we can't infer from the Gitaly side?", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-10-03T14:23:43.804Z", "updated_at": "2018-10-03T14:23:43.804Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 106162379, "type": null, "body": "> I didn't know we were using mtail. Why is it broken now? Anything we can do about that?\n\nmtail parsing is line based and we switched gitlab-shell to json logging.\n\n> What metrics do we want that we can't infer from the Gitaly side?\n\nrejected keys, latency for authentication requests, volume of requests per git node. Also see the description of the issue :)\n", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-10-03T14:27:35.049Z", "updated_at": "2018-10-03T14:27:54.779Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107244492, "type": null, "body": "Discussed with @bjk\\-gitlab today. Sounds like we want to have gitlab-shell create an mtail-friendly log again. Either by creating a new log file, or by maybe extending mtail to parse JSON. We probably want mtail in omnibus anyway.\n\n@bjk\\-gitlab is going to check if adding JSON support mtail is feasible. If not then we just create a new (optional) log file in gitlab-shell where we log the metrics for the sole purpose of mtail consumption.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-10-08T14:39:37.829Z", "updated_at": "2018-10-08T14:39:37.829Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107264701, "type": null, "body": "mentioned in issue #165", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-10-08T15:33:21.350Z", "updated_at": "2018-10-08T15:33:21.350Z", "system": true, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107451361, "type": null, "body": "gitlab-shell logs are JSON, but it's still line-by-line. We should be able to parse this with mtail, just slightly more difficult.", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2018-10-09T11:56:44.457Z", "updated_at": "2018-10-09T11:56:44.457Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107470029, "type": null, "body": "So will we be better off with gitlab-shell generating a log especially for mtail, or with a \"slightly more difficult\" JSON parser in mtail? @bjk-gitlab would that JSON parser be robust against field re-ordering?", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-10-09T13:00:00.997Z", "updated_at": "2018-10-09T13:00:00.997Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107470668, "type": null, "body": "I can try and make it slightly robust against field ordering, but only so much.", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2018-10-09T13:02:17.323Z", "updated_at": "2018-10-09T13:02:17.323Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107471571, "type": null, "body": "> gitlab-shell logs are JSON, but it's still line-by-line. We should be able to parse this with mtail, just slightly more difficult.\n\nThis sounds like an mtail anti pattern :( What's wrong with writing metrics to files on disk instead?", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-10-09T13:05:47.662Z", "updated_at": "2018-10-09T13:05:47.662Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107473830, "type": null, "body": "@jarv The problem is we need to have a lock-free way of writing reliably. If we generate a metric file for every request, this would be a huge number of files.\n\nWe could write out to a unix socket, but we would need to write a custom aggregation exporter.", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2018-10-09T13:13:21.823Z", "updated_at": "2018-10-09T13:13:21.823Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107474368, "type": null, "body": "As a stop-gap until a long-term solution is figured out, I've created an MR to update the current non-working mtail program. https://gitlab.com/gitlab-cookbooks/gitlab-mtail/merge_requests/17", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2018-10-09T13:15:19.283Z", "updated_at": "2018-10-09T13:15:19.283Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107487133, "type": null, "body": "We could extend https://github.com/prometheus/statsd_exporter to support listening on a UDP unix socket and then send statsd format messages to it straight from gitlab-shell (i.e. without having a statsd in the middle).\n\nOr, less silly, use statsd-exporter with normal UDP.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-10-09T13:47:48.477Z", "updated_at": "2018-10-09T13:53:58.977Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107492444, "type": null, "body": "The main reason to avoid statsd_exporter is that it takes a bunch of work to support labels.\n\nhttps://github.com/weaveworks/prom-aggregation-gateway/ supports something more like Prometheus native data model.", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2018-10-09T14:00:25.134Z", "updated_at": "2018-10-09T14:00:25.134Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107494006, "type": null, "body": "I'm missing something here? Why would we chose `statsd_exporter` or `prom-aggregation-gateway` options over push gateway? \n\nEspecially when we have a shiny new push gateway: https://gitlab.com/gitlab-com/gl-infra/infrastructure/issues/4858", "attachment": null, "author": {"id": 895869, "name": "Andrew Newdigate", "username": "andrewn", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/895869/avatar.png", "web_url": "https://gitlab.com/andrewn"}, "created_at": "2018-10-09T14:03:24.697Z", "updated_at": "2018-10-09T14:03:24.697Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107498663, "type": null, "body": "@andrewn The pushgateway does not support aggregating events, so you can't push a counter increment event, only counter set.", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2018-10-09T14:13:21.333Z", "updated_at": "2018-10-09T14:13:21.333Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107509188, "type": null, "body": "mentioned in issue gitlab-com/gl-infra/infrastructure#4858", "attachment": null, "author": {"id": 895869, "name": "Andrew Newdigate", "username": "andrewn", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/895869/avatar.png", "web_url": "https://gitlab.com/andrewn"}, "created_at": "2018-10-09T14:41:27.206Z", "updated_at": "2018-10-09T14:41:27.206Z", "system": true, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107703852, "type": null, "body": "I've added a dashboard based on the updated mtail metrics: https://dashboards.gitlab.net/d/mDACpJJiz/gitlab-shell", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2018-10-10T09:50:36.311Z", "updated_at": "2018-10-10T09:50:36.311Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107721465, "type": null, "body": "This is great to have these metric again!\nIt would be nice if we have smaller buckets for latency.\nI wonder why we see such an unusual command pattern on file-16?", "attachment": null, "author": {"id": 1254817, "name": "John Jarvis", "username": "jarv", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1254817/avatar.png", "web_url": "https://gitlab.com/jarv"}, "created_at": "2018-10-10T11:02:09.143Z", "updated_at": "2018-10-10T11:02:09.143Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 107765642, "type": null, "body": "We can pull some data from the logs and do some re-bucketing.", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2018-10-10T13:44:25.825Z", "updated_at": "2018-10-10T13:44:25.825Z", "system": false, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}], [{"id": 228167737, "type": null, "body": "mentioned in merge request !338", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-10-09T14:50:58.277Z", "updated_at": "2019-10-09T14:50:58.280Z", "system": true, "noteable_id": 8687990, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 121}]]}, {"id": 8597224, "iid": 119, "project_id": 14022, "title": "Remove legacy GitlabReferenceCounter / redis code", "description": "gitlab-shell can perform pre-receive and post-receive hook actions either through the API or by pushing jobs directly into sidekiq using a redis connection.\n\nWhen gitlab-shell is running on gitaly nodes, sidekiq-via-redis integration should not be available. We should just remove the fallback methods - they were put in place to ease migration between version (9.3, 9.4, 9.5) rather than resiliency.", "state": "closed", "created_at": "2018-01-12T13:19:33.706Z", "updated_at": "2018-01-12T15:05:11.423Z", "closed_at": "2018-01-12T14:26:11.882Z", "closed_by": null, "labels": [], "milestone": {"id": 404412, "iid": 7, "group_id": 9970, "title": "10.5", "description": "", "state": "closed", "created_at": "2017-11-02T10:41:09.107Z", "updated_at": "2018-04-20T17:18:01.488Z", "due_date": "2018-02-22", "start_date": "2018-01-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/7"}, "assignees": [{"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/119", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/119", "notes": "https://gitlab.com/api/v4/projects/14022/issues/119/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/119/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 54327381, "type": null, "body": "mentioned in merge request !181", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T13:49:53.614Z", "updated_at": "2018-01-12T13:49:53.614Z", "system": true, "noteable_id": 8597224, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 119}], [{"id": 54327993, "type": null, "body": "changed title from **Remove legacy GitlabReferenceCounter code** to **Remove legacy GitlabReferenceCounter {+/ redis +}code**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T13:53:56.511Z", "updated_at": "2018-01-12T13:53:56.511Z", "system": true, "noteable_id": 8597224, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 119}], [{"id": 54328006, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T13:54:02.911Z", "updated_at": "2018-01-12T13:54:02.911Z", "system": true, "noteable_id": 8597224, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 119}], [{"id": 54328013, "type": null, "body": "changed milestone to %\"10.5\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T13:54:07.055Z", "updated_at": "2018-01-12T13:54:07.055Z", "system": true, "noteable_id": 8597224, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 119}], [{"id": 54332782, "type": null, "body": "closed via merge request !181", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-01-12T14:26:11.930Z", "updated_at": "2018-01-12T14:26:11.930Z", "system": true, "noteable_id": 8597224, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 119}], [{"id": 54334647, "type": null, "body": "mentioned in commit 58ceab7279066faaaa15e16afb842fee4b7eff49", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-01-12T14:39:47.531Z", "updated_at": "2018-01-12T14:39:47.531Z", "system": true, "noteable_id": 8597224, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 119}], [{"id": 54335241, "type": null, "body": "mentioned in issue #87", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:43:58.773Z", "updated_at": "2018-01-12T14:43:58.773Z", "system": true, "noteable_id": 8597224, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 119}], [{"id": 54338540, "type": null, "body": "mentioned in issue #89", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:05:06.367Z", "updated_at": "2018-01-12T15:05:06.367Z", "system": true, "noteable_id": 8597224, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 119}]]}, {"id": 8117988, "iid": 118, "project_id": 14022, "title": "Include a script for authorized_keys lookup in the database", "description": "Per https://gitlab.com/gitlab-org/omnibus-gitlab/issues/2855\n\nCurrently, https://docs.gitlab.com/ee/administration/operations/speed_up_ssh.html asks users to create an unmanaged executable script in a custom location to enable authorized_keys database lookup, which isn't great. \n\nThe custom script just wraps a gitlab-shell script. We should add another gitlab-shell script that implements all of this, and in omnibus, ensure it's installed in the right place, with the right permissions.", "state": "closed", "created_at": "2017-12-08T17:26:14.063Z", "updated_at": "2019-08-07T08:38:49.692Z", "closed_at": "2017-12-19T16:02:24.895Z", "closed_by": null, "labels": ["Geo [DEPRECATED]", "devops::enablement", "group::geo", "workflow::In review"], "milestone": {"id": 360828, "iid": 4, "group_id": 9970, "title": "10.4", "description": "", "state": "closed", "created_at": "2017-08-16T16:52:35.085Z", "updated_at": "2018-04-20T17:17:48.510Z", "due_date": "2018-01-22", "start_date": "2017-12-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/4"}, "assignees": [{"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/118", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/118", "notes": "https://gitlab.com/api/v4/projects/14022/issues/118/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/118/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 1, "epic_iid": null, "discussion": [[{"id": 50668291, "type": null, "body": "changed milestone to %\"10.4\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-12-08T17:26:20.183Z", "updated_at": "2017-12-08T17:26:20.183Z", "system": true, "noteable_id": 8117988, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 118}], [{"id": 50668296, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-12-08T17:26:22.660Z", "updated_at": "2017-12-08T17:26:22.660Z", "system": true, "noteable_id": 8117988, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 118}], [{"id": 50668302, "type": null, "body": "added ~2559747 label", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-12-08T17:26:26.799Z", "updated_at": "2017-12-08T17:26:26.799Z", "system": true, "noteable_id": 8117988, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 118}], [{"id": 50668592, "type": null, "body": "mentioned in issue omnibus-gitlab#2855", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-12-08T17:29:47.884Z", "updated_at": "2017-12-08T17:29:47.884Z", "system": true, "noteable_id": 8117988, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 118}], [{"id": 51861326, "type": null, "body": "added ~2526320 label", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-12-18T17:08:02.751Z", "updated_at": "2017-12-18T17:08:02.751Z", "system": true, "noteable_id": 8117988, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 118}], [{"id": 51973194, "type": null, "body": "mentioned in merge request !178", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-12-19T12:16:54.215Z", "updated_at": "2017-12-19T12:16:54.215Z", "system": true, "noteable_id": 8117988, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 118}], [{"id": 52010417, "type": null, "body": "closed via merge request !178", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-12-19T16:02:24.944Z", "updated_at": "2017-12-19T16:02:24.944Z", "system": true, "noteable_id": 8117988, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 118}], [{"id": 52010418, "type": null, "body": "closed via commit f8f314890758983e9d167529cb3a332a01262d5c", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-12-19T16:02:25.208Z", "updated_at": "2017-12-19T16:02:25.208Z", "system": true, "noteable_id": 8117988, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 118}], [{"id": 53981458, "type": null, "body": "added ~2526326 and removed ~2526320 labels", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-10T11:03:43.374Z", "updated_at": "2018-01-10T11:03:43.374Z", "system": true, "noteable_id": 8117988, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 118}], [{"id": 54333900, "type": null, "body": "mentioned in commit nick.thomas/gitlab-shell-mirror@f8f314890758983e9d167529cb3a332a01262d5c", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-01-12T14:34:39.855Z", "updated_at": "2018-01-12T14:34:39.855Z", "system": true, "noteable_id": 8117988, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 118}]]}, {"id": 7994428, "iid": 116, "project_id": 14022, "title": "Fix the fork_project RPC for hashed storage", "description": "gitlab-shell issue for https://gitlab.com/gitlab-org/gitlab-ce/issues/40711#note_49642936", "state": "closed", "created_at": "2017-11-30T20:25:01.933Z", "updated_at": "2018-01-12T14:34:57.682Z", "closed_at": "2017-12-01T14:31:46.023Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/116", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/116", "notes": "https://gitlab.com/api/v4/projects/14022/issues/116/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/116/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 49648507, "type": null, "body": "mentioned in merge request !174", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-11-30T21:22:37.583Z", "updated_at": "2017-11-30T21:22:37.583Z", "system": true, "noteable_id": 7994428, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 116}], [{"id": 49768981, "type": null, "body": "closed via merge request !174", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-12-01T14:31:46.050Z", "updated_at": "2017-12-01T14:31:46.050Z", "system": true, "noteable_id": 7994428, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 116}], [{"id": 54333941, "type": null, "body": "mentioned in commit nick.thomas/gitlab-shell-mirror@7e81de5ba8fa2aaa13c6035c0e333b4b0ff0df9b", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-01-12T14:34:47.109Z", "updated_at": "2018-01-12T14:34:47.109Z", "system": true, "noteable_id": 7994428, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 116}]]}, {"id": 7988479, "iid": 115, "project_id": 14022, "title": "Remove geo node key special code", "description": "Per https://gitlab.com/gitlab-org/gitlab-ee/merge_requests/3553#note_49556251\n\ngitlab-shell does some additional magic if the API returns `geo_node: true`. Once https://gitlab.com/gitlab-org/gitlab-ee/merge_requests/3553 is merged, it will *never* return `geo_node: true`, so it is safe to remove this magic.", "state": "closed", "created_at": "2017-11-30T13:22:07.577Z", "updated_at": "2019-08-07T08:39:07.349Z", "closed_at": "2018-01-12T14:49:07.946Z", "closed_by": null, "labels": ["Geo [DEPRECATED]", "devops::enablement", "group::geo", "technical debt", "workflow::In review"], "milestone": {"id": 404412, "iid": 7, "group_id": 9970, "title": "10.5", "description": "", "state": "closed", "created_at": "2017-11-02T10:41:09.107Z", "updated_at": "2018-04-20T17:18:01.488Z", "due_date": "2018-02-22", "start_date": "2018-01-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/7"}, "assignees": [{"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/115", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/115", "notes": "https://gitlab.com/api/v4/projects/14022/issues/115/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/115/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 49586742, "type": null, "body": "added ~2559747 ~3011693 labels", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-11-30T13:22:16.147Z", "updated_at": "2017-11-30T13:22:16.147Z", "system": true, "noteable_id": 7988479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 115}], [{"id": 53113608, "type": null, "body": "changed milestone to %\"10.5\"", "attachment": null, "author": {"id": 192328, "name": "Ernst van Nierop", "username": "ernstvn-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/36b7c478bbe1e079f10202afa9b30c0d?s=80&d=identicon", "web_url": "https://gitlab.com/ernstvn-gitlab"}, "created_at": "2018-01-03T01:43:32.262Z", "updated_at": "2018-01-03T01:43:32.262Z", "system": true, "noteable_id": 7988479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 115}], [{"id": 54064048, "type": null, "body": "assigned to @stanhu", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-01-10T21:04:58.678Z", "updated_at": "2018-01-10T21:04:58.678Z", "system": true, "noteable_id": 7988479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 115}], [{"id": 54065095, "type": null, "body": "mentioned in commit 3303c3d694d3ecace3e7fe669dcf3b22f04e8474", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-01-10T21:10:41.783Z", "updated_at": "2018-01-10T21:10:41.783Z", "system": true, "noteable_id": 7988479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 115}], [{"id": 54065258, "type": null, "body": "mentioned in merge request !179", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-01-10T21:12:31.823Z", "updated_at": "2018-01-10T21:12:31.823Z", "system": true, "noteable_id": 7988479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 115}], [{"id": 54065288, "type": null, "body": "added ~2526326 label", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-01-10T21:13:04.300Z", "updated_at": "2018-01-10T21:13:04.300Z", "system": true, "noteable_id": 7988479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 115}], [{"id": 54090339, "type": null, "body": "mentioned in commit 6fa9ae95aa2fb97dcd3d065ebe2f9aad1b3b1086", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-01-11T05:18:00.393Z", "updated_at": "2018-01-11T05:18:00.393Z", "system": true, "noteable_id": 7988479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 115}], [{"id": 54235128, "type": null, "body": "mentioned in commit deed8b992cee0621a97fa4d297bd72d5cadea4db", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-01-11T23:35:31.221Z", "updated_at": "2018-01-11T23:35:31.221Z", "system": true, "noteable_id": 7988479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 115}], [{"id": 54334649, "type": null, "body": "mentioned in commit 9ac02447386495c54236e8e8ba702a54931a4e61", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-01-12T14:39:47.652Z", "updated_at": "2018-01-12T14:39:47.652Z", "system": true, "noteable_id": 7988479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 115}], [{"id": 54335975, "type": null, "body": "closed via commit 9ac02447386495c54236e8e8ba702a54931a4e61", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-01-12T14:49:07.757Z", "updated_at": "2018-01-12T14:49:07.757Z", "system": true, "noteable_id": 7988479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 115}], [{"id": 54335976, "type": null, "body": "closed via commit a478813e1e0c792733ef4a7639d8191bd20a0261", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-01-12T14:49:07.815Z", "updated_at": "2018-01-12T14:49:07.815Z", "system": true, "noteable_id": 7988479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 115}], [{"id": 54335977, "type": null, "body": "closed via merge request !179", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-01-12T14:49:08.090Z", "updated_at": "2018-01-12T14:49:08.090Z", "system": true, "noteable_id": 7988479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 115}], [{"id": 54444138, "type": null, "body": "mentioned in commit nick.thomas/gitlab-shell-mirror@a478813e1e0c792733ef4a7639d8191bd20a0261", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-01-14T02:39:06.141Z", "updated_at": "2018-01-14T02:39:06.141Z", "system": true, "noteable_id": 7988479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 115}]]}, {"id": 7965899, "iid": 114, "project_id": 14022, "title": "Remove unused redis-cli option", "description": "During our work in charts/helm.gitlab.io#56, we stumbled upon a `redis: bin` config option. \nI think this was already known, basically ever since we vendored redis gem.\n\nCan we remove:\n\n```\nredis:\n  bin:\n```\n\nfrom the configuration?\n\nPinging @smcgivern because he is listed on the team page as the maintainer :)", "state": "closed", "created_at": "2017-11-29T10:27:29.595Z", "updated_at": "2018-01-12T14:34:40.051Z", "closed_at": "2017-12-13T10:31:59.639Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}], "author": {"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}, "assignee": {"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}, "user_notes_count": 1, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/114", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/114", "notes": "https://gitlab.com/api/v4/projects/14022/issues/114/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/114/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 49157683, "type": null, "body": "@marin good call!\n\nWe should remove the option and the specs which test it. If someone does that, I'm happy to merge it.", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-11-29T16:19:08.726Z", "updated_at": "2017-11-29T16:19:08.726Z", "system": false, "noteable_id": 7965899, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 114}], [{"id": 51184675, "type": null, "body": "assigned to @marin", "attachment": null, "author": {"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}, "created_at": "2017-12-13T02:31:14.357Z", "updated_at": "2017-12-13T02:31:14.357Z", "system": true, "noteable_id": 7965899, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 114}], [{"id": 51184701, "type": null, "body": "mentioned in merge request !177", "attachment": null, "author": {"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}, "created_at": "2017-12-13T02:31:44.410Z", "updated_at": "2017-12-13T02:31:44.410Z", "system": true, "noteable_id": 7965899, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 114}], [{"id": 51235492, "type": null, "body": "closed via merge request !177", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-12-13T10:31:59.694Z", "updated_at": "2017-12-13T10:31:59.694Z", "system": true, "noteable_id": 7965899, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 114}], [{"id": 51235493, "type": null, "body": "closed via commit 02124edb5d032eb25cde7662f9b0962fa167b3c4", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-12-13T10:31:59.721Z", "updated_at": "2017-12-13T10:31:59.721Z", "system": true, "noteable_id": 7965899, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 114}], [{"id": 51332540, "type": null, "body": "mentioned in merge request omnibus-gitlab!2158", "attachment": null, "author": {"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}, "created_at": "2017-12-13T23:57:22.753Z", "updated_at": "2017-12-13T23:57:22.753Z", "system": true, "noteable_id": 7965899, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 114}], [{"id": 54333901, "type": null, "body": "mentioned in commit nick.thomas/gitlab-shell-mirror@02124edb5d032eb25cde7662f9b0962fa167b3c4", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2018-01-12T14:34:39.945Z", "updated_at": "2018-01-12T14:34:39.945Z", "system": true, "noteable_id": 7965899, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 114}]]}, {"id": 7854643, "iid": 113, "project_id": 14022, "title": "Remove bin/gitlab_projects and lib/gitlab_projects.rb", "description": "Per https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/15853 , the gitlab_projects code has been imported into gitlab-rails. This means it can be removed from gitlab-shell in a v6.0.0\n\n---\n\nAnother old description:\n\n\nCopy lib/gitlab_projects.rb into gitlab-ce/lib/gitlab/git/gitlab_projects.rb (or so)\n\n---\n\nOld description:\n\nCurrently, gitlab-shell uses `SIGKILL` unconditionally if any of its git subprocesses exceed the user-specified timeout. This can lead to corruption of the repository and is generally a bad idea.\n\nInstead, we should send `SIGTERM`, wait ~5 seconds, then send `SIGKILL` if the process hasn't died in that time period. For bonus points, if the gitlab-shell subprocess receives an `INT`, `TERM` or similar signal, it should also kill its children before exiting.\n\nThere are commands where we allow the subprocess to run without any timeouts at all (e.g., `gitlab-projects fork-repository`). These should be fixed.", "state": "closed", "created_at": "2017-11-21T15:44:27.453Z", "updated_at": "2018-01-12T15:18:08.832Z", "closed_at": "2018-01-12T14:23:19.786Z", "closed_by": null, "labels": ["Platform [DEPRECATED]", "backend", "forking"], "milestone": {"id": 404412, "iid": 7, "group_id": 9970, "title": "10.5", "description": "", "state": "closed", "created_at": "2017-11-02T10:41:09.107Z", "updated_at": "2018-04-20T17:18:01.488Z", "due_date": "2018-02-22", "start_date": "2018-01-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/7"}, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 5, "merge_requests_count": 1, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/113", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/113", "notes": "https://gitlab.com/api/v4/projects/14022/issues/113/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/113/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 1, "epic_iid": null, "discussion": [[{"id": 48165858, "type": null, "body": "Alternatively, we could simplify things *enormously* by absorbing `gitlab-projects` into gitlab-ce/lib/gitlab/shell.rb`, cleaning it up along the way. /cc @DouweM", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-11-21T15:45:41.286Z", "updated_at": "2017-11-21T15:45:41.286Z", "system": false, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 48206107, "type": null, "body": "changed milestone to %\"10.3\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-11-21T16:50:21.408Z", "updated_at": "2017-11-21T16:50:21.408Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 48206115, "type": null, "body": "added ~2559747 ~2278658 labels", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-11-21T16:50:28.304Z", "updated_at": "2017-11-21T16:50:28.304Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 48206123, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-11-21T16:50:32.515Z", "updated_at": "2017-11-21T16:50:32.515Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 48208400, "type": null, "body": "Following some discussion with @DouweM, we've agreed to take `gitlab_projects.rb` into gitlab-ce/lib/gitlab/git somewhere.\n\nThis will allow us to take advantage of `Gitlab::Git::Popen#popen_with_timeout` (although we'll need to add the TERM-then-kill support to that), shorten the tree of subprocesses by one (so no need to propagate signals deeply) and it'll also solve a variety of performance issues (`gitlab-projects` has never been quick to start up).\n\nIt'll go into lib/gitlab/git to keep gitaly-ruby happy /cc @jacobvosmaer-gitlab", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-11-21T17:09:00.545Z", "updated_at": "2017-11-21T17:09:00.545Z", "system": false, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 48211299, "type": null, "body": "Sounds good!\n\nHalf of gitlab-projects is no longer used, this is a good way to clean up. Quicker to do it this way than to wait for these things to be gitaly-migrated, and it will make the eventual migration faster.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-11-21T17:37:10.221Z", "updated_at": "2017-11-21T17:37:10.221Z", "system": false, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 48245849, "type": null, "body": "~GeoP3", "attachment": null, "author": {"id": 192328, "name": "Ernst van Nierop", "username": "ernstvn-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/36b7c478bbe1e079f10202afa9b30c0d?s=80&d=identicon", "web_url": "https://gitlab.com/ernstvn-gitlab"}, "created_at": "2017-11-22T01:06:02.865Z", "updated_at": "2017-11-22T01:06:02.865Z", "system": false, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 50001020, "type": null, "body": "changed milestone to %\"10.4\"", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2017-12-04T15:25:57.999Z", "updated_at": "2017-12-04T15:25:57.999Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 50001093, "type": null, "body": "added ~3081802 label", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2017-12-04T15:26:13.226Z", "updated_at": "2017-12-04T15:26:13.226Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 50154130, "type": null, "body": "added ~2492649 label", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2017-12-05T14:16:50.367Z", "updated_at": "2017-12-05T14:16:50.367Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 50164484, "type": null, "body": "added ~992791 label", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2017-12-05T15:27:28.863Z", "updated_at": "2017-12-05T15:27:28.863Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 50326952, "type": null, "body": "assigned to @jramsay", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2017-12-06T14:48:39.554Z", "updated_at": "2017-12-06T14:48:39.554Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 50684554, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-12-08T19:23:48.151Z", "updated_at": "2017-12-08T19:23:48.151Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 50684572, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-12-08T19:23:56.403Z", "updated_at": "2017-12-08T19:23:56.403Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 50686759, "type": null, "body": "added ~3148397 label", "attachment": null, "author": {"id": 192328, "name": "Ernst van Nierop", "username": "ernstvn-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/36b7c478bbe1e079f10202afa9b30c0d?s=80&d=identicon", "web_url": "https://gitlab.com/ernstvn-gitlab"}, "created_at": "2017-12-08T19:59:51.221Z", "updated_at": "2017-12-08T19:59:51.221Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 50959006, "type": null, "body": "removed milestone", "attachment": null, "author": {"id": 192328, "name": "Ernst van Nierop", "username": "ernstvn-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/36b7c478bbe1e079f10202afa9b30c0d?s=80&d=identicon", "web_url": "https://gitlab.com/ernstvn-gitlab"}, "created_at": "2017-12-11T19:19:20.531Z", "updated_at": "2017-12-11T19:19:20.531Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 50959033, "type": null, "body": "Removing milestone from this version of the issue for clarity on the milestone issue board.", "attachment": null, "author": {"id": 192328, "name": "Ernst van Nierop", "username": "ernstvn-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/36b7c478bbe1e079f10202afa9b30c0d?s=80&d=identicon", "web_url": "https://gitlab.com/ernstvn-gitlab"}, "created_at": "2017-12-11T19:19:38.710Z", "updated_at": "2017-12-11T19:19:38.710Z", "system": false, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 51450552, "type": null, "body": "changed title from **{-Improve subprocess handling-}** to **{+Remove gitlab_projects+}**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-12-14T16:17:29.896Z", "updated_at": "2017-12-14T16:17:29.896Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 51450553, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-12-14T16:17:29.930Z", "updated_at": "2017-12-14T16:17:29.930Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 51450585, "type": null, "body": "removed assignee", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-12-14T16:17:37.277Z", "updated_at": "2017-12-14T16:17:37.277Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 51450628, "type": null, "body": "changed title from **Remove {-gitlab_projects-}** to **Remove {+bin/gitlab_projects and lib/gitlab_projects.rb+}**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-12-14T16:17:52.084Z", "updated_at": "2017-12-14T16:17:52.084Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 51450648, "type": null, "body": "removed ~2559747 label", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-12-14T16:17:58.002Z", "updated_at": "2017-12-14T16:17:58.002Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 54125927, "type": null, "body": "reopened", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-11T10:29:17.731Z", "updated_at": "2018-01-11T10:29:17.731Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 54125948, "type": null, "body": "removed ~3148397 label", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-11T10:29:25.039Z", "updated_at": "2018-01-11T10:29:25.039Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 54125984, "type": null, "body": "removed ~992791 label", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-11T10:29:33.535Z", "updated_at": "2018-01-11T10:29:33.535Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 54126056, "type": null, "body": "mentioned in merge request !179", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-11T10:30:09.940Z", "updated_at": "2018-01-11T10:30:09.940Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 54322267, "type": null, "body": "mentioned in issue #110", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T13:16:07.594Z", "updated_at": "2018-01-12T13:16:07.594Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 54324080, "type": null, "body": "mentioned in merge request !180", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T13:29:20.902Z", "updated_at": "2018-01-12T13:29:20.902Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 54328035, "type": null, "body": "changed milestone to %\"10.5\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T13:54:16.354Z", "updated_at": "2018-01-12T13:54:16.354Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 54332366, "type": null, "body": "closed via commit fa2b35a72fd6b24d807916b786e3d53f57dd7312", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-01-12T14:23:19.849Z", "updated_at": "2018-01-12T14:23:19.849Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 54332368, "type": null, "body": "closed via merge request !180", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-01-12T14:23:19.927Z", "updated_at": "2018-01-12T14:23:19.927Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 54334648, "type": null, "body": "mentioned in commit fa2b35a72fd6b24d807916b786e3d53f57dd7312", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-01-12T14:39:47.561Z", "updated_at": "2018-01-12T14:39:47.561Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 54334880, "type": null, "body": "mentioned in issue #71", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:41:30.214Z", "updated_at": "2018-01-12T14:41:30.214Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 54335584, "type": null, "body": "mentioned in issue #37", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:46:35.282Z", "updated_at": "2018-01-12T14:46:35.282Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 54339222, "type": null, "body": "mentioned in issue #44", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:09:30.938Z", "updated_at": "2018-01-12T15:09:30.938Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}], [{"id": 54340298, "type": null, "body": "mentioned in issue #33", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:18:08.816Z", "updated_at": "2018-01-12T15:18:08.816Z", "system": true, "noteable_id": 7854643, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 113}]]}, {"id": 7804324, "iid": 112, "project_id": 14022, "title": "Include the human repo name in gitlab-shell.log when hashed storage is in use", "description": "When hashed storage is in use, we lose the actual project name from the logs:\n\n```\nI, [2017-11-17T00:53:48.231482 #24817]  INFO -- : Removing project @hashed/6b/86/6b86b273ff34fce19d6b804eff5a3f5747ada4eaa22\nf1d49c01e52ddb7875b4b.git from </var/opt/gitlab/git-data/repositories/@hashed/6b/86/6b86b273ff34fce19d6b804eff5a3f5747ada4ea\na22f1d49c01e52ddb7875b4b.git>.\n```\n\nWe should send both the disk path and the project name for ease of debugging.", "state": "closed", "created_at": "2017-11-17T22:31:39.580Z", "updated_at": "2019-08-07T08:39:27.026Z", "closed_at": "2017-12-18T13:44:36.851Z", "closed_by": null, "labels": ["Geo [DEPRECATED]", "devops::enablement", "group::geo"], "milestone": null, "assignees": [], "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/112", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/112", "notes": "https://gitlab.com/api/v4/projects/14022/issues/112/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/112/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 3, "epic_iid": 21, "discussion": [[{"id": 50651507, "type": null, "body": "changed milestone to %\"10.4\"", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2017-12-08T15:16:43.859Z", "updated_at": "2017-12-08T15:16:43.859Z", "system": true, "noteable_id": 7804324, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 112}], [{"id": 51436643, "type": null, "body": "assigned to @jameslopez", "attachment": null, "author": {"id": 273486, "name": "James Lopez", "username": "jameslopez", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/273486/avatar.png", "web_url": "https://gitlab.com/jameslopez"}, "created_at": "2017-12-14T14:50:04.384Z", "updated_at": "2017-12-14T14:50:04.384Z", "system": true, "noteable_id": 7804324, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 112}], [{"id": 51436682, "type": null, "body": "added ~2526320 label", "attachment": null, "author": {"id": 273486, "name": "James Lopez", "username": "jameslopez", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/273486/avatar.png", "web_url": "https://gitlab.com/jameslopez"}, "created_at": "2017-12-14T14:50:18.857Z", "updated_at": "2017-12-14T14:50:18.857Z", "system": true, "noteable_id": 7804324, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 112}], [{"id": 51829068, "type": null, "body": "@jameslopez note that `lib/gitlab_projects.rb` is being removed gitlab-shell for %10.4 - it's now in `lib/gitlab/git/gitlab_projects.rb` in gitlab-ce.\n\nThis probably affects the implementation of this issue. Feel free to move it to the gitlab-ce issue tracker if that's more apppropriate.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-12-18T13:41:41.197Z", "updated_at": "2017-12-18T13:41:41.197Z", "system": false, "noteable_id": 7804324, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 112}], [{"id": 51829392, "type": null, "body": "Makes sense, for now I'm unassigning myself from here as I picked other issues first.", "attachment": null, "author": {"id": 273486, "name": "James Lopez", "username": "jameslopez", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/273486/avatar.png", "web_url": "https://gitlab.com/jameslopez"}, "created_at": "2017-12-18T13:43:55.091Z", "updated_at": "2017-12-18T13:43:55.091Z", "system": false, "noteable_id": 7804324, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 112}], [{"id": 51829393, "type": null, "body": "removed ~2526320 label", "attachment": null, "author": {"id": 273486, "name": "James Lopez", "username": "jameslopez", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/273486/avatar.png", "web_url": "https://gitlab.com/jameslopez"}, "created_at": "2017-12-18T13:43:55.329Z", "updated_at": "2017-12-18T13:43:55.329Z", "system": true, "noteable_id": 7804324, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 112}], [{"id": 51829394, "type": null, "body": "removed assignee", "attachment": null, "author": {"id": 273486, "name": "James Lopez", "username": "jameslopez", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/273486/avatar.png", "web_url": "https://gitlab.com/jameslopez"}, "created_at": "2017-12-18T13:43:55.524Z", "updated_at": "2017-12-18T13:43:55.524Z", "system": true, "noteable_id": 7804324, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 112}], [{"id": 52305644, "type": null, "body": "removed milestone", "attachment": null, "author": {"id": 192328, "name": "Ernst van Nierop", "username": "ernstvn-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/36b7c478bbe1e079f10202afa9b30c0d?s=80&d=identicon", "web_url": "https://gitlab.com/ernstvn-gitlab"}, "created_at": "2017-12-22T01:16:40.870Z", "updated_at": "2017-12-22T01:16:40.870Z", "system": true, "noteable_id": 7804324, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 112}]]}, {"id": 7235629, "iid": 111, "project_id": 14022, "title": "Only one broadcast message return in post-receive api", "description": "### Summary\n\nThe internal post-receive API returns only 1 broadcast message to the client, even if there are multiple current broadcast messages.\n\nThis means that messages are not presented when they should be.\n\n### Steps to reproduce\n\nSet 2 broadcast messages, and push to a repository via ssh.\n\n### What is the current *bug* behavior?\n\nOnly one of the two broadcast messages is presented.\n\n### What is the expected *correct* behavior?\n\nBoth broadcast messages should appear.\n\n### Relevant logs and/or screenshots\n\nThis is how the broadcast messages look in the UI:\n\n![image](/uploads/687b9224c6b3d7427194747c9a2cea4c/image.png)\n\nBut when doing a git push you see only this:\n\n```\ngit push\nAlready up-to-date.\n[master 5903961] Defect 3 update readme\n 1 file changed, 1 insertion(+), 1 deletion(-)\nCounting objects: 5, done.\nWriting objects: 100% (3/3), 288 bytes | 0 bytes/s, done.\nTotal 3 (delta 0), reused 0 (delta 0)\nremote: \nremote: ========================================================================\nremote: \nremote:                                    2\nremote: \nremote: ========================================================================\nTo gittest001@gittest001.hursley.ibm.com:rickettm-gb/asdfadf.git\n   8fa6cfd..5903961  master -> master\n```\n\n### Output of checks\n\n#### Results of GitLab environment info\n\n<details>\n<summary>Expand for output related to GitLab environment info</summary>\n<pre>\n\n$ bundle exec rake gitlab:env:info RAILS_ENV=production\n\nSystem information\nSystem: \nCurrent User:   gittest001\nUsing RVM:      no\nRuby Version:   2.3.5p376\nGem Version:    2.5.2.1\nBundler Version:1.15.4\nRake Version:   12.0.0\nRedis Version:  4.0.2\nGit Version:    2.14.2\nSidekiq Version:5.0.4\nGo Version:     go1.9.1 linux/amd64\n\nGitLab information\nVersion:        10.0.3\nRevision:       8895150541\nDirectory:      /gitlab/gittest001/gitlab\nDB Adapter:     postgresql\nURL:            https://gittest001.hursley.ibm.com\nHTTP Clone URL: https://gittest001.hursley.ibm.com/some-group/some-project.git\nSSH Clone URL:  gittest001@gittest001.hursley.ibm.com:some-group/some-project.git\nUsing LDAP:     yes\nUsing Omniauth: no\n\nGitLab Shell\nVersion:        5.9.0\nRepository storage paths:\n- default:      /gitlab/gittest001/repositories\nHooks:          /gitlab/gittest001/gitlab-shell/hooks\nGit:            /usr/local/bin/git\n\n</pre>\n</details>\n\n#### Results of GitLab application Check\n\n<details>\n<summary>Expand for output related to the GitLab application check</summary>\n<pre>\n\n$ bundle exec rake gitlab:check RAILS_ENV=production\nChecking GitLab Shell ...\n\nGitLab Shell version >= 5.9.0 ? ... OK (5.9.0)\nRepo base directory exists?\ndefault... yes\nRepo storage directories are symlinks?\ndefault... no\nRepo paths owned by gittest001:root, or gittest001:gittest001?\ndefault... yes\nRepo paths access is drwxrws---?\ndefault... yes\nhooks directories in repos are links: ... \nRicketts, M (Mike) / asdfadf ... ok\nRunning /gitlab/gittest001/gitlab-shell/bin/check\nCheck GitLab API access: OK\nRedis available via internal API: OK\n\nAccess to /gitlab/gittest001/.ssh/authorized_keys: OK\ngitlab-shell self-check successful\n\nChecking GitLab Shell ... Finished\n\nChecking Sidekiq ...\n\nRunning? ... yes\nNumber of Sidekiq processes ... 1\n\nChecking Sidekiq ... Finished\n\nReply by email is disabled in config/gitlab.yml\nChecking LDAP ...\n\nServer: ldapmain\nnot verifying SSL hostname of LDAPS server 'bluepages.ibm.com:636'\nLDAP authentication... Success\nLDAP users with access to your GitLab server (only showing the first 10 results)\n        \nChecking LDAP ... Finished\n\nChecking GitLab ...\n\nGit configured correctly? ... yes\nDatabase config exists? ... yes\nll migrations up? ... yes\nDatabase contains orphaned GroupMembers? ... no\nGitLab config exists? ... yes\nGitLab config up to date? ... yes\nLog directory writable? ... yes\nTmp directory writable? ... yes\nUploads directory exists? ... yes\nUploads directory has correct permissions? ... yes\nUploads directory tmp has correct permissions? ... skipped (no tmp uploads folder yet)\nInit script exists? ... yes\nInit script up-to-date? ... yes\nProjects have namespace: ... \nRicketts, M (Mike) / asdfadf ... yes\nRedis version >= 2.8.0? ... yes\nRuby version >= 2.3.3 ? ... yes (2.3.5)\nGit version >= 2.7.3 ? ... yes (2.14.2)\nGit user has default SSH configuration? ... no\n  Try fixing it:\n  mkdir ~/gitlab-check-backup-1508242506\n  sudo mv /gitlab/gittest001/.ssh/authorized_keys.lock ~/gitlab-check-backup-1508242506\n  For more information see:\n  doc/ssh/README.md in section \"SSH on the GitLab server\"\n  Please fix the error above and rerun the checks.\nActive users: ... 8\n\nChecking GitLab ... Finished\n\n</pre>\n</details>\n\n### Possible fixes\n\nlib/api/internal.rb line 104 is the problem, it needs to return all current broadcast messages, not just the last one (ie do what get /broadcast_messages does, not what get /broadcast_message does)\n\nA corresponding change may be needed in gitlab-shell, and in anything else that uses this API.", "state": "opened", "created_at": "2017-10-17T12:20:01.008Z", "updated_at": "2018-01-05T11:36:08.938Z", "closed_at": null, "closed_by": null, "labels": ["Accepting merge requests", "feature"], "milestone": null, "assignees": [], "author": {"id": 118982, "name": "Mike Ricketts", "username": "rickettm", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/118982/avatar.png", "web_url": "https://gitlab.com/rickettm"}, "assignee": null, "user_notes_count": 8, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/111", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/111", "notes": "https://gitlab.com/api/v4/projects/14022/issues/111/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/111/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 43692591, "type": null, "body": "@rickettm Thanks for the report. It looks like this change has to be made in gitlab-shell. It currently is built to call `/broadcast_message` and not `/broadcast_messages` and handle the one message in the payload.\n- https://gitlab.com/gitlab-org/gitlab-shell/blob/76e75549b9bec9dee1e856969ef169a4450b3f30/lib/gitlab_net.rb#L73\n\nWe should move this issue there and convert it to a feature proposal to support multiple broadcast messages in the post-receive.", "attachment": null, "author": {"id": 419655, "name": "Mark Fletcher", "username": "markglenfletcher", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/419655/avatar.png", "web_url": "https://gitlab.com/markglenfletcher"}, "created_at": "2017-10-17T14:01:15.738Z", "updated_at": "2017-10-17T14:01:15.738Z", "system": false, "noteable_id": 7235629, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 111}], [{"id": 43692766, "type": null, "body": "@DouweM What do you think about adding ~\"Accepting Merge Requests\" for this one?", "attachment": null, "author": {"id": 419655, "name": "Mark Fletcher", "username": "markglenfletcher", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/419655/avatar.png", "web_url": "https://gitlab.com/markglenfletcher"}, "created_at": "2017-10-17T14:02:24.338Z", "updated_at": "2017-10-17T14:02:24.338Z", "system": false, "noteable_id": 7235629, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 111}], [{"id": 43692770, "type": null, "body": "added ~243322 label", "attachment": null, "author": {"id": 419655, "name": "Mark Fletcher", "username": "markglenfletcher", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/419655/avatar.png", "web_url": "https://gitlab.com/markglenfletcher"}, "created_at": "2017-10-17T14:02:24.939Z", "updated_at": "2017-10-17T14:02:24.939Z", "system": true, "noteable_id": 7235629, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 111}], [{"id": 43693824, "type": null, "body": "@markglenfletcher Sure!", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-10-17T14:08:28.559Z", "updated_at": "2017-10-17T14:08:28.559Z", "system": false, "noteable_id": 7235629, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 111}], [{"id": 43693825, "type": null, "body": "added ~1890178 label", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-10-17T14:08:29.125Z", "updated_at": "2017-10-17T14:08:29.125Z", "system": true, "noteable_id": 7235629, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 111}], [{"id": 43973449, "type": null, "body": "@markglenfletcher I may well be missing something... but I don't think this can be fixed in gitlab-shell alone.\n\nAs far as I can tell, the broadcast_message api in gitlab-shell is only called from `fallback_post_receive`, which is only called if the GitLab version is too old to have a `post_receive` method.  Otherwise, gitlab-shell uses the `broadcast_message` member of the response to the `post-receive` api - which in turn is only returning a single mssage.\n\nI think that for this to work, GitLab's internal post-receive API needs to be updated to return a list of active broadcast messages rather than just one, AND gitlab-shell needs to be updated to print all the returned ones.", "attachment": null, "author": {"id": 118982, "name": "Mike Ricketts", "username": "rickettm", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/118982/avatar.png", "web_url": "https://gitlab.com/rickettm"}, "created_at": "2017-10-19T15:38:10.897Z", "updated_at": "2017-10-19T15:38:10.897Z", "system": false, "noteable_id": 7235629, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 111}], [{"id": 43987163, "type": null, "body": "@rickettm `/broadcast_messages` will return a list of active messages. Shell can be changed to call that endpoint and cope with multiple messages in the response.\n\n```\ncurl http://gitlab.example.com/api/v4/internal/broadcast_message\\?secret_token\\=shell_token\n```\n\n```json\n{\n  \"message\": \"2\",\n  \"starts_at\": \"2017-10-19T17:40:00.000Z\",\n  \"ends_at\": \"2017-10-20T17:40:00.000Z\",\n  \"color\": \"#e75e40\",\n  \"font\": \"#ffffff\",\n  \"id\": 2,\n  \"active\": true\n}\n```\n\n```\ncurl http://gitlab.example.com/api/v4/internal/broadcast_messages\\?secret_token\\=shell_token\n```\n\n```json\n[\n  {\n    \"message\": \"1\",\n    \"starts_at\": \"2017-10-19T17:40:00.000Z\",\n    \"ends_at\": \"2017-10-20T17:40:00.000Z\",\n    \"color\": \"#e75e40\",\n    \"font\": \"#ffffff\",\n    \"id\": 1,\n    \"active\": true\n  },\n  {\n    \"message\": \"2\",\n    \"starts_at\": \"2017-10-19T17:40:00.000Z\",\n    \"ends_at\": \"2017-10-20T17:40:00.000Z\",\n    \"color\": \"#e75e40\",\n    \"font\": \"#ffffff\",\n    \"id\": 2,\n    \"active\": true\n  }\n]\n```", "attachment": null, "author": {"id": 419655, "name": "Mark Fletcher", "username": "markglenfletcher", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/419655/avatar.png", "web_url": "https://gitlab.com/markglenfletcher"}, "created_at": "2017-10-19T17:49:00.489Z", "updated_at": "2017-10-19T17:49:00.489Z", "system": false, "noteable_id": 7235629, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 111}], [{"id": 44032605, "type": null, "body": "@markglenfletcher So rather than calling /api/v4/internal/post_receive (which is what it currently does), the shell would need to call both /api/v4/internal/post_receive AND /api/v4/internal/broadcast_messages ?\n\nThis feels like the wrong way to fix this - my thinking is that it would be better to change the /api/v4/internal/post_receive api to return all the broadcast messages, rather than just one.\n\nI did a quick test of changing gitlab_net.rb around line 73 to call broadcast_messages and this had no effect as this code is never called.", "attachment": null, "author": {"id": 118982, "name": "Mike Ricketts", "username": "rickettm", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/118982/avatar.png", "web_url": "https://gitlab.com/rickettm"}, "created_at": "2017-10-20T07:49:38.169Z", "updated_at": "2017-10-20T07:49:38.169Z", "system": false, "noteable_id": 7235629, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 111}], [{"id": 44047929, "type": null, "body": "@rickettm Sorry, you're right. The payload from the call to internal `post_receive` needs to be modified as well as the fallback. So this will require a change in both projects", "attachment": null, "author": {"id": 419655, "name": "Mark Fletcher", "username": "markglenfletcher", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/419655/avatar.png", "web_url": "https://gitlab.com/markglenfletcher"}, "created_at": "2017-10-20T10:06:05.978Z", "updated_at": "2017-10-22T06:23:44.215Z", "system": false, "noteable_id": 7235629, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 111}], [{"id": 53441969, "type": null, "body": "@markglenfletcher Thanks - that was my thinking too.\nI'm happy to have a go at making the changes, but since both projects need to be changed at the same time I'm not sure how best to proceed.\n\nCould this issue be moved back to gitlab-ce to make the changes there, and us #107 for the changes in gitlab-shell ?\n\nHow does one enforce that the matching changes are shipped out at the same time?", "attachment": null, "author": {"id": 118982, "name": "Mike Ricketts", "username": "rickettm", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/118982/avatar.png", "web_url": "https://gitlab.com/rickettm"}, "created_at": "2018-01-05T11:36:08.895Z", "updated_at": "2018-01-05T11:36:08.895Z", "system": false, "noteable_id": 7235629, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 111}]]}, {"id": 6998470, "iid": 110, "project_id": 14022, "title": "GitlabReferenceCounter misuse", "description": "In https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/164 , `GitlabReferenceCounter` was altered to use `gl_repository` as the key instead of `repo_path` in the pre-receive and post-receive hooks - along with a fallback to the `repo_path` if the internal API returns a 404 (older version of GitLab).\n\nHowever, users in gitlab-shell such as `mv_storage` still initialize the reference counter with `repo_path`. Having a reference counter that can increment / decrement two different references depending on external factors is not useful at all.\n\nI'm not sure why it was changed to `gl_repository` but I think we should probably change it back to `repo_path` throughout. I probably haven't seen all the missed sites.\n\nWill changes be needed in Gitaly as well? \n\n/cc @eReGeBe @DouweM", "state": "closed", "created_at": "2017-09-28T12:44:13.999Z", "updated_at": "2018-01-12T13:16:09.693Z", "closed_at": "2018-01-12T13:16:09.688Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 4, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/110", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/110", "notes": "https://gitlab.com/api/v4/projects/14022/issues/110/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/110/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 41774182, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-09-28T12:44:48.842Z", "updated_at": "2017-09-28T12:44:48.842Z", "system": true, "noteable_id": 6998470, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 110}], [{"id": 41775004, "type": null, "body": "Also of note in this issue is that the intent of !164 was to get a \"redis-free gitlab-shell\".\n\nSince gitlab-shell still uses `GitlabReferenceCounter` directly, however we fix that usage will mean we're still not redis-free.\n\nIt doesn't look like the internal API has an endpoint to read the value of the reference count?", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-09-28T12:50:46.130Z", "updated_at": "2017-09-28T12:50:46.130Z", "system": false, "noteable_id": 6998470, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 110}], [{"id": 41826495, "type": null, "body": "@nick.thomas the purpose of !164 was to remove the need for Redis only on the NFS boxes, which it does, since those don't run `gitlab_projects` commands. However, this is indeed an overlook that leaves us in a state of inconsistency. I think what we should do is complete the move to `gl_repository` by sending it as an extra argument to GitlabProjects#mv_storage and use that as the reference counter id if present. /cc @jacobvosmaer-gitlab", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2017-09-28T19:32:50.523Z", "updated_at": "2017-09-28T19:32:50.523Z", "system": false, "noteable_id": 6998470, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 110}], [{"id": 41827580, "type": null, "body": "> Having a reference counter that can increment / decrement two different references depending on external factors is not useful at all.\n\nTo comment on this, if my logic is correct then the solution I proposed above will be consistent, since the next gitlab-rails version will pass `gl_repository` to `bin/gitlab-projects mv-storage` and also have the new API that makes the reference counter work with `gl_repository` on the hooks, so there's no need for a middle stage for the implementation.", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2017-09-28T19:48:14.274Z", "updated_at": "2017-09-28T19:48:14.274Z", "system": false, "noteable_id": 6998470, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 110}], [{"id": 54322258, "type": null, "body": "Closing this issue as we'll be removing gitlab_projects in #113", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T13:16:01.537Z", "updated_at": "2018-01-12T13:16:01.537Z", "system": false, "noteable_id": 6998470, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 110}], [{"id": 54322272, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T13:16:09.734Z", "updated_at": "2018-01-12T13:16:09.734Z", "system": true, "noteable_id": 6998470, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 110}]]}, {"id": 6964326, "iid": 109, "project_id": 14022, "title": "tag v5.9.2 reports VERSION as 5.9.1", "description": "I've getting warnings in my installation from source that Gitlab requires shell version 5.9.2 while I have 5.9.1. \n\nI think I've traced it back to the VERSION file which incorrectly reports 5.9.1 at commit bee2bcc5546031aa66d0a3e028bb709282275254 for tag v5.9.2.\n\nThe last commit to that file was 63ac5167f45ee5474e02630cc24d194d2c309d04 that's bumped it to 5.9.1 last time and a 5.9.2 bump seems to have slipped through the cracks.", "state": "closed", "created_at": "2017-09-26T16:01:06.051Z", "updated_at": "2017-09-27T14:32:49.777Z", "closed_at": "2017-09-27T10:37:35.574Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 67704, "name": "Maverik", "username": "maverik", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/97e3af512b76d08790c8a9c6c9bce18b?s=80&d=identicon", "web_url": "https://gitlab.com/maverik"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/109", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/109", "notes": "https://gitlab.com/api/v4/projects/14022/issues/109/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/109/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 41480442, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 67704, "name": "Maverik", "username": "maverik", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/97e3af512b76d08790c8a9c6c9bce18b?s=80&d=identicon", "web_url": "https://gitlab.com/maverik"}, "created_at": "2017-09-26T16:01:49.401Z", "updated_at": "2017-09-26T16:01:49.401Z", "system": true, "noteable_id": 6964326, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 109}], [{"id": 41606578, "type": null, "body": "Thanks for reporting, @maverik!\n\n@reprazent fixed this in https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/170, but we can't change the published tag :disappointed:", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-09-27T10:37:30.000Z", "updated_at": "2017-09-27T10:37:30.000Z", "system": false, "noteable_id": 6964326, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 109}], [{"id": 41606590, "type": null, "body": "closed", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-09-27T10:37:35.618Z", "updated_at": "2017-09-27T10:37:35.618Z", "system": true, "noteable_id": 6964326, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 109}], [{"id": 41647414, "type": null, "body": "No problem. Fortunately it's only a warning that I guess many don't even notice :) Thanks for the quick fix!", "attachment": null, "author": {"id": 67704, "name": "Maverik", "username": "maverik", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/97e3af512b76d08790c8a9c6c9bce18b?s=80&d=identicon", "web_url": "https://gitlab.com/maverik"}, "created_at": "2017-09-27T14:32:49.769Z", "updated_at": "2017-09-27T14:32:49.769Z", "system": false, "noteable_id": 6964326, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 109}]]}, {"id": 6911663, "iid": 108, "project_id": 14022, "title": "pre-receive hook: undefined local variable or method 'repo_path'", "description": "## Error message\nUpon push:\n```\n$ git push devel HEAD\nCounting objects: 3, done.\nDelta compression using up to 4 threads.\nCompressing objects: 100% (3/3), done.\nWriting objects: 100% (3/3), 280 bytes | 0 bytes/s, done.\nTotal 3 (delta 2), reused 0 (delta 0)\nremote: hooks/pre-receive:17:in `rescue in increase_reference_counter': undefined local variable or method `repo_path' for main:Object (NameError)\nremote:     from hooks/pre-receive:13:in `increase_reference_counter'\nremote:     from hooks/pre-receive:31:in `<main>'\nTo gitlab-devel.example.com:jreinhart/test-project.git\n! [remote rejected] HEAD -> junk (pre-receive hook declined)\nerror: failed to push some refs to 'git@gitlab-devel.example.com:jreinhart/test-project.git'\n```\n\n## Version\n- `gitlab-shell`: 5.9.1 (47924c460a288ab145c4448e8a6be7eea70a8a6d)\n- `gitlab`: v9.5.2\n\n\n## Description\n\n```ruby\nrefs = $stdin.read\nkey_id = ENV.delete('GL_ID')\nprotocol = ENV.delete('GL_PROTOCOL')\nrepo_path = Dir.pwd\ngl_repository = ENV['GL_REPOSITORY']\n\ndef increase_reference_counter(gl_repository)\n  result = GitlabNet.new.pre_receive(gl_repository)\n\n  result['reference_counter_increased']\nrescue GitlabNet::NotFound\n  GitlabReferenceCounter.new(repo_path).increase       # <<<<<< repo_path not available\nend\n```\n\nIf `gitlab-shell` is newer than `gitlab` and the `/pre_receive` API doesn't exist yet, then `GitlabNet::NotFound` is raised. The problem is, this `rescue` statement will attempt to access `repo_path`, which [as far as I can tell](https://stackoverflow.com/a/1047482/119527) is not in scope.\n\n## Fixes\n\n### Option A\nMake the variable global:\n```\n$repo_path = Dir.pwd\n$gl_repository = ENV['GL_REPOSITORY']\n```\n\n### Option B\nPass `repo_path` as a parameter:\n```\ndef increase_reference_counter(gl_repository, repo_path)\n```", "state": "closed", "created_at": "2017-09-22T01:35:17.769Z", "updated_at": "2017-12-01T19:36:24.946Z", "closed_at": "2017-09-22T09:48:35.007Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 90962, "name": "Jonathon Reinhart", "username": "JonathonReinhart", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/90962/1916566_sm.jpg", "web_url": "https://gitlab.com/JonathonReinhart"}], "author": {"id": 90962, "name": "Jonathon Reinhart", "username": "JonathonReinhart", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/90962/1916566_sm.jpg", "web_url": "https://gitlab.com/JonathonReinhart"}, "assignee": {"id": 90962, "name": "Jonathon Reinhart", "username": "JonathonReinhart", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/90962/1916566_sm.jpg", "web_url": "https://gitlab.com/JonathonReinhart"}, "user_notes_count": 2, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/108", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/108", "notes": "https://gitlab.com/api/v4/projects/14022/issues/108/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/108/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 41053192, "type": null, "body": "This was broken in commit c658360e94ea31a411923dbd14591c41fbecffdd.\n\ncc @eReGeBe", "attachment": null, "author": {"id": 90962, "name": "Jonathon Reinhart", "username": "JonathonReinhart", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/90962/1916566_sm.jpg", "web_url": "https://gitlab.com/JonathonReinhart"}, "created_at": "2017-09-22T01:38:14.810Z", "updated_at": "2017-09-22T01:38:14.810Z", "system": false, "noteable_id": 6911663, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 108}], [{"id": 41053251, "type": null, "body": "mentioned in merge request !166", "attachment": null, "author": {"id": 90962, "name": "Jonathon Reinhart", "username": "JonathonReinhart", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/90962/1916566_sm.jpg", "web_url": "https://gitlab.com/JonathonReinhart"}, "created_at": "2017-09-22T01:40:23.726Z", "updated_at": "2017-09-22T01:40:23.726Z", "system": true, "noteable_id": 6911663, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 108}], [{"id": 41053321, "type": null, "body": "mentioned in merge request !169", "attachment": null, "author": {"id": 90962, "name": "Jonathon Reinhart", "username": "JonathonReinhart", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/90962/1916566_sm.jpg", "web_url": "https://gitlab.com/JonathonReinhart"}, "created_at": "2017-09-22T01:42:40.129Z", "updated_at": "2017-09-22T01:42:40.129Z", "system": true, "noteable_id": 6911663, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 108}], [{"id": 41056272, "type": null, "body": "assigned to @eReGeBe", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2017-09-22T02:28:39.988Z", "updated_at": "2017-09-22T02:28:39.988Z", "system": true, "noteable_id": 6911663, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 108}], [{"id": 41056342, "type": null, "body": "@eReGeBe I went ahead and fixed this in !169.", "attachment": null, "author": {"id": 90962, "name": "Jonathon Reinhart", "username": "JonathonReinhart", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/90962/1916566_sm.jpg", "web_url": "https://gitlab.com/JonathonReinhart"}, "created_at": "2017-09-22T02:30:08.185Z", "updated_at": "2017-09-22T02:30:08.185Z", "system": false, "noteable_id": 6911663, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 108}], [{"id": 41056395, "type": null, "body": "assigned to @JonathonReinhart and unassigned @eReGeBe", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2017-09-22T02:32:12.641Z", "updated_at": "2017-09-22T02:32:12.641Z", "system": true, "noteable_id": 6911663, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 108}], [{"id": 41095319, "type": null, "body": "closed via merge request !169", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-09-22T09:48:34.905Z", "updated_at": "2017-09-22T09:48:34.905Z", "system": true, "noteable_id": 6911663, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 108}], [{"id": 41095321, "type": null, "body": "closed via commit bee2bcc5546031aa66d0a3e028bb709282275254", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-09-22T09:48:35.083Z", "updated_at": "2017-09-22T09:48:35.083Z", "system": true, "noteable_id": 6911663, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 108}], [{"id": 49799998, "type": null, "body": "mentioned in commit nick.thomas/gitlab-shell-mirror@bee2bcc5546031aa66d0a3e028bb709282275254", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-12-01T19:36:24.903Z", "updated_at": "2017-12-01T19:36:24.903Z", "system": true, "noteable_id": 6911663, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 108}]]}, {"id": 6893286, "iid": 107, "project_id": 14022, "title": "When multiple broadcast messages are active, gitlab-shell only retrieves one", "description": "For a while now the GitLab UI has supported displaying multiple broadcast messages, if there is more than one active at once.\n\nHowever, users who rarely or never log in to the UI will only ever see one of them presented via the git commandline.", "state": "opened", "created_at": "2017-09-20T16:30:07.865Z", "updated_at": "2018-01-05T11:36:16.502Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 118982, "name": "Mike Ricketts", "username": "rickettm", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/118982/avatar.png", "web_url": "https://gitlab.com/rickettm"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/107", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/107", "notes": "https://gitlab.com/api/v4/projects/14022/issues/107/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/107/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 53441981, "type": null, "body": "mentioned in issue #111", "attachment": null, "author": {"id": 118982, "name": "Mike Ricketts", "username": "rickettm", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/118982/avatar.png", "web_url": "https://gitlab.com/rickettm"}, "created_at": "2018-01-05T11:36:16.484Z", "updated_at": "2018-01-05T11:36:16.484Z", "system": true, "noteable_id": 6893286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 107}]]}, {"id": 6800219, "iid": 106, "project_id": 14022, "title": "Update hook is slow; runs once per ref pushed", "description": "We noticed in a customer ticket (ZD: https://gitlab.zendesk.com/agent/tickets/82084) that if you push a new repo with 2000 new refs, `git-receive-pack` runs the update hook 2000 times, which reads `config.yml` repeatedly and checks for custom hooks when there are none.", "state": "closed", "created_at": "2017-09-13T04:52:18.307Z", "updated_at": "2019-04-04T14:31:08.793Z", "closed_at": "2019-04-04T14:31:08.708Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": [], "milestone": null, "assignees": [], "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/106", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/106", "notes": "https://gitlab.com/api/v4/projects/14022/issues/106/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/106/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 54346802, "type": null, "body": "mentioned in issue #74", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-01-12T16:05:33.895Z", "updated_at": "2018-01-12T16:05:33.895Z", "system": true, "noteable_id": 6800219, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 106}], [{"id": 157464353, "type": null, "body": "moved to gitaly#1595", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:31:08.839Z", "updated_at": "2019-04-04T14:31:08.839Z", "system": true, "noteable_id": 6800219, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 106}]]}, {"id": 6702992, "iid": 105, "project_id": 14022, "title": "Cannot find package \"context\"", "description": "Version:\n5.8.0\n\nSteps:\n```shell\n[git@localhost gitlab-shell]$ ./bin/compile\n```\n\nActual result:\n```shell\ngo_build/src/gitlab.com/gitlab-org/gitlab-shell/go/internal/handler/receive_pack.go:4:2: cannot find package \"context\" in any of:\n\t/home/git/gitlab-shell/go_build/src/gitlab.com/gitlab-org/gitlab-shell/go/vendor/context (vendor tree)\n\t/usr/lib/golang/src/context (from $GOROOT)\n\t/home/git/gitlab-shell/go_build/src/context (from $GOPATH)\ncommand failed: {\"GOPATH\"=>\"/home/git/gitlab-shell/go_build\", \"GO15VENDOREXPERIMENT\"=>\"1\"} go install gitlab.com/gitlab-org/gitlab-shell/go/cmd/...\n```\n\nExpect result:\nno error\n\nTemporary solution:\n```shell\n[git@localhost gitlab-shell]$ ln -s /home/git/gitlab-shell/go/vendor/golang.org/x/net/context /home/git/gitlab-shell/go/vendor\n```\n\nThere's also the same issue when executing:\n```shell\n[git@localhost gitlab]$ bundle exec rake gitlab:shell:install REDIS_URL=unix:/opt/rh/rh-redis32/root/var/run/redis/redis.sock RAILS_ENV=production SKIP_STORAGE_VALIDATION=true\n```", "state": "opened", "created_at": "2017-09-07T01:09:47.503Z", "updated_at": "2018-03-10T18:54:20.636Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1592239, "name": "vasintalana", "username": "vasintalana", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/88383874525e42d570c5f79c31547c3b?s=80&d=identicon", "web_url": "https://gitlab.com/vasintalana"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/105", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/105", "notes": "https://gitlab.com/api/v4/projects/14022/issues/105/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/105/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 62552334, "type": null, "body": "Hey could it be that you go version is below 1.7?", "attachment": null, "author": {"id": 270937, "name": "Fritz Otlinghaus", "username": "scriptkiddi200", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/97ee894c6abce6e7802e365917fe9bac?s=80&d=identicon", "web_url": "https://gitlab.com/scriptkiddi200"}, "created_at": "2018-03-10T18:54:20.618Z", "updated_at": "2018-03-10T18:54:20.618Z", "system": false, "noteable_id": 6702992, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 105}]]}, {"id": 6638353, "iid": 104, "project_id": 14022, "title": "list-keys is broken", "description": "`gitlab-keys list-keys` outputs nothing at all.\nThe fix is obvious. I created a [simple patch](https://gitlab.com/otheus.uibk/gitlab-shell/commit/36f597809409a93a509303f0bc92e83f178f45bb), which fails CI:\n```\nrspec ./spec/gitlab_keys_spec.rb:75 # GitlabKeys list_keys adds a key and lists it\n - - [31/Aug/2017:21:23:44 UTC] \"GET /path HTTP/1.1\" 200 23\n- -> /path\nCoverage report generated for RSpec to /builds/otheus.uibk/gitlab-shell/coverage. 2811 / 3940 LOC (71.35%) covered.\n[2017-08-31 21:23:45] INFO  going to shutdown ...\n[2017-08-31 21:23:45] INFO  HTTPUNIXServer#start done\n```\n\nThe spec file is incorrectly written. Obviously, \"list-keys\" should output a list to STDOUT in the same way \"list-key-ids\" does. But the spec writer expected functional output. Someone needs to review this and patch spec (but will that break something else??)", "state": "opened", "created_at": "2017-09-01T09:24:57.199Z", "updated_at": "2017-09-01T09:24:57.199Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1083216, "name": "otheus", "username": "otheus.uibk", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/f223e6842a7683aa71cbe0110da8d8d4?s=80&d=identicon", "web_url": "https://gitlab.com/otheus.uibk"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/104", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/104", "notes": "https://gitlab.com/api/v4/projects/14022/issues/104/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/104/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 6601761, "iid": 103, "project_id": 14022, "title": "Red herring warning message with the fetch_remote gitlab-projects call", "description": "### Summary\n\nA message like this is always outputted by the SSH client when it fetches a remote using the newly-added (https://gitlab.com/gitlab-org/gitlab-ee/issues/98) known_hosts support:\n\n```\nFailed to add the ECDSA host key for IP address 'x.y.z.w' to the list of known hosts (/tmp/gitlab-shell-known-hostsXXXXX).\n```\nSometimes this message is surfaced to the user (e.g., pull repository mirroring when the fetch fails for some reason). It attracts attention and makes people think it's the problem, when it's actually a harmless warning:\n\nWhen the import_url contains a hostname, we generate a known_hosts file containing entries just for the hostnames. SSH's default behaviour is to add the host keys for the *IP* the hostname resolves to, if it's not already there. Since the temporary file is mode 0400, it can't do that, and the above warning message is shown.\n\n### Steps to reproduce\n\n### What is the current *bug* behavior?\n\nMisleading error message shown\n\n### What is the expected *correct* behavior?\n\nNo warning message\n\n\n### Possible fixes\n\nWe can either find the option that turns off the IP-known-host-writing behaviour, or we can just make the known_hosts file mode 0600.", "state": "closed", "created_at": "2017-08-29T10:15:37.739Z", "updated_at": "2018-01-12T15:05:43.911Z", "closed_at": "2018-01-12T15:05:43.746Z", "closed_by": null, "labels": ["bug"], "milestone": null, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/103", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/103", "notes": "https://gitlab.com/api/v4/projects/14022/issues/103/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/103/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 54338568, "type": null, "body": "This code has been moved to gitlab-ce so I'll move this issue there as well.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:05:19.230Z", "updated_at": "2018-01-12T15:05:19.230Z", "system": false, "noteable_id": 6601761, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 103}], [{"id": 54338624, "type": null, "body": "moved to gitlab-com/support-forum#2909", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:05:43.717Z", "updated_at": "2018-01-12T15:05:43.717Z", "system": true, "noteable_id": 6601761, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 103}]]}, {"id": 6394022, "iid": 102, "project_id": 14022, "title": "Backport bugfix to 5.3.x and release in 9.4.x?", "description": "Zendesk: https://gitlab.zendesk.com/agent/tickets/80801\n\nThere is a bug in 5.3.1 which was fixed in https://gitlab.com/gitlab-org/gitlab-shell/commit/f5591f68c1439eda836460e0dec44f610709a5b8. The bug was at https://gitlab.com/gitlab-org/gitlab-shell/commit/f5591f68c1439eda836460e0dec44f610709a5b8#a7adaf7b743bcb71d77bbd080d651151a0e04cb3_43_42 where the 5th arg `nil` was missing. This caused the following error for a customer on rebase:\n\n```\nJuly 31, 2017 20:35 -> ERROR -> MergeRequests::RebaseService error (test/test!24): Failed to push rebased branch with `/opt/gitlab/embedded/bin/git push -f origin gitlab_ci_migration`: \nJuly 31, 2017 20:35 -> ERROR -> MergeRequests::RebaseService error (test/!24): remote: /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_access_status.rb:6:in `initialize': wrong number of arguments (given 4, expected 5) (ArgumentError) \nremote: from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_net.rb:42:in `new' \nremote: from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_net.rb:42:in `check_access' \nremote: from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_access.rb:31:in `block in exec' \nremote: from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_metrics.rb:47:in `measure' \nremote: from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_access.rb:25:in `exec' \nremote: from hooks/pre-receive:24:in `<main>' \nTo /var/opt/gitlab/git-data/repositories/212568159/system_test.git \n! [remote rejected] gitlab_ci_migration -> gitlab_ci_migration (pre-receive hook declined) \nerror: failed to push some refs to '/var/opt/gitlab/git-data/repositories/212568159/system_test.git' \nJuly 31, 2017 20:39 -> ERROR -> MergeRequests::RebaseService error (test/test!24): Failed to push rebased branch with `/opt/gitlab/embedded/bin/git push -f origin gitlab_ci_migration`: \nJuly 31, 2017 20:39 -> ERROR -> MergeRequests::RebaseService error (test/test!24): remote: /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_access_status.rb:6:in `initialize': wrong number of arguments (given 4, expected 5) (ArgumentError) \nremote: from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_net.rb:42:in `new' \nremote: from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_net.rb:42:in `check_access' \nremote: from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_access.rb:31:in `block in exec' \nremote: from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_metrics.rb:47:in `measure' \nremote: from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_access.rb:25:in `exec' \nremote: from hooks/pre-receive:24:in `<main>' \nTo /var/opt/gitlab/git-data/repositories/212568159/test.git \n! [remote rejected] gitlab_ci_migration -> gitlab_ci_migration (pre-receive hook declined) \nerror: failed to push some refs to '/var/opt/gitlab/git-data/repositories/212568159/test.git'\n```\n\nCurrently, the fix is in shell 5.6.0+ which isn't released in any GitLab version yet. I presume then that it would only drop in 9.5.0 which is a ways away yet and the customer may not be able to upgrade right away. Does it make sense to backport this and release shell 5.3.2 and then GitLab 9.4.4? cc/ @stanhu since you fixed the bug.", "state": "closed", "created_at": "2017-08-08T21:30:04.451Z", "updated_at": "2017-09-08T14:49:08.182Z", "closed_at": "2017-09-08T14:49:08.102Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "assignee": null, "user_notes_count": 7, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/102", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/102", "notes": "https://gitlab.com/api/v4/projects/14022/issues/102/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/102/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 37104745, "type": null, "body": "Yeah, I think it makes sense to backport this fix. However, if you're hitting this error that means you're already getting an API failure, so I think the end result is the same, with an uglier error message.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-08-08T21:34:28.302Z", "updated_at": "2017-08-08T21:34:28.302Z", "system": false, "noteable_id": 6394022, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 102}], [{"id": 37104870, "type": null, "body": "@rspeicher Mind doing the honors?", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-08-08T21:37:45.164Z", "updated_at": "2017-08-08T21:37:45.164Z", "system": false, "noteable_id": 6394022, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 102}], [{"id": 37104891, "type": null, "body": "I wonder if the root cause is actually due to https://gitlab.com/gitlab-org/gitlab-ee/issues/3071, which I think it is because the user is working with a rebase on a forked project.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-08-08T21:38:22.915Z", "updated_at": "2017-08-08T21:38:22.915Z", "system": false, "noteable_id": 6394022, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 102}], [{"id": 37104956, "type": null, "body": "@stanhu \n\n> However, if you're hitting this error that means you're already getting an API failure\n\nAbsolutely. I've asked the customer for more details because it's either an API access issue or a permission issue. It definitely could be trying to rebase on a fork like you mention. \n\nIt would be nice to differentiate the error message a bit more. There's a big difference between 'API is inaccessible' and some specific error that the API returned. But that's for another issue.", "attachment": null, "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "created_at": "2017-08-08T21:39:47.244Z", "updated_at": "2017-08-08T21:39:47.244Z", "system": false, "noteable_id": 6394022, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 102}], [{"id": 37106162, "type": null, "body": "> Mind doing the honors?\n\n@stanhu Sorry, which part? Is it just adding the 5th parameter to https://gitlab.com/gitlab-org/gitlab-shell/commit/f5591f68c1439eda836460e0dec44f610709a5b8#a7adaf7b743bcb71d77bbd080d651151a0e04cb3_43_42?\n\nAlso I'm not sure how to backport in this project since we don't have stable branches.", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2017-08-08T21:54:16.277Z", "updated_at": "2017-08-08T21:54:16.277Z", "system": false, "noteable_id": 6394022, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 102}], [{"id": 37108230, "type": null, "body": "Yes, just the 5th parameter.\n\nI added a `5-3-stable` branch for gitlab-shell for !160. :)", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-08-08T22:34:18.551Z", "updated_at": "2017-08-08T22:34:18.551Z", "system": false, "noteable_id": 6394022, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 102}], [{"id": 37181373, "type": null, "body": "mentioned in merge request !162", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2017-08-09T15:44:59.626Z", "updated_at": "2017-08-09T15:44:59.626Z", "system": true, "noteable_id": 6394022, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 102}], [{"id": 39714985, "type": null, "body": "This was actually caused by a bug in the Windows Git client. It was fixed and released as an update to Git - see https://github.com/git-for-windows/git/issues/1258. \n\nIn short, update your Windows client and things will magically work!", "attachment": null, "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "created_at": "2017-09-08T14:49:08.099Z", "updated_at": "2017-09-08T14:49:08.099Z", "system": false, "noteable_id": 6394022, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 102}], [{"id": 39714986, "type": null, "body": "closed", "attachment": null, "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "created_at": "2017-09-08T14:49:08.175Z", "updated_at": "2017-09-08T14:49:08.175Z", "system": true, "noteable_id": 6394022, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 102}]]}, {"id": 6370241, "iid": 101, "project_id": 14022, "title": "Missing dependencies in install instructions.", "description": "I don't develop in ruby or go, so I followed your instructions to a T. \nI was also on a box that had only followed the omnibus instructions. I had to install build essential. Then libssl then zlib1g-dev. I don't really know what else yet\n\n-----\n\nNext thing was setting up config.yaml I made some reasonable gueses, and then I made an empty .gitlab_shell_secret file (again a guess) after seeing this:\n\n```\n$ git push origin master\n/home/ubuntu/gitlab-shell/lib/gitlab_net.rb:245:in `read': No such file or directory @ rb_sysopen - /home/ubuntu/gitlab-shell/.gitlab_shell_secret (Errno::ENOENT)\n        from /home/ubuntu/gitlab-shell/lib/gitlab_net.rb:245:in `secret_token'\n        from /home/ubuntu/gitlab-shell/lib/gitlab_net.rb:179:in `http_request_for'\n        from /home/ubuntu/gitlab-shell/lib/gitlab_net.rb:196:in `request'\n        from /home/ubuntu/gitlab-shell/lib/gitlab_net.rb:224:in `post'\n        from /home/ubuntu/gitlab-shell/lib/gitlab_net.rb:37:in `check_access'\n        from /home/ubuntu/gitlab-shell/lib/gitlab_shell.rb:108:in `verify_access'\n        from /home/ubuntu/gitlab-shell/lib/gitlab_shell.rb:44:in `block in exec'\n        from /home/ubuntu/gitlab-shell/lib/gitlab_metrics.rb:47:in `measure'\n        from /home/ubuntu/gitlab-shell/lib/gitlab_shell.rb:44:in `exec'\n        from /home/ubuntu/gitlab-shell/bin/gitlab-shell:20:in `<main>'\nfatal: Could not read from remote repository.\n\nPlease make sure you have the correct access rights\nand the repository exists.\n\n```\n\nI got all the way to: \n\n```\nIssac Kelly@DESKTOP-P8VSRL8 MINGW64 /c/Projects/HelloLabview (master)\n$ git push origin master\nGitLab: API is not accessible\nfatal: Could not read from remote repository.\n\nPlease make sure you have the correct access rights\nand the repository exists.\n```\n\nThen I quit because you already confirmed that you solved my issue. I'll just wait for it to be shipped with the omnibus. Thanks!\n\n\n", "state": "opened", "created_at": "2017-08-07T06:05:56.215Z", "updated_at": "2017-08-07T06:22:28.726Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 551130, "name": "Issac Kelly", "username": "issackelly", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e00722884b2ce414a6d563fddd8197fb?s=80&d=identicon", "web_url": "https://gitlab.com/issackelly"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/101", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/101", "notes": "https://gitlab.com/api/v4/projects/14022/issues/101/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/101/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 36898444, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 551130, "name": "Issac Kelly", "username": "issackelly", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e00722884b2ce414a6d563fddd8197fb?s=80&d=identicon", "web_url": "https://gitlab.com/issackelly"}, "created_at": "2017-08-07T06:22:28.770Z", "updated_at": "2017-08-07T06:22:28.770Z", "system": true, "noteable_id": 6370241, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 101}]]}, {"id": 6317458, "iid": 100, "project_id": 14022, "title": "Undefined constant GitlabProjects::Tempfile when using SSH authentication", "description": "In !154 we introduced SSH public-key auth and custom known_hosts support too.\n\nActually using it on master causes this error:\n\n```\nMirror update for root/gitlab-shell failed with the following message: /home/lupine/dev/gitlab.com/gitlab-org/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_projects.rb:416:in `setup_ssh_auth': uninitialized constant GitlabProjects::Tempfile (NameError)\n\tfrom /home/lupine/dev/gitlab.com/gitlab-org/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_projects.rb:215:in `fetch_remote'\n\tfrom /home/lupine/dev/gitlab.com/gitlab-org/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_projects.rb:72:in `block in exec'\n\tfrom /home/lupine/dev/gitlab.com/gitlab-org/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_metrics.rb:47:in `measure'\n\tfrom /home/lupine/dev/gitlab.com/gitlab-org/gdk-ee/go-gitlab-shell/src/gitlab.com/gitlab-org/gitlab-shell/lib/gitlab_projects.rb:53:in `exec'\n\tfrom /home/lupine/dev/gitlab.com/gitlab-org/gdk-ee/gitlab-shell/bin/gitlab-projects:25:in `<main>'\n```\n\nPresumably, the tests `require 'tempfile'` but the main binary doesn't!\n\nWe'll need to release a v5.6.1 alongside this.", "state": "closed", "created_at": "2017-08-02T11:10:17.529Z", "updated_at": "2017-08-03T17:09:50.826Z", "closed_at": "2017-08-02T15:20:30.819Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/100", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/100", "notes": "https://gitlab.com/api/v4/projects/14022/issues/100/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/100/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 36543302, "type": null, "body": "mentioned in merge request !156", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-08-02T11:14:10.870Z", "updated_at": "2017-08-02T11:14:10.870Z", "system": true, "noteable_id": 6317458, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 100}], [{"id": 36548762, "type": null, "body": "After resolving this issue, I came across a further problem with the misuse of the `mode` parameter to `Tempfile.new`\n\nI assumed it was the `perm` parameter, i.e., to set file permissions, but it actually affects the mode the file is opened in (read-only, read-write, write-only, etc).", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-08-02T12:08:10.180Z", "updated_at": "2017-08-02T12:08:10.180Z", "system": false, "noteable_id": 6317458, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 100}], [{"id": 36573257, "type": null, "body": "closed via merge request !156", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-08-02T15:20:31.022Z", "updated_at": "2017-08-02T15:20:31.022Z", "system": true, "noteable_id": 6317458, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 100}], [{"id": 36697735, "type": null, "body": "mentioned in commit 980eb544646cccf4dde60825452c59b13b14aa6d", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-08-03T17:09:50.742Z", "updated_at": "2017-08-03T17:09:50.742Z", "system": true, "noteable_id": 6317458, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 100}]]}, {"id": 6250358, "iid": 99, "project_id": 14022, "title": "Running gitlab and gitlab-shell apart", "description": "Is it possible to run gitlab-shell apart from gitlab? Like in different containers?\n\n```\n  ## GitLab Shell settings\n  gitlab_shell:\n    path: /home/git/gitlab-shell/\n    hooks_path: /home/git/gitlab-shell/hooks/\n```\n\nThese lines in `gitlab.yml` kinda suggest that it's not possible but I want to be sure. \n\nThank you.", "state": "closed", "created_at": "2017-07-27T11:55:58.959Z", "updated_at": "2018-01-15T02:56:10.866Z", "closed_at": "2018-01-12T15:02:49.856Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1447840, "name": "Chingis", "username": "chingis", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1447840/avatar.png", "web_url": "https://gitlab.com/chingis"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/99", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/99", "notes": "https://gitlab.com/api/v4/projects/14022/issues/99/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/99/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 54338099, "type": null, "body": "@chingis gitlab makes calls to binaries that exist in gitlab-shell, so the gitlab-shell code does need to be accessible from the gitlab container, and gitlab will acquire subprocesses that are files in the gitlab-shell repository over time. So I think the short answer is no.\n\nLet me know if you want any more details.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:02:48.908Z", "updated_at": "2018-01-12T15:02:48.908Z", "system": false, "noteable_id": 6250358, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 99}], [{"id": 54338102, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:02:49.902Z", "updated_at": "2018-01-12T15:02:49.902Z", "system": true, "noteable_id": 6250358, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 99}], [{"id": 54488578, "type": null, "body": "yep, thank you, I figured that out https://github.com/wodby/gitlab", "attachment": null, "author": {"id": 1447840, "name": "Chingis", "username": "chingis", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1447840/avatar.png", "web_url": "https://gitlab.com/chingis"}, "created_at": "2018-01-15T02:56:10.780Z", "updated_at": "2018-01-15T02:56:10.780Z", "system": false, "noteable_id": 6250358, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 99}]]}, {"id": 6206395, "iid": 98, "project_id": 14022, "title": "Make gitlab-shell run `git upload-pack` instead of `git-upload-pack`", "description": "From https://gitlab.com/gitlab-org/gitaly-proto/merge_requests/43#note_35776962, it was confusing to me that gitlab-shell runs `git-upload-pack` while Gitaly runs `git git-upload-pack`. The difference is subtle but important: the former doesn't accept `-c` arguments, but the latter does.", "state": "opened", "created_at": "2017-07-24T16:16:35.808Z", "updated_at": "2017-07-24T16:16:35.808Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/98", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/98", "notes": "https://gitlab.com/api/v4/projects/14022/issues/98/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/98/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 6158544, "iid": 97, "project_id": 14022, "title": "Loading gitlab_net is slow", "description": "It seems that the following statement takes 100-200 ms on a Digital Ocean VM:\n\n```\nrequire_relative 'gitlab_reference_counter'\n```\n\nThe main reason is that it has to run `require_relative 'gitlab_net'`, which imports the Redis vendored library and `httpunix`, which appears to take the bulk of the time.\n\nIt seems that if we care about performance, we may want to rewrite the GitLab reference counter in Go.", "state": "closed", "created_at": "2017-07-19T22:58:41.940Z", "updated_at": "2019-09-10T18:25:30.924Z", "closed_at": "2018-01-12T14:59:31.176Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "assignee": null, "user_notes_count": 16, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/97", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/97", "notes": "https://gitlab.com/api/v4/projects/14022/issues/97/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/97/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 35451188, "type": null, "body": "This is particularly important for making Web commits and other repository API calls faster: https://gitlab.com/gitlab-org/gitlab-ce/issues/34533#note_35451172", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-07-19T23:01:45.280Z", "updated_at": "2017-07-19T23:01:45.280Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 35806582, "type": null, "body": "FYI, @eReGeBe, I think we should look into rewriting `GitlabReferenceCounter` in Go because it is slowing down our `git push` time (e.g. 200 ms to load `gitlab_net` * 3 = 600 ms!).", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-07-24T23:45:16.825Z", "updated_at": "2017-07-25T00:04:48.911Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 37501238, "type": null, "body": "It looks like instead of rewriting `GitlabReferenceCounter` in go, we could just wrap `redis-cli`?", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-08-14T12:48:00.060Z", "updated_at": "2017-08-14T12:48:00.060Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 37502706, "type": null, "body": "Hmm, it looks like sentinels make that difficult :/", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-08-14T12:56:39.640Z", "updated_at": "2017-08-14T12:56:39.640Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 37515621, "type": null, "body": "@nick.thomas We had that originally, but it was a bit of a hack (e.g. passwords would be sent via command-line).", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-08-14T15:04:23.606Z", "updated_at": "2017-08-14T15:04:23.606Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 37516763, "type": null, "body": "I believe you can send passwords via `stdin`, but the lack of sentinel support makes me want to avoid this option.\n\nLet's see what else we can come up with first!", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-08-14T15:17:13.195Z", "updated_at": "2017-08-14T15:17:13.195Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 38120406, "type": null, "body": "I think we would have to move `GitlabAccess` to Go also, because `hooks/pre-receive` also does `require_relative '../lib/gitlab_access'`, which itself does `require_relative 'gitlab_net'`, which would leave us with the same loading times.", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2017-08-21T21:06:05.593Z", "updated_at": "2017-08-21T21:06:05.593Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 38123632, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-08-21T22:04:46.016Z", "updated_at": "2017-08-21T22:04:46.016Z", "system": true, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 38327102, "type": null, "body": "@stanhu actually, we (Gitaly) were thinking we should just replace the Redis calls with internal HTTP API calls, and so remove the Redis dependency from the gitlab-shell hooks. https://gitlab.com/gitlab-org/gitaly/issues/467\n\nThis makes it easier to set up (new) Gitaly servers.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-08-23T14:56:23.261Z", "updated_at": "2017-08-23T14:56:23.261Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 38327318, "type": null, "body": "It would \"solve\" the problem of redis lib load times, but I don't know what the penalty of doing new HTTP API calls is.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-08-23T14:57:53.689Z", "updated_at": "2017-08-23T14:57:53.689Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 38329672, "type": null, "body": "The biggest problem with internal API calls is that they restrict the concurrency of operations. Each one ties up a whole unicorn for however long it takes to complete. We already have 3 internal API calls per git push; adding more of them will only compound the problem.\n\nMore details at https://gitlab.com/gitlab-org/gitlab-ce/issues/35512 and https://gitlab.com/gitlab-org/gitlab-ce/issues/34533 - we don't have the full picture yet.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-08-23T15:19:43.306Z", "updated_at": "2017-08-23T15:19:43.306Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 38441116, "type": null, "body": "@nick.thomas on gitlab.com at least, the rate of Git pushes is so low that I don't see how concurrent capacity of the Unicorn workers is a problem here.\n\nI think there are two independent improvements we can make to the hooks.\n\n- stop interacting with Redis: this takes away the overhead of loading the redis gem\n- combine multiple HTTP API calls into one: hooks/post-receive only need to make 1 API call each\n\nFor the sake of changing not too many things at once, I suggest we do the Redis thing first.\n\n- for GitLab 10.0, implement redis replacement API calls; gitlab-shell falls back to accessing redis if they return 404. This makes us backwards-compatible\n- wait for 10.0 release\n- remove redis code and fallbacks\n- combine API calls into one", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-08-24T15:39:55.833Z", "updated_at": "2017-08-24T15:39:55.833Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 38441996, "type": null, "body": "@jacobvosmaer-gitlab we're not just interested in deployments on GitLab.com, but also on deployments where the number of unicorn workers is in the single or low double digits. We're also specifically interested in cases where a large number of pushes are being performed concurrently against such an instance. \n\nCombining the calls is an option that I had in mind, but I've not looked to see how viable it is yet. \n\nAgain, I stress we don't have the complete picture yet - maybe the internal API calls are fine, but I'm suspicious of replacing redis interactions, which can do high concurrency with a low RAM footprint, with something that simply can't.\n\nIf gitaly is going to need redis access in the future (I've seen suggstions it's how gitaly and rails will share cached data, for instance), I'd strongly prefer to keep these interactions in redis.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-08-24T15:50:07.158Z", "updated_at": "2017-08-24T15:50:07.158Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 38452838, "type": null, "body": "@nick.thomas of course, redis is faster than the API, but the thing is we will anyway need to call the API, so delegating the redis tasks to an API call at least allows us to simplify our infrastructure (no redis access on shell means no redis/sidekiq access on the NFS servers). API calls still suck performance wise, but we can:\n\na. Replace the API call `notify_post_receive`, which is a no-op, with a new API call that takes care of the redis tasks. This way we are not adding round trips and we're saving ourselves time with loading the redis libraries on shell, as well as accomplishing the infrastructure simplification.\n\nb. After a., replace all API operations in post-receive (ask for the broadcast message, ask for the merge request urls, notify post receive and the redis call added on a.) with a single API call.\n\nI don't think we can get the API calls on post-receive to 0, so after a. and b. we would have an optimal approach.", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2017-08-24T18:34:26.679Z", "updated_at": "2017-08-24T18:34:26.679Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 38498970, "type": null, "body": "@nick.thomas we won't know for sure until we actually make the change but I am pretty confident that the existing HTTP API calls in hooks/pre-receive and hooks/post-receive can be collapsed to just one per hook.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-08-25T09:12:55.815Z", "updated_at": "2017-08-25T09:12:55.815Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 38502250, "type": null, "body": "OK, I'm going to leave the `git push` case alone until after the gitaly team has finished changing it. It's not constructive to have us both pulling in different directions here.\n\nIf you can benchmark before and after for both the low and high concurrency cases, that'd be useful :)", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-08-25T09:50:29.004Z", "updated_at": "2017-08-25T09:50:29.004Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 38502255, "type": null, "body": "removed assignee", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-08-25T09:50:34.999Z", "updated_at": "2017-08-25T09:50:34.999Z", "system": true, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 38502414, "type": null, "body": "mentioned in issue #74", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-08-25T09:52:20.655Z", "updated_at": "2017-08-25T09:52:20.655Z", "system": true, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 54337551, "type": null, "body": "`require_relative 'gitlab_reference_counter'` no longer appears anywhere in any code, so I'll close this issue.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:59:30.658Z", "updated_at": "2018-01-12T14:59:30.658Z", "system": false, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}], [{"id": 54337552, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:59:31.219Z", "updated_at": "2018-01-12T14:59:31.219Z", "system": true, "noteable_id": 6158544, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 97}]]}, {"id": 6117339, "iid": 96, "project_id": 14022, "title": "Use the same versioning schema as the Rails app / Omnibus package", "description": "At the moment, we have a problem with knowing what gitlab-shell code is in (or is going into) a particular release of GitLab the product.\n\nWe could just tag this repo with the same version as the Rails app, and fetch that version instead. There might be something I've missed, but wouldn't that be simpler with our current situation (I understand it may not have been a good idea historically) :thinking:", "state": "opened", "created_at": "2017-07-17T16:19:05.949Z", "updated_at": "2017-07-19T09:20:58.602Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "assignee": null, "user_notes_count": 9, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/96", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/96", "notes": "https://gitlab.com/api/v4/projects/14022/issues/96/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/96/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 35186236, "type": null, "body": "@rymai @dzaporozhets @marin wdyt?", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-07-17T16:19:17.544Z", "updated_at": "2017-07-17T16:19:17.544Z", "system": false, "noteable_id": 6117339, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 96}], [{"id": 35188515, "type": null, "body": "@smcgivern That means we'd only tag `gitlab-shell` at the same time (or just before) tagging the GitLab release it should go into?\n\nThe downside is that we'd couple `gitlab-shell` with GitLab: we won't be able to merge upcoming (and possibly breaking) changes in `gitlab-shell` until we'd tagged it for the GitLab release...\n\nThat doesn't sound very practical to me. I know GitLab Runner follows GitLab versioning, but GitLab Runner is not a dependency of GitLab, it can just follow GitLab and tag its versions (loosely) following GitLab.\n\nLet's take a fictitious example:\n\n- GitLab is now 9.8\n- GitLab Shell is now 9.8\n- A minor change is merged in GitLab Shell, it should go into 9.9\n- A major change is submitted to GitLab Shell but we cannot merge it as it would break 9.9\n  - We cannot tag GitLab Shell 9.8 yet as maybe we'll want to merge more stuff for it before the 9.8 GitLab tag\n- Wait for GitLab 9.9 to be ready to be tagged\n- Tag GitLab Shell 9.9\n- Tag GitLab 9.9\n- Merge the breaking GitLab Shell merge request: in the worst case, we'd wait 30 days before being able to merge it\n\n----\n\nNow, maybe *I* am missing something? :)", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2017-07-17T16:46:42.433Z", "updated_at": "2017-07-17T16:46:42.433Z", "system": false, "noteable_id": 6117339, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 96}], [{"id": 35192682, "type": null, "body": "@rymai sure, that's a problem. But how many cases do we have now where we're merging gitlab-shell but not immediately updating the Rails app to use that version? If we assume the same versioning scheme, I don't see how this doesn't apply to work on GitLab CE?", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-07-17T17:48:11.621Z", "updated_at": "2017-07-17T17:48:11.621Z", "system": false, "noteable_id": 6117339, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 96}], [{"id": 35245251, "type": null, "body": "@smcgivern We had those cases in the past, cannot find links now. If we do want to go down this route (and I think it is not unreasonable to think about it), we might be able to get away with using `stable` branches. \n\nSo we could have a situation like:\n\n* `Master` of CE/EE uses `master` of gitlab-shell\n* When we tag, 9.4.x of CE/EE uses 9.4.x created from `9-4-stable`\n\nThis way we also resolve the issue of bumping the versions in gitlab-shell because it is highly unlikely that we would have to cut a release of gitlab-shell without bumping that also in the stable branch of CE.", "attachment": null, "author": {"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}, "created_at": "2017-07-18T09:12:35.054Z", "updated_at": "2017-07-18T09:12:35.054Z", "system": false, "noteable_id": 6117339, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 96}], [{"id": 35252381, "type": null, "body": "@smcgivern @marin Stable branches for `gitlab-shell` sounds reasonable and would indeed solve the problem I pointed out. So basically, the release process would create/use a stable branch for `gitlab-shell`, and tag it prior to tagging CE/EE.", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2017-07-18T10:15:16.325Z", "updated_at": "2017-07-18T10:15:16.325Z", "system": false, "noteable_id": 6117339, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 96}], [{"id": 35265596, "type": null, "body": "@marin good idea! I think that makes sense.\n\nI don't think this is essential, or anything, but I find it weird that this repo gets its own versioning, when presumably no-one is using it outside the context of a GitLab version that pins this, and sometimes we bump the version multiple times without those ever going in to a particular GitLab release, or bump the version and forget to update the Rails app. (Or, in one recent case, only bump the version in EE, not CE!)", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-07-18T11:46:15.951Z", "updated_at": "2017-07-18T11:46:15.951Z", "system": false, "noteable_id": 6117339, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 96}], [{"id": 35267733, "type": null, "body": "If we then need to revert a breaking change in gitlab-shell the version might only change from 9.4.0 to 9.4.1 despite having a breaking change. So we'd no longer be following semantic versioning.\n\nAt the moment the version can also be helpful when deciding whether to pick changes to the gitlab-shell version. An RM looking at a major version bump knows that a more significant change is being selected. With the new system I guess this decision would instead happen when picking into stable. Both could work.", "attachment": null, "author": {"id": 654619, "name": "James Edwards-Jones", "username": "jamedjo", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/654619/avatar.png", "web_url": "https://gitlab.com/jamedjo"}, "created_at": "2017-07-18T12:09:07.183Z", "updated_at": "2017-07-18T12:09:07.183Z", "system": false, "noteable_id": 6117339, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 96}], [{"id": 35346729, "type": null, "body": "/cc @eReGeBe as you've been making changes here lately too.", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-07-19T08:53:17.278Z", "updated_at": "2017-07-19T08:53:17.278Z", "system": false, "noteable_id": 6117339, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 96}], [{"id": 35349643, "type": null, "body": "Let's do stable branches for corresponding GitLab releases like @marin proposed.", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2017-07-19T09:20:58.583Z", "updated_at": "2017-07-19T09:20:58.583Z", "system": false, "noteable_id": 6117339, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 96}]]}, {"id": 6116586, "iid": 95, "project_id": 14022, "title": "Add SSH pubkey support to fetch_remote", "description": "gitlab-shell is used during repository mirroring to fetch git remotes.\n\nIn https://gitlab.com/gitlab-org/gitlab-ee/issues/98 I'm adding SSH public key authentication support to pull mirroring; this will require extra code and configuration in gitlab-shell to support.\n\nInstead of doing that work in Ruby and managing an external `ssh` process, including, in all likelihood, writing SSH private keys to `$TMPDIR`, I'd instead like to use gitlab-shell's golang component to produce a binary using `golang.org/x/crypto/ssh` and `gopkg.in/src-d/go-git.v4` to do exactly what we want. \n\nThis is all-new functionality so there's no chance of regressions; we can continue to handle password authentication with the existing Ruby-shelling-out-to-git code for now, and migrate it over later if we feel the need.\n\n/cc @DouweM @jacobvosmaer-gitlab", "state": "closed", "created_at": "2017-07-17T16:10:41.782Z", "updated_at": "2017-08-03T17:09:52.483Z", "closed_at": "2017-07-31T15:23:23.441Z", "closed_by": null, "labels": [], "milestone": {"id": 334067, "iid": 20, "project_id": 14022, "title": "9.5", "description": "", "state": "closed", "created_at": "2017-06-22T11:52:49.770Z", "updated_at": "2018-06-25T17:30:56.289Z", "due_date": null, "start_date": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/-/milestones/20"}, "assignees": [{"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "user_notes_count": 4, "merge_requests_count": 2, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/95", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/95", "notes": "https://gitlab.com/api/v4/projects/14022/issues/95/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/95/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 35185842, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-07-17T16:14:58.669Z", "updated_at": "2017-07-17T16:14:58.669Z", "system": true, "noteable_id": 6116586, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 95}], [{"id": 35188768, "type": null, "body": "I'd like to pass the SSH public key and expected host key fingerprint to gitlab-shell in the environment. It could be 4K in size, but that's not a problem on any systems we support: https://www.in-ulm.de/~mascheck/various/argmax/#results. Plus, gitlab-shell's golang subprocess can automatically inherit those envvars without gitlab-shell needing to do anything explicit.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-07-17T16:50:18.916Z", "updated_at": "2017-07-17T16:50:18.916Z", "system": false, "noteable_id": 6116586, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 95}], [{"id": 35190824, "type": null, "body": "changed title from **{-Port fetch_remote to-} golang** to **{+Add SSH pubkey support to fetch_remote using+} golang**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-07-17T17:20:31.085Z", "updated_at": "2017-07-17T17:20:31.085Z", "system": true, "noteable_id": 6116586, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 95}], [{"id": 35240885, "type": null, "body": "mentioned in merge request !146", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-07-18T08:39:59.305Z", "updated_at": "2017-07-18T08:39:59.305Z", "system": true, "noteable_id": 6116586, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 95}], [{"id": 35246203, "type": null, "body": "go-git is missing a couple of `git fetch` options we seem to rely on. I've opened an issue upstream: https://github.com/src-d/go-git/issues/490", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-07-18T09:20:57.719Z", "updated_at": "2017-07-18T09:20:57.719Z", "system": false, "noteable_id": 6116586, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 95}], [{"id": 35248142, "type": null, "body": "mentioned in merge request !147", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-07-18T09:35:03.051Z", "updated_at": "2017-07-18T09:35:03.051Z", "system": true, "noteable_id": 6116586, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 95}], [{"id": 35250123, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-07-18T09:53:18.429Z", "updated_at": "2017-07-18T09:53:18.429Z", "system": true, "noteable_id": 6116586, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 95}], [{"id": 35265897, "type": null, "body": "Aside from the missing `--no-tags` and `--no-force` support, the code seems to handle password authentication out of the box. Pleasant :)", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-07-18T11:49:34.730Z", "updated_at": "2017-07-18T11:49:34.730Z", "system": false, "noteable_id": 6116586, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 95}], [{"id": 35841928, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-07-25T09:48:22.786Z", "updated_at": "2017-07-25T09:48:22.786Z", "system": true, "noteable_id": 6116586, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 95}], [{"id": 36189707, "type": null, "body": "In case the `go-git` work isn't done in time, I'm also going to prepare a Ruby version of !147 . It won't be as good, but at least we won't be blocked.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-07-28T15:40:58.448Z", "updated_at": "2017-07-28T15:40:58.448Z", "system": false, "noteable_id": 6116586, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 95}], [{"id": 36190261, "type": null, "body": "mentioned in merge request !154", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-07-28T15:47:55.427Z", "updated_at": "2017-07-28T15:47:55.427Z", "system": true, "noteable_id": 6116586, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 95}], [{"id": 36341056, "type": null, "body": "closed via commit dcdb9b8736f1c38dc097a07384c5dfc1d5bbe1cf", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-07-31T15:23:19.496Z", "updated_at": "2017-07-31T15:23:19.496Z", "system": true, "noteable_id": 6116586, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 95}], [{"id": 36341063, "type": null, "body": "closed via merge request !154", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-07-31T15:23:24.598Z", "updated_at": "2017-07-31T15:23:24.598Z", "system": true, "noteable_id": 6116586, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 95}], [{"id": 36344121, "type": null, "body": "changed title from **Add SSH pubkey support to fetch_remote{- using golang-}** to **Add SSH pubkey support to fetch_remote**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-07-31T15:53:34.523Z", "updated_at": "2017-07-31T15:53:34.523Z", "system": true, "noteable_id": 6116586, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 95}], [{"id": 36697742, "type": null, "body": "mentioned in commit dcdb9b8736f1c38dc097a07384c5dfc1d5bbe1cf", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-08-03T17:09:52.376Z", "updated_at": "2017-08-03T17:09:52.376Z", "system": true, "noteable_id": 6116586, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 95}]]}, {"id": 6101073, "iid": 94, "project_id": 14022, "title": "question: SSH gets the client IP address", "description": "Could i get the client IP address for ssh clone or push operating\uff1f", "state": "closed", "created_at": "2017-07-16T08:01:29.731Z", "updated_at": "2017-07-23T00:39:06.214Z", "closed_at": "2017-07-23T00:39:06.090Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 667772, "name": "asu", "username": "suguojun", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/667772/avatar.png", "web_url": "https://gitlab.com/suguojun"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/94", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/94", "notes": "https://gitlab.com/api/v4/projects/14022/issues/94/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/94/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 35676247, "type": null, "body": "closed", "attachment": null, "author": {"id": 667772, "name": "asu", "username": "suguojun", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/667772/avatar.png", "web_url": "https://gitlab.com/suguojun"}, "created_at": "2017-07-23T00:39:06.206Z", "updated_at": "2017-07-23T00:39:06.206Z", "system": true, "noteable_id": 6101073, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 94}]]}, {"id": 5848428, "iid": 93, "project_id": 14022, "title": "Adding new ssh-keys is broken in gitlab 9.3", "description": "GitLab 9.3.0-ee omnibus\nGitLab Shell 5.0.5\nUbuntu 14.04.5 LTS\n\nDescription of the issue:\n- add a user ssh key via the webgui\n- the key is displayed in the users key view\n- the key is not in /var/opt/gitlab/.ssh/authorized_keys\n- I can't clone/push/... using this key\n- if I manually add the key there with the correct ID that I can see in the webgui, then the key works", "state": "closed", "created_at": "2017-06-26T14:03:18.088Z", "updated_at": "2017-06-26T14:29:42.939Z", "closed_at": "2017-06-26T14:29:42.089Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1172389, "name": "khartahk", "username": "khartahk", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1172389/avatar.png", "web_url": "https://gitlab.com/khartahk"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/93", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/93", "notes": "https://gitlab.com/api/v4/projects/14022/issues/93/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/93/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 33474929, "type": null, "body": "It looks like you are running into https://gitlab.com/gitlab-org/gitlab-ee/issues/2738. The quick workaround is to:\n\n* Go to the Admin panel -> Settings\n* Click on the 'Write to authorized_keys file` checkbox: https://docs.gitlab.com/ee/administration/operations/speed_up_ssh.html\n* Rebuild your SSH key list via `sudo gitlab-rake gitlab:shell:setup`: https://docs.gitlab.com/ce/administration/raketasks/maintenance.html#rebuild-authorized_keys-file", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-06-26T14:25:05.886Z", "updated_at": "2017-06-26T14:25:05.886Z", "system": false, "noteable_id": 5848428, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 93}], [{"id": 33475311, "type": null, "body": "closed", "attachment": null, "author": {"id": 1172389, "name": "khartahk", "username": "khartahk", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1172389/avatar.png", "web_url": "https://gitlab.com/khartahk"}, "created_at": "2017-06-26T14:29:42.208Z", "updated_at": "2017-06-26T14:29:42.208Z", "system": true, "noteable_id": 5848428, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 93}], [{"id": 33475314, "type": null, "body": "That did the trick.\nThank you for a quick response.", "attachment": null, "author": {"id": 1172389, "name": "khartahk", "username": "khartahk", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1172389/avatar.png", "web_url": "https://gitlab.com/khartahk"}, "created_at": "2017-06-26T14:29:42.915Z", "updated_at": "2017-06-26T14:29:42.915Z", "system": false, "noteable_id": 5848428, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 93}]]}, {"id": 5807479, "iid": 92, "project_id": 14022, "title": "TypeError in gitlab_post_receive.rb", "description": "I'm not sure if this is right place for this, but I got the following stack trace when doing a `push` of a new branch\n\n```\nremote: /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_post_receive.rb:61:in `[]': no implicit conversion of String into Integer (TypeError)\nremote: \tfrom /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_post_receive.rb:61:in `print_merge_request_link'\nremote: \tfrom /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_post_receive.rb:57:in `block in print_merge_request_links'\nremote: \tfrom /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_post_receive.rb:57:in `each'\nremote: \tfrom /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_post_receive.rb:57:in `print_merge_request_links'\nremote: \tfrom /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_post_receive.rb:38:in `exec'\nremote: \tfrom hooks/post-receive:18:in `<main>'\nremote:\n```\n\nI've checked the [lines in the file](https://gitlab.com/gitlab-org/gitlab-shell/blob/ec207719270f5b1c5ccd4c6043f338ca53d45c63/lib/gitlab_post_receive.rb#L61) and it seems plausible to me that there error might still be there. After looking at it a bit it seems that maybe the [response to merge_request_urls](https://gitlab.com/gitlab-org/gitlab-shell/blob/ec207719270f5b1c5ccd4c6043f338ca53d45c63/lib/gitlab_net.rb#L78) is coming back as an array, especially since the code to compute the URL has changed in the latest commit.", "state": "closed", "created_at": "2017-06-22T03:34:56.556Z", "updated_at": "2019-08-07T08:26:55.009Z", "closed_at": "2017-07-12T17:16:22.601Z", "closed_by": null, "labels": ["Gitaly [DEPRECATED]", "devops::create", "group::gitaly"], "milestone": null, "assignees": [{"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}], "author": {"id": 915383, "name": "Daniel", "username": "dlatypov", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/9882a774248b03364b8714b6d8503b70?s=80&d=identicon", "web_url": "https://gitlab.com/dlatypov"}, "assignee": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "user_notes_count": 15, "merge_requests_count": 7, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/92", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/92", "notes": "https://gitlab.com/api/v4/projects/14022/issues/92/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/92/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 34195613, "type": null, "body": "I also received this message after a push to a new branch on one of my repos today", "attachment": null, "author": {"id": 607779, "name": "Josh Bode", "username": "joshbode", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/522cd74f8cf03b1799d09cfb0b85b36f?s=80&d=identicon", "web_url": "https://gitlab.com/joshbode"}, "created_at": "2017-07-05T00:35:36.867Z", "updated_at": "2017-07-05T00:35:36.867Z", "system": false, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34211570, "type": null, "body": "Same here as of this morning\r\n\r\n```\r\ngit push\r\nCounting objects: 9, done.\r\nDelta compression using up to 8 threads.\r\nCompressing objects: 100% (9/9), done.\r\nWriting objects: 100% (9/9), 1.02 KiB | 0 bytes/s, done.\r\nTotal 9 (delta 6), reused 0 (delta 0)\r\nremote: /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_post_receive.rb:61:in `[]': no implicit conversion of String into Integer (TypeError)\r\nremote:         from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_post_receive.rb:61:in `print_merge_request_link'\r\nremote:         from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_post_receive.rb:57:in `block in print_merge_request_links'\r\nremote:         from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_post_receive.rb:57:in `each'\r\nremote:         from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_post_receive.rb:57:in `print_merge_request_links'\r\nremote:         from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_post_receive.rb:38:in `exec'\r\nremote:         from hooks/post-receive:18:in `<main>'\r\nremote:\r\nTo ecatcetic.gitlab.com:cetic-it/adumar.git\r\n   a47a52a..ab7bd60  master -> master\r\n\r\n\r\n```", "attachment": null, "author": {"id": 276816, "name": "Etienne Charlier", "username": "ecatcetic", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/bcb2a03e67c73fc5d15c936b12605aa8?s=80&d=identicon", "web_url": "https://gitlab.com/ecatcetic"}, "created_at": "2017-07-05T07:20:57.498Z", "updated_at": "2017-07-05T07:21:17.627Z", "system": false, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34225096, "type": null, "body": "/cc: @eReGeBe, @smcgivern", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-07-05T09:44:35.420Z", "updated_at": "2017-07-05T09:44:35.420Z", "system": false, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34231067, "type": null, "body": "mentioned in issue gitlab-com/support-forum#2184", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-07-05T10:42:07.029Z", "updated_at": "2017-07-05T10:42:07.029Z", "system": true, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34243624, "type": null, "body": "I can't reproduce this on GitLab.com right now. @ayufan do you know if anything happened with the hotfix around these times? https://log.gitlap.com/goto/f60b22ab812cf9135b70f2f55bac43ae (This isn't all of the instances.)\n\n@dlatypov thanks for the investigation, but this is supposed to return an array of hashes, so falling back to an array should be fine :thinking:", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-07-05T12:57:40.835Z", "updated_at": "2017-07-05T12:57:40.835Z", "system": false, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34347842, "type": null, "body": "No, the hotfix did got overwritten with release.", "attachment": null, "author": {"id": 12452, "name": "Kamil Trzci\u0144ski", "username": "ayufan", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/7a285e30f35d72526fb0954e8fe7cefa?s=80&d=identicon", "web_url": "https://gitlab.com/ayufan"}, "created_at": "2017-07-06T13:56:44.029Z", "updated_at": "2017-07-06T13:56:44.029Z", "system": false, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34451150, "type": null, "body": "@ayufan reproduced this - once! https://gitlab.slack.com/archives/C101F3796/p1499442835873213\n\nWe probably need to add logging to track this down.", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-07-07T16:03:52.886Z", "updated_at": "2017-07-07T16:03:52.886Z", "system": false, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34454260, "type": null, "body": "It is caused by `/api/v4/internal/merge_request_urls` returning 500 due to this exception: https://sentry.gitlap.com/gitlab/gitlabcom/issues/34756/.", "attachment": null, "author": {"id": 12452, "name": "Kamil Trzci\u0144ski", "username": "ayufan", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/7a285e30f35d72526fb0954e8fe7cefa?s=80&d=identicon", "web_url": "https://gitlab.com/ayufan"}, "created_at": "2017-07-07T16:51:21.813Z", "updated_at": "2017-07-07T16:51:21.813Z", "system": false, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34454326, "type": null, "body": "GitLab Shell doesn't verify error code, and blindly tries to parse returned response. Ideally it should verify if it is 200.", "attachment": null, "author": {"id": 12452, "name": "Kamil Trzci\u0144ski", "username": "ayufan", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/7a285e30f35d72526fb0954e8fe7cefa?s=80&d=identicon", "web_url": "https://gitlab.com/ayufan"}, "created_at": "2017-07-07T16:52:10.794Z", "updated_at": "2017-07-07T16:52:10.794Z", "system": false, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34459750, "type": null, "body": "added ~1507480 label", "attachment": null, "author": {"id": 895869, "name": "Andrew Newdigate", "username": "andrewn", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/895869/avatar.png", "web_url": "https://gitlab.com/andrewn"}, "created_at": "2017-07-07T18:24:19.252Z", "updated_at": "2017-07-07T18:24:19.252Z", "system": true, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34595467, "type": null, "body": "Thanks @ayufan, good investigation!\n\n@eReGeBe do you think just checking the response code will be sufficient? It sounds like a good idea to me.", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-07-10T13:39:14.955Z", "updated_at": "2017-07-10T13:39:14.955Z", "system": false, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34627254, "type": null, "body": "@smcgivern sounds good to me. We're discussing the fix for the underlying problem on https://gitlab.com/gitlab-org/gitlab-ce/issues/34840 but yeah, we should only parse on status 200.", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2017-07-10T19:06:20.746Z", "updated_at": "2017-07-10T19:06:20.746Z", "system": false, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34783371, "type": null, "body": "mentioned in merge request !145", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-07-12T08:39:56.505Z", "updated_at": "2017-07-12T08:39:56.505Z", "system": true, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34783415, "type": null, "body": "I've created https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/145, but to pick this into 9.4, we'd need to pick that change to a 5.1.2 or something. @stanhu wdyt?", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-07-12T08:40:26.639Z", "updated_at": "2017-07-12T08:40:26.639Z", "system": false, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34783421, "type": null, "body": "assigned to @smcgivern", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-07-12T08:40:27.459Z", "updated_at": "2017-07-12T08:40:27.459Z", "system": true, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34803767, "type": null, "body": "changed title from **TypeError in gitlab_post_recei{-e-}ve.rb** to **TypeError in gitlab_post_receive.rb**", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2017-07-12T11:23:12.643Z", "updated_at": "2017-07-12T11:23:12.643Z", "system": true, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34814385, "type": null, "body": "@smcgivern I think Gitaly is going to bump gitlab-shell version up to 5.3.0 so I think we can roll this into 9.4 without having to pick into an older \"branch\".", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-07-12T13:12:48.417Z", "updated_at": "2017-07-12T13:12:48.417Z", "system": false, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34825850, "type": null, "body": "Cool! @andrewn can you confirm please? If we're doing that, I can just cut a 5.3.1, and we should use that in 9.4.", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-07-12T14:52:24.090Z", "updated_at": "2017-07-12T14:52:24.090Z", "system": false, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34830156, "type": null, "body": "@smcgivern GitLab-Shell 5.3.0 is in GitLab-CE master and is awaiting `Pick into Stable` for the next release candidate: https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/12730", "attachment": null, "author": {"id": 895869, "name": "Andrew Newdigate", "username": "andrewn", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/895869/avatar.png", "web_url": "https://gitlab.com/andrewn"}, "created_at": "2017-07-12T15:37:44.366Z", "updated_at": "2017-07-12T15:37:44.366Z", "system": false, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34831898, "type": null, "body": "OK, let's just pull https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/12817 into 9.4 instead.", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-07-12T15:54:50.157Z", "updated_at": "2017-07-12T15:54:50.157Z", "system": false, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}], [{"id": 34844078, "type": null, "body": "closed via merge request gitlab-ce!12817", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-07-12T17:16:22.650Z", "updated_at": "2017-07-12T17:16:22.650Z", "system": true, "noteable_id": 5807479, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 92}]]}, {"id": 5785567, "iid": 91, "project_id": 14022, "title": "Update 5.0.4 -> 5.0.5 brings breaking changes!", "description": "https://gitlab.com/gitlab-org/gitlab-shell/compare/v5.0.4...v5.0.5\n\nThese changes are not even mentioned in the changelog!\n\n```\nv5.0.5\n  - Use gl_repository if present when enqueing Sidekiq PostReceive jobs\n```\n\nIt broke my installation.", "state": "closed", "created_at": "2017-06-20T10:53:55.495Z", "updated_at": "2018-01-12T14:42:20.266Z", "closed_at": "2018-01-12T14:42:20.261Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 522587, "name": "Jakub Jirutka", "username": "jirutka", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/061bdb74aa4a543108658b277a257b4b?s=80&d=identicon", "web_url": "https://gitlab.com/jirutka"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/91", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/91", "notes": "https://gitlab.com/api/v4/projects/14022/issues/91/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/91/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 54334992, "type": null, "body": "Sorry about this @jirutka - hopefully we can do a better job of managing semver and the CHANGELOG in the future!", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:42:19.543Z", "updated_at": "2018-01-12T14:42:19.543Z", "system": false, "noteable_id": 5785567, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 91}], [{"id": 54334993, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:42:20.302Z", "updated_at": "2018-01-12T14:42:20.302Z", "system": true, "noteable_id": 5785567, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 91}]]}, {"id": 5734445, "iid": 90, "project_id": 14022, "title": "Make it easier to refresh VCR cassettes", "description": "We use VCR cassettes for tests in `spec/gitlab_net_spec.rb`). I encountered a few problems when trying to refresh them:\n1. they point to `https://dev.gitlab.org` which, as far as I understand, means that I have to have `.gitlab_shell_secret` for `https://dev.gitlab.org` (which I don't have, probably won't have and also don't want to have)\n2. they use a hardcoded dummy value of the said secret. This means that a person refreshing them has to locally change the tests, refresh the cassettes and change the tests back\n3. they contain references to very specific data that only exists in `https://dev.gitlab.org`\n\nI tried pointing the tests to my local GitLab instance. This works for example for `check-ok.yml`, but fails for `discover-ok.yml` because of point 3.\n\nI don't know what the best solution here is. Point 3 seems to be the biggest obstacle. However, I like the fact that these tests are quite detailed (which requires depending on specific data).\n\nAssuming that we make changes here relatively rarely, maybe we only need a better documentation that describes the process of refreshing the cassettes and this process may depend on one specific person with access rights.", "state": "closed", "created_at": "2017-06-16T18:48:35.903Z", "updated_at": "2017-06-21T13:24:58.363Z", "closed_at": "2017-06-21T13:24:40.916Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}], "author": {"id": 378947, "name": "Adam Niedzielski", "username": "adamniedzielski", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/378947/avatar.png", "web_url": "https://gitlab.com/adamniedzielski"}, "assignee": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/90", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/90", "notes": "https://gitlab.com/api/v4/projects/14022/issues/90/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/90/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 32558851, "type": null, "body": "/cc @dzaporozhets", "attachment": null, "author": {"id": 378947, "name": "Adam Niedzielski", "username": "adamniedzielski", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/378947/avatar.png", "web_url": "https://gitlab.com/adamniedzielski"}, "created_at": "2017-06-16T18:48:51.256Z", "updated_at": "2017-06-16T18:48:51.256Z", "system": false, "noteable_id": 5734445, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 90}], [{"id": 32559523, "type": null, "body": "mentioned in merge request !135", "attachment": null, "author": {"id": 378947, "name": "Adam Niedzielski", "username": "adamniedzielski", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/378947/avatar.png", "web_url": "https://gitlab.com/adamniedzielski"}, "created_at": "2017-06-16T18:59:06.309Z", "updated_at": "2017-06-16T18:59:06.309Z", "system": true, "noteable_id": 5734445, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 90}], [{"id": 33112057, "type": null, "body": "@adamniedzielski Should be fixed by !135. Still will require a bit of manual work.", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2017-06-21T13:24:40.765Z", "updated_at": "2017-06-21T13:24:57.664Z", "system": false, "noteable_id": 5734445, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 90}], [{"id": 33112058, "type": null, "body": "closed", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2017-06-21T13:24:40.973Z", "updated_at": "2017-06-21T13:24:40.973Z", "system": true, "noteable_id": 5734445, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 90}], [{"id": 33112068, "type": null, "body": "assigned to @dzaporozhets", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2017-06-21T13:24:44.105Z", "updated_at": "2017-06-21T13:24:44.105Z", "system": true, "noteable_id": 5734445, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 90}]]}, {"id": 5662120, "iid": 89, "project_id": 14022, "title": "Warning on ruby 2.4 about constant Fixnum in vendored redis client", "description": "```\nshell/lib/vendor/redis/lib/redis/client.rb:459: warning: constant ::Fixnum is deprecated\n```", "state": "closed", "created_at": "2017-06-09T12:48:51.948Z", "updated_at": "2018-01-12T15:04:51.324Z", "closed_at": "2018-01-12T15:04:51.319Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 123015, "name": "darix", "username": "darix", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/eec0b791c6aab72d99940855fe374fda?s=80&d=identicon", "web_url": "https://gitlab.com/darix"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/89", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/89", "notes": "https://gitlab.com/api/v4/projects/14022/issues/89/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/89/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 37807143, "type": null, "body": "I see the same warning:\r\n`\r\n$ git push\r\nCounting objects: 76, done.\r\nDelta compression using up to 8 threads.\r\nCompressing objects: 100% (62/62), done.\r\nWriting objects: 100% (76/76), 409.56 KiB | 0 bytes/s, done.\r\nTotal 76 (delta 3), reused 0 (delta 0)\r\nremote: /home/git/gitlab-shell/lib/vendor/redis/lib/redis/client.rb:459: warning: constant ::Fixnum is deprecated\r\nremote: /home/git/gitlab-shell/lib/vendor/redis/lib/redis/client.rb:459: warning: constant ::Fixnum is deprecated\r\nTo https://someserver/somerep.git\r\n   ad4085b..47126c5  master -> master\r\n`\r\n\r\nI am on Gitlab CE, v9.4.5 using ruby 2.4.2p131.", "attachment": null, "author": {"id": 387623, "name": "Alex", "username": "guitarwatson", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/72df6dad50b9e6e6194d119566fdf6ce?s=80&d=identicon", "web_url": "https://gitlab.com/guitarwatson"}, "created_at": "2017-08-17T12:10:12.868Z", "updated_at": "2017-08-17T12:10:34.541Z", "system": false, "noteable_id": 5662120, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 89}], [{"id": 54338500, "type": null, "body": "The vendored redis client has been removed: #119 so I'll close this issue.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:04:50.720Z", "updated_at": "2018-01-12T15:04:50.720Z", "system": false, "noteable_id": 5662120, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 89}], [{"id": 54338502, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:04:51.368Z", "updated_at": "2018-01-12T15:04:51.368Z", "system": true, "noteable_id": 5662120, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 89}]]}, {"id": 5610558, "iid": 88, "project_id": 14022, "title": "error: pathspec 'v5.0.4' did not match any file(s) known to git.", "description": "Hello, when i try to update gitlab from version 9.1.2 to 9.2 in steps 6.Update gitlab-shell - I get error:\n\n`sudo -u git -H git checkout v$(</home/git/gitlab/GITLAB_SHELL_VERSION)\nerror: pathspec 'v5.0.4' did not match any file(s) known to git.`\n\nHere my versions:\nRedis version >= 2.8.0? ... yes\nRuby version >= 2.1.0 ? ... yes (2.3.3)\nYour git bin path is \"/usr/bin/git\"\nGit version >= 2.7.3 ? ... yes (2.13.0)\n\nPlease help me to resolve that probelm.", "state": "closed", "created_at": "2017-06-04T13:01:25.834Z", "updated_at": "2018-01-12T14:49:50.587Z", "closed_at": "2018-01-12T14:49:50.581Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1373336, "name": "Yosif Peev", "username": "djimbo", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/76fb4cc22117c8a0d55cc5e1769bfa1d?s=80&d=identicon", "web_url": "https://gitlab.com/djimbo"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/88", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/88", "notes": "https://gitlab.com/api/v4/projects/14022/issues/88/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/88/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 31654486, "type": null, "body": "Are you using the git repository from github? looks like that repo is not up to date with gitlab-shell repo from here , the latest tag there is 5.0.2", "attachment": null, "author": {"id": 637646, "name": "Andre Ferraz", "username": "deferraz", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/bab22a316bf1dc28d2621b59a0dd8e4a?s=80&d=identicon", "web_url": "https://gitlab.com/deferraz"}, "created_at": "2017-06-06T19:45:20.782Z", "updated_at": "2017-06-06T19:45:20.782Z", "system": false, "noteable_id": 5610558, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 88}], [{"id": 54336109, "type": null, "body": "v5.0.4 tags exist in both this repository and github. Perhaps a `git fetch` was missed, or the tags were slow to be replicated?", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:49:49.467Z", "updated_at": "2018-01-12T14:49:49.467Z", "system": false, "noteable_id": 5610558, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 88}], [{"id": 54336114, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:49:50.621Z", "updated_at": "2018-01-12T14:49:50.621Z", "system": true, "noteable_id": 5610558, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 88}]]}, {"id": 5593883, "iid": 87, "project_id": 14022, "title": "Time/monitor Sidekiq job insertion time", "description": "We saw that in https://gitlab.com/gitlab-com/infrastructure/issues/1935, a misconfiguration in Redis caused 30-60 delay in a push because post-receive took a while to timeout to another Redis Sentinel. \n\nWe should log and monitor the time it takes to insert a job into Sidekiq. If it takes more than a few seconds consistently, we should send off an alarm.", "state": "closed", "created_at": "2017-06-01T22:25:53.063Z", "updated_at": "2018-01-12T14:43:52.109Z", "closed_at": "2018-01-12T14:43:52.104Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "assignee": null, "user_notes_count": 4, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/87", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/87", "notes": "https://gitlab.com/api/v4/projects/14022/issues/87/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/87/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 31391081, "type": null, "body": "@bjk-gitlab What are your thoughts on instrumenting gitlab-shell, a process that runs and terminates quickly? This seems more like a job for something like statsd.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-06-02T14:39:36.536Z", "updated_at": "2017-06-02T14:39:36.536Z", "system": false, "noteable_id": 5593883, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 87}], [{"id": 31392820, "type": null, "body": "StatsD + statsd_exporter.  influxdb + indfluxdb_exporter, or pushgateway.", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2017-06-02T14:50:54.399Z", "updated_at": "2017-06-02T14:50:54.399Z", "system": false, "noteable_id": 5593883, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 87}], [{"id": 31419336, "type": null, "body": "Thanks! [Pushgateway](https://github.com/prometheus/pushgateway) seems like the most natural thing to do with Prometheus, but it's done over HTTP. I think the UDP approach from statsd or InfluxDB seems more appropriate.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-06-02T20:25:51.064Z", "updated_at": "2017-06-02T20:25:51.064Z", "system": false, "noteable_id": 5593883, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 87}], [{"id": 54335212, "type": null, "body": "We no longer insert jobs into sidekiq: #119. We do have `GitlabMetrics` instrumentation in place for the internal API calls that replaced it, and we can monitor the time those endpoints take on the gitlab-ce side as well, so I'll close this issue.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:43:51.356Z", "updated_at": "2018-01-12T14:43:51.356Z", "system": false, "noteable_id": 5593883, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 87}], [{"id": 54335221, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:43:52.153Z", "updated_at": "2018-01-12T14:43:52.153Z", "system": true, "noteable_id": 5593883, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 87}]]}, {"id": 5567726, "iid": 86, "project_id": 14022, "title": "Follow-up from \"Use gl_repository if present when enqueing Sidekiq PostReceive jobs\"", "description": "The following discussion from !132 should be addressed:\n\n- [ ] @eReGeBe started a [discussion](https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/132#note_31103971)", "state": "closed", "created_at": "2017-05-31T02:53:13.848Z", "updated_at": "2017-06-21T12:53:33.454Z", "closed_at": "2017-06-21T08:41:04.378Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}], "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "assignee": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/86", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 1, "completed_count": 0}, "has_tasks": true, "task_status": "0 of 1 task completed", "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/86", "notes": "https://gitlab.com/api/v4/projects/14022/issues/86/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/86/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 31211771, "type": null, "body": "assigned to @eReGeBe", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2017-05-31T21:13:17.869Z", "updated_at": "2017-05-31T21:13:17.869Z", "system": true, "noteable_id": 5567726, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 86}], [{"id": 32908098, "type": null, "body": "created branch [`86-follow-up-from-use-gl_repository-if-present-when-enqueing-sidekiq-postreceive-jobs`](https://gitlab.com/gitlab-org/gitlab-shell/compare/master...86-follow-up-from-use-gl_repository-if-present-when-enqueing-sidekiq-postreceive-jobs)", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2017-06-19T20:31:42.818Z", "updated_at": "2017-06-19T20:31:42.818Z", "system": true, "noteable_id": 5567726, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 86}], [{"id": 32908125, "type": null, "body": "mentioned in merge request !136", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2017-06-19T20:31:45.582Z", "updated_at": "2017-06-19T20:31:45.582Z", "system": true, "noteable_id": 5567726, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 86}], [{"id": 33084298, "type": null, "body": "closed via commit fa6343515ba65423e9de4c98c6005facc6059938", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-06-21T08:41:03.909Z", "updated_at": "2017-06-21T08:41:03.909Z", "system": true, "noteable_id": 5567726, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 86}], [{"id": 33084302, "type": null, "body": "closed via merge request !136", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-06-21T08:41:04.924Z", "updated_at": "2017-06-21T08:41:04.924Z", "system": true, "noteable_id": 5567726, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 86}], [{"id": 33109046, "type": null, "body": "mentioned in commit fa6343515ba65423e9de4c98c6005facc6059938", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-06-21T12:53:33.276Z", "updated_at": "2017-06-21T12:53:33.276Z", "system": true, "noteable_id": 5567726, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 86}]]}, {"id": 5485875, "iid": 85, "project_id": 14022, "title": "Go programs are not go1.5-compatible", "description": "In !127 we added a `hello-world` go binary. Unfortunately, this fails to compile on Go 1.5:\r\n\r\n```\r\nroot@025f6642d625:/gitlab-shell# bin/compile \r\n# gitlab.com/gitlab-org/gitlab-shell/go/vendor/google.golang.org/grpc/transport\r\ngo_build/src/gitlab.com/gitlab-org/gitlab-shell/go/vendor/google.golang.org/grpc/transport/http2_client.go:133: undefined: dialContext\r\ncommand failed: {\"GOPATH\"=>\"/gitlab-shell/go_build\", \"GO15VENDOREXPERIMENT\"=>\"1\"} go install gitlab.com/gitlab-org/gitlab-shell/go/cmd/...\r\nroot@025f6642d625:/gitlab-shell#\r\n```\r\n\r\nThe README.md states that go1.5 is supported, and some install-from-source users are having trouble as a result, e.g.: https://about.gitlab.com/2017/05/22/gitlab-9-2-released/#comment-3320082300\r\n\r\nCan we make this hello-world program go1.5-compatible in a hurry? Or is the better route to update the README and the install-from-source instructions? Is grpc fundamentally incompatible with go1.5 or is it just missing some files due to being vendored under the wrong version of go?\r\n\r\nRelatedly, I was hoping to add `.gitlab-ci.yml` `compile:go1.{5,6,7,8}` tasks but the `bin/compile` script is currently written in Ruby, making this more difficult than necessary (we can't just use the golang:1.X docker images). One way or another, we should be compiling, and running unit tests when they start to be needed, for every version of Go that we support.\r\n\r\n/cc @bkc @jacobvosmaer-gitlab", "state": "closed", "created_at": "2017-05-23T12:34:04.351Z", "updated_at": "2017-06-03T08:39:21.961Z", "closed_at": "2017-06-02T16:19:23.254Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}], "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "assignee": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "user_notes_count": 9, "merge_requests_count": 1, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/85", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/85", "notes": "https://gitlab.com/api/v4/projects/14022/issues/85/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/85/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 30458978, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-05-23T12:37:26.906Z", "updated_at": "2017-05-23T12:37:26.906Z", "system": true, "noteable_id": 5485875, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 85}], [{"id": 30654740, "type": null, "body": "same here got this too\r\n```\r\n[git@dev gitlab-shell]$ go version\r\ngo version go1.5.3 linux/amd64\r\n```", "attachment": null, "author": {"id": 5766, "name": "MrKeiKun", "username": "MrKeiKun", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3d05b760e98afb1c694cd990ec99cd3d?s=80&d=identicon", "web_url": "https://gitlab.com/MrKeiKun"}, "created_at": "2017-05-25T06:02:20.127Z", "updated_at": "2017-05-25T06:02:20.127Z", "system": false, "noteable_id": 5485875, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 85}], [{"id": 30855705, "type": null, "body": "how to solve this problem?\r\n>>\r\n\r\nI install v1.8.3 is solve ...\r\n\r\n", "attachment": null, "author": {"id": 786362, "name": "kay_chen", "username": "kaychen", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/4196325a864f12bad22da17805f99ca1?s=80&d=identicon", "web_url": "https://gitlab.com/kaychen"}, "created_at": "2017-05-27T14:12:53.853Z", "updated_at": "2017-05-27T14:28:43.684Z", "system": false, "noteable_id": 5485875, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 85}], [{"id": 30924680, "type": null, "body": "Hi,\r\nSame error\r\n\r\n```sh\r\n# sudo -u git -H git checkout v$(</home/git/gitlab/GITLAB_SHELL_VERSION)\r\nHEAD is now at 285c061... Bump version to 5.0.4\r\nroot@gitlab:/home/git/gitlab-shell# sudo -u git -H bin/compile\r\n# gitlab.com/gitlab-org/gitlab-shell/go/vendor/google.golang.org/grpc/transport\r\ngo_build/src/gitlab.com/gitlab-org/gitlab-shell/go/vendor/google.golang.org/grpc/transport/http2_client.go:133: undefined: dialContext\r\ncommand failed: {\"GOPATH\"=>\"/home/git/gitlab-shell/go_build\", \"GO15VENDOREXPERIMENT\"=>\"1\"} go install gitlab.com/gitlab-org/gitlab-shell/go/cmd/...\r\n```\r\n\r\n```\r\nSystem information\r\nSystem:\t\tUbuntu 14.04\r\nCurrent User:\tgit\r\nUsing RVM:\tno\r\nRuby Version:\t2.3.1p112\r\nGem Version:\t2.5.1\r\nBundler Version:1.14.5\r\nRake Version:\t10.5.0\r\nRedis Version:\t2.8.4\r\nGit Version:\t2.10.2\r\nSidekiq Version:5.0.0\r\n\r\nGitLab information\r\nVersion:\t9.2.2\r\nRevision:\tcbde95c\r\nDirectory:\t/home/git/gitlab\r\nDB Adapter:\tmysql2\r\n```", "attachment": null, "author": {"id": 28635, "name": "Florent Detry \ud83d\udda5", "username": "Fridus", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3ab73c6fee2e96f843bea6ae2104fcc7?s=80&d=identicon", "web_url": "https://gitlab.com/Fridus"}, "created_at": "2017-05-29T09:13:27.340Z", "updated_at": "2017-05-29T09:13:27.340Z", "system": false, "noteable_id": 5485875, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 85}], [{"id": 31310714, "type": null, "body": "@nick.thomas This one says \"update docs to state go 1.8\" https://gitlab.com/gitlab-org/gitlab-ce/issues/31943 \n\nAs for the CI you could use this image: https://gitlab.com/gitlab-org/gitlab-build-images/blob/master/Dockerfile.ruby-2.4.1-golang-1.8-git-2.7-phantomjs-2.1-node-7.1-postgresql-9.6 (or make a new one with only ruby+golang)", "attachment": null, "author": {"id": 487110, "name": "Kim Carlb\u00e4cker", "username": "bkc", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d05dbfb80d6b9a461cd4578f18709a83?s=80&d=identicon", "web_url": "https://gitlab.com/bkc"}, "created_at": "2017-06-01T17:52:57.782Z", "updated_at": "2017-06-01T17:52:57.782Z", "system": false, "noteable_id": 5485875, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 85}], [{"id": 31380321, "type": null, "body": "This should be an easy fix, we just need to grab an older version of grpc which is not going to be a problem.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-06-02T12:57:34.591Z", "updated_at": "2017-06-02T12:57:34.591Z", "system": false, "noteable_id": 5485875, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 85}], [{"id": 31382641, "type": null, "body": "mentioned in merge request !133", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-06-02T13:20:49.493Z", "updated_at": "2017-06-02T13:20:49.493Z", "system": true, "noteable_id": 5485875, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 85}], [{"id": 31382982, "type": null, "body": "assigned to @jacobvosmaer-gitlab", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-06-02T13:24:31.084Z", "updated_at": "2017-06-02T13:24:31.084Z", "system": true, "noteable_id": 5485875, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 85}], [{"id": 31383963, "type": null, "body": "@nick.thomas good idea to add a matrix for multiple go versions. I am not a big fan of shell scripts however.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-06-02T13:35:37.306Z", "updated_at": "2017-06-02T13:35:37.306Z", "system": false, "noteable_id": 5485875, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 85}], [{"id": 31384169, "type": null, "body": "We don't need a special version of Ruby for bin/compile. Can't we `apt-get install ruby` from within the go images?", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-06-02T13:36:58.941Z", "updated_at": "2017-06-02T13:36:58.941Z", "system": false, "noteable_id": 5485875, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 85}], [{"id": 31385646, "type": null, "body": "working on that in https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/134", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-06-02T13:52:46.005Z", "updated_at": "2017-06-02T13:52:46.005Z", "system": false, "noteable_id": 5485875, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 85}], [{"id": 31387624, "type": null, "body": "@jacobvosmaer-gitlab we can do that, but it will increase build time a little.The base image probably has perl... ;)", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-06-02T14:07:44.083Z", "updated_at": "2017-06-02T14:07:44.083Z", "system": false, "noteable_id": 5485875, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 85}], [{"id": 31404046, "type": null, "body": "closed via commit 1472f046fbcfb9378dea1fb5a2ecbb7d6982d585", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2017-06-02T16:19:23.478Z", "updated_at": "2017-06-02T16:19:23.478Z", "system": true, "noteable_id": 5485875, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 85}], [{"id": 31436959, "type": null, "body": "mentioned in commit savitojs/gitlab-shell@1472f046fbcfb9378dea1fb5a2ecbb7d6982d585", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2017-06-03T08:39:21.895Z", "updated_at": "2017-06-03T08:39:21.895Z", "system": true, "noteable_id": 5485875, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 85}]]}, {"id": 5361196, "iid": 83, "project_id": 14022, "title": "Follow-up from \"Handle GL_REPOSITORY env variable and use it in api calls\"", "description": "Update Gitlab Shell to pass only gl_repository", "state": "closed", "created_at": "2017-05-11T15:20:30.006Z", "updated_at": "2017-06-01T02:26:51.927Z", "closed_at": "2017-05-31T13:56:23.139Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}], "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "assignee": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/83", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/83", "notes": "https://gitlab.com/api/v4/projects/14022/issues/83/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/83/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 30625789, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2017-05-24T21:02:14.170Z", "updated_at": "2017-05-24T21:02:14.170Z", "system": true, "noteable_id": 5361196, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 83}], [{"id": 31103120, "type": null, "body": "mentioned in merge request !130", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2017-05-31T02:25:11.838Z", "updated_at": "2017-05-31T02:25:11.838Z", "system": true, "noteable_id": 5361196, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 83}], [{"id": 31103451, "type": null, "body": "created branch [`83-follow-up-from-handle-gl_repository-env-variable-and-use-it-in-api-calls`](https://gitlab.com/gitlab-org/gitlab-shell/compare/master...83-follow-up-from-handle-gl_repository-env-variable-and-use-it-in-api-calls)", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2017-05-31T02:36:02.062Z", "updated_at": "2017-05-31T02:36:02.062Z", "system": true, "noteable_id": 5361196, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 83}], [{"id": 31103453, "type": null, "body": "mentioned in merge request !132", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2017-05-31T02:36:03.467Z", "updated_at": "2017-05-31T02:36:03.467Z", "system": true, "noteable_id": 5361196, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 83}], [{"id": 31164875, "type": null, "body": "closed via merge request !132", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-05-31T13:56:23.200Z", "updated_at": "2017-05-31T13:56:23.200Z", "system": true, "noteable_id": 5361196, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 83}], [{"id": 31224019, "type": null, "body": "mentioned in commit savitojs/gitlab-shell@c64411662493dd7b64a84149dd1e3aa18588db7b", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-06-01T02:26:51.852Z", "updated_at": "2017-06-01T02:26:51.852Z", "system": true, "noteable_id": 5361196, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 83}]]}, {"id": 5057853, "iid": 81, "project_id": 14022, "title": "Remove Ruby's Timeout.timeout from pull/push logic", "description": "as it is being discussed in https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/124#note_27501394\n\n`Timeout.timeout` poses some serious problems and should be avoided at all costs.\n\n\\cc @stanhu @smcgivern", "state": "opened", "created_at": "2017-04-15T16:50:29.554Z", "updated_at": "2017-04-17T10:04:02.163Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 117638, "name": "Tiago Botelho", "username": "tiagonbotelho", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/117638/avatar.png", "web_url": "https://gitlab.com/tiagonbotelho"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/81", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/81", "notes": "https://gitlab.com/api/v4/projects/14022/issues/81/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/81/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 27528253, "type": null, "body": "(I'm assuming we're pulling over **HTTP** here, ignore if we don't)\n\nNot saying it's nice (but nicer than `Timeout.timeout`, but you could abuse [`http.lowSpeedTime`](https://github.com/git/git/blob/master/Documentation/config.txt#L1956) to get a timeout. Setting the `Limit` to way high (above what we can pull, probably configurable) and then use `Time` as a regular timeout.\n\n```patch\n cmd = %W(git --git-dir=#{full_path} fetch #{@name} --prune --quiet)\n+# Limit is 1Gbps in bps\n+cmd << '-c http.lowSpeedLimit=1000000000 -c http.lowSpeedTime=#{timeout}'\n```", "attachment": null, "author": {"id": 487110, "name": "Kim Carlb\u00e4cker", "username": "bkc", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d05dbfb80d6b9a461cd4578f18709a83?s=80&d=identicon", "web_url": "https://gitlab.com/bkc"}, "created_at": "2017-04-15T19:43:23.514Z", "updated_at": "2017-04-15T19:43:23.514Z", "system": false, "noteable_id": 5057853, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 81}], [{"id": 27573031, "type": null, "body": "@bkc I love it! :smiley: Unfortunately we can use SSH here :disappointed:\n\nIn the specific case mentioned here, I don't think we're too vulnerable, but I might be misunderstanding the scope:\n\n1. We don't have any other threads.\n2. The command that can be interrupted at any point is something we're shelling out to anyway.\n\nI might be wrong, though! And it's certainly possible to imagine a future where those aren't both true.", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-04-17T10:04:01.634Z", "updated_at": "2017-04-17T10:04:01.634Z", "system": false, "noteable_id": 5057853, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 81}]]}, {"id": 5011386, "iid": 80, "project_id": 14022, "title": "Is it OK to include Go code in this repository?", "description": "Rationale in https://gitlab.com/gitlab-org/gitaly/issues/91#note_27246560\n\nIn short, gitlab-shell needs to act as a Gitaly client. Two options:\n\n- start using Bundler and C extensions in gitlab-shell (breaking with current design)\n- create a standalone Go executable that can talk to Gitaly\n\nI propose the second. That means we need to put the source code of that executable somewhere. I propose we put it in this repo, under a `/go` directory.\n\n@rymai @smcgivern @DouweM @rspeicher (current gitlab-shell maintainers) is this OK?", "state": "closed", "created_at": "2017-04-11T10:01:58.969Z", "updated_at": "2019-08-07T08:27:06.277Z", "closed_at": null, "closed_by": null, "labels": ["Gitaly [DEPRECATED]", "devops::create", "group::gitaly"], "milestone": null, "assignees": [], "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "assignee": null, "user_notes_count": 6, "merge_requests_count": 0, "upvotes": 2, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/80", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/80", "notes": "https://gitlab.com/api/v4/projects/14022/issues/80/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/80/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 27247261, "type": null, "body": "mentioned in issue gitaly#91", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-11T10:02:50.350Z", "updated_at": "2017-04-11T10:02:50.350Z", "system": true, "noteable_id": 5011386, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 80}, {"id": 27247512, "type": null, "body": "We can also ask ourselves if bundler & native extensions are really that bad. I think one argument against is that it is finnicky to control these parameters when `bin/gitlab-shell` is launched by sshd:\n\n- which `ruby` executable (hence Ruby runtime) is used\n- BUNLDE_GEMFILE or whatever is needed to help bundler, because the current working directory is the user's home directory /home/git, not /home/git/gitlab-shell\n\nI think the Go helper executable idea solves these problems well because it is a static binary.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-11T10:06:07.743Z", "updated_at": "2017-04-11T10:06:07.743Z", "system": false, "noteable_id": 5011386, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 80}, {"id": 27254302, "type": null, "body": "> I propose the second. That means we need to put the source code of that executable somewhere. I propose we put it in this repo, under a `/go` directory.\n\n@jacobvosmaer-gitlab I'd be ok with that!", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2017-04-11T11:20:47.841Z", "updated_at": "2017-04-11T11:20:47.841Z", "system": false, "noteable_id": 5011386, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 80}, {"id": 27270417, "type": null, "body": "This all sounds pretty reasonable to me. In fact, gitlab-shell itself would be easier to ship as a static binary, but that's probably a bigger question :slight_smile:", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-04-11T14:00:41.763Z", "updated_at": "2017-04-11T14:00:41.763Z", "system": false, "noteable_id": 5011386, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 80}, {"id": 27272109, "type": null, "body": "Well one nice benefit of this is that it puts the plumbing in place to migrate gitlab-shell commands to Go, one at a time.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-11T14:17:48.923Z", "updated_at": "2017-04-11T14:17:48.923Z", "system": false, "noteable_id": 5011386, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 80}, {"id": 27275513, "type": null, "body": "It sounds like we're going to do this. This will be driven from the Gitaly team. I think we (I?) will start with a plumbing MR that only adds a `bin/hello-world` Go executable to gitlab-shell.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-11T14:56:08.275Z", "updated_at": "2017-04-11T14:56:08.275Z", "system": false, "noteable_id": 5011386, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 80}, {"id": 27277432, "type": null, "body": "Closing in the assumption that the final verdict is \"it is OK\". Please reopen if I'm wrong. :)", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-11T15:17:23.595Z", "updated_at": "2017-04-11T15:17:23.595Z", "system": false, "noteable_id": 5011386, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 80}, {"id": 27277434, "type": null, "body": "closed", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-11T15:17:24.008Z", "updated_at": "2017-04-11T15:17:24.008Z", "system": true, "noteable_id": 5011386, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 80}, {"id": 27281456, "type": null, "body": "mentioned in merge request !127", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-11T16:13:57.500Z", "updated_at": "2017-04-11T16:13:57.500Z", "system": true, "noteable_id": 5011386, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 80}, {"id": 27339913, "type": null, "body": "mentioned in merge request gitlab-development-kit!282", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-12T11:40:55.314Z", "updated_at": "2017-04-12T11:40:55.314Z", "system": true, "noteable_id": 5011386, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 80}], [{"id": 28258142, "type": null, "body": "mentioned in issue gitaly#193", "attachment": null, "author": {"id": 895869, "name": "Andrew Newdigate", "username": "andrewn", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/895869/avatar.png", "web_url": "https://gitlab.com/andrewn"}, "created_at": "2017-04-26T09:18:42.144Z", "updated_at": "2017-04-26T09:18:42.144Z", "system": true, "noteable_id": 5011386, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 80}]]}, {"id": 5173561, "iid": 82, "project_id": 14022, "title": "create-hooks doesn't work for GitLab 9.x subgroups", "description": "While attempting to migrate my GitLab installation to a new server I discovered that the `create-hooks` script doesn't support the new subgroups feature which means the symlinks aren't been generated for new and restored instances.\n\nFor now, I've manually re-created these links but it would be awesome to see this fixed.", "state": "closed", "created_at": "2017-04-06T13:16:58.442Z", "updated_at": "2017-04-26T07:29:37.326Z", "closed_at": "2017-04-25T18:33:03.386Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}], "author": {"id": 1210151, "name": "Chris Shaw", "username": "cshawaus", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/89a81f4cc3cec373f6a1547fde9e8c26?s=80&d=identicon", "web_url": "https://gitlab.com/cshawaus"}, "assignee": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "user_notes_count": 2, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/82", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/82", "notes": "https://gitlab.com/api/v4/projects/14022/issues/82/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/82/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 28124251, "type": null, "body": "@chris.upjohn Thanks for the report! You're right, it looks like this script hasn't yet been updated to cope with subgroups\n\nRelevant code:\n* https://gitlab.com/gitlab-org/gitlab-shell/blob/3986309c0aee87ee5091c6b3de1205c3411cb45b/bin/create-hooks#L14", "attachment": null, "author": {"id": 419655, "name": "Mark Fletcher", "username": "markglenfletcher", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/419655/avatar.png", "web_url": "https://gitlab.com/markglenfletcher"}, "created_at": "2017-04-25T03:47:11.951Z", "updated_at": "2017-04-25T03:47:11.951Z", "system": false, "noteable_id": 5173561, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 82}], [{"id": 28124369, "type": null, "body": "/cc @dzaporozhets", "attachment": null, "author": {"id": 419655, "name": "Mark Fletcher", "username": "markglenfletcher", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/419655/avatar.png", "web_url": "https://gitlab.com/markglenfletcher"}, "created_at": "2017-04-25T03:51:44.363Z", "updated_at": "2017-04-25T03:51:44.363Z", "system": false, "noteable_id": 5173561, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 82}], [{"id": 28208750, "type": null, "body": "mentioned in merge request !128", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2017-04-25T17:41:50.480Z", "updated_at": "2017-04-25T17:41:50.480Z", "system": true, "noteable_id": 5173561, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 82}], [{"id": 28208997, "type": null, "body": "assigned to @dzaporozhets", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2017-04-25T17:45:21.434Z", "updated_at": "2017-04-25T17:45:21.434Z", "system": true, "noteable_id": 5173561, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 82}], [{"id": 28211552, "type": null, "body": "closed via merge request !128", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2017-04-25T18:33:03.973Z", "updated_at": "2017-04-25T18:33:03.973Z", "system": true, "noteable_id": 5173561, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 82}], [{"id": 28248380, "type": null, "body": "mentioned in commit savitojs/gitlab-shell@158b424f9aec0e4ce439f56cb193e369b36e0e46", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2017-04-26T07:29:37.323Z", "updated_at": "2017-04-26T07:29:37.323Z", "system": true, "noteable_id": 5173561, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 82}]]}, {"id": 4957818, "iid": 79, "project_id": 14022, "title": "add-key should fail if the required number of arguments are not specified", "description": "We saw in gitlab-org/gitlab-ce!10466 that it's possible for `gitlab-shell add-key` to be called with insufficient/blank arguments. We should refuse to add a key and send a warning message if this is attempted.\n\n/cc: @MrChrisW", "state": "opened", "created_at": "2017-04-05T06:28:20.285Z", "updated_at": "2017-04-11T17:41:56.551Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/79", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/79", "notes": "https://gitlab.com/api/v4/projects/14022/issues/79/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/79/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 27284071, "type": null, "body": "We already have some code for that, interesting that it didn't catch it.\n\nhttps://gitlab.com/gitlab-org/gitlab-shell/blob/684599daddefd2b6149c5f99a620424f6f26166c/lib/gitlab_keys.rb#L82-83", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-11T16:54:53.911Z", "updated_at": "2017-04-11T16:54:53.911Z", "system": false, "noteable_id": 4957818, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 79}, {"id": 27286608, "type": null, "body": "That's true for the batch case, but the simple `add_key` case doesn't have that check.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-04-11T17:41:56.547Z", "updated_at": "2017-04-11T17:41:56.547Z", "system": false, "noteable_id": 4957818, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 79}]]}, {"id": 4957334, "iid": 78, "project_id": 14022, "title": "Log in UTC", "description": "#### Overview\n\ngitlab-shell's logger uses the local instances timezone for the timestamp, when logging information to `gitlab-shell.log` \n\n```\nI, [2017-04-05T03:32:03.861957 #28240]  INFO \n```\n\n#### Proposal \n\nBy default use UTC time for the log timestamp", "state": "opened", "created_at": "2017-04-05T04:40:09.396Z", "updated_at": "2017-04-05T04:40:09.396Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 444214, "name": "Chris", "username": "MrChrisW", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444214/avatar.png", "web_url": "https://gitlab.com/MrChrisW"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/78", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/78", "notes": "https://gitlab.com/api/v4/projects/14022/issues/78/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/78/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 4938931, "iid": 77, "project_id": 14022, "title": "Can we remove the direct dependency of gitlab-shell hooks on Redis?", "description": "Gitlab-shell integrates with Redis in two ways, both of them in the push hooks:\r\n\r\n- directly enqueueing Sidekiq PostReceive jobs\r\n- reference counter to wait for active pushes to finish when trying to migrate the repository to another storage\r\n\r\nThis seems needlessly complex. I am wondering if we can get rid of the Redis dependency and do everything with HTTP calls to the internal API instead.\r\n\r\nI was involved as a reviewer in making the second Redis interaction (counters); I don't remember exactly why we chose to go to Redis directly but I am not sure it is needed.\r\n\r\nThe first Redis interaction (enqueueing Sidekiq jobs) goes way back to [gitlab-shell 1.0, 4 years ago](https://gitlab.com/gitlab-org/gitlab-shell/blob/a7304fe0600aaaebe46d984954ca4f12707e00e5/hooks/post-receive#L10).\r\n\r\n@dzaporozhets do you remember if there was a special reason to enqueue to Redis directly, instead of going via a HTTP API call (with Rails enqueuing the job)?", "state": "closed", "created_at": "2017-04-03T10:03:23.190Z", "updated_at": "2019-08-07T08:27:08.531Z", "closed_at": "2018-01-12T15:08:11.777Z", "closed_by": null, "labels": ["Gitaly [DEPRECATED]", "devops::create", "group::gitaly"], "milestone": null, "assignees": [], "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "assignee": null, "user_notes_count": 13, "merge_requests_count": 0, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/77", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/77", "notes": "https://gitlab.com/api/v4/projects/14022/issues/77/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/77/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 26720520, "type": null, "body": "cc @pcarranza", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-03T10:03:30.154Z", "updated_at": "2017-04-03T10:03:30.154Z", "system": false, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}, {"id": 26720648, "type": null, "body": "mentioned in issue gitaly#74", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-03T10:05:32.119Z", "updated_at": "2017-04-03T10:05:32.119Z", "system": true, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}, {"id": 26721649, "type": null, "body": "cc @eReGeBe because you were the main person working on the counters.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-03T10:20:29.074Z", "updated_at": "2017-04-03T10:20:29.074Z", "system": false, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}, {"id": 26725227, "type": null, "body": "I would to it through the API call, that would also allow us to reduce the number of redis connections as a whole.", "attachment": null, "author": {"id": 274314, "name": "Pablo Carranza [GitLab]", "username": "pcarranza-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/69cd9eb49317e1207ce3ee115f28a9ad?s=80&d=identicon", "web_url": "https://gitlab.com/pcarranza-gitlab"}, "created_at": "2017-04-03T11:11:32.719Z", "updated_at": "2017-04-03T11:11:32.719Z", "system": false, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}, {"id": 26727857, "type": null, "body": "@pcarranza yes, I think there are several benefits to doing these things through HTTP API calls.\n\n- less code and configuration in gitlab-shell\n- no need to maintain the 'schema' of the PostReceive jobs in both gitlab-shell and gitlab-ce\n- as Pablo mentions, less Redis connection churn in production\n\nWhat I am not sure about is what is the benefit (today), if there is any, of doing things in Redis directly from gitlab-shell.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-03T11:55:50.401Z", "updated_at": "2017-04-03T11:55:50.401Z", "system": false, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}, {"id": 26793211, "type": null, "body": "> do you remember if there was a special reason to enqueue to Redis directly, instead of going via a HTTP API call (with Rails enqueuing the job)?\n\n@jacobvosmaer-gitlab I believe it was done that way even before gitlab-shell. At that time there were no such thing as internal API so it was boring solution. Now I believe its a good time to replace it with API call", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2017-04-04T10:00:31.370Z", "updated_at": "2017-04-04T10:00:31.370Z", "system": false, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}, {"id": 26856716, "type": null, "body": "I tend to agree from a design point of view, especially since gitlab-shell has to reverse engineer the Sidekiq format when it talks to Redis. However, I'll bring up the counterargument: having gitlab-shell talk directly to Redis means it can still file Sidekiq events even if Rails is busy/tied up with other requests. If we were to change this, for every push event, we:\n\n1. Check the /internal/allowed endpoint\n2. Send a request to /internal/some_event to post the event\n\nIf for some reason step 2 fails, we could lose these push events, and repository updates could go \"missing\".", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-04-05T06:34:29.690Z", "updated_at": "2017-04-05T06:34:29.690Z", "system": false, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}, {"id": 26860585, "type": null, "body": "A counter-counter-argument to that is that we have scale Redis for both the API and the direct accesses and we need to spread logic for failure cases and also the credentials in 2 places forcing us into shotgun surgery whenever we need to change things. It's the opposite of DRY.\n\nI rather worry about scaling the API at the right level knowing that all the Redis access will come that way than having similar logic in multiple places to allow random weird usage.\n\nAdditionally, @stanhu, your example can fail the same way with and without direct Redis access, just that now we would need to code for failure both in the API **and** in `gitlab-shell` specific direct Redis access.\n\nOn top of that, good engineering practices say that we need to code for failure. If your Redis insertion fails on the API we could also code a retry mechanism, or even queue these operations somewhere else (even log?), so we don't fail so easily.", "attachment": null, "author": {"id": 274314, "name": "Pablo Carranza [GitLab]", "username": "pcarranza-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/69cd9eb49317e1207ce3ee115f28a9ad?s=80&d=identicon", "web_url": "https://gitlab.com/pcarranza-gitlab"}, "created_at": "2017-04-05T07:32:53.439Z", "updated_at": "2017-04-05T07:32:53.439Z", "system": false, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}, {"id": 26991336, "type": null, "body": "With regards to the [counter code](https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/71) (not to be confused with counter-arguments :), I think the decision was just \"a fast storage for this value\". As long as shell is talking to Redis for some other reason I think that is a better fit for the counters, because rails doesn't do anything with them for them to be on CE's code. But if we remove the need for Redis elsewhere (and I do side with moving the Sidekiq code to the API), then it probably doesn't justify leaving it just for this feature, and then we should move it too.", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2017-04-06T18:10:11.698Z", "updated_at": "2017-04-06T18:11:09.902Z", "system": false, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}, {"id": 27063537, "type": null, "body": "The push hooks are already heavily dependent on the internal API. If `pre-receive` cannot reach the internal API, your push is rejected.\n\nThe only argument against I can think of is the one raised by @stanhu : that using Redis to send the notification might in practice somehow be more reliable than using the HTTP API. But first of all we have no way to validate that, and even if it is true, this extra reliability comes at a very large complexity cost.\n\nShall we say that Redis has to go?", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-07T14:38:00.165Z", "updated_at": "2017-04-07T14:38:00.165Z", "system": false, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}, {"id": 27246834, "type": null, "body": "I propose we create three follow-up issues:\r\n\r\n- migrate post-receive submission from Redis to internal HTTP API\r\n- migrate counter logic from Redis to internal HTTP API\r\n- delete all Redis code from gitlab-shell (also touches gitlab-ce, omnibus because those set up gitlab-shell)\r\n\r\n@stanhu do you agree? (Not sure who better to ask)", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-11T09:57:08.867Z", "updated_at": "2017-04-11T09:57:28.050Z", "system": false, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}, {"id": 27276867, "type": null, "body": "mentioned in merge request !115", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-11T15:09:43.566Z", "updated_at": "2017-04-11T15:09:43.566Z", "system": true, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}], [{"id": 27817977, "type": null, "body": "Adding the ~Gitaly label because, while this isn't strictly a Gitaly change, Gitaly is dependent on it.", "attachment": null, "author": {"id": 895869, "name": "Andrew Newdigate", "username": "andrewn", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/895869/avatar.png", "web_url": "https://gitlab.com/andrewn"}, "created_at": "2017-04-20T13:23:02.841Z", "updated_at": "2017-04-20T13:23:02.841Z", "system": false, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}], [{"id": 27817984, "type": null, "body": "added ~1507480 label", "attachment": null, "author": {"id": 895869, "name": "Andrew Newdigate", "username": "andrewn", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/895869/avatar.png", "web_url": "https://gitlab.com/andrewn"}, "created_at": "2017-04-20T13:23:08.304Z", "updated_at": "2017-04-20T13:23:08.304Z", "system": true, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}], [{"id": 39194527, "type": null, "body": "Also note that `/notify_post_receive` currently exists, but doesn't do anything. Once `/post_receive` is in use, I imagine `/notify_post_receive` will go away. See https://gitlab.com/gitlab-org/gitlab-ce/issues/18667#note_38476397.", "attachment": null, "author": {"id": 90962, "name": "Jonathon Reinhart", "username": "JonathonReinhart", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/90962/1916566_sm.jpg", "web_url": "https://gitlab.com/JonathonReinhart"}, "created_at": "2017-09-03T20:00:45.852Z", "updated_at": "2017-09-03T20:00:45.852Z", "system": false, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}], [{"id": 39194618, "type": null, "body": "mentioned in merge request !166", "attachment": null, "author": {"id": 90962, "name": "Jonathon Reinhart", "username": "JonathonReinhart", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/90962/1916566_sm.jpg", "web_url": "https://gitlab.com/JonathonReinhart"}, "created_at": "2017-09-03T20:05:08.454Z", "updated_at": "2017-09-03T20:05:08.454Z", "system": true, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}], [{"id": 54338998, "type": null, "body": "This is done in v6.0.0", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:08:11.164Z", "updated_at": "2018-01-12T15:08:11.164Z", "system": false, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}], [{"id": 54338999, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:08:11.832Z", "updated_at": "2018-01-12T15:08:11.832Z", "system": true, "noteable_id": 4938931, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 77}]]}, {"id": 4895000, "iid": 76, "project_id": 14022, "title": "create-hooks doesn't work for GitLab 9.x subgroups", "description": "While attempting to migrate my GitLab installation to a new server I discovered that the `create-hooks` does not support the new subgroups feature which means the symlinks aren't been generated for new and restored instances.\n\nFor now, I've manually re-created these links but it would be awesome to see this fixed.", "state": "closed", "created_at": "2017-03-29T10:33:23.062Z", "updated_at": "2017-04-06T13:16:00.835Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1210151, "name": "Chris Shaw", "username": "cshawaus", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/89a81f4cc3cec373f6a1547fde9e8c26?s=80&d=identicon", "web_url": "https://gitlab.com/cshawaus"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/76", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/76", "notes": "https://gitlab.com/api/v4/projects/14022/issues/76/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/76/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 26971199, "type": null, "body": "closed", "attachment": null, "author": {"id": 1210151, "name": "Chris Shaw", "username": "cshawaus", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/89a81f4cc3cec373f6a1547fde9e8c26?s=80&d=identicon", "web_url": "https://gitlab.com/cshawaus"}, "created_at": "2017-04-06T13:16:00.829Z", "updated_at": "2017-04-06T13:16:00.829Z", "system": true, "noteable_id": 4895000, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 76}]]}, {"id": 4676784, "iid": 75, "project_id": 14022, "title": "Syntax Error in application_setting.rb when trying to install Shell", "description": "Running this command from a Trusty [installation guide](https://www.linode.com/docs/applications/development/install-gitlab-on-ubuntu-14-04-trusty-tahr) (working on setting up a GitLab instance on EC2), I am getting the following output.  The guide is a little dated, as it walks you through setting up version 6.9 with Shell version 1.9, but I am not sure if that would have caused any problems.\r\n\r\nAnyway, here is the error and stracktrace:\r\n\r\n```\r\n$ bundle exec rake gitlab:shell:install[v5.0.0] REDIS_URL=redis://localhost:6379 RAILS_ENV=production --trace\r\n** Invoke gitlab:shell:install (first_time)\r\n** Invoke environment (first_time)\r\n** Execute environment\r\nD, [2017-03-09T16:31:42.532454 #3755] DEBUG -- sentry: ** [Raven] /home/git/gitlab/app/models/application_setting.rb:135: syntax error, unexpected '.'\r\n    value&.each do |level|\r\n           ^\r\n/home/git/gitlab/app/models/application_setting.rb:143: syntax error, unexpected '.'\r\n    value&.each do |source|\r\n           ^\r\n/home/git/gitlab/app/models/application_setting.rb:151: syntax error, unexpected '.'\r\n    value&.each do |source|\r\n           ^\r\n/home/git/gitlab/app/models/application_setting.rb:256: syntax error, unexpected '.'\r\n    self.domain_whitelist&.join(\"\\n\")\r\n                           ^\r\n/home/git/gitlab/app/models/application_setting.rb:260: syntax error, unexpected '.'\r\n    self.domain_blacklist&.join(\"\\n\")\r\n                           ^ excluded from capture due to environment or should_capture callback\r\nrake aborted!\r\nSyntaxError: /home/git/gitlab/app/models/application_setting.rb:135: syntax error, unexpected '.'\r\n    value&.each do |level|\r\n           ^\r\n/home/git/gitlab/app/models/application_setting.rb:143: syntax error, unexpected '.'\r\n    value&.each do |source|\r\n           ^\r\n/home/git/gitlab/app/models/application_setting.rb:151: syntax error, unexpected '.'\r\n    value&.each do |source|\r\n           ^\r\n/home/git/gitlab/app/models/application_setting.rb:256: syntax error, unexpected '.'\r\n    self.domain_whitelist&.join(\"\\n\")\r\n                           ^\r\n/home/git/gitlab/app/models/application_setting.rb:260: syntax error, unexpected '.'\r\n    self.domain_blacklist&.join(\"\\n\")\r\n                           ^\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/dependencies.rb:274:in `require'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/dependencies.rb:274:in `block in require'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/dependencies.rb:240:in `load_dependency'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/dependencies.rb:274:in `require'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/dependencies.rb:360:in `require_or_load'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/dependencies.rb:494:in `load_missing_constant'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/dependencies.rb:184:in `const_missing'\r\n/home/git/gitlab/config/initializers/1_settings.rb:464:in `<top (required)>'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/dependencies.rb:268:in `load'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/dependencies.rb:268:in `block in load'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/dependencies.rb:240:in `load_dependency'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/dependencies.rb:268:in `load'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/railties-4.2.8/lib/rails/engine.rb:652:in `block in load_config_initializer'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/notifications.rb:166:in `instrument'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/railties-4.2.8/lib/rails/engine.rb:651:in `load_config_initializer'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/railties-4.2.8/lib/rails/engine.rb:616:in `block (2 levels) in <class:Engine>'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/railties-4.2.8/lib/rails/engine.rb:615:in `each'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/railties-4.2.8/lib/rails/engine.rb:615:in `block in <class:Engine>'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/railties-4.2.8/lib/rails/initializable.rb:30:in `instance_exec'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/railties-4.2.8/lib/rails/initializable.rb:30:in `run'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/railties-4.2.8/lib/rails/initializable.rb:55:in `block in run_initializers'\r\n/usr/local/lib/ruby/2.1.0/tsort.rb:226:in `block in tsort_each'\r\n/usr/local/lib/ruby/2.1.0/tsort.rb:348:in `block (2 levels) in each_strongly_connected_component'\r\n/usr/local/lib/ruby/2.1.0/tsort.rb:418:in `block (2 levels) in each_strongly_connected_component_from'\r\n/usr/local/lib/ruby/2.1.0/tsort.rb:427:in `each_strongly_connected_component_from'\r\n/usr/local/lib/ruby/2.1.0/tsort.rb:417:in `block in each_strongly_connected_component_from'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/railties-4.2.8/lib/rails/initializable.rb:44:in `each'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/railties-4.2.8/lib/rails/initializable.rb:44:in `tsort_each_child'\r\n/usr/local/lib/ruby/2.1.0/tsort.rb:411:in `call'\r\n/usr/local/lib/ruby/2.1.0/tsort.rb:411:in `each_strongly_connected_component_from'\r\n/usr/local/lib/ruby/2.1.0/tsort.rb:347:in `block in each_strongly_connected_component'\r\n/usr/local/lib/ruby/2.1.0/tsort.rb:345:in `each'\r\n/usr/local/lib/ruby/2.1.0/tsort.rb:345:in `call'\r\n/usr/local/lib/ruby/2.1.0/tsort.rb:345:in `each_strongly_connected_component'\r\n/usr/local/lib/ruby/2.1.0/tsort.rb:224:in `tsort_each'\r\n/usr/local/lib/ruby/2.1.0/tsort.rb:205:in `tsort_each'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/railties-4.2.8/lib/rails/initializable.rb:54:in `run_initializers'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/railties-4.2.8/lib/rails/application.rb:352:in `initialize!'\r\n/home/git/gitlab/config/environment.rb:5:in `<top (required)>'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/dependencies.rb:274:in `require'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/dependencies.rb:274:in `block in require'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/dependencies.rb:240:in `load_dependency'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/activesupport-4.2.8/lib/active_support/dependencies.rb:274:in `require'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/railties-4.2.8/lib/rails/application.rb:328:in `require_environment!'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/railties-4.2.8/lib/rails/application.rb:457:in `block in run_tasks_blocks'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/task.rb:240:in `call'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/task.rb:240:in `block in execute'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/task.rb:235:in `each'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/task.rb:235:in `execute'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/task.rb:179:in `block in invoke_with_call_chain'\r\n/usr/local/lib/ruby/2.1.0/monitor.rb:211:in `mon_synchronize'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/task.rb:172:in `invoke_with_call_chain'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/task.rb:201:in `block in invoke_prerequisites'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/task.rb:199:in `each'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/task.rb:199:in `invoke_prerequisites'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/task.rb:178:in `block in invoke_with_call_chain'\r\n/usr/local/lib/ruby/2.1.0/monitor.rb:211:in `mon_synchronize'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/task.rb:172:in `invoke_with_call_chain'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/task.rb:165:in `invoke'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/application.rb:150:in `invoke_task'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/application.rb:106:in `block (2 levels) in top_level'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/application.rb:106:in `each'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/application.rb:106:in `block in top_level'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/application.rb:115:in `run_with_threads'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/application.rb:100:in `top_level'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/application.rb:78:in `block in run'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/application.rb:176:in `standard_exception_handling'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/lib/rake/application.rb:75:in `run'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/gems/rake-10.5.0/bin/rake:33:in `<top (required)>'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/bin/rake:23:in `load'\r\n/home/git/gitlab/vendor/bundler/ruby/2.1.0/bin/rake:23:in `<top (required)>'\r\n/usr/local/lib/ruby/gems/2.1.0/gems/bundler-1.14.6/lib/bundler/cli/exec.rb:74:in `load'\r\n/usr/local/lib/ruby/gems/2.1.0/gems/bundler-1.14.6/lib/bundler/cli/exec.rb:74:in `kernel_load'\r\n/usr/local/lib/ruby/gems/2.1.0/gems/bundler-1.14.6/lib/bundler/cli/exec.rb:27:in `run'\r\n/usr/local/lib/ruby/gems/2.1.0/gems/bundler-1.14.6/lib/bundler/cli.rb:335:in `exec'\r\n/usr/local/lib/ruby/gems/2.1.0/gems/bundler-1.14.6/lib/bundler/vendor/thor/lib/thor/command.rb:27:in `run'\r\n/usr/local/lib/ruby/gems/2.1.0/gems/bundler-1.14.6/lib/bundler/vendor/thor/lib/thor/invocation.rb:126:in `invoke_command'\r\n/usr/local/lib/ruby/gems/2.1.0/gems/bundler-1.14.6/lib/bundler/vendor/thor/lib/thor.rb:359:in `dispatch'\r\n/usr/local/lib/ruby/gems/2.1.0/gems/bundler-1.14.6/lib/bundler/cli.rb:20:in `dispatch'\r\n/usr/local/lib/ruby/gems/2.1.0/gems/bundler-1.14.6/lib/bundler/vendor/thor/lib/thor/base.rb:440:in `start'\r\n/usr/local/lib/ruby/gems/2.1.0/gems/bundler-1.14.6/lib/bundler/cli.rb:11:in `start'\r\n/usr/local/lib/ruby/gems/2.1.0/gems/bundler-1.14.6/exe/bundle:32:in `block in <top (required)>'\r\n/usr/local/lib/ruby/gems/2.1.0/gems/bundler-1.14.6/lib/bundler/friendly_errors.rb:121:in `with_friendly_errors'\r\n/usr/local/lib/ruby/gems/2.1.0/gems/bundler-1.14.6/exe/bundle:24:in `<top (required)>'\r\n/usr/local/bin/bundle:23:in `load'\r\n/usr/local/bin/bundle:23:in `<main>'\r\nTasks: TOP => gitlab:shell:install => environment\r\n```", "state": "closed", "created_at": "2017-03-10T00:38:21.894Z", "updated_at": "2018-01-12T14:46:02.836Z", "closed_at": "2018-01-12T14:46:02.831Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 1178268, "name": "Alex DeMars", "username": "ademars94", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/56413c6fd56ace5655d17229184e6de6?s=80&d=identicon", "web_url": "https://gitlab.com/ademars94"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/75", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/75", "notes": "https://gitlab.com/api/v4/projects/14022/issues/75/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/75/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 54335493, "type": null, "body": "This issue should have been in gitlab-ce - however, it looks like you were using an older ruby than we expect: 2.1 instead of 2.3 ?", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:46:02.205Z", "updated_at": "2018-01-12T14:46:02.205Z", "system": false, "noteable_id": 4676784, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 75}], [{"id": 54335494, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:46:02.875Z", "updated_at": "2018-01-12T14:46:02.875Z", "system": true, "noteable_id": 4676784, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 75}]]}, {"id": 4077286, "iid": 74, "project_id": 14022, "title": "Feature flag to allow Golang implementations of gitlab-shell functionality to be selected", "description": "As a first step toward rewriting gitlab-shell in Go, we need a `bin/gitlab-shell` binary that can service commands with the existing Ruby binary, or switch to experimental Go reimplementations of the same functionality if requested in the configuration file.\n\n---\n(original description):\n\nBecause of the way bin/gitlab-shell integrates with sshd it is a disadvantage that we use Ruby. It depends on the Linux distribution how you can make sure that bin/gitlab-shell uses the right Ruby runtime. We have been avoiding this problem by making sure that bin/gitlab-shell works with _any_ Ruby runtime on the system: we don't use Bundler, and no third-party C extensions. (Both of these are tied to the Ruby runtime.)\n\nIn omnibus-gitlab we solve this by rewriting all ruby scripts in gitlab-shell during the build, to use the Ruby runtime embedded in omnibus-gitlab. But we still support installations from source and the way we organize GitLab itself is that everything should be able to run without Omnibus.\n\nThis idea is relevant because we chose to build [gitaly](https://gitlab.com/gitlab-org/gitaly) using gRPC, which needs a C extension on Ruby. The Go version of gRPC is native, meaning that we can trivially compile a static executable with a gRPC client in it. Our current plan is to make a command-line gitaly client, and to make that client a dependency of gitlab-shell. This is the same approach we used to use with Redis (gitlab-shell/hooks/post-receive use to shell out to redis-cli). We no longer use redis-cli because we figured out we could vendor the Redis gem because it is native Ruby (no C extensions).\n\nOver time I have heard several people (@brodock, @bjk-gitlab, @vsizov ) suggest it would be _nicer_ if bin/gitlab-shell and the hooks were re-written in Go because then we can use any third-party library we want (as long it is native Go code) and integration with sshd becomes less problematic.\n\nThis issue is meant for discussion of this idea.", "state": "closed", "created_at": "2017-01-26T14:18:57.619Z", "updated_at": "2018-12-19T11:19:07.082Z", "closed_at": "2018-09-28T15:46:09.755Z", "closed_by": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "labels": ["Create [DEPRECATED]", "backstage", "devops::create", "performance", "technical debt", "workflow::In review"], "milestone": {"id": 567670, "iid": 19, "group_id": 9970, "title": "11.4", "description": "", "state": "closed", "created_at": "2018-06-14T17:31:41.249Z", "updated_at": "2018-12-20T06:49:55.749Z", "due_date": "2018-10-22", "start_date": "2018-09-08", "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/19"}, "assignees": [{"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}], "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "assignee": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "user_notes_count": 28, "merge_requests_count": 1, "upvotes": 5, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/74", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/74", "notes": "https://gitlab.com/api/v4/projects/14022/issues/74/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/74/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 22117266, "type": null, "body": "One of the problems with doing a rewrite is that gitlab-shell is a critical security / authentication / authorization component, and all its test are white-box Ruby: we don't test if the executables do what they should, we test if the ruby code in the executables does what it should. That means we cannot reuse any current tests in a Go rewrite, and it opens up a fairly large risk of breakage (of the interaction with gitlab-rails) and security regressions.\n\nMy gut feeling is that these costs/risks outweigh the benefits. On the other hand, having a patchwork of Ruby code and helper executables constitutes technical debt.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-01-26T14:24:05.763Z", "updated_at": "2017-01-26T14:24:05.763Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}, {"id": 22117905, "type": null, "body": "While the risk is real, the code-base is not so big. The critical part is the parsing of commands, etc. While we can't re-use the ruby tests we can port a few of them.\n\nIf we can also create some blackbox integration tests, we can reduce the risk quite a lot.\nI think it's nice to at least try a POC with Go.", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2017-01-26T14:34:19.426Z", "updated_at": "2017-01-26T14:34:19.426Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}, {"id": 22117914, "type": null, "body": "We should also ask ourselves where the hooks should 'live'. They will run on the gitaly servers eventually. Should they become part of gitaly?", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-01-26T14:34:26.598Z", "updated_at": "2017-01-26T14:34:26.598Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}, {"id": 22117983, "type": null, "body": "What would a PoC demonstrate? That it can be done? I don't doubt that. The question is how much work is it, and can we justify doing that work. _When_ can we justify it.\r\n\r\n@brodock or do you mean a PoC that demonstrates the testing strategy?", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-01-26T14:35:29.827Z", "updated_at": "2017-01-26T14:37:55.647Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}, {"id": 22120303, "type": null, "body": "One data point: on development machines, `gitlab-shell` frequently causes problems for people due to its use of the system ruby runtime (no `CLOCK_MONOTONIC` on some macs). That's an actual pain we are experiencing now, that this would solve.\r\n\r\nI've done this kind of migration before; having a set of blackbox tests you can run against both implementations is extremely useful. If we add them to the `gitlab-shell` repository as a first step, even if we decide not to go ahead with the switch, it's still valuable work as it can test the Ruby code in perpetuity.\r\n\r\nWe might even find some more bugs in the process ;)", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-01-26T15:08:15.626Z", "updated_at": "2017-01-26T15:08:58.850Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}, {"id": 22121021, "type": null, "body": "@jacobvosmaer-gitlab I mean, a PoC is a nice way to estimate the \"whole thing\". I find difficult to estimate time over too much unknown. The PoC will help answer things like do we need external libraries? How mature they are? etc.\r\n\r\nA one week timeboxed hands-on can give us much data than multiple abstract meetings :)", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2017-01-26T15:20:08.998Z", "updated_at": "2017-01-26T17:10:53.623Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}, {"id": 22121204, "type": null, "body": "@brodock Yes, I think a 1-week timebox effort is a good idea.", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2017-01-26T15:23:00.223Z", "updated_at": "2017-01-26T15:23:00.223Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 28449737, "type": null, "body": "It looks like bin/gitlab-shell will slowly start to morph into a Go binary. https://gitlab.com/gitlab-org/gitaly/issues/193 Not literally, but it will start handing off to a Go process. This can eventually lead to gitlab-shell being a Go process.\n\nThe hooks will soon have to run on the Gitaly servers. That may (or may not) motivate us to move them to the Gitaly repository. It is fine to leave them where they are and how they for now, from a Gitaly perspective.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-04-28T12:13:36.325Z", "updated_at": "2017-04-28T12:13:36.325Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 38204279, "type": null, "body": "A small update, although hooks must indeed run on the Gitaly servers, we have no plans to rewrite them in any way. There is no time for that. We will just have gitlab-shell installed on the Gitaly servers.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-08-22T14:28:33.000Z", "updated_at": "2017-08-22T14:28:33.000Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 38305044, "type": null, "body": "Rewriting them is on my radar for %10.0", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-08-23T12:09:42.788Z", "updated_at": "2017-08-23T12:09:42.788Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 38305073, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-08-23T12:09:50.168Z", "updated_at": "2017-08-23T12:09:50.168Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 38502310, "type": null, "body": "removed assignee", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-08-25T09:51:18.179Z", "updated_at": "2017-08-25T09:51:18.179Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 38502413, "type": null, "body": "Holding off, per https://gitlab.com/gitlab-org/gitlab-shell/issues/97#note_38502250", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-08-25T09:52:19.988Z", "updated_at": "2017-08-25T09:52:19.988Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 54337477, "type": null, "body": "From v6.0.0, the code is *much* simpler, making the risk of a go reimplementation much lower.\n\nOn the other hand, since we no longer have a redis library to load, run times are probably also lower, although I haven't benchmarked it yet. I expect the performance argument for a rewrite is now weaker, but avoiding a dependency on the system ruby version was always more compelling, at least to my mind.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:59:01.006Z", "updated_at": "2018-01-12T14:59:01.006Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 54345694, "type": null, "body": "/cc @lyda", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2018-01-12T15:56:54.626Z", "updated_at": "2018-01-12T15:56:54.626Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 54345910, "type": null, "body": "We still have to deal with metrics collection from short-lived processes.", "attachment": null, "author": {"id": 928230, "name": "Ben Kochie", "username": "bjk-gitlab", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/928230/avatar.png", "web_url": "https://gitlab.com/bjk-gitlab"}, "created_at": "2018-01-12T15:58:40.624Z", "updated_at": "2018-01-12T15:58:40.624Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 54346408, "type": null, "body": "Here's a case where we might want to rewrite in Go for performance: https://gitlab.com/gitlab-org/gitlab-shell/issues/106", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-01-12T16:02:41.299Z", "updated_at": "2018-01-12T16:02:41.299Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 94620170, "type": null, "body": "@stanhu @jacobvosmaer\\-gitlab @ash.mckenzie @rspeicher This has come into my thoughts again, following the gitlab-shell refactor-then-revert issues we've had around the v8.1 release: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/214 and https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/228\n\nPerformance is one issue, code quality is another. We're in a situation where making changes to the gitlab-shell codebase (for performance *or* quality improvements) is difficult. We know a Go reimplementation would solve the performance concerns, and it also does an end-run around the quality-of-the-existing-codebase issue, since it'd be a new codebase ;)\n\nThere are also parallels with the `gitlab-elasticsearch-indexer` rewrite done in https://gitlab.com/gitlab-org/gitlab-elasticsearch-indexer\n\nOne thing that came out of that process is the value of keeping both implementations available and allowing them to be selectable at runtime. This allowed us to recommend that people enable the Go version to improve performance, but if they hit a regression that blocked them, it was easy to go back to the working version until the regression was fixed.\n\nThe major downside is needing to maintain two different implementations of the same thing, of course, which is why we're now looking to remove the Ruby version of the elasticsearch indexer. The pain of this - especially for relatively-infrequently-changing code - is low, though.\n\nThe hooks are moving into Gitaly, so I don't think there's much value in working on them as part of this issue. I **do** think that adding a `go/gitlab-shell` implementation in this repository would be valuable. It can compile to `gitlab-shell`, and we can rename the existing `bin/gitlab-shell` to `bin/gitlab-shell-ruby`.\n\nThe config file can include an `experimental:` key. If set to true, the Go binary processes commands itself; otherwise it just forks and execs `bin/gitlab-shell-ruby`. This should allow us to have both versions of the code available while doing the rewrite. We can even move functionality one call at a time.\n\nIn Gitaly, the ruby sidecar has given us some problems - mostly relating to external dependencies. gitlab-shell doesn't have those, so it's not an issue I'm concerned with here!\n\nSince this issue was written, we've also gained a number of specs that execute `bin/gitlab-shell` against a mock HTTP server that pretends to be gitlab-ce. These could be run with equal facility against `gitlab-shell-ruby` and `gitlab-shell-go`", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-15T07:52:54.856Z", "updated_at": "2018-08-15T07:54:57.836Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 94624420, "type": null, "body": "I'm signed up to run a UGC session entitled \"Golang 101\" at the 2018 summit. If it gets picked, I think this issue would be a really good candidate for real code to work on *during* that session - assuming we can get some agreement that the above is a reasonable strategy! CCing @jeremy_ as ~Manage PM for that.\n\nHaving a wrapper around `gitlab-shell-ruby` *also* gives us a reasonable place to put the `--disable-gems` argument to the Ruby interpreter:\n\n```\nlupine@gitlab-t470p:~/dev/gitlab.com/gitlab-org/gitlab-development-kit/gitlab-shell$ time ruby bin/gitlab-shell\nOnly ssh allowed\n\nreal\t0m0.032s\nuser\t0m0.031s\nsys\t0m0.001s\nlupine@gitlab-t470p:~/dev/gitlab.com/gitlab-org/gitlab-development-kit/gitlab-shell$ time ruby --disable-gems bin/gitlab-shell\nOnly ssh allowed\n\nreal\t0m0.008s\nuser\t0m0.005s\nsys\t0m0.004s\n```\n\nThis allows us to knock 47 thousandths off of boot time, which should more than compensate for the additional process boot and config read time.\n\nIn Ruby, booting with `--disable-gems` and parsing the config totals 32 thousandths:\n\n```\nlupine@gitlab-t470p:~/dev/gitlab.com/gitlab-org/gitlab-development-kit/gitlab-shell$ time ruby --disable-gems -e 'require \"yaml\"; YAML.load(File.read(\"config.yml\"))'\n\nreal\t0m0.016s\nuser\t0m0.012s\nsys\t0m0.004s\n```\n\nSo a net  benefit of 15  - it'd be a little bit faster in Go. Even introducing a no-op Golang gitlab-shell binary will, *at worst*, be a slight performance improvement \\o/\n\nIt also lets us remove the existing omnibus-gitlab shell script rewrite hack for `bin/gitlab-shell` - we can just add a `ruby: ` line to config.yml for the wrapper to read, falling back to an unqualified `ruby` if unset.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-15T08:16:12.498Z", "updated_at": "2018-08-15T08:18:12.633Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 94624475, "type": null, "body": "added ~7161201 ~3011727 ~3712065 ~2731248 labels", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-15T08:16:35.468Z", "updated_at": "2018-08-15T08:16:35.468Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 94639371, "type": null, "body": "Moving to ~Create per discussion with @DouweM about where gitlab-shell falls. Sorry for the noise! \n\n/cc @jramsay", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-15T09:35:14.959Z", "updated_at": "2018-08-15T09:35:14.959Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 94639438, "type": null, "body": "added ~7156613 ~3103452 and removed ~7161201 labels", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-15T09:35:30.833Z", "updated_at": "2018-08-15T09:35:30.833Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 94639605, "type": null, "body": "added ~3011693 and removed ~3712065 labels", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-15T09:36:32.706Z", "updated_at": "2018-08-15T09:36:32.706Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 94653392, "type": null, "body": "mentioned in issue gitlab-qa#311", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-15T10:49:18.189Z", "updated_at": "2018-08-15T10:49:18.189Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 94674249, "type": null, "body": "changed milestone to %\"Backlog\"", "attachment": null, "author": {"id": 1187333, "name": "James Ramsay", "username": "jramsay", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1187333/avatar.png", "web_url": "https://gitlab.com/jramsay"}, "created_at": "2018-08-15T12:40:28.272Z", "updated_at": "2018-08-15T12:40:28.272Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 94706126, "type": null, "body": "Sounds good @nick.thomas \n\n- focus on the SSH parts, forget about the hooks\n- create a go `gitlab-shell` executable that can defer to `gitlab-shell-ruby` if config.yml says so\n\nI think the first hurdle is to add more tests that exercise the executables against a mock HTTP server.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2018-08-15T15:11:42.922Z", "updated_at": "2018-08-15T15:11:42.922Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 94708029, "type": null, "body": "@nick.thomas Re https://gitlab.com/gitlab-org/gitlab-shell/issues/74#note_94624420, isn't the `--disable-rubygems` flag done by Omnibus already via https://gitlab.com/gitlab-org/omnibus-gitlab/merge_requests/1707?", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2018-08-15T15:20:53.142Z", "updated_at": "2018-08-15T15:20:53.142Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 94724546, "type": null, "body": "@stanhu ah, I missed that going in! \n\nMy intent was to show that the worst-case outcome of introducing an extra process in the chain was a small change in performance; I think that's still the case. I guess we're talking +32 instead of -17 thousandths to total execution time.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-15T16:23:58.532Z", "updated_at": "2018-08-15T16:23:58.532Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 94724877, "type": null, "body": "@jacobvosmaer\\-gitlab agreed. We've got https://gitlab.com/gitlab-org/gitlab-shell/blob/master/spec/gitlab_shell_spec.rb now, but there's a lot not in there yet.\n\nI've recently opened this qa issue too: https://gitlab.com/gitlab-org/gitlab-qa/issues/311", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-15T16:26:38.642Z", "updated_at": "2018-08-28T08:04:50.683Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 94779901, "type": null, "body": "Also see #149", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-15T21:44:48.328Z", "updated_at": "2018-08-15T21:44:48.328Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 97033728, "type": null, "body": "assigned to @nick.thomas", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-27T11:01:08.028Z", "updated_at": "2018-08-27T11:01:08.028Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 97034159, "type": null, "body": "UGC is happening, so I will work on the aforementioned `gitlab-shell`and `gitlab-shell-ruby` changes tomorrow: !233\n\nOther parts of gitlab-shell that need Go implementations:\n\n* Hooks to Gitlay (@zj is working on this)\n* Internal API client library (@zj / @reprazent) https://gitlab.com/gitlab-org/gitlab-shell/issues/158\n* `git pull` support https://gitlab.com/gitlab-org/gitlab-shell/issues/160\n* `git push` support https://gitlab.com/gitlab-org/gitlab-shell/issues/161\n* `git archive` support #162\n* two-factor auth support #159\n* LFS authentication support https://gitlab.com/gitlab-org/gitlab-shell/issues/163", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-27T11:03:15.432Z", "updated_at": "2018-10-01T12:44:31.398Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 97268698, "type": null, "body": "mentioned in merge request !233", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-28T08:38:26.167Z", "updated_at": "2018-08-28T08:38:26.167Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 97734366, "type": null, "body": "> Internal API client library\n\nI didn't get this finished during the summit :grin:, @jramsay is this something we want to schedule?", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2018-08-29T21:11:52.532Z", "updated_at": "2018-08-29T21:11:52.532Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 97744557, "type": null, "body": "mentioned in merge request !234", "attachment": null, "author": {"id": 171554, "name": "Bob Van Landuyt", "username": "reprazent", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/171554/avatar.png", "web_url": "https://gitlab.com/reprazent"}, "created_at": "2018-08-29T22:04:21.057Z", "updated_at": "2018-08-29T22:04:21.057Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 104729991, "type": null, "body": "mentioned in issue #158", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-27T10:44:17.347Z", "updated_at": "2018-09-27T10:44:17.347Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 104730321, "type": null, "body": "Golang API client library has been split out into its own issue: https://gitlab.com/gitlab-org/gitlab-shell/issues/158", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-27T10:45:05.932Z", "updated_at": "2018-09-27T10:45:05.932Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 104730907, "type": null, "body": "I'll split out the other gitlab-shell items mentioned in https://gitlab.com/gitlab-org/gitlab-shell/issues/74#note_97034159 out into their own issues once the feature flag is merged, so they don't accidentally get scheduled before it's possible to do them :D", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-27T10:46:10.020Z", "updated_at": "2018-09-27T10:46:10.020Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 104940277, "type": null, "body": "changed milestone to %\"11.4\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-28T03:55:43.519Z", "updated_at": "2018-09-28T03:55:43.519Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 104940464, "type": null, "body": "changed title from **{-Rewrite bin/gitlab-shell and the hooks in Go?-}** to **{+Feature flag to allow Golang implementations of gitlab-shell functionality to be selected+}**", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-28T03:58:11.967Z", "updated_at": "2018-09-28T03:58:11.967Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 104940465, "type": null, "body": "changed the description", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-09-28T03:58:11.994Z", "updated_at": "2018-09-28T03:58:11.994Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 105123201, "type": null, "body": "closed via commit 3cf936123cda48a8856fb6cd534331f2dabe9e15", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-09-28T15:46:09.801Z", "updated_at": "2018-09-28T15:46:09.801Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 105527189, "type": null, "body": "mentioned in issue #159", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:33:22.273Z", "updated_at": "2018-10-01T12:33:22.273Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 105528557, "type": null, "body": "mentioned in issue #160", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:38:13.582Z", "updated_at": "2018-10-01T12:38:13.582Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 105528980, "type": null, "body": "mentioned in issue #161", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:40:00.426Z", "updated_at": "2018-10-01T12:40:00.426Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 105529717, "type": null, "body": "mentioned in issue #162", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:41:54.751Z", "updated_at": "2018-10-01T12:41:54.751Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 105530274, "type": null, "body": "mentioned in issue #163", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:44:15.108Z", "updated_at": "2018-10-01T12:44:15.108Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 105530559, "type": null, "body": "OK, all follow-up issues created. If anything is missing or you feel like more detail can be usefully added to any of them, please do!", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-10-01T12:45:13.806Z", "updated_at": "2018-10-01T12:45:13.806Z", "system": false, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 111511414, "type": null, "body": "mentioned in commit 3cf936123cda48a8856fb6cd534331f2dabe9e15", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-10-24T15:19:41.950Z", "updated_at": "2018-10-24T15:19:41.950Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}], [{"id": 126125616, "type": null, "body": "mentioned in issue gitlab-com/www-gitlab-com#3559", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-12-19T11:19:07.070Z", "updated_at": "2018-12-19T11:19:07.070Z", "system": true, "noteable_id": 4077286, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 74}]]}, {"id": 3942755, "iid": 73, "project_id": 14022, "title": "Question: capturing messages from remote on git-push", "description": "Use case:\nUser does a `git push -u origin feature/awesome` and receives the following from remote:\n\n```\nremote: \nremote: To create a merge request for feature/awesome, visit:\nremote:   https://gitlab.com/project-awesome?merge_request%5Bsource_branch%5D=feature/awesome\nremote: \n```\n\nI'd like to streamline my cli workflow with prs a bit with a script that pulls the url from the remote message here, but I can't seem to get my head around where this output resides. It's neither in stdout or stderr.\n\nLooking at !77 didn't help much besides pointing me to redis, but that's a blind alley for me atm.\n\nA hint would be greatly appreciated!", "state": "closed", "created_at": "2017-01-11T21:11:59.722Z", "updated_at": "2017-03-24T16:24:48.162Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 11749, "name": "Marek", "username": "mlisik", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0c81aa1c8d118e9337018f18919768ec?s=80&d=identicon", "web_url": "https://gitlab.com/mlisik"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/73", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/73", "notes": "https://gitlab.com/api/v4/projects/14022/issues/73/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/73/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 21266691, "type": null, "body": "Closing, I was just going about the outputs all wrong!", "attachment": null, "author": {"id": 11749, "name": "Marek", "username": "mlisik", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0c81aa1c8d118e9337018f18919768ec?s=80&d=identicon", "web_url": "https://gitlab.com/mlisik"}, "created_at": "2017-01-11T21:41:49.215Z", "updated_at": "2017-01-11T21:41:49.215Z", "system": false, "noteable_id": 3942755, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 73}, {"id": 21266692, "type": null, "body": "closed", "attachment": null, "author": {"id": 11749, "name": "Marek", "username": "mlisik", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0c81aa1c8d118e9337018f18919768ec?s=80&d=identicon", "web_url": "https://gitlab.com/mlisik"}, "created_at": "2017-01-11T21:41:49.254Z", "updated_at": "2017-01-11T21:41:49.254Z", "system": true, "noteable_id": 3942755, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 73}]]}, {"id": 3786712, "iid": 72, "project_id": 14022, "title": "http+unix client does not set Host header", "description": "This seems to be incorrect behavior that was being tolerated by some servers. However, the 8.15 omnibus-gitlab packages use Go 1.7, and it seems like Go 1.7 rejects requests lacking a Host: header.\n\nSo the broken HTTP client used for unix sockets in gitlab-shell breaks when used with GitLab 8.15 and gitlab-workhorse.\n\nHard to tell what the impact is because this is a non-standard configuration. And some people who use the unix socket option use it to connect to Unicorn, not gitlab-workhorse, and Unicorn may not mind the missing Host header.", "state": "closed", "created_at": "2016-12-21T12:36:24.400Z", "updated_at": "2017-12-06T16:20:04.441Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}], "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "assignee": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "user_notes_count": 5, "merge_requests_count": 2, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/72", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/72", "notes": "https://gitlab.com/api/v4/projects/14022/issues/72/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/72/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 20338546, "type": null, "body": "The reason the Host header is missing is that in the http+unix scheme the 'host' part of the API URL is used to indicate the path to the unix socket.\n\nThe most reasonable thing we can do for now is to hack that client so that it sets `Host: localhost`, I think. It is not entirely obvious to me how to do that because you have to know how Net::HTTP works.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2016-12-21T12:39:59.989Z", "updated_at": "2016-12-21T12:39:59.989Z", "system": false, "noteable_id": 3786712, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 72}, {"id": 20384882, "type": null, "body": "Cross posting from https://gitlab.com/gitlab-com/infrastructure/issues/904#note_20348472\n\n> I am a bit interested therefore I took a look. I think `Net::HTTP` is using `#addr_port` for the `Host` header, which was overridden to be `#address` in `Net::HTTPUNIX`. This sounds to me that it would use something like this as the `Host` header: `%2Fhome%2Fgit%2Fgitlab%2Ftmp%2Fsockets%2Fgitlab-workhorse.socket`. And I do believe that this would be an invalid hostname, however, it's not missing. Could you confirm if it's really missing `Host` header, or that? If so, I \"guess\" this could be fixed easily.", "attachment": null, "author": {"id": 423915, "name": "Lin Jen-Shin", "username": "godfat", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80&d=identicon", "web_url": "https://gitlab.com/godfat"}, "created_at": "2016-12-22T11:39:21.085Z", "updated_at": "2016-12-22T11:39:21.085Z", "system": false, "noteable_id": 3786712, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 72}, {"id": 20384957, "type": null, "body": "For the reference, this was the original commit: https://gitlab.com/gitlab-org/gitlab-shell/commit/184385ac5b15ee8b7dc6fa5278f7e711de275921", "attachment": null, "author": {"id": 423915, "name": "Lin Jen-Shin", "username": "godfat", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/8c73dab2ecd23d5b5627a0235ae2f9b1?s=80&d=identicon", "web_url": "https://gitlab.com/godfat"}, "created_at": "2016-12-22T11:41:33.308Z", "updated_at": "2016-12-22T11:41:33.308Z", "system": false, "noteable_id": 3786712, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 72}, {"id": 20777020, "type": null, "body": "mentioned in issue gitaly#37", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-01-02T14:17:54.897Z", "updated_at": "2017-01-02T14:17:54.897Z", "system": true, "noteable_id": 3786712, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 72}, {"id": 20777469, "type": null, "body": "I am going to look at this for a few minutes.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-01-02T14:35:01.767Z", "updated_at": "2017-01-02T14:35:01.767Z", "system": false, "noteable_id": 3786712, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 72}, {"id": 20777471, "type": null, "body": "assigned to @jacobvosmaer-gitlab", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-01-02T14:35:02.451Z", "updated_at": "2017-01-02T14:35:02.451Z", "system": true, "noteable_id": 3786712, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 72}, {"id": 20777671, "type": null, "body": "I propose we vendor [Excon](https://github.com/excon/excon#unix-socket-support) which is pure ruby (no native extension problems), has not dependencies of its own, and support Unix sockets out of the box.\r\n\r\n- vendoring because we cannot use Bundler\r\n- not the first time, we do the same with Redis in gitlab-shell\r\n- Net::HTTP only lets you create a custom connection by monkey-patching. I don't think we should go deeper down that rabbit hole.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-01-02T14:40:23.089Z", "updated_at": "2017-01-02T14:49:33.255Z", "system": false, "noteable_id": 3786712, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 72}, {"id": 20780726, "type": null, "body": "mentioned in merge request !115", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-01-02T15:50:43.889Z", "updated_at": "2017-01-02T15:50:43.889Z", "system": true, "noteable_id": 3786712, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 72}, {"id": 20784765, "type": null, "body": "mentioned in merge request !116", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-01-02T18:10:39.747Z", "updated_at": "2017-01-02T18:10:39.747Z", "system": true, "noteable_id": 3786712, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 72}, {"id": 20809978, "type": null, "body": "mentioned in merge request !117", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2017-01-03T10:10:06.875Z", "updated_at": "2017-01-03T10:10:06.875Z", "system": true, "noteable_id": 3786712, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 72}, {"id": 20812004, "type": null, "body": "closed via commit f61bdfe39c6b0618144f369d5cf4df1099be9948", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-01-03T10:55:49.587Z", "updated_at": "2017-01-03T10:55:49.587Z", "system": true, "noteable_id": 3786712, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 72}, {"id": 20816111, "type": null, "body": "mentioned in commit savitojs/gitlab-shell@f61bdfe39c6b0618144f369d5cf4df1099be9948", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-01-03T12:16:28.219Z", "updated_at": "2017-01-03T12:16:28.219Z", "system": true, "noteable_id": 3786712, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 72}]]}, {"id": 3666366, "iid": 71, "project_id": 14022, "title": "Remove unused `GitlabProjects` commands", "description": "- `create-tags`: gitlab-org/gitlab-shell!26\n- `list-projects`\n- `gc`", "state": "closed", "created_at": "2016-12-05T14:27:38.712Z", "updated_at": "2018-01-12T14:41:20.872Z", "closed_at": "2018-01-12T14:41:20.862Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/71", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/71", "notes": "https://gitlab.com/api/v4/projects/14022/issues/71/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/71/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 19433719, "type": null, "body": "mentioned in merge request !26", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2016-12-05T14:27:56.866Z", "updated_at": "2016-12-05T14:27:56.866Z", "system": true, "noteable_id": 3666366, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 71}], [{"id": 54334851, "type": null, "body": "gitlab_projects has been removed entirely: #113", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:41:20.133Z", "updated_at": "2018-01-12T14:41:20.133Z", "system": false, "noteable_id": 3666366, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 71}], [{"id": 54334855, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:41:20.926Z", "updated_at": "2018-01-12T14:41:20.926Z", "system": true, "noteable_id": 3666366, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 71}]]}, {"id": 3517939, "iid": 70, "project_id": 14022, "title": "Push fails because of missing dependencies on gitlab_custom_hooks", "description": "https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/106 introduced `gitlab_metrics` into `gitlab_custom_hook`, but since the former requires the constant `ROOT_PATH`, which is defined in `gitlab_init` but not included, you get the following exception when trying to push:\n\n```\nremote: /Users/alejandro/gdk/gitlab-shell/lib/gitlab_config.rb:7:in `initialize': uninitialized constant GitlabConfig::ROOT_PATH (NameError)\nremote: \tfrom /Users/alejandro/gdk/gitlab-shell/lib/gitlab_logger.rb:13:in `new'\nremote: \tfrom /Users/alejandro/gdk/gitlab-shell/lib/gitlab_logger.rb:13:in `<top (required)>'\nremote: \tfrom /Users/alejandro/gdk/gitlab-shell/lib/gitlab_metrics.rb:3:in `require_relative'\nremote: \tfrom /Users/alejandro/gdk/gitlab-shell/lib/gitlab_metrics.rb:3:in `<top (required)>'\nremote: \tfrom /Users/alejandro/gdk/gitlab-shell/lib/gitlab_custom_hook.rb:2:in `require_relative'\nremote: \tfrom /Users/alejandro/gdk/gitlab-shell/lib/gitlab_custom_hook.rb:2:in `<top (required)>'\nremote: \tfrom hooks/pre-receive:11:in `require_relative'\nremote: \tfrom hooks/pre-receive:11:in `<main>'\n```", "state": "closed", "created_at": "2016-11-16T22:17:36.597Z", "updated_at": "2017-03-24T16:24:48.284Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}], "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "assignee": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/70", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/70", "notes": "https://gitlab.com/api/v4/projects/14022/issues/70/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/70/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 18529901, "type": null, "body": "Started branch [`70-push-fails-because-of-missing-dependencies-on-gitlab_custom_hooks`](https://gitlab.com/gitlab-org/gitlab-shell/compare/master...70-push-fails-because-of-missing-dependencies-on-gitlab_custom_hooks)", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2016-11-16T22:17:48.279Z", "updated_at": "2016-11-16T22:17:48.279Z", "system": true, "noteable_id": 3517939, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 70}, {"id": 18530025, "type": null, "body": "Mentioned in merge request !107", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2016-11-16T22:21:50.002Z", "updated_at": "2016-11-16T22:21:50.002Z", "system": true, "noteable_id": 3517939, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 70}, {"id": 18556708, "type": null, "body": "Mentioned in merge request !93", "attachment": null, "author": {"id": 163557, "name": "Elan Ruusam\u00e4e", "username": "glensc", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/effff0989c8041ef98aaf916c7092d6d?s=80&d=identicon", "web_url": "https://gitlab.com/glensc"}, "created_at": "2016-11-17T09:29:41.829Z", "updated_at": "2016-11-17T09:29:41.829Z", "system": true, "noteable_id": 3517939, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 70}, {"id": 18562718, "type": null, "body": "Status changed to closed by merge request !107", "attachment": null, "author": {"id": 209240, "name": "Yorick Peterse", "username": "yorickpeterse", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/209240/avatar.png", "web_url": "https://gitlab.com/yorickpeterse"}, "created_at": "2016-11-17T11:30:47.924Z", "updated_at": "2016-11-17T11:30:47.924Z", "system": true, "noteable_id": 3517939, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 70}]]}, {"id": 3496940, "iid": 69, "project_id": 14022, "title": "`CLOCK_MONOTONIC` requires ruby >= 2.1", "description": "With **gitlab-shell** `>= 3.6.5`, metrics was introduced and it made gitlab-shell incompatible with ruby `2.0.x`.\r\n\r\nTrying to push code that runs with **gitlab-shell** `>= 3.6.5` and ruby `2.0.x` gives me the following error message:\r\n\r\n```\r\n/home/git/gitlab-shell/lib/gitlab_metrics.rb:24:in `monotonic_time': uninitialized constant Process::CLOCK_MONOTONIC (NameError)\r\n\tfrom /home/git/gitlab-shell/lib/gitlab_metrics.rb:44:in `measure'\r\n\tfrom /home/git/gitlab-shell/lib/gitlab_shell.rb:37:in `exec'\r\n\tfrom /home/git/gitlab-shell/bin/gitlab-shell:20:in `<main>'\r\nfatal: Could not read from remote repository.\r\n\r\nPlease make sure you have the correct access rights\r\nand the repository exists.\r\n```\r\n\r\ncc @yorickpeterse ", "state": "closed", "created_at": "2016-11-14T21:58:18.431Z", "updated_at": "2017-12-01T19:36:25.252Z", "closed_at": "2017-08-09T10:40:47.301Z", "closed_by": null, "labels": ["bug", "regression"], "milestone": null, "assignees": [], "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "assignee": null, "user_notes_count": 10, "merge_requests_count": 1, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/69", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/69", "notes": "https://gitlab.com/api/v4/projects/14022/issues/69/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/69/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 18337903, "type": null, "body": "I thought we are only supporting Ruby  2.1 and 2.3 now. Is this an issue?", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-11-14T21:59:45.433Z", "updated_at": "2016-11-14T21:59:45.433Z", "system": false, "noteable_id": 3496940, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 69}, {"id": 18338107, "type": null, "body": "@stanhu README says we support 2.0.", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2016-11-14T22:05:57.639Z", "updated_at": "2016-11-14T22:05:57.639Z", "system": false, "noteable_id": 3496940, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 69}, {"id": 18455307, "type": null, "body": "@stanhu @brodock We bumped the requirement for GitLab CE/EE. We should also bump this for gitlab-shell.", "attachment": null, "author": {"id": 209240, "name": "Yorick Peterse", "username": "yorickpeterse", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/209240/avatar.png", "web_url": "https://gitlab.com/yorickpeterse"}, "created_at": "2016-11-15T16:52:34.556Z", "updated_at": "2016-11-15T16:52:34.556Z", "system": false, "noteable_id": 3496940, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 69}, {"id": 18470600, "type": null, "body": "@yorickpeterse we could do that in `4.0`, but ideally we shouldn't break this kind of compatibility in a patch release. Is there any \"less precise\" alternative we can use to the specific line, that will keep `2.0` happy?", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2016-11-15T20:42:03.547Z", "updated_at": "2016-11-15T20:42:03.547Z", "system": false, "noteable_id": 3496940, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 69}, {"id": 18477163, "type": null, "body": "@brodock \n\n> we could do that in 4.0, but ideally we shouldn't break this kind of compatibility in a patch release\n\nThen we can just release 4.0, there's no reason to delay that.\n\n> Is there any \"less precise\" alternative we can use to the specific line, that will keep 2.0 happy?\n\n`Process::CLOCK_REALTIME` is an alternative, but it's not a monotonic clock and thus not very reliable.", "attachment": null, "author": {"id": 209240, "name": "Yorick Peterse", "username": "yorickpeterse", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/209240/avatar.png", "web_url": "https://gitlab.com/yorickpeterse"}, "created_at": "2016-11-15T23:29:01.376Z", "updated_at": "2016-11-15T23:29:01.376Z", "system": false, "noteable_id": 3496940, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 69}, {"id": 21908873, "type": null, "body": "I also ran into this because my system Ruby version was `ruby 2.0.0p648`(macOS 10.12) even though I use rvm Ruby 2.3.3. Then learned \"GitLab shell will always use your system ruby\".\r\n\r\nI was able to get it working by adding the proper rvm commands to `.bashrc` like I already had in `.profile` and `.zshrc`, see https://github.com/gitlabhq/gitlab-shell/issues/12#issuecomment-274622994", "attachment": null, "author": {"id": 892863, "name": "Eric Eastwood", "username": "MadLittleMods", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/4d634a2b818e2265fa2924b5f4c2da71?s=80&d=identicon", "web_url": "https://gitlab.com/MadLittleMods"}, "created_at": "2017-01-23T21:30:39.444Z", "updated_at": "2017-01-23T21:30:39.444Z", "system": false, "noteable_id": 3496940, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 69}], [{"id": 37012292, "type": null, "body": "@yorickpeterse can we change the code from: \r\n\r\n```ruby\r\n    def self.monotonic_time\r\n      Process.clock_gettime(Process::CLOCK_MONOTONIC, :millisecond)\r\n    end\r\n```\r\n\r\nto \r\n\r\n```ruby\r\n    def self.monotonic_time\r\n      if defined?(Process::CLOCK_MONOTONIC)\r\n        Process.clock_gettime(Process::CLOCK_MONOTONIC, :millisecond)\r\n      else\r\n        Process.clock_gettime(Process::CLOCK_REALTIME, :millisecond)\r\n      end\r\n    end\r\n```\r\n\r\nso it works out of the box in our development machines? (MacOS ship ruby 2.0.0 as system ruby). It looks like if you are using RVM there is a workaround as stated by @MadLittleMods, but for the others there is no easy way rather than patching the code manually.\r\n\r\ncc @to1ne", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2017-08-08T07:02:57.745Z", "updated_at": "2017-08-08T07:03:09.889Z", "system": false, "noteable_id": 3496940, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 69}], [{"id": 37012874, "type": null, "body": "I ran into this when Geo was trying to synchronize repositories.\n\nTo workaround the issue, I ended up changing the shebang in `bin/gitlab-projects` and `bin/gitlab-shell` from `#!/usr/bin/env ruby` to `#!/Users/toon/.rubies/ruby-2.3.3/bin/ruby`.\n\nBut I don't really like that solution.\n\nAs an alternative solution I tried to add `PATH` to `GITLAB_SHELL_ENV_VARS` in [`gitlab-ee/lib/gitlab/shell.rb`](https://gitlab.com/gitlab-org/gitlab-ee/blob/master/lib/gitlab/shell.rb#L8). But unfortunately this didn't help.\n\ncc @stanhu", "attachment": null, "author": {"id": 660180, "name": "Toon Claes", "username": "toon", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a00f7b8442da1be77057de6f1d518739?s=80&d=identicon", "web_url": "https://gitlab.com/toon"}, "created_at": "2017-08-08T07:11:21.432Z", "updated_at": "2017-08-08T07:11:21.432Z", "system": false, "noteable_id": 3496940, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 69}], [{"id": 37031293, "type": null, "body": "@brodock Yeah I think your solution is reasonable.", "attachment": null, "author": {"id": 209240, "name": "Yorick Peterse", "username": "yorickpeterse", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/209240/avatar.png", "web_url": "https://gitlab.com/yorickpeterse"}, "created_at": "2017-08-08T10:33:09.888Z", "updated_at": "2017-08-08T10:33:09.888Z", "system": false, "noteable_id": 3496940, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 69}], [{"id": 37077182, "type": null, "body": "I'm wondering why I haven't seen this problem. I'm using rbenv, and it looks my `PATH` precedes the system `ruby`:\n\n```\n$ /usr/bin/env ruby --version\nruby 2.3.3p222 (2016-11-21 revision 56859) [x86_64-darwin15]\n```", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2017-08-08T18:44:50.622Z", "updated_at": "2017-08-08T18:44:50.622Z", "system": false, "noteable_id": 3496940, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 69}], [{"id": 37127869, "type": null, "body": "mentioned in merge request !161", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2017-08-09T06:59:50.226Z", "updated_at": "2017-08-09T06:59:50.226Z", "system": true, "noteable_id": 3496940, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 69}], [{"id": 37148519, "type": null, "body": "closed via merge request !161", "attachment": null, "author": {"id": 209240, "name": "Yorick Peterse", "username": "yorickpeterse", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/209240/avatar.png", "web_url": "https://gitlab.com/yorickpeterse"}, "created_at": "2017-08-09T10:40:47.368Z", "updated_at": "2017-08-09T10:40:47.368Z", "system": true, "noteable_id": 3496940, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 69}], [{"id": 49800000, "type": null, "body": "mentioned in commit nick.thomas/gitlab-shell-mirror@e358cf251a1916284033c4af6f9c75495ad1e2a7", "attachment": null, "author": {"id": 209240, "name": "Yorick Peterse", "username": "yorickpeterse", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/209240/avatar.png", "web_url": "https://gitlab.com/yorickpeterse"}, "created_at": "2017-12-01T19:36:25.190Z", "updated_at": "2017-12-01T19:36:25.190Z", "system": true, "noteable_id": 3496940, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 69}]]}, {"id": 3436525, "iid": 68, "project_id": 14022, "title": "version 4.0.0 breaks ssh push/pull/clone", "description": "I don't know it this is an issue with gitlab-shell itself or just something missing in gitlab-ce, i'm reporting on both projects.\r\n\r\nVersion 4.0.0 doesn't allow for any ssh operation to be executed with the error:\r\n\r\n```\r\nGitLab: The project you were looking for could not be found.\r\nfatal: Could not read from remote repository.\r\n```\r\n\r\nAfter changing the *origin* in the already cloned repositories to something without \".git\" at the end (which fixes cloning), push doesn't work:\r\n\r\n```\r\nremote: GitLab: The project you were looking for could not be found.\r\nTo code.r3pek.org:r3pek/paal\r\n ! [remote rejected] master -> master (pre-receive hook declined)\r\nerror: failed to push some refs to 'gitlab@code.r3pek.org:r3pek/paal'\r\n```\r\n\r\nGitlab-ce issue is reported [here](https://gitlab.com/gitlab-org/gitlab-ce/issues/24230)", "state": "closed", "created_at": "2016-11-07T21:51:34.383Z", "updated_at": "2018-01-12T14:50:50.427Z", "closed_at": "2018-01-12T14:50:50.422Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 820561, "name": "Carlos Silva", "username": "r3pek", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/fe176213053c293e70d97bd2da63737b?s=80&d=identicon", "web_url": "https://gitlab.com/r3pek"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 2, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/68", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/68", "notes": "https://gitlab.com/api/v4/projects/14022/issues/68/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/68/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 19366480, "type": null, "body": "I just updated my gitlab to 8.14 and started receiving this error.\r\nI removed protected branches from my repo and it started to work.\r\nCould this be a bug with protected branches somehow?", "attachment": null, "author": {"id": 822575, "name": "scottix", "username": "scottix", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/acda6b7d5597b2367905248c9428178a?s=80&d=identicon", "web_url": "https://gitlab.com/scottix"}, "created_at": "2016-12-03T00:36:17.950Z", "updated_at": "2016-12-03T00:36:17.950Z", "system": false, "noteable_id": 3436525, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 68}], [{"id": 54336259, "type": null, "body": "Looks like this was fixed in gitlab-ce with #24496 https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/7480", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:50:49.702Z", "updated_at": "2018-01-12T14:50:49.702Z", "system": false, "noteable_id": 3436525, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 68}], [{"id": 54336263, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:50:50.590Z", "updated_at": "2018-01-12T14:50:50.590Z", "system": true, "noteable_id": 3436525, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 68}]]}, {"id": 3397760, "iid": 67, "project_id": 14022, "title": "Suppress interactive Git prompts during cloning / mirroring", "description": "https://github.com/blog/1957-git-2-3-has-been-released#the-credential-subsystem-is-now-friendlier-to-scripting\n\n`GIT_TERMINAL_PROMPT=0` is our friend.", "state": "closed", "created_at": "2016-11-04T16:54:40.169Z", "updated_at": "2018-01-12T14:52:12.124Z", "closed_at": "2018-01-12T14:52:12.119Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "assignee": null, "user_notes_count": 3, "merge_requests_count": 0, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/67", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/67", "notes": "https://gitlab.com/api/v4/projects/14022/issues/67/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/67/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 17876674, "type": null, "body": "We can use this because we currently require Git 2.7.4 or newer https://gitlab.com/gitlab-org/gitlab-ce/blob/master/doc/install/installation.md#1-packages-dependencies", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2016-11-04T16:56:02.153Z", "updated_at": "2016-11-04T16:56:02.153Z", "system": false, "noteable_id": 3397760, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 67}, {"id": 17876779, "type": null, "body": "Good point.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-11-04T16:58:10.823Z", "updated_at": "2016-11-04T16:58:10.823Z", "system": false, "noteable_id": 3397760, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 67}], [{"id": 54336460, "type": null, "body": "As this is set in gitlab-ce, is there anything we need to set in gitlab-shell for the ssh git clone / git push case, or was this specifically about gitlab_projects?\n\nI think the latter, so I'll close this issue, but feel free to re-open if there's something more to do.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:52:11.477Z", "updated_at": "2018-01-12T14:52:11.477Z", "system": false, "noteable_id": 3397760, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 67}], [{"id": 54336464, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:52:12.188Z", "updated_at": "2018-01-12T14:52:12.188Z", "system": true, "noteable_id": 3397760, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 67}]]}, {"id": 3364681, "iid": 66, "project_id": 14022, "title": "Publish on rubygems.org", "description": "Would it be possible to publish it there as well? Makes it easier to fetch it as a gem.\n\nThanks!", "state": "opened", "created_at": "2016-11-01T08:42:36.237Z", "updated_at": "2017-06-20T21:57:23.309Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 426769, "name": "Manuel R\u00fcger", "username": "mrueg", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/f190b6ae2db5269f7e3d6ae8fcfc6fce?s=80&d=identicon", "web_url": "https://gitlab.com/mrueg"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/66", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/66", "notes": "https://gitlab.com/api/v4/projects/14022/issues/66/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/66/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 3300877, "iid": 65, "project_id": 14022, "title": "GitHub mirror out of date", "description": "I have a Gitlab source installation. (Packages didn't exist when I first installed it.)  For some reason gitlab-shell is installed from https://github.com/gitlabhq/gitlab-shell. (Don't blame me, it must have been that way in the installation guide.)\n\nThis worked fine until now, but now the latest available tag on Github is 3.6.2 while the [upgrade guide](https://gitlab.com/gitlab-org/gitlab-ce/blob/v8.13.0/doc/update/8.12-to-8.13.md) asks for 3.6.3. The latest available tag here is 3.6.6.\n\nI will try changing the remote URL to this repository, but I'm not sure if that is the correct way because the [current installation guide](https://gitlab.com/gitlab-org/gitlab-ce/blob/master/doc/install/installation.md) does not install gitlab-shell by cloning the repository.", "state": "opened", "created_at": "2016-10-23T09:48:55.876Z", "updated_at": "2018-06-26T13:48:34.917Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 15584, "name": "Andr\u00e9 H\u00e4nsel", "username": "AndreKR", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=80&d=identicon", "web_url": "https://gitlab.com/AndreKR"}, "assignee": null, "user_notes_count": 6, "merge_requests_count": 0, "upvotes": 2, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/65", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/65", "notes": "https://gitlab.com/api/v4/projects/14022/issues/65/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/65/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 20008571, "type": null, "body": "+1\r\n\r\ngithub mirror not updated since Sep 20, 2016.\r\n\r\nPlease update it or tell us to switch on gitlab repo.", "attachment": null, "author": {"id": 4784, "name": "janfy", "username": "janfy", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/38a10d8bce754f4e840dc1c0fa0927a7?s=80&d=identicon", "web_url": "https://gitlab.com/janfy"}, "created_at": "2016-12-14T12:51:05.969Z", "updated_at": "2016-12-14T12:51:05.969Z", "system": false, "noteable_id": 3300877, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 65}], [{"id": 54336674, "type": null, "body": "This does still seem to be an issue. v5.10.*, v5.11.0 and v6.0.0 are not on github yet.\n\nWe have a push mirror set up to dev.gitlab.org, I don't know how we currently try to update github. Surely it's not manual?", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:53:39.731Z", "updated_at": "2018-01-12T14:54:19.296Z", "system": false, "noteable_id": 3300877, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 65}], [{"id": 74351928, "type": null, "body": "I've just hit this problem now when trying to upgrade from Gitlab 10.5 to 10.6. Last version is 6.0.3 but this repo is already on 7.1.2 (5 versions behind)", "attachment": null, "author": {"id": 1675896, "name": "Bruce Pieterse", "username": "octoquad", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1675896/avatar.png", "web_url": "https://gitlab.com/octoquad"}, "created_at": "2018-05-22T13:02:06.125Z", "updated_at": "2018-05-22T13:02:17.074Z", "system": false, "noteable_id": 3300877, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 65}], [{"id": 83983114, "type": null, "body": "I received an email from a brazilian customer:\n\n```\nHi Felipe !\nDo you know who I have to contact that has commit access to gitlab-shell inside github? it seems that\nit is not being updated any more and all the tools we use to build gitlab / gitlab-shell are based on \nthe tar.gz generated in the releases, the release 6.0.3 is la, but 6.0.4 is not and it seems that it is \nmandatory for gitlab 10.6.x\n\n\nthank you \n```\n\n@rspeicher @DouweM Anyone that can help with this?", "attachment": null, "author": {"id": 426128, "name": "Felipe Artur", "username": "felipe_artur", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80&d=identicon", "web_url": "https://gitlab.com/felipe_artur"}, "created_at": "2018-06-25T14:14:39.564Z", "updated_at": "2018-06-25T14:15:18.878Z", "system": false, "noteable_id": 3300877, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 65}], [{"id": 84006533, "type": null, "body": "@felipe\\_artur Is there a particular reason why they're getting the tgzs from https://github.com/gitlabhq/gitlab-shell, rather than https://gitlab.com/gitlab-org/gitlab-shell? My preferred way to resolve this issue would be to archive https://github.com/gitlabhq/gitlab-shell.", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2018-06-25T15:56:00.673Z", "updated_at": "2018-06-25T15:56:00.673Z", "system": false, "noteable_id": 3300877, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 65}], [{"id": 84259939, "type": null, "body": "@DouweM I Don't know. I told him that using https://gitlab.com/gitlab-org/gitlab-shell is an option.  \n\n> My preferred way to resolve this issue would be to archive https://github.com/gitlabhq/gitlab-shell.  \n\nAgree!", "attachment": null, "author": {"id": 426128, "name": "Felipe Artur", "username": "felipe_artur", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/dbad92659914f56621cbdd726e283e60?s=80&d=identicon", "web_url": "https://gitlab.com/felipe_artur"}, "created_at": "2018-06-26T13:48:34.833Z", "updated_at": "2018-06-26T13:48:34.833Z", "system": false, "noteable_id": 3300877, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 65}]]}, {"id": 3209688, "iid": 64, "project_id": 14022, "title": "Re-use the regular logger for performance data", "description": "As per https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/98/diffs#note_16839564 using a separate logger in the current setup won't work. Re-using the same logger as used for regular log messages also means we don't need to set up any extra log rotation and what not. This _does_ mean we'll need to prefix performance log lines with something, e.g. \"metrics: command-add-keys cpu_time=XXX wall_time=XXX\". This would produce log messages such as:\n\n```\nI, [2016-10-12T15:53:37.714193 #17935]  INFO -- : metrics: command-add-keys cpu_time=1.2 wall_time=2.0\n```", "state": "closed", "created_at": "2016-10-12T13:54:02.048Z", "updated_at": "2017-03-24T16:24:48.316Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": {"id": 90697, "iid": 9, "project_id": 14022, "title": "8.13", "description": "", "state": "closed", "created_at": "2016-08-24T10:59:43.008Z", "updated_at": "2016-11-23T05:55:08.667Z", "due_date": "2016-10-22", "start_date": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/-/milestones/9"}, "assignees": [{"id": 489758, "name": "Paco Guzman", "username": "pacoguzman", "state": "blocked", "avatar_url": "https://secure.gravatar.com/avatar/59692ba8990e3e064b6c7c6e5754f038?s=80&d=identicon", "web_url": "https://gitlab.com/pacoguzman"}], "author": {"id": 209240, "name": "Yorick Peterse", "username": "yorickpeterse", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/209240/avatar.png", "web_url": "https://gitlab.com/yorickpeterse"}, "assignee": {"id": 489758, "name": "Paco Guzman", "username": "pacoguzman", "state": "blocked", "avatar_url": "https://secure.gravatar.com/avatar/59692ba8990e3e064b6c7c6e5754f038?s=80&d=identicon", "web_url": "https://gitlab.com/pacoguzman"}, "user_notes_count": 2, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/64", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/64", "notes": "https://gitlab.com/api/v4/projects/14022/issues/64/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/64/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 16840427, "type": null, "body": "@pacoguzman Please make sure you handle this today so we don't ship a broken nightly.", "attachment": null, "author": {"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}, "created_at": "2016-10-12T13:58:39.945Z", "updated_at": "2016-10-12T13:58:39.945Z", "system": false, "noteable_id": 3209688, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 64}, {"id": 16840473, "type": null, "body": "Paco is not working today, @yorickpeterse should we revert the MR?", "attachment": null, "author": {"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}, "created_at": "2016-10-12T13:59:27.117Z", "updated_at": "2016-10-12T13:59:27.117Z", "system": false, "noteable_id": 3209688, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 64}, {"id": 16841140, "type": null, "body": "Mentioned in commit 1d68fefe5016baa61043e72ba7ee5458eded8634", "attachment": null, "author": {"id": 209240, "name": "Yorick Peterse", "username": "yorickpeterse", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/209240/avatar.png", "web_url": "https://gitlab.com/yorickpeterse"}, "created_at": "2016-10-12T14:12:05.054Z", "updated_at": "2016-10-12T14:12:05.054Z", "system": true, "noteable_id": 3209688, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 64}, {"id": 16841280, "type": null, "body": "Mentioned in merge request !100", "attachment": null, "author": {"id": 209240, "name": "Yorick Peterse", "username": "yorickpeterse", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/209240/avatar.png", "web_url": "https://gitlab.com/yorickpeterse"}, "created_at": "2016-10-12T14:14:26.815Z", "updated_at": "2016-10-12T14:14:26.815Z", "system": true, "noteable_id": 3209688, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 64}, {"id": 16841780, "type": null, "body": "Status changed to closed by merge request !100", "attachment": null, "author": {"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}, "created_at": "2016-10-12T14:22:29.459Z", "updated_at": "2016-10-12T14:22:29.459Z", "system": true, "noteable_id": 3209688, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 64}, {"id": 16841790, "type": null, "body": "Mentioned in commit 8ba3bc0e3014125d519af26ee601df0d25bfefc5", "attachment": null, "author": {"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}, "created_at": "2016-10-12T14:22:42.251Z", "updated_at": "2016-10-12T14:22:42.251Z", "system": true, "noteable_id": 3209688, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 64}]]}, {"id": 3193861, "iid": 63, "project_id": 14022, "title": "Make post push receive message optional", "description": "Me and my users find the new `gitlab_post_receive` message about \"*Create merge request for ...*\" after pushing quite irritating. If you are used to have a very short push message you mistakenly now think \"oh no, an error message, something went wrong ... no wait... hmm, no error ... ah, darn, that unnecessary message again!\"\r\n\r\nThe message was introduced here, I think: https://gitlab.com/gitlab-org/gitlab-shell/commit/9ba4a0aa4fc104189873134644a2d5da28f5b4b7\r\n\r\nCan we please get an option to turn that off?", "state": "closed", "created_at": "2016-10-10T10:30:26.829Z", "updated_at": "2017-06-06T18:27:56.284Z", "closed_at": "2017-04-21T14:28:13.525Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 453755, "name": "Michael H\u00e4rtl", "username": "mikehaertl", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/8d870f414d0a3282e8eb22d4a3d8ca16?s=80&d=identicon", "web_url": "https://gitlab.com/mikehaertl"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/63", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/63", "notes": "https://gitlab.com/api/v4/projects/14022/issues/63/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/63/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 16939160, "type": null, "body": "Mentioned in merge request !74", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2016-10-13T19:02:04.827Z", "updated_at": "2016-10-13T19:02:04.827Z", "system": true, "noteable_id": 3193861, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 63}], [{"id": 27900228, "type": null, "body": "@mikehaertl this option has been added in https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/9663, I'm closing this issue :slight_smile:", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-04-21T14:28:09.067Z", "updated_at": "2017-04-21T14:28:09.067Z", "system": false, "noteable_id": 3193861, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 63}], [{"id": 27900236, "type": null, "body": "closed", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2017-04-21T14:28:13.609Z", "updated_at": "2017-04-21T14:28:13.609Z", "system": true, "noteable_id": 3193861, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 63}]]}, {"id": 3175767, "iid": 62, "project_id": 14022, "title": "Instrument GitLab Shell and log metrics data to a file", "description": "We need to start instrumenting the code so we know where time is being spent. The easiest way is to essentially measure blocks (with a name) and log the metrics to a file. This allows us to scrape the data using mtail (as discussed in https://gitlab.com/gitlab-com/infrastructure/issues/502).\n\nData to measure:\n\n* CPU time used\n* Real time used\n* call count\n\nSee the GitLab CE code for more information on how this is currently done.", "state": "closed", "created_at": "2016-10-07T10:58:21.017Z", "updated_at": "2017-03-24T16:24:48.355Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 489758, "name": "Paco Guzman", "username": "pacoguzman", "state": "blocked", "avatar_url": "https://secure.gravatar.com/avatar/59692ba8990e3e064b6c7c6e5754f038?s=80&d=identicon", "web_url": "https://gitlab.com/pacoguzman"}], "author": {"id": 209240, "name": "Yorick Peterse", "username": "yorickpeterse", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/209240/avatar.png", "web_url": "https://gitlab.com/yorickpeterse"}, "assignee": {"id": 489758, "name": "Paco Guzman", "username": "pacoguzman", "state": "blocked", "avatar_url": "https://secure.gravatar.com/avatar/59692ba8990e3e064b6c7c6e5754f038?s=80&d=identicon", "web_url": "https://gitlab.com/pacoguzman"}, "user_notes_count": 4, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/62", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/62", "notes": "https://gitlab.com/api/v4/projects/14022/issues/62/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/62/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 16648587, "type": null, "body": "Reassigned to @pacoguzman", "attachment": null, "author": {"id": 209240, "name": "Yorick Peterse", "username": "yorickpeterse", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/209240/avatar.png", "web_url": "https://gitlab.com/yorickpeterse"}, "created_at": "2016-10-07T10:58:35.052Z", "updated_at": "2016-10-07T10:58:35.052Z", "system": true, "noteable_id": 3175767, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 62}, {"id": 16648593, "type": null, "body": "It might be a good idea to log to a separate file instead of the same file, this makes it a little bit easier to scrape things.", "attachment": null, "author": {"id": 209240, "name": "Yorick Peterse", "username": "yorickpeterse", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/209240/avatar.png", "web_url": "https://gitlab.com/yorickpeterse"}, "created_at": "2016-10-07T10:58:56.419Z", "updated_at": "2016-10-07T10:58:56.419Z", "system": false, "noteable_id": 3175767, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 62}, {"id": 16727191, "type": null, "body": "@yorickpeterse I have some doubts about this:\n\na. do we want to be explicit on which blocks of code we measure?\n\n  ```ruby\n  GitlabMetrics.measure(:\"gitlab_shell_exec\") do\n    GitlabShell.new(key_id).exec(original_cmd)\n  end\n  ```\n\nb. You suggested to measure the call count, I guess for that we need the concept of a Transaction, is that really needed? or we just need to measure times for the moment. \n\nc. do you think would be a good idea to extract Gitlab::Metrics to their own gem? I guess if we want only to support explicit blocks without transaction we don't need to extract the code because is very few what we're going to need to implement it, but adding the Transaction concept we'll need more code from gitlab-ce. But on calls to `Kernel::exec(env, *args, unsetenv_others: true)` as it ends the current ruby process I'm not sure we're going to be able to use the `Transaction` concept.\n\nWhat do you think?", "attachment": null, "author": {"id": 489758, "name": "Paco Guzman", "username": "pacoguzman", "state": "blocked", "avatar_url": "https://secure.gravatar.com/avatar/59692ba8990e3e064b6c7c6e5754f038?s=80&d=identicon", "web_url": "https://gitlab.com/pacoguzman"}, "created_at": "2016-10-10T08:21:19.987Z", "updated_at": "2016-10-10T08:21:19.987Z", "system": false, "noteable_id": 3175767, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 62}, {"id": 16730840, "type": null, "body": "@pacoguzman Let's measure it explicitly using the block example you provided, and write the data directly to a file when the block ends For b) I think we can drop the call count for now as we indeed would need a transaction of sorts for that. c) No, this is too much work. It wouldn't help much either because we'd have to set up InfluxDB in both GitLab and gitlab-shell.", "attachment": null, "author": {"id": 209240, "name": "Yorick Peterse", "username": "yorickpeterse", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/209240/avatar.png", "web_url": "https://gitlab.com/yorickpeterse"}, "created_at": "2016-10-10T09:37:07.472Z", "updated_at": "2016-10-10T09:37:07.472Z", "system": false, "noteable_id": 3175767, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 62}, {"id": 16733157, "type": null, "body": "Thanks @yorickpeterse it's clearer now", "attachment": null, "author": {"id": 489758, "name": "Paco Guzman", "username": "pacoguzman", "state": "blocked", "avatar_url": "https://secure.gravatar.com/avatar/59692ba8990e3e064b6c7c6e5754f038?s=80&d=identicon", "web_url": "https://gitlab.com/pacoguzman"}, "created_at": "2016-10-10T10:21:14.616Z", "updated_at": "2016-10-10T10:21:14.616Z", "system": false, "noteable_id": 3175767, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 62}, {"id": 16740301, "type": null, "body": "Mentioned in merge request !98", "attachment": null, "author": {"id": 489758, "name": "Paco Guzman", "username": "pacoguzman", "state": "blocked", "avatar_url": "https://secure.gravatar.com/avatar/59692ba8990e3e064b6c7c6e5754f038?s=80&d=identicon", "web_url": "https://gitlab.com/pacoguzman"}, "created_at": "2016-10-10T13:17:46.062Z", "updated_at": "2016-10-10T13:17:46.062Z", "system": true, "noteable_id": 3175767, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 62}, {"id": 16795033, "type": null, "body": "Status changed to closed by merge request !98", "attachment": null, "author": {"id": 209240, "name": "Yorick Peterse", "username": "yorickpeterse", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/209240/avatar.png", "web_url": "https://gitlab.com/yorickpeterse"}, "created_at": "2016-10-11T15:20:16.144Z", "updated_at": "2016-10-11T15:20:16.144Z", "system": true, "noteable_id": 3175767, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 62}]]}, {"id": 3111304, "iid": 61, "project_id": 14022, "title": "Test on Ruby 2.3", "description": "It doesn't look like we test GitLab shell on 2.3...", "state": "closed", "created_at": "2016-09-29T06:45:44.422Z", "updated_at": "2017-03-24T16:24:48.384Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 386624, "name": "Connor Shea", "username": "connorshea", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/386624/avatar.png", "web_url": "https://gitlab.com/connorshea"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/61", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/61", "notes": "https://gitlab.com/api/v4/projects/14022/issues/61/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/61/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 16742135, "type": null, "body": "Mentioned in merge request !99", "attachment": null, "author": {"id": 489758, "name": "Paco Guzman", "username": "pacoguzman", "state": "blocked", "avatar_url": "https://secure.gravatar.com/avatar/59692ba8990e3e064b6c7c6e5754f038?s=80&d=identicon", "web_url": "https://gitlab.com/pacoguzman"}, "created_at": "2016-10-10T13:53:00.185Z", "updated_at": "2016-10-10T13:53:00.185Z", "system": true, "noteable_id": 3111304, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 61}, {"id": 16743181, "type": null, "body": "Status changed to closed by merge request !99", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2016-10-10T14:13:40.352Z", "updated_at": "2016-10-10T14:13:40.352Z", "system": true, "noteable_id": 3111304, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 61}, {"id": 16743287, "type": null, "body": "Mentioned in commit b30d957fe2a85ee9ebb058010020e1c21d256a44", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2016-10-10T14:16:15.015Z", "updated_at": "2016-10-10T14:16:15.015Z", "system": true, "noteable_id": 3111304, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 61}]]}, {"id": 3038553, "iid": 60, "project_id": 14022, "title": "Provide a way through the config to specify global git-config defaults", "description": "It would be useful for me to set some git config options globally on my server (compression, performance tuning, etc). I would like to be able to set a variable in the gitlab-shell config yaml that corresponds to a variable in the git config file for each repo managed by gitlab.", "state": "opened", "created_at": "2016-09-19T16:09:07.816Z", "updated_at": "2017-06-20T21:57:23.393Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 698206, "name": "Derek Wilson", "username": "dwilson1", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/456262c379c8e26661efa34a9c94857a?s=80&d=identicon", "web_url": "https://gitlab.com/dwilson1"}, "assignee": null, "user_notes_count": 3, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/60", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/60", "notes": "https://gitlab.com/api/v4/projects/14022/issues/60/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/60/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 15707545, "type": null, "body": "Mentioned in merge request !88", "attachment": null, "author": {"id": 698206, "name": "Derek Wilson", "username": "dwilson1", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/456262c379c8e26661efa34a9c94857a?s=80&d=identicon", "web_url": "https://gitlab.com/dwilson1"}, "created_at": "2016-09-19T16:09:55.218Z", "updated_at": "2016-09-19T16:09:55.218Z", "system": true, "noteable_id": 3038553, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 60}, {"id": 15707586, "type": null, "body": "while i submitted !88 before this issue, i do feel like this feature would be very useful to more than just myself.", "attachment": null, "author": {"id": 698206, "name": "Derek Wilson", "username": "dwilson1", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/456262c379c8e26661efa34a9c94857a?s=80&d=identicon", "web_url": "https://gitlab.com/dwilson1"}, "created_at": "2016-09-19T16:11:09.956Z", "updated_at": "2016-09-19T16:11:09.956Z", "system": false, "noteable_id": 3038553, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 60}, {"id": 16082607, "type": null, "body": "any thoughts or comments? i need this for my production environment. i'm currently using the referenced patch and it works well for altering server side settings. you could even include disabling automatic garbage collection here instead of at the git user level (more configuration in an expected place rather than in . files inside a users home directory).\n\ni see this as a really useful feature - what can i do to help get it merged?", "attachment": null, "author": {"id": 698206, "name": "Derek Wilson", "username": "dwilson1", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/456262c379c8e26661efa34a9c94857a?s=80&d=identicon", "web_url": "https://gitlab.com/dwilson1"}, "created_at": "2016-09-27T14:47:31.457Z", "updated_at": "2016-09-27T14:47:31.457Z", "system": false, "noteable_id": 3038553, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 60}, {"id": 21889000, "type": null, "body": "the work is done, this is useful, and it shouldn't cause any trouble or conflict with other features.\n\ni would love to stop maintaining my own fork to have this.", "attachment": null, "author": {"id": 698206, "name": "Derek Wilson", "username": "dwilson1", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/456262c379c8e26661efa34a9c94857a?s=80&d=identicon", "web_url": "https://gitlab.com/dwilson1"}, "created_at": "2017-01-23T16:11:04.088Z", "updated_at": "2017-01-23T16:11:04.088Z", "system": false, "noteable_id": 3038553, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 60}]]}, {"id": 3007611, "iid": 59, "project_id": 14022, "title": "Provides a way to log GIT_TRACE output", "description": "On the context of https://gitlab.com/gitlab-org/gitlab-ce/issues/22053 we decided to log GIT_TRACE output to a file", "state": "closed", "created_at": "2016-09-15T14:13:49.591Z", "updated_at": "2017-03-24T16:24:48.414Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": {"id": 64398, "iid": 6, "project_id": 14022, "title": "8.12", "description": "", "state": "closed", "created_at": "2016-05-16T22:05:40.079Z", "updated_at": "2016-10-20T14:14:53.297Z", "due_date": "2016-09-22", "start_date": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/-/milestones/6"}, "assignees": [{"id": 489758, "name": "Paco Guzman", "username": "pacoguzman", "state": "blocked", "avatar_url": "https://secure.gravatar.com/avatar/59692ba8990e3e064b6c7c6e5754f038?s=80&d=identicon", "web_url": "https://gitlab.com/pacoguzman"}], "author": {"id": 489758, "name": "Paco Guzman", "username": "pacoguzman", "state": "blocked", "avatar_url": "https://secure.gravatar.com/avatar/59692ba8990e3e064b6c7c6e5754f038?s=80&d=identicon", "web_url": "https://gitlab.com/pacoguzman"}, "assignee": {"id": 489758, "name": "Paco Guzman", "username": "pacoguzman", "state": "blocked", "avatar_url": "https://secure.gravatar.com/avatar/59692ba8990e3e064b6c7c6e5754f038?s=80&d=identicon", "web_url": "https://gitlab.com/pacoguzman"}, "user_notes_count": 3, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/59", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/59", "notes": "https://gitlab.com/api/v4/projects/14022/issues/59/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/59/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 15388367, "type": null, "body": "Mentioned in merge request !91", "attachment": null, "author": {"id": 489758, "name": "Paco Guzman", "username": "pacoguzman", "state": "blocked", "avatar_url": "https://secure.gravatar.com/avatar/59692ba8990e3e064b6c7c6e5754f038?s=80&d=identicon", "web_url": "https://gitlab.com/pacoguzman"}, "created_at": "2016-09-15T14:17:19.949Z", "updated_at": "2016-09-15T14:17:19.949Z", "system": true, "noteable_id": 3007611, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 59}, {"id": 15707407, "type": null, "body": "i would love to see this solution built as a way to set any git environment variable (or any allowable environment variable if there are ones we wouldn't want to support).", "attachment": null, "author": {"id": 698206, "name": "Derek Wilson", "username": "dwilson1", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/456262c379c8e26661efa34a9c94857a?s=80&d=identicon", "web_url": "https://gitlab.com/dwilson1"}, "created_at": "2016-09-19T16:06:40.236Z", "updated_at": "2016-09-19T16:06:40.236Z", "system": false, "noteable_id": 3007611, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 59}, {"id": 16081734, "type": null, "body": "Status changed to closed by merge request !91", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2016-09-27T14:29:53.412Z", "updated_at": "2016-09-27T14:29:53.412Z", "system": true, "noteable_id": 3007611, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 59}, {"id": 16082180, "type": null, "body": "so... that's a no?", "attachment": null, "author": {"id": 698206, "name": "Derek Wilson", "username": "dwilson1", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/456262c379c8e26661efa34a9c94857a?s=80&d=identicon", "web_url": "https://gitlab.com/dwilson1"}, "created_at": "2016-09-27T14:37:39.919Z", "updated_at": "2016-09-27T14:37:39.919Z", "system": false, "noteable_id": 3007611, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 59}, {"id": 16082242, "type": null, "body": "@dwilson1 Depends on what you want! See !91. :)", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2016-09-27T14:38:58.842Z", "updated_at": "2016-09-27T14:38:58.842Z", "system": false, "noteable_id": 3007611, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 59}, {"id": 16082397, "type": null, "body": "Mentioned in commit glensc/gitlab-shell@0b4fd0af16555b2bdc28f6b18781d72226c5d56c", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2016-09-27T14:43:38.356Z", "updated_at": "2016-09-27T14:43:38.356Z", "system": true, "noteable_id": 3007611, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 59}]]}, {"id": 2974359, "iid": 58, "project_id": 14022, "title": "FAILED: Failed to connect to internal API", "description": "currently using: c6d8af599dc797ec8ba7874380abad393b439c9e\n\n```\nW, [2016-09-12T23:26:54.840085 #682]  WARN -- : Failed to connect to internal API <GET https://DOMAIN.TLD/api/v3/internal/check>: #<OpenSSL::SSL::SSLError: SSL_connect returned=1 errno=0 state=SSLv3 read server certificate B: certificate verify failed>\nI, [2016-09-12T23:26:54.840354 #682]  INFO -- : GET https://DOMAIN.TLD/api/v3/internal/check 0.00883\n```\n\nssl file exist and does work, the problem just arrived after updating from 3043b31", "state": "closed", "created_at": "2016-09-12T15:30:59.715Z", "updated_at": "2018-01-12T14:56:30.477Z", "closed_at": "2018-01-12T14:56:30.470Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 5766, "name": "MrKeiKun", "username": "MrKeiKun", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3d05b760e98afb1c694cd990ec99cd3d?s=80&d=identicon", "web_url": "https://gitlab.com/MrKeiKun"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/58", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/58", "notes": "https://gitlab.com/api/v4/projects/14022/issues/58/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/58/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 54337137, "type": null, "body": "Sorry you didn't see any response on this @MrKeiKun . This feels like a misconfiguration, and since it's been a year, I'll assume you managed to fix it. Feel free to re-open if you still need support though.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:56:29.814Z", "updated_at": "2018-01-12T14:56:29.814Z", "system": false, "noteable_id": 2974359, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 58}], [{"id": 54337142, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:56:30.518Z", "updated_at": "2018-01-12T14:56:30.518Z", "system": true, "noteable_id": 2974359, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 58}]]}, {"id": 2865126, "iid": 57, "project_id": 14022, "title": "Standardize gitlab-shell's messages to the user", "description": "We should have a standard way to show gitlab-shell's messages, like limit the characters of each message line and adding a blank line or three dashes before and after the message in order to be more apparent from the rest of the messages produced by Git itself.\r\n\r\nRight now we show the user various messages, for example:\r\n\r\n```\r\ngit grep -n \"message = \"\r\n\r\nlib/gitlab_post_receive.rb:55:      message = \"Create merge request for #{merge_request[\"branch_name\"]}:\"\r\nlib/gitlab_post_receive.rb:57:      message = \"View merge request for #{merge_request[\"branch_name\"]}:\"\r\nlib/gitlab_reference_counter.rb:46:      message = \"GitLab: An unexpected error occurred in writing to Redis: #{e}\"\r\nlib/gitlab_shell.rb:42:    message = \"gitlab-shell: Access denied for git command <#{origin_cmd}> by #{log_username}.\"\r\nlib/gitlab_shell.rb:48:    message = \"gitlab-shell: Attempt to execute disallowed command <#{origin_cmd}> by #{log_username}.\"\r\n```\r\n\r\n```\r\ngit grep -n \"stderr.puts\"\r\n\r\nlib/gitlab_access.rb:30:    $stderr.puts \"GitLab: Failed to authorize your Git request: internal API unreachable\"\r\nlib/gitlab_access.rb:33:    $stderr.puts \"GitLab: #{ex.message}\"\r\nlib/gitlab_logger.rb:8:  $stderr.puts \"WARNING: Unrecognized log level #{log_level.inspect}.\"\r\nlib/gitlab_logger.rb:9:  $stderr.puts \"WARNING: Falling back to INFO.\"\r\nlib/gitlab_post_receive.rb:116:      $stderr.puts \"GitLab: An unexpected error occurred in writing to Redis: #{e}\"\r\nlib/gitlab_reference_counter.rb:47:      $stderr.puts message\r\nlib/gitlab_shell.rb:39:    $stderr.puts \"GitLab: Failed to authorize your Git request: internal API unreachable\"\r\nlib/gitlab_shell.rb:45:    $stderr.puts \"GitLab: #{ex.message}\"\r\nlib/gitlab_shell.rb:51:    $stderr.puts \"GitLab: Disallowed command\"\r\nlib/gitlab_shell.rb:54:    $stderr.puts \"GitLab: Invalid repository path\"\r\n```\r\n\r\ncc @rspeicher @DouweM @regisF\r\n", "state": "opened", "created_at": "2016-08-29T08:12:00.418Z", "updated_at": "2017-06-28T21:02:44.880Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 3585, "name": "Achilleas Pipinellis", "username": "axil", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3585/avatar.png", "web_url": "https://gitlab.com/axil"}, "assignee": null, "user_notes_count": 5, "merge_requests_count": 0, "upvotes": 2, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/57", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/57", "notes": "https://gitlab.com/api/v4/projects/14022/issues/57/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/57/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 14667215, "type": null, "body": "Changed title: **Standardize gitlab-shell** \u2192 **Standardize gitlab-shell{+&#39;s messages to the user+}**", "attachment": null, "author": {"id": 3585, "name": "Achilleas Pipinellis", "username": "axil", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3585/avatar.png", "web_url": "https://gitlab.com/axil"}, "created_at": "2016-08-29T08:21:46.718Z", "updated_at": "2016-08-29T08:21:46.718Z", "system": true, "noteable_id": 2865126, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 57}, {"id": 14667230, "type": null, "body": "mentioned in merge request !87", "attachment": null, "author": {"id": 3585, "name": "Achilleas Pipinellis", "username": "axil", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3585/avatar.png", "web_url": "https://gitlab.com/axil"}, "created_at": "2016-08-29T08:22:16.880Z", "updated_at": "2016-08-29T08:22:16.880Z", "system": true, "noteable_id": 2865126, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 57}, {"id": 14675742, "type": null, "body": ":clap: \r\n\r\nI like your proposal on https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/87\r\n\r\n```\r\nGitLab: ---\r\nGitLab: This repository's size exceeds the limit of XX MB and as a result\r\nGitLab: you are unable to push to it. Please contact your GitLab\r\nGitLab: administrator for more information.\r\nGitLab: ---\r\n```", "attachment": null, "author": {"id": 574797, "name": "R\u00e9gis Freyd (GitLab)", "username": "regisF", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/574797/avatar.png", "web_url": "https://gitlab.com/regisF"}, "created_at": "2016-08-29T12:20:29.409Z", "updated_at": "2016-08-29T12:20:29.409Z", "system": false, "noteable_id": 2865126, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 57}, {"id": 14779933, "type": null, "body": "Standardizing is good. :+1:", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2016-08-31T16:45:42.979Z", "updated_at": "2016-08-31T16:45:42.979Z", "system": false, "noteable_id": 2865126, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 57}, {"id": 15759854, "type": null, "body": "Yep, good idea. Note that the `---` delimiter, word-wrap, and the `GitLab:` prefix should be handled by gitlab-shell\u2014GitLab itself should just return the error message as a string.", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2016-09-20T14:05:44.492Z", "updated_at": "2016-09-20T14:05:44.492Z", "system": false, "noteable_id": 2865126, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 57}, {"id": 15760310, "type": null, "body": "When we will change this, we probably should warn the community about the change.\r\n\r\nSee https://gitlab.com/gitlab-org/gitlab-ce/issues/21451 where users say how they try to find workarounds for the extra formatting we add on the shell returned from git.", "attachment": null, "author": {"id": 574797, "name": "R\u00e9gis Freyd (GitLab)", "username": "regisF", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/574797/avatar.png", "web_url": "https://gitlab.com/regisF"}, "created_at": "2016-09-20T14:13:06.455Z", "updated_at": "2016-09-20T14:13:06.455Z", "system": false, "noteable_id": 2865126, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 57}, {"id": 15932832, "type": null, "body": "Please respect the `--quiet` option from git commands while you are at it. It's there for a reason, scripted git commands, instegration in IDEs... you name it.", "attachment": null, "author": {"id": 384986, "name": "Beno\u00eet Bleuz\u00e9", "username": "tiggerben", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/1e50394d4ab9cd22ed60318657f83b8d?s=80&d=identicon", "web_url": "https://gitlab.com/tiggerben"}, "created_at": "2016-09-23T11:22:53.247Z", "updated_at": "2016-09-23T11:22:53.247Z", "system": false, "noteable_id": 2865126, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 57}]]}, {"id": 2739608, "iid": 56, "project_id": 14022, "title": "Can't add keys in master", "description": "Adding a key errors out: \r\n```\r\n/opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_keys.rb:17:in `chomp!': can't modify frozen String (RuntimeError)\r\n```\r\n\r\nThe ARGV strings are frozen when supplied from the cli, but not in our tests. We should freeze the ARGV strings in the tests, and dup the public key in gitlab_keys.\r\n\r\ncc\\ @jacobvosmaer-gitlab ", "state": "closed", "created_at": "2016-08-10T23:52:48.519Z", "updated_at": "2017-03-24T16:24:48.451Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 42196, "name": "DJ Mountney", "username": "twk3", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0585c59e37fc2dbc124fc4c9f575234d?s=80&d=identicon", "web_url": "https://gitlab.com/twk3"}], "author": {"id": 42196, "name": "DJ Mountney", "username": "twk3", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0585c59e37fc2dbc124fc4c9f575234d?s=80&d=identicon", "web_url": "https://gitlab.com/twk3"}, "assignee": {"id": 42196, "name": "DJ Mountney", "username": "twk3", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0585c59e37fc2dbc124fc4c9f575234d?s=80&d=identicon", "web_url": "https://gitlab.com/twk3"}, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/56", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/56", "notes": "https://gitlab.com/api/v4/projects/14022/issues/56/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/56/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 13765723, "type": null, "body": "mentioned in merge request !84", "attachment": null, "author": {"id": 42196, "name": "DJ Mountney", "username": "twk3", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0585c59e37fc2dbc124fc4c9f575234d?s=80&d=identicon", "web_url": "https://gitlab.com/twk3"}, "created_at": "2016-08-10T23:56:00.610Z", "updated_at": "2016-08-10T23:56:00.610Z", "system": true, "noteable_id": 2739608, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 56}, {"id": 13808313, "type": null, "body": "Status changed to closed by merge request !84", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2016-08-11T21:09:57.967Z", "updated_at": "2016-08-11T21:09:57.967Z", "system": true, "noteable_id": 2739608, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 56}, {"id": 13925619, "type": null, "body": "mentioned in commit dblessing/gitlab-shell@4f8e91fac043f09ea94a3542eeff9734db33645a", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2016-08-16T22:16:57.992Z", "updated_at": "2016-08-16T22:16:57.992Z", "system": true, "noteable_id": 2739608, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 56}, {"id": 16879870, "type": null, "body": "Mentioned in commit ngpestelos/gitlab-shell@4f8e91fac043f09ea94a3542eeff9734db33645a", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2016-10-13T03:20:34.925Z", "updated_at": "2016-10-13T03:20:34.925Z", "system": true, "noteable_id": 2739608, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 56}]]}, {"id": 2696905, "iid": 55, "project_id": 14022, "title": "github mirror broken", "description": "looks like github mirror is broken:\r\n\r\n- https://github.com/gitlabhq/gitlab-shell/commits/master - last commit Jul 27, 2016\r\n- https://gitlab.com/gitlab-org/gitlab-shell/commits/master - last commit 03 Aug, 2016\r\n\r\ni use github mirror, because it provides better download tarball integration: https://gitlab.com/gitlab-org/gitlab-ce/issues/15665\r\n\r\nalso anitya uses github url for version monitoring: https://release-monitoring.org/project/11295/", "state": "closed", "created_at": "2016-08-04T06:22:38.222Z", "updated_at": "2017-03-24T16:24:48.497Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 163557, "name": "Elan Ruusam\u00e4e", "username": "glensc", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/effff0989c8041ef98aaf916c7092d6d?s=80&d=identicon", "web_url": "https://gitlab.com/glensc"}, "assignee": null, "user_notes_count": 4, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/55", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/55", "notes": "https://gitlab.com/api/v4/projects/14022/issues/55/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/55/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 13573781, "type": null, "body": "The sync is done manually right now. We still recommend using GitLab.com since it will get the latest updates, but I understand in this context we need better automatic tarball generation for versions.\r\n\r\nI've done a manual sync now.\r\n", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-08-04T12:28:59.621Z", "updated_at": "2016-08-04T12:28:59.621Z", "system": false, "noteable_id": 2696905, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 55}, {"id": 13573782, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-08-04T12:28:59.799Z", "updated_at": "2016-08-04T12:28:59.799Z", "system": true, "noteable_id": 2696905, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 55}, {"id": 13575495, "type": null, "body": "i've seen .gitlab-ci.yml hook which pushes to github on tags and master. i suppose such ci config would make it automatic", "attachment": null, "author": {"id": 163557, "name": "Elan Ruusam\u00e4e", "username": "glensc", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/effff0989c8041ef98aaf916c7092d6d?s=80&d=identicon", "web_url": "https://gitlab.com/glensc"}, "created_at": "2016-08-04T13:14:33.611Z", "updated_at": "2016-08-04T13:14:33.611Z", "system": false, "noteable_id": 2696905, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 55}, {"id": 13575509, "type": null, "body": "please reopen: tags are still not there: https://github.com/gitlabhq/gitlab-shell/releases", "attachment": null, "author": {"id": 163557, "name": "Elan Ruusam\u00e4e", "username": "glensc", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/effff0989c8041ef98aaf916c7092d6d?s=80&d=identicon", "web_url": "https://gitlab.com/glensc"}, "created_at": "2016-08-04T13:14:55.346Z", "updated_at": "2016-08-04T13:14:55.346Z", "system": false, "noteable_id": 2696905, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 55}, {"id": 13575558, "type": null, "body": "and anitya lacks support as well: https://github.com/fedora-infra/anitya/issues/272\r\n\r\ni.e this site: https://release-monitoring.org/", "attachment": null, "author": {"id": 163557, "name": "Elan Ruusam\u00e4e", "username": "glensc", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/effff0989c8041ef98aaf916c7092d6d?s=80&d=identicon", "web_url": "https://gitlab.com/glensc"}, "created_at": "2016-08-04T13:16:07.606Z", "updated_at": "2016-08-04T13:16:07.606Z", "system": false, "noteable_id": 2696905, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 55}]]}, {"id": 2672903, "iid": 54, "project_id": 14022, "title": "Upgrade to RSpec 3", "description": "For tests at least, we should be trying to match the gems and versions used by GitLab CE/EE.", "state": "closed", "created_at": "2016-07-29T17:02:54.718Z", "updated_at": "2018-08-16T12:58:51.224Z", "closed_at": "2018-08-16T12:58:50.778Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["technical debt"], "milestone": null, "assignees": [{"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}], "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "assignee": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "user_notes_count": 0, "merge_requests_count": 1, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/54", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/54", "notes": "https://gitlab.com/api/v4/projects/14022/issues/54/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/54/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 13439450, "type": null, "body": "mentioned in merge request !77", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2016-07-29T17:03:23.520Z", "updated_at": "2016-07-29T17:03:23.520Z", "system": true, "noteable_id": 2672903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 54}], [{"id": 94545338, "type": null, "body": "mentioned in merge request !229", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-08-14T20:11:30.983Z", "updated_at": "2018-08-14T20:11:30.983Z", "system": true, "noteable_id": 2672903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 54}], [{"id": 94545433, "type": null, "body": "assigned to @rspeicher", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2018-08-14T20:11:36.295Z", "updated_at": "2018-08-14T20:11:36.295Z", "system": true, "noteable_id": 2672903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 54}], [{"id": 94908842, "type": null, "body": "closed via merge request !229", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-16T12:58:51.242Z", "updated_at": "2018-08-16T12:58:51.242Z", "system": true, "noteable_id": 2672903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 54}], [{"id": 94908846, "type": null, "body": "mentioned in commit fb8606f65a60808e52539f71f09fba871b5aba6b", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-08-16T12:58:51.675Z", "updated_at": "2018-08-16T12:58:51.675Z", "system": true, "noteable_id": 2672903, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 54}]]}, {"id": 2663010, "iid": 53, "project_id": 14022, "title": "Consider reexposing GL_ID to custom hooks", "description": "In our company, we use a custom git hook to perform additional permission checks based on the user that is pushing (essentially, branch based access control), using GL_ID to identify the user that is performing the action. This broke in GitLab 8.10 when commit https://gitlab.com/gitlab-org/gitlab-shell/commit/48d292ebde4177972117957df5fd37ac1f2692da removed GL_ID from the environment before calling the custom hook.\r\n\r\nCould you consider re-adding this, or to expose the identified user id / user name to the custom hooks?\r\nCurrently, we have to use the internal api to identify which user an ssh key belongs to, because to our knowledge, the public API does not even allow this for admins.", "state": "closed", "created_at": "2016-07-28T08:39:15.347Z", "updated_at": "2017-03-24T16:24:48.535Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 59678, "name": "Valery Sizov", "username": "vsizov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/59678/avatar.png", "web_url": "https://gitlab.com/vsizov"}], "author": {"id": 640239, "name": "Patrick B\u00e4nziger", "username": "padyx", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5abed89937ebb786e9eaef71155176bb?s=80&d=identicon", "web_url": "https://gitlab.com/padyx"}, "assignee": {"id": 59678, "name": "Valery Sizov", "username": "vsizov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/59678/avatar.png", "web_url": "https://gitlab.com/vsizov"}, "user_notes_count": 9, "merge_requests_count": 1, "upvotes": 1, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/53", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/53", "notes": "https://gitlab.com/api/v4/projects/14022/issues/53/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/53/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 13851050, "type": null, "body": "ping @jacobvosmaer-gitlab - what is your opinion? How can custom hooks identify users best (or at all)?", "attachment": null, "author": {"id": 640239, "name": "Patrick B\u00e4nziger", "username": "padyx", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5abed89937ebb786e9eaef71155176bb?s=80&d=identicon", "web_url": "https://gitlab.com/padyx"}, "created_at": "2016-08-13T12:10:23.191Z", "updated_at": "2016-08-13T12:10:23.191Z", "system": false, "noteable_id": 2663010, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 53}, {"id": 13871368, "type": null, "body": "Relevant MR: https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/73", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2016-08-15T08:38:23.719Z", "updated_at": "2016-08-15T08:38:23.719Z", "system": false, "noteable_id": 2663010, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 53}, {"id": 13871532, "type": null, "body": "@padyx if we do want to tell custom hooks the user id then GL_ID is the best (only?) way to do it. But then it should be implemented as a feature, not as an accident.\r\n\r\n- pass key_id as a function argument to GitlabCustomHook\r\n- add tests that assert that GL_ID is set when executing the custom hook executable\r\n\r\ncc @DouweM ", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2016-08-15T08:47:52.653Z", "updated_at": "2016-08-15T08:47:52.653Z", "system": false, "noteable_id": 2663010, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 53}, {"id": 14655814, "type": null, "body": "Hi there,\r\n\r\nI also have pre-receive hooks which identify the users, I would definitely love to see that feature re-integrated in the project.\r\n\r\nI found that getting the GL_ID with an env variable is actually quite nice since we can then use any language we want to write the hook\r\n\r\n\r\n\r\n", "attachment": null, "author": {"id": 644813, "name": "jean", "username": "pralut", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/4df0e9ee5cf6e2867d7a666adf32b554?s=80&d=identicon", "web_url": "https://gitlab.com/pralut"}, "created_at": "2016-08-28T22:33:56.046Z", "updated_at": "2016-08-28T22:33:56.046Z", "system": false, "noteable_id": 2663010, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 53}, {"id": 14674960, "type": null, "body": "@DouweM do you think the undocumented previous behavior of exposing GL_ID to custom hooks should be a feature?", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2016-08-29T12:05:57.615Z", "updated_at": "2016-08-29T12:05:57.615Z", "system": false, "noteable_id": 2663010, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 53}, {"id": 14713773, "type": null, "body": "@jacobvosmaer-gitlab This has lost some priority for us since GitLab 8.11 EE now allows to configure the users that are allowed to push to protected branches, which allowed us to mostly replace our custom hook.\n\nNevertheless, I think GL_ID should probably be exposed again anyway: We can do a lot more complicated access checks in such a custom hook than GitLab currently allows to configure. Alternatively, instead of the GL_ID, the user information could also be exposed in the form of the \"proper\" userId (for REST API) - or user name - of a GitLab user.", "attachment": null, "author": {"id": 640239, "name": "Patrick B\u00e4nziger", "username": "padyx", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5abed89937ebb786e9eaef71155176bb?s=80&d=identicon", "web_url": "https://gitlab.com/padyx"}, "created_at": "2016-08-30T11:46:29.417Z", "updated_at": "2016-08-30T11:46:29.417Z", "system": false, "noteable_id": 2663010, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 53}, {"id": 14732319, "type": null, "body": "We have come to depend on having GL_ID available in our custom hooks.  That being said, another method of obtaining the user information in a custom hook would also be acceptable since at this point without GL_ID we don't know of a way to do this.  ", "attachment": null, "author": {"id": 72528, "name": "Adam J. Baker", "username": "nordicmachine", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/2a6f0824537d77982fb1345ccd1736f9?s=80&d=identicon", "web_url": "https://gitlab.com/nordicmachine"}, "created_at": "2016-08-30T18:06:58.846Z", "updated_at": "2016-08-30T18:06:58.846Z", "system": false, "noteable_id": 2663010, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 53}, {"id": 14962287, "type": null, "body": "Ping @DouweM", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2016-09-05T13:14:34.647Z", "updated_at": "2016-09-05T13:14:34.647Z", "system": false, "noteable_id": 2663010, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 53}, {"id": 16147005, "type": null, "body": "Reassigned to @vsizov", "attachment": null, "author": {"id": 59678, "name": "Valery Sizov", "username": "vsizov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/59678/avatar.png", "web_url": "https://gitlab.com/vsizov"}, "created_at": "2016-09-28T16:14:51.234Z", "updated_at": "2016-09-28T16:14:51.234Z", "system": true, "noteable_id": 2663010, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 53}, {"id": 16354531, "type": null, "body": "Mentioned in merge request !95", "attachment": null, "author": {"id": 59678, "name": "Valery Sizov", "username": "vsizov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/59678/avatar.png", "web_url": "https://gitlab.com/vsizov"}, "created_at": "2016-10-03T16:17:34.545Z", "updated_at": "2016-10-03T16:17:34.545Z", "system": true, "noteable_id": 2663010, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 53}, {"id": 16355007, "type": null, "body": "Fix https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/95", "attachment": null, "author": {"id": 59678, "name": "Valery Sizov", "username": "vsizov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/59678/avatar.png", "web_url": "https://gitlab.com/vsizov"}, "created_at": "2016-10-03T16:27:39.277Z", "updated_at": "2016-10-03T16:27:39.277Z", "system": false, "noteable_id": 2663010, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 53}, {"id": 16438939, "type": null, "body": "Status changed to closed by merge request !95", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2016-10-05T08:55:12.213Z", "updated_at": "2016-10-05T08:55:12.213Z", "system": true, "noteable_id": 2663010, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 53}, {"id": 16738151, "type": null, "body": "Mentioned in commit dirker/gitlab-shell@fad9498c1b15e96bf553064d77dc33c17ff7baa7", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2016-10-10T12:34:20.001Z", "updated_at": "2016-10-10T12:34:20.001Z", "system": true, "noteable_id": 2663010, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 53}]]}, {"id": 2661937, "iid": 52, "project_id": 14022, "title": "push v3.2.1 tag to github", "description": "I package this and use the downloads from github.  Could you push that tag up there as well?", "state": "closed", "created_at": "2016-07-28T04:05:40.640Z", "updated_at": "2017-03-24T16:24:48.584Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 35067, "name": "Travis Glenn Hansen", "username": "travisghansen", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/fe873705633da34d0623cd88fd96d217?s=80&d=identicon", "web_url": "https://gitlab.com/travisghansen"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/52", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/52", "notes": "https://gitlab.com/api/v4/projects/14022/issues/52/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/52/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 13380809, "type": null, "body": "Done, but we really recommend pointing to GitLab.com because we can't guarantee the GitHub site will always be in sync.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-07-28T04:06:57.055Z", "updated_at": "2016-07-28T04:06:57.055Z", "system": false, "noteable_id": 2661937, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 52}, {"id": 13380810, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-07-28T04:06:57.090Z", "updated_at": "2016-07-28T04:06:57.090Z", "system": true, "noteable_id": 2661937, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 52}, {"id": 13380844, "type": null, "body": "I would love to, problem is the folder names are not predicable in the downloaded archives from gitlab.  Not overly helpful for packagers.", "attachment": null, "author": {"id": 35067, "name": "Travis Glenn Hansen", "username": "travisghansen", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/fe873705633da34d0623cd88fd96d217?s=80&d=identicon", "web_url": "https://gitlab.com/travisghansen"}, "created_at": "2016-07-28T04:09:25.850Z", "updated_at": "2016-07-28T04:09:25.850Z", "system": false, "noteable_id": 2661937, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 52}]]}, {"id": 2656182, "iid": 51, "project_id": 14022, "title": "gitlab-project's fork_project command doesn't work if the project is being forked to another storage", "description": "Related to https://gitlab.com/gitlab-org/gitlab-ce/issues/20302", "state": "closed", "created_at": "2016-07-26T19:45:01.522Z", "updated_at": "2017-03-24T16:24:48.618Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": {"id": 73313, "iid": 8, "project_id": 14022, "title": "8.10", "description": "", "state": "closed", "created_at": "2016-06-21T10:21:39.353Z", "updated_at": "2016-08-23T21:43:28.241Z", "due_date": "2016-07-22", "start_date": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/-/milestones/8"}, "assignees": [{"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}], "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "assignee": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/51", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/51", "notes": "https://gitlab.com/api/v4/projects/14022/issues/51/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/51/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 13343523, "type": null, "body": "Started branch [`51-gitlab-project-s-fork_project-command-doesn-t-work-if-the-project-is-being-forked-to-another-storage`](https://gitlab.com/gitlab-org/gitlab-shell/compare/master...51-gitlab-project-s-fork_project-command-doesn-t-work-if-the-project-is-being-forked-to-another-storage)", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2016-07-26T19:45:23.356Z", "updated_at": "2016-07-26T19:45:23.356Z", "system": true, "noteable_id": 2656182, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 51}, {"id": 13343548, "type": null, "body": "mentioned in merge request !75", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2016-07-26T19:47:04.936Z", "updated_at": "2016-07-26T19:47:04.936Z", "system": true, "noteable_id": 2656182, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 51}, {"id": 13344791, "type": null, "body": "Status changed to closed by commit ccf949e17127d590b8c823d8f678e9b687718dda", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2016-07-26T21:03:19.374Z", "updated_at": "2016-07-26T21:03:19.374Z", "system": true, "noteable_id": 2656182, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 51}, {"id": 13365486, "type": null, "body": "mentioned in commit ccf949e17127d590b8c823d8f678e9b687718dda", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2016-07-27T15:14:17.296Z", "updated_at": "2016-07-27T15:14:17.296Z", "system": true, "noteable_id": 2656182, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 51}]]}, {"id": 2619918, "iid": 50, "project_id": 14022, "title": "gitlab-projects error: no implicit conversion of nil into String (TypeError)", "description": "Upgraded a source install from 8.2 to 8.10. \r\n\r\nWhile trying to debug why the project activity doesn't update I noticed the following errors when running the following:\r\n<pre>\r\nsudo -u git -H /home/git/gitlab-shell/bin/gitlab-projects list-projects\r\n/home/git/gitlab-shell/lib/gitlab_projects.rb:157:in `chdir': no implicit conversion of nil into String (TypeError)\r\n\tfrom /home/git/gitlab-shell/lib/gitlab_projects.rb:157:in `list_projects'\r\n\tfrom /home/git/gitlab-shell/lib/gitlab_projects.rb:55:in `exec'\r\n\tfrom /home/git/gitlab-shell/bin/gitlab-projects:25:in `<main>'\r\n</pre>\r\n\r\n<pre>\r\nsudo -u git -H /home/git/gitlab-shell/bin/gitlab-projects add-project gitlab/gitlab-ci.git\r\n/usr/local/lib/ruby/2.1.0/fileutils.rb:1572:in `path': no implicit conversion of nil into String (TypeError)\r\n\tfrom /usr/local/lib/ruby/2.1.0/fileutils.rb:1572:in `block in fu_list'\r\n\tfrom /usr/local/lib/ruby/2.1.0/fileutils.rb:1572:in `map'\r\n\tfrom /usr/local/lib/ruby/2.1.0/fileutils.rb:1572:in `fu_list'\r\n\tfrom /usr/local/lib/ruby/2.1.0/fileutils.rb:204:in `mkdir_p'\r\n\tfrom /home/git/gitlab-shell/lib/gitlab_projects.rb:150:in `add_project'\r\n\tfrom /home/git/gitlab-shell/lib/gitlab_projects.rb:54:in `exec'\r\n\tfrom /home/git/gitlab-shell/bin/gitlab-projects:25:in `<main>'\r\n</pre>\r\n\r\ngitlab-shell.log does indicate that the command ran:\r\n\r\n<pre>\r\ntail gitlab-shell.log\r\nI, [2016-07-20T20:51:02.589251 #32382]  INFO -- : Listing projects\r\nI, [2016-07-20T20:51:20.830745 #32384]  INFO -- : Listing all keys\r\nI, [2016-07-20T20:51:53.193252 #32386]  INFO -- : GET https://gitlab.gemini.edu/api/v3/internal/check 0.01295\r\nI, [2016-07-20T20:52:18.652531 #32392]  INFO -- : Listing projects\r\nI, [2016-07-20T20:52:29.762448 #32394]  INFO -- : Listing projects\r\nI, [2016-07-20T20:52:48.903840 #32396]  INFO -- : Listing projects\r\nI, [2016-07-20T20:52:54.840587 #32398]  INFO -- : GET https://gitlab.gemini.edu/api/v3/internal/check 1.64386\r\nI, [2016-07-20T20:54:09.771579 #32405]  INFO -- : GET https://gitlab.gemini.edu/api/v3/internal/check 0.01290\r\nW, [2016-07-20T20:54:32.118535 #32410]  WARN -- : Attempt to execute invalid gitlab-projects command nil.\r\nI, [2016-07-20T20:54:50.329260 #32415]  INFO -- : Listing projects\r\n</pre>", "state": "closed", "created_at": "2016-07-21T07:23:22.369Z", "updated_at": "2017-03-24T16:24:48.655Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 663, "name": "Jason Kalawe", "username": "jason", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d9ad3e57c3d031283141ca5fbfe33389?s=80&d=identicon", "web_url": "https://gitlab.com/jason"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 2, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/50", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/50", "notes": "https://gitlab.com/api/v4/projects/14022/issues/50/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/50/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 13234330, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 663, "name": "Jason Kalawe", "username": "jason", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d9ad3e57c3d031283141ca5fbfe33389?s=80&d=identicon", "web_url": "https://gitlab.com/jason"}, "created_at": "2016-07-21T19:03:50.158Z", "updated_at": "2016-07-21T19:03:50.158Z", "system": true, "noteable_id": 2619918, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 50}]]}, {"id": 2588486, "iid": 49, "project_id": 14022, "title": "Add post-update Git hook", "description": "## Summary\r\n\r\nOne of our Customers has asked that we implement the post-update Git hook to support their current workflow\r\n\r\n## Additional Detail\r\n\r\nRelevant Zendesk ticket: https://gitlab.zendesk.com/agent/tickets/29817\r\n\r\n\\cc @jacobvosmaer-gitlab ", "state": "opened", "created_at": "2016-07-13T17:07:14.002Z", "updated_at": "2019-09-10T13:22:45.678Z", "closed_at": null, "closed_by": null, "labels": ["customer"], "milestone": null, "assignees": [], "author": {"id": 419655, "name": "Mark Fletcher", "username": "markglenfletcher", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/419655/avatar.png", "web_url": "https://gitlab.com/markglenfletcher"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/49", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/49", "notes": "https://gitlab.com/api/v4/projects/14022/issues/49/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/49/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 2559224, "iid": 48, "project_id": 14022, "title": "Regression in v3.1.0 vs v3.0.0", "description": "Just updated to gitlab-shell to 3.1.0 and it is not usable anymore. Works perfectly fine with v3.0.0 though. Gitlab itself is 8.9.4.\r\nExpected was a successful clone. Here is the command and the received result:\r\n```\r\n$ git clone git@gitlab.mydomain:somegroup/myrepo.git\r\n/home/git/gitlab-shell/lib/gitlab_shell.rb:183:in `absolute_path': no implicit conversion of nil into String (TypeError)\r\n\tfrom /home/git/gitlab-shell/lib/gitlab_shell.rb:183:in `repo_path='\r\n\tfrom /home/git/gitlab-shell/lib/gitlab_shell.rb:92:in `verify_access'\r\n\tfrom /home/git/gitlab-shell/lib/gitlab_shell.rb:32:in `exec'\r\n\tfrom /home/git/gitlab-shell/bin/gitlab-shell:20:in `<main>'\r\nfatal: Could not read from remote repository.\r\n\r\nPlease make sure you have the correct access rights\r\nand the repository exists.\r\n```\r\nMaybe [this issue](https://github.com/gitlabhq/gitlab-shell/pull/119) is related.", "state": "closed", "created_at": "2016-07-06T05:24:51.611Z", "updated_at": "2017-03-24T16:24:48.695Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 606504, "name": "Leif Middelschulte", "username": "leiflm", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19a5f184c0bdfee18f90eff89f149d3c?s=80&d=identicon", "web_url": "https://gitlab.com/leiflm"}, "assignee": null, "user_notes_count": 3, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/48", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/48", "notes": "https://gitlab.com/api/v4/projects/14022/issues/48/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/48/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 12897827, "type": null, "body": "I think gitlab-shell 3.1.0 is not compatible with 8.9.4 but needs `master` to get the repo path back. Should we provide a better error message, @eReGeBe?\r\n", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-07-06T05:36:18.992Z", "updated_at": "2016-07-06T05:36:18.992Z", "system": false, "noteable_id": 2559224, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 48}, {"id": 12911158, "type": null, "body": "@stanhu sure. Something like \"Repository path not provided. Please make sure you're using gitlab v8.10 or later\"?", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2016-07-06T16:18:39.512Z", "updated_at": "2016-07-06T16:18:39.512Z", "system": false, "noteable_id": 2559224, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 48}, {"id": 12911265, "type": null, "body": "@eReGeBe Sounds good.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-07-06T16:23:04.454Z", "updated_at": "2016-07-06T16:23:04.454Z", "system": false, "noteable_id": 2559224, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 48}, {"id": 12911803, "type": null, "body": "Started branch [`48-regression-in-v3-1-0-vs-v3-0-0`](https://gitlab.com/gitlab-org/gitlab-shell/compare/master...48-regression-in-v3-1-0-vs-v3-0-0)", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2016-07-06T16:47:58.929Z", "updated_at": "2016-07-06T16:47:58.929Z", "system": true, "noteable_id": 2559224, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 48}, {"id": 12911887, "type": null, "body": "mentioned in merge request !70", "attachment": null, "author": {"id": 367626, "name": "Alejandro Rodr\u00edguez", "username": "alejandro", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a979fdfec9f263cd1ba9fe0f720d911d?s=80&d=identicon", "web_url": "https://gitlab.com/alejandro"}, "created_at": "2016-07-06T16:51:07.117Z", "updated_at": "2016-07-06T16:51:07.117Z", "system": true, "noteable_id": 2559224, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 48}, {"id": 12912373, "type": null, "body": "Status changed to closed by merge request !70", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-07-06T17:17:17.389Z", "updated_at": "2016-07-06T17:17:17.389Z", "system": true, "noteable_id": 2559224, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 48}, {"id": 13241635, "type": null, "body": "mentioned in commit dblessing/gitlab-shell@e8a4dc7018bba7f0321ce8d5d7758629c6503075", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-07-22T05:33:41.942Z", "updated_at": "2016-07-22T05:33:41.942Z", "system": true, "noteable_id": 2559224, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 48}]]}, {"id": 2554118, "iid": 47, "project_id": 14022, "title": "Use STDERR to write error message instead of STDOUT", "description": "Currently we return non-zero exit status and write message error to STDOUT, we need to write to STDERR instead.\r\n\r\nExample https://gitlab.com/gitlab-org/gitlab-shell/blob/710746ff1e6762f5072c6ae6443fd3ad75169bc1/lib/gitlab_post_receive.rb#L87", "state": "closed", "created_at": "2016-07-04T13:19:43.856Z", "updated_at": "2017-03-24T16:24:48.729Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 59678, "name": "Valery Sizov", "username": "vsizov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/59678/avatar.png", "web_url": "https://gitlab.com/vsizov"}, "assignee": null, "user_notes_count": 9, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/47", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/47", "notes": "https://gitlab.com/api/v4/projects/14022/issues/47/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/47/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 12865212, "type": null, "body": "I know the STDOUT message shows up on the user's client; where does STDERR go?", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-07-04T13:23:15.586Z", "updated_at": "2016-07-04T13:23:15.586Z", "system": false, "noteable_id": 2554118, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 47}, {"id": 12865305, "type": null, "body": "@stanhu What user's client do you mean?\r\n\r\nThe problem is that we write to STDERR and STDOUT, depend on error. We need to do it right :)\r\nI believe it will require changes in client side as well but it should be checked out", "attachment": null, "author": {"id": 59678, "name": "Valery Sizov", "username": "vsizov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/59678/avatar.png", "web_url": "https://gitlab.com/vsizov"}, "created_at": "2016-07-04T13:27:38.657Z", "updated_at": "2016-07-04T13:27:38.657Z", "system": false, "noteable_id": 2554118, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 47}, {"id": 12865364, "type": null, "body": "example of right output https://gitlab.com/gitlab-org/gitlab-shell/blob/710746ff1e6762f5072c6ae6443fd3ad75169bc1/lib/gitlab_access.rb#L29", "attachment": null, "author": {"id": 59678, "name": "Valery Sizov", "username": "vsizov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/59678/avatar.png", "web_url": "https://gitlab.com/vsizov"}, "created_at": "2016-07-04T13:30:00.613Z", "updated_at": "2016-07-04T13:30:00.613Z", "system": false, "noteable_id": 2554118, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 47}, {"id": 12865413, "type": null, "body": "By the way, it looks like the example from the issue description is a single use of STDOUT. So it's not a big deal, we just need to fix it I think", "attachment": null, "author": {"id": 59678, "name": "Valery Sizov", "username": "vsizov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/59678/avatar.png", "web_url": "https://gitlab.com/vsizov"}, "created_at": "2016-07-04T13:32:15.769Z", "updated_at": "2016-07-04T13:34:46.184Z", "system": false, "noteable_id": 2554118, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 47}, {"id": 12865514, "type": null, "body": "@vsizov Please submit a MR for this. Thanks! :)\r\n", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-07-04T13:37:04.452Z", "updated_at": "2016-07-04T13:37:04.452Z", "system": false, "noteable_id": 2554118, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 47}, {"id": 12866216, "type": null, "body": "@vsizov I'm more wondering what does the user see when an error message gets displayed by `puts` there. For example, if the user runs `git push` and gitlab-shell hits that `puts` line, the error message gets displayed on the user's git client output. Where does stderr go?\r\n", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-07-04T14:04:58.066Z", "updated_at": "2016-07-04T14:04:58.066Z", "system": false, "noteable_id": 2554118, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 47}, {"id": 12866317, "type": null, "body": "AFAIK git client will show both outputs. But I will check before sending an MR :)", "attachment": null, "author": {"id": 59678, "name": "Valery Sizov", "username": "vsizov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/59678/avatar.png", "web_url": "https://gitlab.com/vsizov"}, "created_at": "2016-07-04T14:08:58.215Z", "updated_at": "2016-07-04T14:08:58.215Z", "system": false, "noteable_id": 2554118, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 47}, {"id": 12879976, "type": null, "body": "I just checked it out, git shows both outputs. So I will change that one line as I was going earlier.", "attachment": null, "author": {"id": 59678, "name": "Valery Sizov", "username": "vsizov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/59678/avatar.png", "web_url": "https://gitlab.com/vsizov"}, "created_at": "2016-07-05T09:24:23.359Z", "updated_at": "2016-07-05T09:24:23.359Z", "system": false, "noteable_id": 2554118, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 47}, {"id": 12880639, "type": null, "body": "https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/68", "attachment": null, "author": {"id": 59678, "name": "Valery Sizov", "username": "vsizov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/59678/avatar.png", "web_url": "https://gitlab.com/vsizov"}, "created_at": "2016-07-05T09:52:09.461Z", "updated_at": "2016-07-05T09:52:09.461Z", "system": false, "noteable_id": 2554118, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 47}, {"id": 12880642, "type": null, "body": "mentioned in merge request !68", "attachment": null, "author": {"id": 59678, "name": "Valery Sizov", "username": "vsizov", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/59678/avatar.png", "web_url": "https://gitlab.com/vsizov"}, "created_at": "2016-07-05T09:52:26.960Z", "updated_at": "2016-07-05T09:52:26.960Z", "system": true, "noteable_id": 2554118, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 47}, {"id": 12883432, "type": null, "body": "Status changed to closed by merge request !68", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-07-05T12:04:02.239Z", "updated_at": "2016-07-05T12:04:02.239Z", "system": true, "noteable_id": 2554118, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 47}, {"id": 12895424, "type": null, "body": "mentioned in commit 011317c8c1c7678ab88eb8a8673347587fd3236d", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-07-05T23:04:39.946Z", "updated_at": "2016-07-05T23:04:39.946Z", "system": true, "noteable_id": 2554118, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 47}]]}, {"id": 2545959, "iid": 46, "project_id": 14022, "title": "Insufficient right on server side repo ?", "description": "Hello,\r\n\r\nI'm using **gitlab** `v3.0.0` on **gitlab** `v8.9.0-rc8`.\r\n\r\nWhen I try to push from my client, I have\r\n\r\n~~~\r\nCompressing objects: 100% (54/54), done.\r\nWriting objects: 100% (61/61), 6.25 KiB | 0 bytes/s, done.\r\nTotal 61 (delta 41), reused 0 (delta 0)\r\nremote: error: insufficient permission for adding an object to repository database objects\r\nremote: fatal: failed to write object\r\nerror: unpack failed: unpack-objects abnormal exit\r\n~~~\r\n\r\nHas anybody encounter this ?", "state": "closed", "created_at": "2016-07-01T09:00:18.698Z", "updated_at": "2017-04-11T11:42:15.943Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 16567, "name": "waghanza", "username": "waghanza", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/74ac34cad32d38b6d6566d09d63e3c1f?s=80&d=identicon", "web_url": "https://gitlab.com/waghanza"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/46", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/46", "notes": "https://gitlab.com/api/v4/projects/14022/issues/46/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/46/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 12820924, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 16567, "name": "waghanza", "username": "waghanza", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/74ac34cad32d38b6d6566d09d63e3c1f?s=80&d=identicon", "web_url": "https://gitlab.com/waghanza"}, "created_at": "2016-07-01T09:08:29.238Z", "updated_at": "2016-07-01T09:08:29.238Z", "system": true, "noteable_id": 2545959, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 46}, {"id": 12820925, "type": null, "body": "The problem was **object** directory (on server side repo) contains directories owned by `root`", "attachment": null, "author": {"id": 16567, "name": "waghanza", "username": "waghanza", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/74ac34cad32d38b6d6566d09d63e3c1f?s=80&d=identicon", "web_url": "https://gitlab.com/waghanza"}, "created_at": "2016-07-01T09:08:29.268Z", "updated_at": "2016-07-01T09:08:29.268Z", "system": false, "noteable_id": 2545959, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 46}, {"id": 27255762, "type": null, "body": "I am having the same issue from time to time.\r\nUsing GitLab 8.16.4 on Ubuntu 16.\r\n\r\n", "attachment": null, "author": {"id": 119054, "name": "Thomas", "username": "Perschak", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d1d479221e26bb221a42b39f12aa262c?s=80&d=identicon", "web_url": "https://gitlab.com/Perschak"}, "created_at": "2017-04-11T11:42:15.939Z", "updated_at": "2017-04-11T11:42:15.939Z", "system": false, "noteable_id": 2545959, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 46}]]}, {"id": 2536656, "iid": 45, "project_id": 14022, "title": "when i have a \"@\" in my password,and i want to use \"git --git-dir push -f\" with http,  i got a fail result.", "description": "in my company, each of us has a password with a \"@\",this is not a problem .\r\nbut i have got a requirement to use a command below(in the gitlab-shell):\r\ngit --git-dir=/home/git/gdk8.0.2/gitlab-development-kit/Iscas/documentcloud_underscore.git/.git push -f http://root:admin@example.com@192.168.5.23:3000/Iscas/documentcloud_underscore.git master\r\n\r\nadmin@example.com is the password of root user,i find this command return a failure.\r\nif i change the password to make it without a \"@\",it return success,but i cant change the password because of other requirement,\r\ndo you have any idea?\r\n\r\n3Q.", "state": "closed", "created_at": "2016-06-29T01:35:50.028Z", "updated_at": "2018-05-20T13:59:13.487Z", "closed_at": "2018-01-12T15:11:25.860Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 253056, "name": "jinxialiu", "username": "jinxialiu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/253056/Screenshot_2016-01-21-13-24-22.png", "web_url": "https://gitlab.com/jinxialiu"}, "assignee": null, "user_notes_count": 3, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/45", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/45", "notes": "https://gitlab.com/api/v4/projects/14022/issues/45/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/45/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 12974669, "type": null, "body": "o,i finally solve this problem by use ssh protocol rather than http.\r\nbut i still wonder where does the command be execed,because a user has a password with '@' is very normal ,that command should not just cannot identify it.\r\n3Q", "attachment": null, "author": {"id": 253056, "name": "jinxialiu", "username": "jinxialiu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/253056/Screenshot_2016-01-21-13-24-22.png", "web_url": "https://gitlab.com/jinxialiu"}, "created_at": "2016-07-10T14:01:13.957Z", "updated_at": "2016-07-10T14:01:13.957Z", "system": false, "noteable_id": 2536656, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 45}], [{"id": 54339440, "type": null, "body": "@jinxialiu you should be able to provide the password URL-encoded, like:\n\n```\ngit --git-dir=/home/git/gdk8.0.2/gitlab-development-kit/Iscas/documentcloud_underscore.git/.git push -f http://root:admin%40example.com@192.168.5.23:3000/Iscas/documentcloud_underscore.git master\n```\n\nI don't see a direct relevance to gitlab-shell though. I'll close this issue.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:11:25.205Z", "updated_at": "2018-01-12T15:11:25.205Z", "system": false, "noteable_id": 2536656, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 45}], [{"id": 54339441, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:11:25.944Z", "updated_at": "2018-01-12T15:11:25.944Z", "system": true, "noteable_id": 2536656, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 45}], [{"id": 74019285, "type": null, "body": "Thank you very much", "attachment": null, "author": {"id": 253056, "name": "jinxialiu", "username": "jinxialiu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/253056/Screenshot_2016-01-21-13-24-22.png", "web_url": "https://gitlab.com/jinxialiu"}, "created_at": "2018-05-20T13:59:13.468Z", "updated_at": "2018-05-20T13:59:13.468Z", "system": false, "noteable_id": 2536656, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 45}]]}, {"id": 2517402, "iid": 44, "project_id": 14022, "title": "Deprecate the gitlab-projects command", "description": "We currently have a command in gitlab-shell, called `gitlab-projects`, that performs tasks like renaming repositories, initializing repositories etc. This command is only used by GitLab internally via https://gitlab.com/gitlab-org/gitlab-ce/blob/master/lib/gitlab/backend/shell.rb .\r\n\r\nThis split serves no purpose and I suspect we only have it from when GitLab used two system users ('git' for Gitolite and 'gitlab' for GitLab itself). @dzaporozhets can you confirm?\r\n\r\nI propose we deprecate the gitlab-projects command in gitlab-shell and move its functionality into the Gitlab::Shell class in gitlab-ce. This will make it easier to contribute to GitLab.\r\n\r\ncc @stanhu @DouweM ", "state": "closed", "created_at": "2016-06-23T10:00:53.700Z", "updated_at": "2018-01-12T15:09:23.720Z", "closed_at": "2018-01-12T15:09:23.710Z", "closed_by": null, "labels": ["Stretch"], "milestone": null, "assignees": [], "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "assignee": null, "user_notes_count": 6, "merge_requests_count": 0, "upvotes": 4, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/44", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/44", "notes": "https://gitlab.com/api/v4/projects/14022/issues/44/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/44/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 12654212, "type": null, "body": "@jacobvosmaer-gitlab I am OK with moving gitlab-projects functionality to CE. ", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2016-06-23T11:40:36.398Z", "updated_at": "2016-06-23T11:40:36.398Z", "system": false, "noteable_id": 2517402, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 44}, {"id": 12654382, "type": null, "body": "The only thing that would visibly change (to system administrators) is that gitlab-projects prints log messages in gitlab-shell/gitlab-shell.log and those messages would go somewhere in gitlab/log/foo.log afterwards.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2016-06-23T11:46:44.845Z", "updated_at": "2016-06-23T11:46:44.845Z", "system": false, "noteable_id": 2517402, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 44}, {"id": 12760370, "type": null, "body": "Sounds good to me.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-06-29T02:14:45.894Z", "updated_at": "2016-06-29T02:14:45.894Z", "system": false, "noteable_id": 2517402, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 44}, {"id": 13091734, "type": null, "body": "The more I think about it the more I think we need this. I am not per se against separating code that moves/updates repos into a separate repo (a gem?), although I am not sure if that is even useful. But I am more and more convinced that calling this code in a subprocess is an unnecessary layer of indirection.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2016-07-15T09:45:43.077Z", "updated_at": "2016-07-15T09:45:43.077Z", "system": false, "noteable_id": 2517402, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 44}, {"id": 18981949, "type": null, "body": "@jacobvosmaer-gitlab Let's schedule that for %\"8.15\"!", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2016-11-25T14:20:08.121Z", "updated_at": "2016-11-25T14:20:08.121Z", "system": false, "noteable_id": 2517402, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 44}, {"id": 19433434, "type": null, "body": "changed milestone to %11", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2016-12-05T14:22:45.673Z", "updated_at": "2016-12-05T14:22:45.673Z", "system": true, "noteable_id": 2517402, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 44}, {"id": 19433448, "type": null, "body": "added ~992792 label", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2016-12-05T14:22:55.532Z", "updated_at": "2016-12-05T14:22:55.532Z", "system": true, "noteable_id": 2517402, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 44}, {"id": 20296389, "type": null, "body": "mentioned in issue gitlab-org/gitaly#7", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2016-12-20T14:56:00.098Z", "updated_at": "2016-12-20T14:56:00.098Z", "system": true, "noteable_id": 2517402, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 44}, {"id": 22739322, "type": null, "body": "removed milestone", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-02-03T18:28:51.459Z", "updated_at": "2017-02-03T18:28:51.459Z", "system": true, "noteable_id": 2517402, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 44}], [{"id": 54339194, "type": null, "body": "This is done: #113", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:09:23.120Z", "updated_at": "2018-01-12T15:09:23.120Z", "system": false, "noteable_id": 2517402, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 44}], [{"id": 54339195, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:09:23.778Z", "updated_at": "2018-01-12T15:09:23.778Z", "system": true, "noteable_id": 2517402, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 44}]]}, {"id": 2406417, "iid": 43, "project_id": 14022, "title": "Make it easier to query the GitLab API via a Unix domain socket", "description": "We have had support for API requests via Unix domain sockets for some time now, using the 'http+unix' URL scheme. This awesome but not super user friendly. The socket path has to be URL-encoded; on an installation from source this looks like this in config.yml:\r\n\r\n```\r\ngitlab_url: http+unix://%2Fhome%2Fgit%2Fgitlab%2Ftmp%2Fsockets%2Fgitlab-workhorse.socket\r\n```\r\n\r\nI am pushing to make Unix socket connections through gitlab-workhorse the default setting (see https://gitlab.com/gitlab-com/operations/issues/343). I think this is not reasonable towards administrators unless we make it easier to configure the socket.\r\n\r\nI propose the following format:\r\n\r\n```\r\ngitlab_socket: /home/git/gitlab/tmp/sockets/gitlab-workhorse.socket\r\n```\r\n\r\nIf GitLab is mounted on a relative URL, use both gitlab_url and gitlab_socket:\r\n\r\n```\r\ngitlab_url: http://localhost/my-gitlab\r\ngitlab_socket: /home/git/gitlab/tmp/sockets/gitlab-workhorse.socket\r\n```\r\n\r\nUnder the covers I think we should first parse gitlab_url and then override its 'host' and 'scheme' if gitlab_socket is present.", "state": "opened", "created_at": "2016-06-10T11:42:19.630Z", "updated_at": "2017-09-16T09:38:05.022Z", "closed_at": null, "closed_by": null, "labels": ["technical debt"], "milestone": null, "assignees": [], "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "assignee": null, "user_notes_count": 3, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/43", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/43", "notes": "https://gitlab.com/api/v4/projects/14022/issues/43/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/43/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 12374316, "type": null, "body": "This is important but not urgent. The fact that Unicorn listens both on a TCP port (localhost:8080) and on a socket is confusing. We have stopped using port 8080 on gitlab.com because it makes it harder to measure what is going on in the system. Generally speaking, routing API requests through gitlab-workhorse declutters the application design.\r\n\r\n@DouweM @stanhu can you think of somebody who could work on this?", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2016-06-10T11:55:37.542Z", "updated_at": "2016-06-10T11:55:37.542Z", "system": false, "noteable_id": 2406417, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 43}, {"id": 12374330, "type": null, "body": "mentioned in issue gitlab-com/operations#343", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2016-06-10T11:56:07.224Z", "updated_at": "2016-06-10T11:56:07.224Z", "system": true, "noteable_id": 2406417, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 43}, {"id": 12609695, "type": null, "body": "Milestone changed to %8", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2016-06-21T18:14:38.811Z", "updated_at": "2016-06-21T18:14:38.811Z", "system": true, "noteable_id": 2406417, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 43}, {"id": 12609717, "type": null, "body": "Added ~378220 label", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2016-06-21T18:15:56.807Z", "updated_at": "2016-06-21T18:15:56.807Z", "system": true, "noteable_id": 2406417, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 43}, {"id": 12609737, "type": null, "body": "@jacobvosmaer-gitlab I'll put it for 8.10 and label it ~\"technical debt\" since it doesn't have priority over customer stuff or bugs, but nicer/easier configuration is important for purely \"quality of technical stuff\" reasons.", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2016-06-21T18:16:47.148Z", "updated_at": "2016-06-21T18:17:00.803Z", "system": false, "noteable_id": 2406417, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 43}, {"id": 12629546, "type": null, "body": "Thanks @DouweM ", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2016-06-22T13:52:40.064Z", "updated_at": "2016-06-22T13:52:40.064Z", "system": false, "noteable_id": 2406417, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 43}, {"id": 13309667, "type": null, "body": "Milestone changed to %5", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2016-07-25T17:35:18.915Z", "updated_at": "2016-07-25T17:35:18.915Z", "system": true, "noteable_id": 2406417, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 43}, {"id": 22738927, "type": null, "body": "removed milestone", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-02-03T18:25:16.625Z", "updated_at": "2017-02-03T18:25:16.625Z", "system": true, "noteable_id": 2406417, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 43}]]}, {"id": 2181661, "iid": 41, "project_id": 14022, "title": "The 'Welcome, XXX' message should be aware of deploy keys", "description": "When SSH'ing in as a real, authorized user, you see a message like this:\r\n\r\n```\r\nWelcome to GitLab, Mark Campbell!\r\n```\r\n\r\nWhen SSH'ing in with a deployment key (like when I'm debugging why something isn't working), I get this instead:\r\n\r\n```\r\nWelcome to GitLab, Anonymous!\r\n```\r\n\r\nThis is because the request to `/api/v3/internal/discover?key_id=xxx` responds with `Key.find(params[:id]).user` and user is nil, which results in the check here:\r\n\r\n```\r\n  def username\r\n    user && user['name'] || 'Anonymous'\r\n  end\r\n```\r\nhttps://gitlab.com/gitlab-org/gitlab-shell/blob/master/lib/gitlab_shell.rb#L159\r\n\r\nTurning into just 'Anonymous'. \r\n\r\nSo a few solutions that I could come up with (bear in mind that I have no idea how GitLab works):\r\n\r\n1. Respond with a deployment key user that will indicate which deployment key it's associated with\r\n2. Add an additional endpoint that responds with deployment key users as to not mix the discover api to return both real users and deployment key users\r\n\r\nWhat do you guys think is the right course of action?", "state": "opened", "created_at": "2016-05-09T12:41:22.921Z", "updated_at": "2017-09-16T09:38:33.445Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 419680, "name": "Mark Campbell", "username": "Nitrodist", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3fcde728ed0a517b5ab83ada2d4f155f?s=80&d=identicon", "web_url": "https://gitlab.com/Nitrodist"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 2, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/41", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/41", "notes": "https://gitlab.com/api/v4/projects/14022/issues/41/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/41/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 1578396, "iid": 40, "project_id": 14022, "title": "How can I see a ssh error log?", "description": "Hi. Thank you all guys for creating and sharing these great apps.  \r\nI'm using Gitlab 8.6.4 of [sameersbn/docker-gitlab](https://github.com/sameersbn/docker-gitlab) now.\r\n\r\n\r\nI was looking up `/var/log/gitlab/gitlab-shell/gitlab-shell.log` but there was no error log when our client failed to connect ssh because of an invalid id_rsa file.\r\n\r\nI found `log_level` setting in [config.yml](https://gitlab.com/gitlab-org/gitlab-shell/blob/master/config.yml.example) but couldn't find any document of this parameter.\r\n  \r\n  \r\nI saw docs like these.\r\n- http://doc.gitlab.com/omnibus/settings/logs.html\r\n- http://doc.gitlab.com/ce/logs/logs.html\r\n- https://gitlab.com/gitlab-org/gitlab-shell\r\n  \r\n  \r\n\r\nWhat value of `log_level` will show the errors in `gitlab-shell.log` and how will I be able to apply it on my running gitlab?\r\n\r\nI hope you'll be able to provide some information.\r\n\r\nThank you.", "state": "closed", "created_at": "2016-04-28T07:47:33.064Z", "updated_at": "2018-01-12T15:12:42.546Z", "closed_at": "2018-01-12T15:12:42.541Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 341150, "name": "kujiy", "username": "kujiy", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/b85c98d7f5aef61b7a5d181e8140903e?s=80&d=identicon", "web_url": "https://gitlab.com/kujiy"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/40", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/40", "notes": "https://gitlab.com/api/v4/projects/14022/issues/40/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/40/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 5103549, "type": null, "body": "I found the another log in [/var/log/gitlab/supervisor/sshd.log](https://github.com/sameersbn/docker-gitlab/blob/master/assets/build/install.sh#L295) at last.\r\nI tried to find sshd's log (supervisor's log) before wrote this issue but I didn't notice that there were two folders with the same name. \r\n\r\nNow I seem to get the sshd error log but I'd still want to know the `log_level` of `gitlab-shell.log`.\r\n\r\nThank you.", "attachment": null, "author": {"id": 341150, "name": "kujiy", "username": "kujiy", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/b85c98d7f5aef61b7a5d181e8140903e?s=80&d=identicon", "web_url": "https://gitlab.com/kujiy"}, "created_at": "2016-04-28T08:07:13.203Z", "updated_at": "2016-04-28T08:08:06.996Z", "system": false, "noteable_id": 1578396, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 40}], [{"id": 54339608, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:12:42.714Z", "updated_at": "2018-01-12T15:12:42.714Z", "system": true, "noteable_id": 1578396, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 40}]]}, {"id": 1409621, "iid": 39, "project_id": 14022, "title": "Add command to list tags on remote repos", "description": "", "state": "closed", "created_at": "2016-03-30T17:27:22.922Z", "updated_at": "2017-03-24T16:24:48.810Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 280339, "name": "Rub\u00e9n D\u00e1vila", "username": "rdavila", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/280339/avatar.png", "web_url": "https://gitlab.com/rdavila"}], "author": {"id": 280339, "name": "Rub\u00e9n D\u00e1vila", "username": "rdavila", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/280339/avatar.png", "web_url": "https://gitlab.com/rdavila"}, "assignee": {"id": 280339, "name": "Rub\u00e9n D\u00e1vila", "username": "rdavila", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/280339/avatar.png", "web_url": "https://gitlab.com/rdavila"}, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/39", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/39", "notes": "https://gitlab.com/api/v4/projects/14022/issues/39/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/39/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 4525909, "type": null, "body": "mentioned in merge request !47", "attachment": null, "author": {"id": 280339, "name": "Rub\u00e9n D\u00e1vila", "username": "rdavila", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/280339/avatar.png", "web_url": "https://gitlab.com/rdavila"}, "created_at": "2016-03-31T15:18:25.842Z", "updated_at": "2016-03-31T15:18:25.842Z", "system": true, "noteable_id": 1409621, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 39}, {"id": 4528428, "type": null, "body": "Status changed to closed by commit b8dffd8379b4c2e29243805396bda71c512e004b", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2016-03-31T18:16:05.190Z", "updated_at": "2016-03-31T18:16:05.190Z", "system": true, "noteable_id": 1409621, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 39}]]}, {"id": 1399684, "iid": 38, "project_id": 14022, "title": "InternalId#set_iid does not synchronize, leading to possible race conditions", "description": "The method `InternalId#set_iid` grabs the latest iid of a collection, adds 1 to it and then uses the result as the new iid. While there's a unique index on `(project_id, iid)` there's nothing on code level that seems to prevent a race condition where 2 requests try to create data with the same iid. The index itself doesn't _prevent_ the race condition, it merely prevents the result of it (= duplicate data).\r\n\r\nI'm not sure _if_ there's anything extra we can do depending on how good ActiveRecord's locking support is (it probably isn't), but at the very least it should be looked into.\r\n\r\ncc @DouweM @rspeicher", "state": "closed", "created_at": "2016-03-29T13:26:41.793Z", "updated_at": "2018-01-12T15:15:13.835Z", "closed_at": "2018-01-12T15:15:13.829Z", "closed_by": null, "labels": ["bug", "technical debt"], "milestone": null, "assignees": [], "author": {"id": 209240, "name": "Yorick Peterse", "username": "yorickpeterse", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/209240/avatar.png", "web_url": "https://gitlab.com/yorickpeterse"}, "assignee": null, "user_notes_count": 3, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/38", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/38", "notes": "https://gitlab.com/api/v4/projects/14022/issues/38/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/38/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 4481509, "type": null, "body": "I found the [sequenced gem](https://github.com/djreimer/sequenced) the other day, maybe that would be useful. See https://github.com/djreimer/sequenced#schema-and-data-integrity.\r\n\r\nEdit: Ah, yeah that seems to be what you already pointed out -- merely preventing the _result_ of the race condition.", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2016-03-29T16:25:19.733Z", "updated_at": "2016-03-29T16:27:03.515Z", "system": false, "noteable_id": 1399684, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 38}, {"id": 12634361, "type": null, "body": "Milestone changed to %8", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2016-06-22T17:05:28.408Z", "updated_at": "2016-06-22T17:05:28.408Z", "system": true, "noteable_id": 1399684, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 38}, {"id": 13309668, "type": null, "body": "Milestone changed to %5", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2016-07-25T17:35:19.023Z", "updated_at": "2016-07-25T17:35:19.023Z", "system": true, "noteable_id": 1399684, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 38}, {"id": 13313629, "type": null, "body": "Added ~15495 ~378220 labels", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2016-07-25T20:44:07.569Z", "updated_at": "2016-07-25T20:44:07.569Z", "system": true, "noteable_id": 1399684, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 38}, {"id": 22738930, "type": null, "body": "removed milestone", "attachment": null, "author": {"id": 87854, "name": "Douwe Maan", "username": "DouweM", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e03ae98506b6ae6ac2c8eee0c06fa4?s=80&d=identicon", "web_url": "https://gitlab.com/DouweM"}, "created_at": "2017-02-03T18:25:19.422Z", "updated_at": "2017-02-03T18:25:19.422Z", "system": true, "noteable_id": 1399684, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 38}], [{"id": 29137513, "type": null, "body": "I just hit this as well. What a pita. It _really_ concerns me that it's been a year with no movement - this is such a critical problem.\r\n\r\nhttps://gitlab.com/gitlab-org/gitlab-ee/issues/2374", "attachment": null, "author": {"id": 1289197, "name": "julian lyndon-smith", "username": "jmls", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1289197/avatar.png", "web_url": "https://gitlab.com/jmls"}, "created_at": "2017-05-09T17:44:16.943Z", "updated_at": "2017-05-09T17:44:16.943Z", "system": false, "noteable_id": 1399684, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 38}], [{"id": 54339901, "type": null, "body": "This doesn't seem to be a gitlab-shell problem and it is tracked by https://gitlab.com/gitlab-org/gitlab-ce/issues/31114 and https://gitlab.com/gitlab-org/gitlab-ce/issues/24285 , so I'll close this particular issue.\n\nI agree that it should be fixed though!", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:15:13.116Z", "updated_at": "2018-01-12T15:15:13.116Z", "system": false, "noteable_id": 1399684, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 38}], [{"id": 54339903, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:15:13.878Z", "updated_at": "2018-01-12T15:15:13.878Z", "system": true, "noteable_id": 1399684, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 38}]]}, {"id": 1194663, "iid": 37, "project_id": 14022, "title": "[Documentation] Update Readme.md to add missing gitlab-projects commands", "description": "Please update documentation to mention the `mv-project` & `fetch-remote` commands as well.\r\n\r\nMy use case: bulk move 50ish projects into new group. I had to do it one by one at the time through admin panel. `mv-project` could have saved me a lot of time there. This command should come in very handy once some form of nested grouping lands in gitlab.\r\n\r\nI'm not sure about use case of `fetch-remote` and documentation will help there.", "state": "closed", "created_at": "2016-02-12T13:07:39.900Z", "updated_at": "2018-01-12T14:46:27.476Z", "closed_at": "2018-01-12T14:46:27.470Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 67704, "name": "Maverik", "username": "maverik", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/97e3af512b76d08790c8a9c6c9bce18b?s=80&d=identicon", "web_url": "https://gitlab.com/maverik"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/37", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/37", "notes": "https://gitlab.com/api/v4/projects/14022/issues/37/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/37/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 54335563, "type": null, "body": "gitlab-projects is gone so we can close this issue: #113", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:46:26.782Z", "updated_at": "2018-01-12T14:46:26.782Z", "system": false, "noteable_id": 1194663, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 37}], [{"id": 54335564, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T14:46:27.549Z", "updated_at": "2018-01-12T14:46:27.549Z", "system": true, "noteable_id": 1194663, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 37}]]}, {"id": 1180704, "iid": 36, "project_id": 14022, "title": "Tests are broken with Ruby 2.2.4", "description": "```\r\n$ bundle exec rspec 2>&1 | head\r\n/Volumes/GitLab.com/gitlab-development-kit/gitlab-shell/lib/gitlab_init.rb:1: warning: already initialized constant ROOT_PATH\r\n/Volumes/GitLab.com/gitlab-development-kit/gitlab-shell/spec/spec_helper.rb:1: warning: previous definition of ROOT_PATH was here\r\n[2016-02-09 16:59:37] INFO  WEBrick 1.3.1\r\n[2016-02-09 16:59:37] INFO  ruby 2.2.4 (2015-12-16) [x86_64-darwin15]\r\n[2016-02-09 16:59:37] INFO  HTTPUNIXServer#start: pid=3307 port=80\r\n[2016-02-09 16:59:37] ERROR NoMethodError: undefined method `[]' for nil:NilClass\r\n\t/Users/jacobvosmaer/.rubies/2.2.4/lib/ruby/2.2.0/webrick/server.rb:174:in `block in start'\r\n[2016-02-09 16:59:37] ERROR NoMethodError: undefined method `[]' for nil:NilClass\r\n\t/Users/jacobvosmaer/.rubies/2.2.4/lib/ruby/2.2.0/webrick/server.rb:174:in `block in start'\r\n[2016-02-09 16:59:37] ERROR NoMethodError: undefined method `[]' for nil:NilClass\r\n```\r\n\r\n(It prints many many times the same error, that is why I put `head` there.)\r\n\r\ncc @jameslopez ", "state": "closed", "created_at": "2016-02-09T16:00:23.556Z", "updated_at": "2017-03-24T16:24:48.849Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 273486, "name": "James Lopez", "username": "jameslopez", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/273486/avatar.png", "web_url": "https://gitlab.com/jameslopez"}], "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "assignee": {"id": 273486, "name": "James Lopez", "username": "jameslopez", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/273486/avatar.png", "web_url": "https://gitlab.com/jameslopez"}, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/36", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/36", "notes": "https://gitlab.com/api/v4/projects/14022/issues/36/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/36/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 3637710, "type": null, "body": "mentioned in merge request !38", "attachment": null, "author": {"id": 273486, "name": "James Lopez", "username": "jameslopez", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/273486/avatar.png", "web_url": "https://gitlab.com/jameslopez"}, "created_at": "2016-02-09T17:24:32.110Z", "updated_at": "2016-02-09T17:24:32.110Z", "system": true, "noteable_id": 1180704, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 36}, {"id": 3650767, "type": null, "body": "Status changed to closed by commit ff31080b0d5b5e7c99bfe7738aaa2bb1fafe60fb", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2016-02-10T13:34:56.199Z", "updated_at": "2016-02-10T13:34:56.199Z", "system": true, "noteable_id": 1180704, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 36}, {"id": 3945375, "type": null, "body": "mentioned in commit kirr/gitlab-shell@ff31080b0d5b5e7c99bfe7738aaa2bb1fafe60fb", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2016-02-25T19:50:15.926Z", "updated_at": "2016-02-25T19:50:15.926Z", "system": true, "noteable_id": 1180704, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 36}]]}, {"id": 1018578, "iid": 35, "project_id": 14022, "title": "Releases should be tagged as soon as you add requirements into other parts of the project", "description": "```\r\nWARNING: This version of GitLab depends on gitlab-shell 2.6.10, but you're running 2.6.9. Please update gitlab-shell.\r\n```\r\n\r\nWithout a corresponding release just sucks. I am happy to run snapshots of gitlab-ce and help you testing but not everything should be a snapshot then.", "state": "closed", "created_at": "2016-01-11T16:37:58.881Z", "updated_at": "2018-01-15T12:17:24.337Z", "closed_at": "2018-01-12T15:16:13.218Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 123015, "name": "darix", "username": "darix", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/eec0b791c6aab72d99940855fe374fda?s=80&d=identicon", "web_url": "https://gitlab.com/darix"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/35", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/35", "notes": "https://gitlab.com/api/v4/projects/14022/issues/35/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/35/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 54340044, "type": null, "body": "I agree, and think we are doing this now. We tag the relase before updating GITLAB_SHELL_VERSION in gitlab-ce.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:16:12.617Z", "updated_at": "2018-01-12T15:16:12.617Z", "system": false, "noteable_id": 1018578, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 35}], [{"id": 54340046, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:16:13.261Z", "updated_at": "2018-01-12T15:16:13.261Z", "system": true, "noteable_id": 1018578, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 35}], [{"id": 54547070, "type": null, "body": "Thank you!", "attachment": null, "author": {"id": 123015, "name": "darix", "username": "darix", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/eec0b791c6aab72d99940855fe374fda?s=80&d=identicon", "web_url": "https://gitlab.com/darix"}, "created_at": "2018-01-15T12:17:24.323Z", "updated_at": "2018-01-15T12:17:24.323Z", "system": false, "noteable_id": 1018578, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 35}]]}, {"id": 939120, "iid": 34, "project_id": 14022, "title": "Auto create custom_hooks when create project", "description": "1. custom_hooks hold all group and project hooks.\r\n\r\n2. custom_hooks project in gitlab \r\n  \r\n  1. custom_hook hook him self \r\n  2. custom_hook auto update himself on gitlab.\r\n\r\n3. custom_hooks patch auto create custom_hooks when create project.\r\n\r\n## Patch for gitlab-shell: ##\r\n\r\n```patch\r\n--- gitlab-shell/lib/gitlab_projects.rb.bak\t2015-12-22 14:23:31.583468111 +0800\r\n+++ gitlab-shell/lib/gitlab_projects.rb\t2015-12-22 14:49:03.271317753 +0800\r\n@@ -6,6 +6,7 @@ require_relative 'gitlab_logger'\r\n \r\n class GitlabProjects\r\n   GLOBAL_HOOKS_DIRECTORY = File.join(ROOT_PATH, 'hooks')\r\n+  GLOBAL_CUSTOM_HOOKS_DIRECTORY = File.join(ROOT_PATH, 'custom_hooks')\r\n \r\n   # Project name is a directory name for repository with .git at the end\r\n   # It may be namespaced or not. Like repo.git or gitlab/repo.git\r\n@@ -21,13 +22,21 @@ class GitlabProjects\r\n \r\n   def self.create_hooks(path)\r\n     local_hooks_directory = File.join(path, 'hooks')\r\n+    local_custom_hooks_directory = File.join(path, 'custom_hooks')\r\n     real_local_hooks_directory = :not_found\r\n+    real_local_custom_hooks_directory = :not_found\r\n     begin\r\n       real_local_hooks_directory = File.realpath(local_hooks_directory)\r\n     rescue Errno::ENOENT\r\n       # real_local_hooks_directory == :not_found\r\n     end\r\n \r\n+    begin\r\n+      real_local_hooks_directory = File.realpath(local_custom_hooks_directory)\r\n+    rescue Errno::ENOENT\r\n+      # real_local_custom_hooks_directory == :not_found\r\n+    end\r\n+\r\n     if real_local_hooks_directory != File.realpath(GLOBAL_HOOKS_DIRECTORY)\r\n       if File.exist?(local_hooks_directory)\r\n         $logger.info \"Moving existing hooks directory and symlinking global hooks directory for #{path}.\"\r\n@@ -38,6 +47,17 @@ class GitlabProjects\r\n       $logger.info \"Hooks already exist for #{path}.\"\r\n       true\r\n     end\r\n+\r\n+    if real_local_custom_hooks_directory != File.realpath(GLOBAL_HOOKS_DIRECTORY)\r\n+      if File.exist?(local_custom_hooks_directory)\r\n+        $logger.info \"Moving existing hooks directory and symlinking global hooks directory for #{path}.\"\r\n+        FileUtils.mv(local_custom_hooks_directory, \"#{local_custom_hooks_directory}.old.#{Time.now.to_i}\")\r\n+      end\r\n+      FileUtils.ln_sf(GLOBAL_CUSTOM_HOOKS_DIRECTORY, local_custom_hooks_directory)\r\n+    else\r\n+      $logger.info \"Custom hooks already exist for #{path}.\"\r\n+      true\r\n+    end\r\n   end\r\n \r\n   def initialize\r\n\r\n```\r\n\r\n## custom_hooks project Files ##\r\n\r\n```bash\r\ncustom_hooks\r\n\u251c\u2500\u2500 custom #Group name this is custom_hooks hook\r\n\u2502   \u251c\u2500\u2500 post-receive \r\n\u2502   \u2514\u2500\u2500 pre-receive \r\n\u251c\u2500\u2500 other_group #Other Group name\r\n\u2502   \u2514\u2500\u2500 pre-receive #Other Group post-receive\r\n\u251c\u2500\u2500 ...\r\n\u251c\u2500\u2500 ...\r\n\u251c\u2500\u2500 another_group\r\n\u2502   \u251c\u2500\u2500 post-receive\r\n\u2502   \u2514\u2500\u2500 pre-receive\r\n\u251c\u2500\u2500 post-receive #hold group name and run group post-receive hooks\r\n\u2514\u2500\u2500 pre-receive  #hold group name and run group pre-receive\r\n```\r\n\r\npost-receive content:\r\n```bash\r\n#!/bin/bash\r\n#BASH_SOURCE\r\n\r\n#echo \"Running $BASH_SOURCE\"\r\nCUR_HOOK_DIR=`dirname $BASH_SOURCE`\r\nGIT_FULLPATH=$PWD\r\nGIT_NAME=`basename $GIT_FULLPATH`\r\nGIT_GROUPPATH=`dirname $GIT_FULLPATH`\r\nGIT_GROUPNAME=`basename $GIT_GROUPPATH`\r\nX_RECEIVE=post-receive\r\nGROUP_HOOK=$CUR_HOOK_DIR/$GIT_GROUPNAME/$X_RECEIVE\r\n\r\nexport CUR_HOOK_DIR\r\nexport GIT_FULLPATH\r\nexport GIT_NAME\r\nexport GIT_GROUPPATH\r\nexport GIT_GROUPNAME\r\nexport X_RECEIVE\r\nexport GROUP_HOOK\r\n\r\necho \"\tcheck $X_RECEIVE\"\r\nif [ -f $GROUP_HOOK ]; then\r\n\techo \"\tfound $X_RECEIVE: run\"\r\n\techo \"\t$GIT_GROUPNAME/$X_RECEIVE\"\r\n\t$GROUP_HOOK $@\r\nelse\r\n\techo \"$X_RECEIVE not found\"\r\nfi\r\n```\r\n\r\npre-receive content:\r\n\r\n```bash\r\n#!/bin/bash\r\n#BASH_SOURCE\r\n\r\n#echo \"Running $BASH_SOURCE\"\r\nCUR_HOOK_DIR=`dirname $BASH_SOURCE`\r\nGIT_FULLPATH=$PWD\r\nGIT_NAME=`basename $GIT_FULLPATH`\r\nGIT_GROUPPATH=`dirname $GIT_FULLPATH`\r\nGIT_GROUPNAME=`basename $GIT_GROUPPATH`\r\nX_RECEIVE=pre-receive\r\nGROUP_HOOK=$CUR_HOOK_DIR/$GIT_GROUPNAME/$X_RECEIVE\r\n\r\necho \"-------------------------------------\"\r\necho \"     repo \uff1a $GIT_NAME\"\r\necho \"     group\uff1a $GIT_GROUPNAME\"\r\necho \"-------------------------------------\"\r\necho \"\tcheck $X_RECEIVE\"\r\nif [ -f $GROUP_HOOK ]; then\r\n\techo \"\tfound $X_RECEIVE: found\"\r\n\techo \"\t$GIT_GROUPNAME/$X_RECEIVE\"\r\n\t$GROUP_HOOK $@\r\nelse\r\n\techo \"$X_RECEIVE not found\"\r\nfi\r\n```\r\n\r\n\r\ncustom/post-receive content:\r\n\r\n```bash\r\n#!/bin/bash\r\n\r\nuser=username\r\npassword=password\r\ncustom_hooks_path=\"/opt/gitlab/embedded/service/gitlab-shell/custom_hooks\"\r\nif [ $GIT_NAME = \"custom_hooks.git\" ]; then\r\n    sshpass -p $password ssh username@gitlab.domain \"cd $custom_hooks_path\"; git pull\"\r\nfi\r\n```\r\n\r\n## Auto create hooks result ##\r\n```bash\r\ngitlab:/opt/gitlab-opt/gitlab/git-data/repositories/gdzhang/test.git# ls ../test2.git/ -l\r\ntotal 16\r\n-rw-r--r-- 1 git git   91 12\u6708 22 14:49 config\r\nlrwxrwxrwx 1 git git   54 12\u6708 22 14:49 custom_hooks -> /opt/gitlab/embedded/service/gitlab-shell/custom_hooks\r\n-rw-r--r-- 1 git git   73 12\u6708 22 14:49 description\r\n-rw-r--r-- 1 git git   23 12\u6708 22 14:49 HEAD\r\nlrwxrwxrwx 1 git git   47 12\u6708 22 14:49 hooks -> /opt/gitlab/embedded/service/gitlab-shell/hooks\r\n\r\n```\r\n", "state": "closed", "created_at": "2015-12-22T07:32:12.605Z", "updated_at": "2019-04-04T14:38:05.241Z", "closed_at": "2019-04-04T14:38:05.217Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": [], "milestone": null, "assignees": [], "author": {"id": 122325, "name": "gdbdzgd", "username": "gdbdzgd", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/89117ee125fc37bcd16678122909ecb9?s=80&d=identicon", "web_url": "https://gitlab.com/gdbdzgd"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 3, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/34", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/34", "notes": "https://gitlab.com/api/v4/projects/14022/issues/34/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/34/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 3023978, "type": null, "body": "mentioned in issue #32", "attachment": null, "author": {"id": 122325, "name": "gdbdzgd", "username": "gdbdzgd", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/89117ee125fc37bcd16678122909ecb9?s=80&d=identicon", "web_url": "https://gitlab.com/gdbdzgd"}, "created_at": "2015-12-23T03:26:36.050Z", "updated_at": "2015-12-23T03:26:36.050Z", "system": true, "noteable_id": 939120, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 34}], [{"id": 157468123, "type": null, "body": "I'm going to close this as a duplicate of https://gitlab.com/gitlab-org/gitlab-ce/issues/58176 - hooks are no longer under the control of gitlab-shell.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:37:59.731Z", "updated_at": "2019-04-04T14:37:59.731Z", "system": false, "noteable_id": 939120, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 34}], [{"id": 157468154, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:38:05.265Z", "updated_at": "2019-04-04T14:38:05.265Z", "system": true, "noteable_id": 939120, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 34}]]}, {"id": 850100, "iid": 33, "project_id": 14022, "title": "Create repo path if not exists", "description": "Trying to fork a project while the user hasn't created project yet, fails... (initially noted on Feb 3, 2014). This exact issue persists!\r\n\r\nOriginating from https://github.com/gitlabhq/gitlabhq/issues/6228 and with the root cause described in https://github.com/gitlabhq/gitlab-shell/pull/226 the original issue still remains in GitLab 8.2.3 - GitLab Shell 2.6.8.\r\n\r\nThe GitLab Shell pull request solves the problem (verified it again today), so why not pull it in? The test \"should not fork into a namespace that doesn't exist\" would have to be dropped though. What's the reason for this test?", "state": "closed", "created_at": "2015-12-15T10:02:20.068Z", "updated_at": "2018-01-12T15:18:04.379Z", "closed_at": "2018-01-12T15:18:04.374Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 351360, "name": "Per G\u00e4rden", "username": "perg", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/06cc73d6dd1a36c15da64246202c96c8?s=80&d=identicon", "web_url": "https://gitlab.com/perg"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/33", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/33", "notes": "https://gitlab.com/api/v4/projects/14022/issues/33/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/33/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 54340289, "type": null, "body": "This should no longer be a problem as forking creates the namespace then the project. The responsible code has moved into gitlab-ce since #113 ; feel free to open a new issue there if a problem persists.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:18:03.170Z", "updated_at": "2018-01-12T15:18:03.170Z", "system": false, "noteable_id": 850100, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 33}], [{"id": 54340290, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:18:04.429Z", "updated_at": "2018-01-12T15:18:04.429Z", "system": true, "noteable_id": 850100, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 33}]]}, {"id": 829431, "iid": 32, "project_id": 14022, "title": "Add ability to configure a global set of custom hooks", "description": "## Description including problem, use cases, benefits, and/or goals\r\n\r\nOrganisations would like to apply custom git hooks to all projects, present and future. This makes it easier to enforce a very specific workflow.\r\n\r\nRight now, this requires manual editing the server for each new project.\r\n\r\n## Proposal\r\n\r\nWe can do global custom_hooks directory in gitlab-shell. There you can put custom hooks that will be symlinked to every new project created. If you don't want a hook in certain project - just manually remove symlink. Its also up to author to make a proper error messages in hooks to make experience more friendly.\r\n\r\nA rake task that would show which projects have or lack the symlink would make this significantly easier.\r\n\r\n## original issue\r\n\r\nSome organizations configure custom hooks that they wish to apply to all projects - present and future. This is especially useful for pre-receive hooks - adding some policy check before accepting a push. This could potentially be accomplished through a symlink or we could add an additional call to global hooks before project-specific custom hooks.\r\n\r\nThis feature was requested by a large prospective organization. \r\n\r\ncc/ @dzaporozhets What do you think?", "state": "closed", "created_at": "2015-12-11T18:55:03.161Z", "updated_at": "2017-11-15T16:38:32.265Z", "closed_at": null, "closed_by": null, "labels": ["customer", "feature"], "milestone": {"id": 118779, "iid": 11, "project_id": 14022, "title": "8.15", "description": "", "state": "closed", "created_at": "2016-10-24T12:30:59.531Z", "updated_at": "2017-02-03T18:30:05.533Z", "due_date": "2016-12-22", "start_date": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/-/milestones/11"}, "assignees": [{"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}], "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "assignee": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "user_notes_count": 35, "merge_requests_count": 1, "upvotes": 3, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/32", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/32", "notes": "https://gitlab.com/api/v4/projects/14022/issues/32/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/32/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": 4, "epic_iid": null, "discussion": [[{"id": 2928859, "type": null, "body": "@dblessing You're positive this organization will have these hooks on every repo, no exceptions?", "attachment": null, "author": {"id": 1, "name": "Sid Sijbrandij", "username": "sytses", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/78b060780d36f51a6763ac9831a4f022?s=80&d=identicon", "web_url": "https://gitlab.com/sytses"}, "created_at": "2015-12-11T21:37:46.850Z", "updated_at": "2015-12-11T21:37:46.850Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 2928961, "type": null, "body": "@sytses That's what they've told us. They have a series of pre-checks they run on every project to enforce policy. It's a bit of a specific use-case, but I can see how it might be useful to some other organizations. I also don't think it would be too much effort to do it.", "attachment": null, "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "created_at": "2015-12-11T21:56:04.797Z", "updated_at": "2015-12-11T21:56:04.797Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 2959496, "type": null, "body": "@JobV It would be great to get your feedback on this feature request as well.  This request is from an India based company that provides an online marketplace.   They have around 2000 developers and this is a critical feature request for their current workflow.  (This could be a good Enterprise upgrade type feature). ", "attachment": null, "author": {"id": 276352, "name": "Zach Long", "username": "ZachLong", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/87af090e2daaf3958983ae303773100b?s=80&d=identicon", "web_url": "https://gitlab.com/ZachLong"}, "created_at": "2015-12-15T21:07:13.671Z", "updated_at": "2015-12-15T21:21:41.906Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 2965231, "type": null, "body": "@ZachLong @dblessing for extensive checks, they're probably better of using CI and a good merge flow.\r\n\r\nNone the less, I can imagine an organisation wanting this, although it's not a very good idea.\r\n\r\n@dzaporozhets your thoughts on the feasibility of this?", "attachment": null, "author": {"id": 5497, "name": "Job van der Voort", "username": "JobV", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e1e9ffdda52d8c519ac5c49929d7dc?s=80&d=identicon", "web_url": "https://gitlab.com/JobV"}, "created_at": "2015-12-16T11:23:45.453Z", "updated_at": "2015-12-16T11:23:45.453Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 3023976, "type": null, "body": "@dblessing I have done this use my function \r\n\r\nuse my patch and custom_hooks.git project in gitlab it can hold groups hooks and every project \uff5e\r\n\r\nsee #34  \r\n\r\ncc/ @sytses @ZachLong @JobV @dzaporozhets ", "attachment": null, "author": {"id": 122325, "name": "gdbdzgd", "username": "gdbdzgd", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/89117ee125fc37bcd16678122909ecb9?s=80&d=identicon", "web_url": "https://gitlab.com/gdbdzgd"}, "created_at": "2015-12-23T03:26:35.098Z", "updated_at": "2015-12-23T03:26:35.098Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 3025666, "type": null, "body": "by the way how can I submit my merge request~ :cold_sweat: @dzaporozhets @dblessing \r\nhttps://gitlab.com/gdbdzgd/gitlab-shell/commit/4afb101a85bdda67e28e707b66b140a457e8fc55", "attachment": null, "author": {"id": 122325, "name": "gdbdzgd", "username": "gdbdzgd", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/89117ee125fc37bcd16678122909ecb9?s=80&d=identicon", "web_url": "https://gitlab.com/gdbdzgd"}, "created_at": "2015-12-23T09:17:32.719Z", "updated_at": "2015-12-23T09:17:32.719Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 3025693, "type": null, "body": "we can add an option in web control global custom_hooks [enable/disable] ", "attachment": null, "author": {"id": 122325, "name": "gdbdzgd", "username": "gdbdzgd", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/89117ee125fc37bcd16678122909ecb9?s=80&d=identicon", "web_url": "https://gitlab.com/gdbdzgd"}, "created_at": "2015-12-23T09:18:57.457Z", "updated_at": "2015-12-23T09:18:57.457Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 3033021, "type": null, "body": "https://gitlab.com/gdbdzgd/gitlab-shell/commit/4afb101a85bdda67e28e707b66b140a457e8fc55", "attachment": null, "author": {"id": 122325, "name": "gdbdzgd", "username": "gdbdzgd", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/89117ee125fc37bcd16678122909ecb9?s=80&d=identicon", "web_url": "https://gitlab.com/gdbdzgd"}, "created_at": "2015-12-24T05:15:18.670Z", "updated_at": "2015-12-24T05:15:18.670Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 3131564, "type": null, "body": "Hi @gdbdzgd \r\n\r\nFor something like global custom hooks we need to implement it in the same way as the current single project custom hooks. This means filesystem configuration only, no application settings. This is a low-level feature.\r\n\r\nIf you still wish to send a merge request you can do so by forking the project and then open a merge request against the main repository master branch.", "attachment": null, "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "created_at": "2016-01-06T18:50:41.518Z", "updated_at": "2016-01-06T18:50:41.518Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 3132276, "type": null, "body": "Implementation suggestion from a comment on IRC: \"What about having a directory of global custom hooks and linking them (or a specified subset of them) into newly-created repos by default? Allows global custom hooks as a starting point but repos could customize which ones they need after. Would also be easy to see what hooks will be run (anything in the project's custom_hooks dir - normal script or link to a global hook)\"\r\n\r\nPasting here for later. I haven't had time to digest it.", "attachment": null, "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "created_at": "2016-01-06T20:34:00.375Z", "updated_at": "2016-01-06T20:34:00.375Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 3942920, "type": null, "body": "@JobV Will you please schedule?", "attachment": null, "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "created_at": "2016-02-25T17:01:01.709Z", "updated_at": "2016-02-25T17:01:01.709Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 4028895, "type": null, "body": "@dblessing I'm not excited about the proposals as they will stifle moving quickly with new projects.\r\n\r\nI also have to hear from @dzaporozhets whether this is easily possible.", "attachment": null, "author": {"id": 5497, "name": "Job van der Voort", "username": "JobV", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e1e9ffdda52d8c519ac5c49929d7dc?s=80&d=identicon", "web_url": "https://gitlab.com/JobV"}, "created_at": "2016-03-01T13:16:12.823Z", "updated_at": "2016-03-01T13:16:12.823Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 4040576, "type": null, "body": "@JobV What do you mean 'stifle moving quickly with new projects'? \r\n\r\nFrom a technical perspective it **should** be relatively easy. We have the logic for custom hooks, now it just needs to execute by looking in one additional location.", "attachment": null, "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "created_at": "2016-03-01T16:00:05.038Z", "updated_at": "2016-03-01T16:00:05.038Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 4054424, "type": null, "body": "@dblessing @JobV are we talking about feature like this http://doc.gitlab.com/ce/hooks/custom_hooks.html instead of per-project customer wants certain hook be symlink to all projects from gitlab-shell directory? ", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2016-03-02T13:43:28.801Z", "updated_at": "2016-03-02T13:43:28.801Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 4078053, "type": null, "body": "@dzaporozhets yes.\r\n\r\n@dblessing because custom hooks set restrictions to new projects without being visible immediately to the person starting the project.\r\n\r\nSay I make a custom hook that disallows you to commit files ending with `.test`. As a new employee I might make a little test project and try to push something I call `test.test`. When I push it, my push gets rejected without any mention of the reason. \r\n\r\nAnyway, I don't really like pre-commit hooks. I'll let @dzaporozhets give his opinion, because I do understand the usecase of the customer.", "attachment": null, "author": {"id": 5497, "name": "Job van der Voort", "username": "JobV", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e1e9ffdda52d8c519ac5c49929d7dc?s=80&d=identicon", "web_url": "https://gitlab.com/JobV"}, "created_at": "2016-03-03T16:11:12.693Z", "updated_at": "2016-03-03T16:11:12.693Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 4078128, "type": null, "body": "@JobV Thanks. I understand where you're coming from. For the most part, I'm also against putting too much logic in custom hooks like this. It's surprising the number of customers who have complex hooks that do things like check JIRA. They're not just checking that an issue is mentioned, but that the issue is in the correct state before pushing. It seems like something so specific and yet I've heard it from multiple customers.", "attachment": null, "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "created_at": "2016-03-03T16:15:00.823Z", "updated_at": "2016-03-03T16:15:00.823Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 4211046, "type": null, "body": "@dblessing @JobV in general I am not big fan of this idea. I would rather implement more of this http://doc.gitlab.com/ee/git_hooks/git_hooks.html. However I understand it might now work for all customers. \r\n\r\nWe can do global `custom_hooks` directory in gitlab-shell. There you can put custom hooks that will be symlinked to every new project created. If you don't want a hook in certain project - just manually remove symlink. Its also up to author to make a proper error messages in hooks to make experience more friendly. \r\n\r\nBasically pure gitlab-shell feature. ", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2016-03-11T09:24:45.322Z", "updated_at": "2016-03-11T09:24:45.322Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 4211925, "type": null, "body": "Thanks @dzaporozhets. I'll add your proposal to the description.", "attachment": null, "author": {"id": 5497, "name": "Job van der Voort", "username": "JobV", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e1e9ffdda52d8c519ac5c49929d7dc?s=80&d=identicon", "web_url": "https://gitlab.com/JobV"}, "created_at": "2016-03-11T10:11:50.558Z", "updated_at": "2016-03-11T10:11:50.558Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 4211952, "type": null, "body": "@dblessing can you see if this works for the customer?", "attachment": null, "author": {"id": 5497, "name": "Job van der Voort", "username": "JobV", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e1e9ffdda52d8c519ac5c49929d7dc?s=80&d=identicon", "web_url": "https://gitlab.com/JobV"}, "created_at": "2016-03-11T10:12:41.909Z", "updated_at": "2016-03-11T10:12:41.909Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 4462735, "type": null, "body": "@JobV Yes, this will work. It may be useful to have rake tasks to show which projects don't have the global link, and add it to all or some.", "attachment": null, "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "created_at": "2016-03-28T13:39:55.378Z", "updated_at": "2016-03-28T13:39:55.378Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 11702340, "type": null, "body": "Milestone changed to [8.11](https://gitlab.com/gitlab-org/gitlab-shell/milestones/5)", "attachment": null, "author": {"id": 5497, "name": "Job van der Voort", "username": "JobV", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e1e9ffdda52d8c519ac5c49929d7dc?s=80&d=identicon", "web_url": "https://gitlab.com/JobV"}, "created_at": "2016-05-09T11:35:19.752Z", "updated_at": "2016-05-09T11:35:19.752Z", "system": true, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 11702348, "type": null, "body": "Added ~243323 ~243322 labels", "attachment": null, "author": {"id": 5497, "name": "Job van der Voort", "username": "JobV", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/07e1e9ffdda52d8c519ac5c49929d7dc?s=80&d=identicon", "web_url": "https://gitlab.com/JobV"}, "created_at": "2016-05-09T11:35:49.528Z", "updated_at": "2016-05-09T11:35:49.528Z", "system": true, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 12815666, "type": null, "body": "Requested: https://gitlab.zendesk.com/agent/tickets/23584", "attachment": null, "author": {"id": 444214, "name": "Chris", "username": "MrChrisW", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444214/avatar.png", "web_url": "https://gitlab.com/MrChrisW"}, "created_at": "2016-07-01T03:21:57.462Z", "updated_at": "2016-07-01T03:21:57.462Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 14847938, "type": null, "body": "My company would also be interested in having a set of global custom hooks, mainly for mailing notifications to a dynamically created list of users. Also, it would be good to not have them clash with optional repository local custom hooks, I think symlinking would break that.\r\n\r\nSince we currently are upgrading from an old customized 5.x install to 8.11.x I have some time on my hands to look at this. Would you be accepting merge requests?\r\n\r\nHow about the idea of implementing this using the suggested global custom_hooks directory, but instead of symlinking and potentially clashing with local custom hooks, the global ones are simply also getting called via GitlabCustomHook#call_receive_hook? Filtering out unwanted repositories could happen in the hooks themselves, at the same time keeping configuration somewhat central.", "attachment": null, "author": {"id": 148656, "name": "Dirk H\u00f6rner", "username": "dirker", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/148656/avatar.png", "web_url": "https://gitlab.com/dirker"}, "created_at": "2016-09-01T18:45:51.385Z", "updated_at": "2016-09-01T18:45:51.385Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 14848113, "type": null, "body": "@dirker Sure, we'll entertain any merge request for this. We may also have to put something in the GitLab app to call custom hooks when using the web UI to commit.", "attachment": null, "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "created_at": "2016-09-01T18:53:55.020Z", "updated_at": "2016-09-01T18:53:55.020Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 14958195, "type": null, "body": "mentioned in merge request !89", "attachment": null, "author": {"id": 148656, "name": "Dirk H\u00f6rner", "username": "dirker", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/148656/avatar.png", "web_url": "https://gitlab.com/dirker"}, "created_at": "2016-09-05T11:27:28.104Z", "updated_at": "2016-09-05T11:27:28.104Z", "system": true, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 14958443, "type": null, "body": "I created !89 which implements my proposal. Please review and let me know.", "attachment": null, "author": {"id": 148656, "name": "Dirk H\u00f6rner", "username": "dirker", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/148656/avatar.png", "web_url": "https://gitlab.com/dirker"}, "created_at": "2016-09-05T11:29:01.595Z", "updated_at": "2016-09-05T11:29:01.595Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 16666205, "type": null, "body": "It's been 3 weeks since the activity on the MR, I hope this feature isn't loosing momentum. We have several policies that we're trying to implement and I see this feature as very helpful. It would allow us to keep the major policies uniform across all projects.", "attachment": null, "author": {"id": 658126, "name": "Robert Lasirona", "username": "lasirona", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/c071b712cf80574fec250c183374e3bd?s=80&d=identicon", "web_url": "https://gitlab.com/lasirona"}, "created_at": "2016-10-07T16:47:57.571Z", "updated_at": "2016-10-07T16:47:57.571Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 16666344, "type": null, "body": "Looking forward for a fix. Providing a way to manage such hooks via UI will be really awesome.", "attachment": null, "author": {"id": 560998, "name": "Muthu Subramaniam", "username": "thangamuthu", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/03cd3af94331ea269ddfcbd1e31a49a9?s=80&d=identicon", "web_url": "https://gitlab.com/thangamuthu"}, "created_at": "2016-10-07T16:52:26.063Z", "updated_at": "2016-10-07T16:52:26.063Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 16752471, "type": null, "body": "Mentioned in merge request !93", "attachment": null, "author": {"id": 163557, "name": "Elan Ruusam\u00e4e", "username": "glensc", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/effff0989c8041ef98aaf916c7092d6d?s=80&d=identicon", "web_url": "https://gitlab.com/glensc"}, "created_at": "2016-10-10T17:24:29.518Z", "updated_at": "2016-10-10T17:24:29.518Z", "system": true, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 16822201, "type": null, "body": "Just ran into this while upgrading to 8.10. Seems like there was something changed on hooks/post-receive and git therefor jumps into my face and won't upgrade until i manually figured out what my predecessor did to this script... The proper way to implement this seems to be a global custom hook. Please add this feature soon! I just hate managing custom patched files ;) Thanks! ", "attachment": null, "author": {"id": 776981, "name": "Matthias Baur", "username": "m.baur", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/69b5c294be8d288c04790c8158db81b0?s=80&d=identicon", "web_url": "https://gitlab.com/m.baur"}, "created_at": "2016-10-12T06:46:59.863Z", "updated_at": "2016-10-12T06:46:59.863Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 17155486, "type": null, "body": "I spoke with a prospect for EE yesterday who wanted this.  The company's own product interfaces with Gerrit  via git (global?) hooks.  A a part of moving from Gerrit to GitLab they are looking for that type of functionality in GitLab.  They don't want to have to implement the hooks separately for each project.  They have a LOT of projects.\n\nProspect details here: https://gitlab.my.salesforce.com/0066100000D1AUo", "attachment": null, "author": {"id": 434338, "name": "Reb", "username": "xyzzy", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/aee5472805ac7a5c87fd961f1704fcc4?s=80&d=identicon", "web_url": "https://gitlab.com/xyzzy"}, "created_at": "2016-10-19T13:47:03.183Z", "updated_at": "2016-10-19T13:47:03.183Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 17179604, "type": null, "body": "@xyzzy This is being implemented in either https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/89 or https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/93 - These are waiting a review from @DouweM afaik", "attachment": null, "author": {"id": 444214, "name": "Chris", "username": "MrChrisW", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444214/avatar.png", "web_url": "https://gitlab.com/MrChrisW"}, "created_at": "2016-10-20T02:22:55.636Z", "updated_at": "2016-10-20T02:22:55.636Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 18062169, "type": null, "body": "Requested https://gitlab.zendesk.com/agent/tickets/47561", "attachment": null, "author": {"id": 444214, "name": "Chris", "username": "MrChrisW", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444214/avatar.png", "web_url": "https://gitlab.com/MrChrisW"}, "created_at": "2016-11-09T01:58:59.037Z", "updated_at": "2016-11-09T01:58:59.037Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 18062177, "type": null, "body": "@smcgivern Can you look into https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/89 or https://gitlab.com/gitlab-org/gitlab-shell/merge_requests/93 maybe we can keep the preferred implementation open?", "attachment": null, "author": {"id": 444214, "name": "Chris", "username": "MrChrisW", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444214/avatar.png", "web_url": "https://gitlab.com/MrChrisW"}, "created_at": "2016-11-09T02:00:08.476Z", "updated_at": "2016-11-09T02:00:08.476Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 18181189, "type": null, "body": "I'm really sorry about how long this has taken. Basically, as you can see, we are waiting on some very busy people to review this, and as `gitlab-shell` rarely has features that on their own are this important, we don't have the best workflow for prioritising this.\n\nI think I prefer !93 because it doesn't add much more complexity, but the flexibility seems really useful and is implemented in a nice way. I've spoken to @DouweM and @rymai briefly about this, and I think we all agree it's better to make _a_ decision and get something merged. If this turns out to be the wrong decision, we can always change the code - that's the great thing about software! :grinning: \n\n@dirker thank you for working on this, and for your patience - I'll close !89 now and get to reviewing the other MR. Hopefully we can still make the merge window for 8.14!", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2016-11-11T11:41:43.217Z", "updated_at": "2016-11-11T11:41:43.217Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 18181190, "type": null, "body": "Milestone changed to %10", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2016-11-11T11:41:45.008Z", "updated_at": "2016-11-11T11:41:45.008Z", "system": true, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 18181191, "type": null, "body": "Reassigned to @smcgivern", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2016-11-11T11:41:45.047Z", "updated_at": "2016-11-11T11:41:45.047Z", "system": true, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 18181234, "type": null, "body": "Mentioned in merge request !89", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2016-11-11T11:43:21.544Z", "updated_at": "2016-11-11T11:43:21.544Z", "system": true, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 18425096, "type": null, "body": "Hmm, actually 8.15 might be a better idea. We'd be merging this very close to the release, and it is quite a significant change. But we will do it!", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2016-11-15T10:43:18.819Z", "updated_at": "2016-11-15T10:43:18.819Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 18425097, "type": null, "body": "Milestone changed to %11", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2016-11-15T10:43:19.418Z", "updated_at": "2016-11-15T10:43:19.418Z", "system": true, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 19287974, "type": null, "body": "Mentioned in merge request !111", "attachment": null, "author": {"id": 443319, "name": "Sean McGivern", "username": "smcgivern", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/443319/avatar.png", "web_url": "https://gitlab.com/smcgivern"}, "created_at": "2016-12-01T12:13:23.325Z", "updated_at": "2016-12-01T12:13:23.325Z", "system": true, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 19505026, "type": null, "body": "closed via merge request !111", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2016-12-06T16:43:32.856Z", "updated_at": "2016-12-06T16:43:32.856Z", "system": true, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}, {"id": 19519605, "type": null, "body": "mentioned in commit savitojs/gitlab-shell@e1b0aca197cb61a4ee33b8de37b79c57bb3369ad", "attachment": null, "author": {"id": 128633, "name": "R\u00e9my Coutable", "username": "rymai", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/263da227929cc0035cb0eba512bcf81a?s=80&d=identicon", "web_url": "https://gitlab.com/rymai"}, "created_at": "2016-12-06T20:33:47.357Z", "updated_at": "2016-12-06T20:33:47.357Z", "system": true, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}], [{"id": 47364922, "type": null, "body": "@dblessing This seems to cover pre-receive and post-receive, but not pre-commit.  Would the same method work for pre-commit hooks?  I have a customer asking about that.", "attachment": null, "author": {"id": 1514779, "name": "Brendan O'Leary \ud83d\udc22", "username": "brendan", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1514779/avatar.png", "web_url": "https://gitlab.com/brendan"}, "created_at": "2017-11-15T15:04:51.824Z", "updated_at": "2017-11-15T15:04:51.824Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}], [{"id": 47380878, "type": null, "body": "@boleary We talked in chat since you posted this, but to close the loop here - no, pre-commit hooks are client-side only. This is a Git design and not something we can change.", "attachment": null, "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "created_at": "2017-11-15T16:38:32.132Z", "updated_at": "2017-11-15T16:38:32.132Z", "system": false, "noteable_id": 829431, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 32}]]}, {"id": 736772, "iid": 31, "project_id": 14022, "title": "Prevent mistakes like 2.6.6-2.6.7 RCE in the future", "description": "", "state": "closed", "created_at": "2015-11-25T15:30:08.678Z", "updated_at": "2017-03-24T16:24:48.932Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [{"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}], "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "assignee": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "user_notes_count": 3, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/31", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/31", "notes": "https://gitlab.com/api/v4/projects/14022/issues/31/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/31/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 2765192, "type": null, "body": "I want GitlabShell#exec_cmd to bail out when passed a string instead of an array. Also document how to invoke a command with no arguments.", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2015-11-25T15:32:47.355Z", "updated_at": "2015-11-25T15:32:47.355Z", "system": false, "noteable_id": 736772, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 31}, {"id": 2766269, "type": null, "body": "In !33", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2015-11-25T17:01:38.619Z", "updated_at": "2015-11-25T17:01:38.619Z", "system": false, "noteable_id": 736772, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 31}, {"id": 5109808, "type": null, "body": "Reassigned to @jacobvosmaer-gitlab", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2016-04-28T13:11:32.255Z", "updated_at": "2016-04-28T13:11:32.255Z", "system": true, "noteable_id": 736772, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 31}, {"id": 5109810, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2016-04-28T13:11:41.679Z", "updated_at": "2016-04-28T13:11:41.679Z", "system": true, "noteable_id": 736772, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 31}, {"id": 5109811, "type": null, "body": "MR got merged.", "attachment": null, "author": {"id": 513969, "name": "Jacob Vosmaer", "username": "jacobvosmaer-gitlab", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d92f60988b2c44662df64bd895f28dbf?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer-gitlab"}, "created_at": "2016-04-28T13:11:41.782Z", "updated_at": "2016-04-28T13:11:41.782Z", "system": false, "noteable_id": 736772, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 31}]]}, {"id": 656389, "iid": 30, "project_id": 14022, "title": "allow using gitlab-shell installation from tarballs and use load path instead of require_relative", "description": "1. Should not require git repo for gitlab-shell, I want to package it separately from tag tarballs.\r\n2. By default we install lib/* to /usr/lib/vendor_ruby and it will be available from ruby load path. So instead of using require_relative, if you add lib directory to load path, both cases will work.\r\n\r\n```\r\n** Execute gitlab:shell:install\r\nfatal: Not a git repository (or any of the parent directories): .git\r\nfatal: Not a git repository (or any of the parent directories): .git\r\nfatal: Not a git repository (or any of the parent directories): .git\r\nbin/install:3:in `require_relative': cannot load such file -- /usr/share/gitlab\r\n-shell/lib/gitlab_init (LoadError)\r\n        from bin/install:3:in `<main>'\r\nbin/create-hooks:7:in `require_relative': cannot load such file -- /usr/share/g\r\nitlab-shell/lib/gitlab_init (LoadError)\r\n        from bin/create-hooks:7:in `<main>'\r\nrake aborted!\r\nErrno::ENOENT: No such file or directory @ rb_sysopen - /usr/share/gitlab/.ssh/\r\nenvironment\r\n/usr/share/gitlab/lib/tasks/gitlab/shell.rake:73:in `initialize'\r\n/usr/share/gitlab/lib/tasks/gitlab/shell.rake:73:in `open'\r\n/usr/share/gitlab/lib/tasks/gitlab/shell.rake:73:in `block (3 levels) in <top (\r\nrequired)>'\r\n/usr/lib/ruby/vendor_ruby/rake/task.rb:240:in `call'\r\n/usr/lib/ruby/vendor_ruby/rake/task.rb:240:in `block in execute'\r\n/usr/lib/ruby/vendor_ruby/rake/task.rb:235:in `each'\r\n/usr/lib/ruby/vendor_ruby/rake/task.rb:235:in `execute'\r\n/usr/lib/ruby/vendor_ruby/rake/task.rb:179:in `block in invoke_with_call_chain'\r\n/usr/lib/ruby/2.1.0/monitor.rb:211:in `mon_synchronize'\r\n/usr/lib/ruby/vendor_ruby/rake/task.rb:172:in `invoke_with_call_chain'\r\n/usr/lib/ruby/vendor_ruby/rake/task.rb:165:in `invoke'\r\n/usr/lib/ruby/vendor_ruby/rake/application.rb:150:in `invoke_task'\r\n/usr/lib/ruby/vendor_ruby/rake/application.rb:106:in `block (2 levels) in top_level'\r\n/usr/lib/ruby/vendor_ruby/rake/application.rb:106:in `each'\r\n/usr/lib/ruby/vendor_ruby/rake/application.rb:106:in `block in top_level'\r\n/usr/lib/ruby/vendor_ruby/rake/application.rb:115:in `run_with_threads'\r\n/usr/lib/ruby/vendor_ruby/rake/application.rb:100:in `top_level'\r\n/usr/lib/ruby/vendor_ruby/rake/application.rb:78:in `block in run'\r\n/usr/lib/ruby/vendor_ruby/rake/application.rb:176:in `standard_exception_handling'\r\n/usr/lib/ruby/vendor_ruby/rake/application.rb:75:in `run'\r\n/usr/bin/rake:27:in `<main>'   \r\nTasks: TOP => gitlab:shell:install\r\n```", "state": "closed", "created_at": "2015-11-10T05:12:36.844Z", "updated_at": "2017-06-06T18:27:56.337Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/30", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/30", "notes": "https://gitlab.com/api/v4/projects/14022/issues/30/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/30/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 2622483, "type": null, "body": "mentioned in merge request !28", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2015-11-10T17:58:58.829Z", "updated_at": "2015-11-10T17:58:58.829Z", "system": true, "noteable_id": 656389, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 30}, {"id": 2638163, "type": null, "body": "Status changed to closed by merge request !28", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2015-11-12T11:29:09.281Z", "updated_at": "2015-11-12T11:29:09.281Z", "system": true, "noteable_id": 656389, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 30}]]}, {"id": 646997, "iid": 29, "project_id": 14022, "title": "Support connecting to Redis Sentinel", "description": "Needed for Redis HA on gitlab.com gitlab-com/operations#5.\r\n\r\nMeans adding sentinel config in config.yml: list of sentinels, master name. And when sentinel is enabled, <s>before connecting to redis, first run `redis-cli SENTINEL get-master-addr-by-name mymaster` to get the address of the current master.</s>\r\n\r\nSince we now have `redis-rb` library vendorized, we can rely on it to discover / handle sentinel connection itself. \r\n\r\nRelated to: https://gitlab.com/gitlab-org/gitlab-ce/issues/3355\r\n\r\n----\r\n\r\nFollowing gitlab's `resque.yml` syntax, for `config.yml` we are going to add a `sentinels`key in `redis`:\r\n\r\n```yaml\r\n# Redis settings used for pushing commit notices to gitlab\r\nredis:\r\n  bin: /usr/bin/redis-cli\r\n  # host: 127.0.0.1\r\n  # port: 6379\r\n  # pass: redispass # Allows you to specify the password for Redis\r\n  database: 0\r\n  socket: /var/run/redis/redis.sock # Comment out this line if you want to use TCP or Sentinels\r\n  namespace: resque:gitlab\r\n  sentinels: \r\n    -\r\n      host: localhost\r\n      port: 26380 # point to sentinel, not to redis port\r\n    -\r\n      host: slave2\r\n      port: 26381 # point to sentinel, not to redis port\r\n```", "state": "closed", "created_at": "2015-11-05T13:36:43.674Z", "updated_at": "2017-06-06T18:27:56.378Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": {"id": 62107, "iid": 5, "project_id": 14022, "title": "8.11", "description": "", "state": "closed", "created_at": "2016-05-09T08:46:53.471Z", "updated_at": "2017-02-03T18:25:26.611Z", "due_date": "2016-08-22", "start_date": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/-/milestones/5"}, "assignees": [{"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}], "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "assignee": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "user_notes_count": 8, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/29", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/29", "notes": "https://gitlab.com/api/v4/projects/14022/issues/29/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/29/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 2808610, "type": null, "body": "@jacobvosmaer any reason why we are using redis-cli here instead of redis-rb?\r\n\r\nSupporting sentinel reliably feels a little different then that, from my understanding (by reading the documentation).\r\n\r\nWe can ask one of our sentinels about the master, but it became a single point of failure.\r\nIdeally we should have a list of sentinels to ping. Redis-rb does include this intelligence, plus it will try first, to use pre-defined master, making things a little faster when master is up.\r\n\r\nI'm working on this issue, but I need to know if we are keeping the redis-cli approach or not.\r\n\r\nAlternatively we could use something like [tiny_redis_client](https://gist.github.com/keymone/b89c23e3e43beb97eb94) to prevent reconnects and not having to deal with unix process calling / parsing", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2015-11-30T20:20:42.342Z", "updated_at": "2015-12-01T02:14:39.884Z", "system": false, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}, {"id": 2814852, "type": null, "body": "@brodock this is no longer urgent, see gitlab-com/operations#5\r\n\r\nTo answer your question about redis-rb: gitlab-shell does not use bundler in production because it is too hard to guarantee bundler working the way gitlab-shell is invoked, namely by SSHD. If we would want to use redis-rb (which is not unreasonable for sentinel support) we should probably vendor the gem and load it with something like `require_relative '../vendor/redis/redis'`.", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2015-12-01T13:02:58.128Z", "updated_at": "2015-12-01T13:02:58.128Z", "system": false, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}, {"id": 2815781, "type": null, "body": "@jacobvosmaer I will commit what I have coded so far, and stop working on this issue.\r\nThanks :)", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2015-12-01T14:59:31.554Z", "updated_at": "2015-12-01T14:59:31.554Z", "system": false, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}, {"id": 12139805, "type": null, "body": "In gitlab-shell 3.0, we have added a bonafide Redis client in the `vendor` directory, so we should now be able to support Sentinel easily.\r\n", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-05-30T03:20:43.951Z", "updated_at": "2016-05-30T03:20:43.951Z", "system": false, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}, {"id": 12139895, "type": null, "body": "@stanhu cool, so let's put a milestone again :)\r\nThe other related changes will need to be rebased and assigned milestones as well .", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2016-05-30T03:32:46.239Z", "updated_at": "2016-05-30T03:32:46.239Z", "system": false, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}, {"id": 12184500, "type": null, "body": "@brodock Can you list the changes and tasks necessary? I'd imagine this also includes Omnibus changes?", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-06-01T03:58:35.404Z", "updated_at": "2016-06-01T03:58:35.404Z", "system": false, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}, {"id": 14004138, "type": null, "body": "Idea here is to borrow (duplicate/adapt) Redis class from gitlab's code as we have made all the required jugglery done there.\r\nIt will also require extra code in omnibus to add required config lines to `gitlab.yml`", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2016-08-17T16:49:04.214Z", "updated_at": "2016-08-17T16:49:49.052Z", "system": false, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}, {"id": 14006193, "type": null, "body": "mentioned in issue gitlab-org/omnibus-gitlab#1512", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2016-08-17T18:20:46.150Z", "updated_at": "2016-08-17T18:20:46.150Z", "system": true, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}, {"id": 14039545, "type": null, "body": "Reassigned to @brodock", "attachment": null, "author": {"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}, "created_at": "2016-08-18T08:28:16.470Z", "updated_at": "2016-08-18T08:28:16.470Z", "system": true, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}, {"id": 14039546, "type": null, "body": "Milestone changed to %5", "attachment": null, "author": {"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}, "created_at": "2016-08-18T08:28:19.981Z", "updated_at": "2016-08-18T08:28:19.981Z", "system": true, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}, {"id": 14043738, "type": null, "body": "mentioned in merge request !85", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2016-08-18T10:30:26.689Z", "updated_at": "2016-08-18T10:30:26.689Z", "system": true, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}, {"id": 14078043, "type": null, "body": "I made some manual tests to understand how it will work live:\r\n\r\n*  Without changing configs (no sentinel)\r\n* Changing redis to a wrong port (simulating downtime)\r\n* Correct redis port but incorrect sentinel port (simulating sentinel downtime)\r\n* Incorrect redis port with correct sentinel (sentinel should heal)\r\n* correct redis port and correct sentinel (everything should \"just work\")\r\n\r\nsome outputs: \r\n\r\nincorrect sentinel params:\r\n```\r\nCounting objects: 3, done.\r\nWriting objects: 100% (3/3), 267 bytes | 0 bytes/s, done.\r\nTotal 3 (delta 0), reused 0 (delta 0)\r\nremote: GitLab: An unexpected error occurred in writing to Redis: No sentinels available.\r\nTo git@gabriel-redisbug:root/test.git\r\n ! [remote rejected] other-branch -> other-branch (pre-receive hook declined)\r\nerror: failed to push some refs to 'git@gabriel-redisbug:root/test.git'\r\n```\r\n\r\nonly redis with incorrect params: \r\n```\r\nCounting objects: 3, done.\r\nWriting objects: 100% (3/3), 267 bytes | 0 bytes/s, done.\r\nTotal 3 (delta 0), reused 0 (delta 0)\r\nremote: GitLab: An unexpected error occurred in writing to Redis: Error connecting to Redis on localhost:6378 (Errno::ECONNREFUSED)\r\nTo git@gabriel-redisbug:root/test.git\r\n ! [remote rejected] other-branch -> other-branch (pre-receive hook declined)\r\nerror: failed to push some refs to 'git@gabriel-redisbug:root/test.git'\r\n```\r\n\r\nincorrect redis params with correct sentinel:\r\n```\r\nCounting objects: 3, done.\r\nWriting objects: 100% (3/3), 267 bytes | 0 bytes/s, done.\r\nTotal 3 (delta 0), reused 0 (delta 0)\r\nremote:\r\nremote: Create merge request for other-branch:\r\nremote:   http://gabriel-redisbug/root/test/merge_requests/new?merge_request%5Bsource_branch%5D=other-branch\r\nremote:\r\nTo git@gabriel-redisbug:root/test.git\r\n \u00a0 5456c53..3f44023 \u00a0other-branch -> other-branch\r\n```", "attachment": null, "author": {"id": 2293, "name": "Gabriel Mazetto", "username": "brodock", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/2293/avatar.png", "web_url": "https://gitlab.com/brodock"}, "created_at": "2016-08-19T12:01:06.307Z", "updated_at": "2016-08-19T12:01:06.307Z", "system": false, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}, {"id": 14088629, "type": null, "body": "Status changed to closed by merge request !85", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2016-08-19T18:55:33.728Z", "updated_at": "2016-08-19T18:55:33.728Z", "system": true, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}, {"id": 15315211, "type": null, "body": "Mentioned in commit winniehell/gitlab-ce@a16ac37e91cefec81d53b7ade755b04c67b4912c", "attachment": null, "author": {"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}, "created_at": "2016-09-14T12:03:13.712Z", "updated_at": "2016-09-14T12:03:13.712Z", "system": true, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}, {"id": 15391408, "type": null, "body": "Mentioned in commit pfjason/gitlab-ce@0f2ffb7484ebcdb4226497c7d40917aa75a60f17", "attachment": null, "author": {"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}, "created_at": "2016-09-15T15:22:25.710Z", "updated_at": "2016-09-15T15:22:25.710Z", "system": true, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}, {"id": 16879872, "type": null, "body": "Mentioned in commit ngpestelos/gitlab-shell@3043b31c458bf720843a84b35c9fbad5c1488c1d", "attachment": null, "author": {"id": 15139, "name": "Robert Speicher", "username": "rspeicher", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/19c928bc60c7b0d10e708c429e389523?s=80&d=identicon", "web_url": "https://gitlab.com/rspeicher"}, "created_at": "2016-10-13T03:20:35.225Z", "updated_at": "2016-10-13T03:20:35.225Z", "system": true, "noteable_id": 646997, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 29}]]}, {"id": 641050, "iid": 28, "project_id": 14022, "title": "consider renaming bin/check to bin/checkgitlab", "description": "it is too generic and debian package will be installing it in /usr/bin. Can this be changed to checkgitlab?", "state": "closed", "created_at": "2015-11-03T10:44:57.037Z", "updated_at": "2017-06-06T18:27:56.421Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "assignee": null, "user_notes_count": 11, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/28", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/28", "notes": "https://gitlab.com/api/v4/projects/14022/issues/28/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/28/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 2558630, "type": null, "body": "also 'install' is too generic. Can this be changed to installgitlab?", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2015-11-03T16:13:00.527Z", "updated_at": "2015-11-08T15:31:11.160Z", "system": false, "noteable_id": 641050, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 28}, {"id": 2598482, "type": null, "body": "or gitlab should add gitlab_shell:path/bin to PATH.", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2015-11-08T15:30:53.623Z", "updated_at": "2015-11-08T15:30:53.623Z", "system": false, "noteable_id": 641050, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 28}, {"id": 2598699, "type": null, "body": "If planning to change name, I suggest `gitlabcheck` and `gitlabinstall` so that they will be presented on tab-completion with `gitlab`. :) ", "attachment": null, "author": {"id": 4849, "name": "Balasankar \"Balu\" C", "username": "balasankarc", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/4849/avatar.png", "web_url": "https://gitlab.com/balasankarc"}, "created_at": "2015-11-08T16:30:13.143Z", "updated_at": "2015-11-08T16:30:13.143Z", "system": false, "noteable_id": 641050, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 28}, {"id": 2662773, "type": null, "body": "@jnijhof How about renaming check to gitlabcheck?", "attachment": null, "author": {"id": 1, "name": "Sid Sijbrandij", "username": "sytses", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/78b060780d36f51a6763ac9831a4f022?s=80&d=identicon", "web_url": "https://gitlab.com/sytses"}, "created_at": "2015-11-16T01:02:00.121Z", "updated_at": "2015-11-16T01:02:00.121Z", "system": false, "noteable_id": 641050, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 28}, {"id": 2662774, "type": null, "body": "/cc @dzaporozhets ", "attachment": null, "author": {"id": 1, "name": "Sid Sijbrandij", "username": "sytses", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/78b060780d36f51a6763ac9831a4f022?s=80&d=identicon", "web_url": "https://gitlab.com/sytses"}, "created_at": "2015-11-16T01:02:07.113Z", "updated_at": "2015-11-16T01:02:07.113Z", "system": false, "noteable_id": 641050, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 28}, {"id": 2806546, "type": null, "body": "Maybe `gitlab-check` and `gitlab-install` for better readability ", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2015-11-30T16:20:55.720Z", "updated_at": "2015-11-30T16:20:55.720Z", "system": false, "noteable_id": 641050, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 28}, {"id": 2810928, "type": null, "body": "Dmitriy's suggestions seem better. :+1: ", "attachment": null, "author": {"id": 4849, "name": "Balasankar \"Balu\" C", "username": "balasankarc", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/4849/avatar.png", "web_url": "https://gitlab.com/balasankarc"}, "created_at": "2015-12-01T04:32:41.971Z", "updated_at": "2015-12-01T04:32:41.971Z", "system": false, "noteable_id": 641050, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 28}, {"id": 2914531, "type": null, "body": "I think `gitlab-check` is a bad name, especially if it becomes `/usr/bin/gitlab-check`. It is not the only check in GitLab. Nothing in the name signifies that the executable belongs to gitlab-shell.", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2015-12-10T15:43:21.887Z", "updated_at": "2015-12-10T15:43:21.887Z", "system": false, "noteable_id": 641050, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 28}, {"id": 2914611, "type": null, "body": "I think `gitlab-shell-check` would be a better name.\r\n\r\n@pravi why would you want to put gitlab-shell/bin/install into /usr/bin ? Most if not all of what is in gitlab-shell/bin is not meant to invoked by the user, it is 'libexec' stuff. None of this stuff is exposed in the omnibus packages. The bin/check script is run indirectly via `rake gitlab:check`.", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2015-12-10T15:48:16.048Z", "updated_at": "2015-12-10T15:48:16.048Z", "system": false, "noteable_id": 641050, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 28}, {"id": 2914626, "type": null, "body": "So maybe the best thing would just be to put none gitlab-shell/bin into /usr/bin. Just my two cents from packaging GitLab into omnibus-gitlab.", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2015-12-10T15:49:10.765Z", "updated_at": "2015-12-10T15:49:10.765Z", "system": false, "noteable_id": 641050, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 28}, {"id": 2919998, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2015-12-11T05:19:33.816Z", "updated_at": "2015-12-11T05:19:33.816Z", "system": true, "noteable_id": 641050, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 28}, {"id": 2919999, "type": null, "body": "Yes, that makes sense. I moved it to /usr/share/gitlab-shell/bin. May be there is a better location, but it works for now.", "attachment": null, "author": {"id": 3855, "name": "Praveen Arimbrathodiyil", "username": "pravi", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3855/sajjangad1.JPG", "web_url": "https://gitlab.com/pravi"}, "created_at": "2015-12-11T05:19:33.914Z", "updated_at": "2015-12-11T05:19:33.914Z", "system": false, "noteable_id": 641050, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 28}]]}, {"id": 534085, "iid": 27, "project_id": 14022, "title": "gitlab-shell execute hook(update) failure", "description": "my server(ubuntu 14,x64, gitlab 7.0 stable) is up, but when i push something into my project, it shown:  \r\nremote: /usr/local/lib/ruby/gems/2.0.0/gems/bundler-1.10.6/lib/bundler/spec_set.rb:92:in `block in materialize': Could not find rake-10.3.2 in any of the sources (Bundler::GemNotFound)  \r\nremote: \tfrom /usr/local/lib/ruby/gems/2.0.0/gems/bundler-1.10.6/lib/bundler/spec_set.rb:85:in `map!'  \r\nremote: \tfrom /usr/local/lib/ruby/gems/2.0.0/gems/bundler-1.10.6/lib/bundler/spec_set.rb:85:in `materialize'  \r\nremote: \tfrom /usr/local/lib/ruby/gems/2.0.0/gems/bundler-1.10.6/lib/bundler/definition.rb:140:in `specs'  \r\nremote: \tfrom /usr/local/lib/ruby/gems/2.0.0/gems/bundler-1.10.6/lib/bundler/definition.rb:185:in   `specs_for'\r\nremote: \tfrom /usr/local/lib/ruby/gems/2.0.0/gems/bundler-1.10.6/lib/bundler/definition.rb:174:in   `requested_specs'\r\nremote: \tfrom /usr/local/lib/ruby/gems/2.0.0/gems/bundler-1.10.6/lib/bundler/environment.rb:18:in   `requested_specs'\r\nremote: \tfrom /usr/local/lib/ruby/gems/2.0.0/gems/bundler-1.10.6/lib/bundler/runtime.rb:13:in `setup'  \r\nremote: \tfrom /usr/local/lib/ruby/gems/2.0.0/gems/bundler-1.10.6/lib/bundler.rb:127:in `setup'  \r\nremote: \tfrom /usr/local/lib/ruby/gems/2.0.0/gems/bundler-1.10.6/lib/bundler/setup.rb:18:in `<top (required)>'  \r\nremote: \tfrom /usr/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'  \r\nremote: \tfrom /usr/lib/ruby/1.9.1/rubygems/custom_require.rb:36:in `require'  \r\nremote: error: hook declined to update refs/heads/master  \r\nTo http://git.codingsky.com/androidos/launcher-2-3.git  \r\n! [remote rejected] master -> master (hook declined)  \r\nerror: failed to push some refs to 'http://git.codingsky.com/androidos/launcher-2-3.git'  \r\n\r\nbut rake is ok for me when i execute :   \r\ncd /home/git/gitlab  \r\nsudo -u git -H bundle install  \r\nUsing rake 10.3.2  \r\nUsing ace-rails-ap 2.0.1  \r\nUsing i18n 0.6.9  \r\nUsing json 1.8.1  \r\nUsing minitest 5.3.4  \r\nUsing thread_safe 0.3.4  \r\nUsing tzinfo 1.2.1  \r\nUsing activesupport 4.1.1  \r\nUsing builder 3.2.2  \r\nUsing erubis 2.7.0  \r\nUsing actionview 4.1.1  \r\nUsing rack 1.5.2  \r\nUsing rack-test 0.6.2  \r\nUsing actionpack 4.1.1  \r\nUsing mime-types 1.25.1  \r\nUsing polyglot 0.3.4  \r\nUsing treetop 1.4.15  \r\nUsing mail 2.5.4  \r\nUsing actionmailer 4.1.1  \r\nUsing activemodel 4.1.1  \r\nUsing arel 5.0.1.20140414130214  \r\nUsing activerecord 4.1.1  \r\nUsing bundler 1.10.6  \r\nUsing thor 0.19.1  \r\nUsing railties 4.1.1  \r\nUsing hike 1.2.3  \r\nUsing multi_json 1.10.1  \r\nUsing tilt 1.4.1  \r\nUsing sprockets 2.11.0  \r\nUsing sprockets-rails 2.1.3  \r\nUsing rails 4.1.1  \r\nUsing acts-as-taggable-on 2.4.1  \r\nUsing asciidoctor 0.1.4  \r\nUsing descendants_tracker 0.0.3\r\nUsing ice_nine 0.10.0\r\nUsing axiom-types 0.0.5\r\nUsing bcrypt-ruby 3.1.2\r\nUsing sass 3.2.19\r\nUsing bootstrap-sass 3.0.3.0\r\nUsing carrierwave 0.9.0\r\nUsing timers 1.1.0\r\nUsing celluloid 0.15.2\r\nUsing charlock_holmes 0.6.9.4\r\nUsing coercible 1.0.0\r\nUsing coffee-script-source 1.6.3\r\nUsing execjs 2.0.2\r\nUsing coffee-script 2.2.0\r\nUsing coffee-rails 4.0.1\r\nUsing colored 1.2\r\nUsing connection_pool 1.2.0\r\nUsing d3_rails 3.1.10\r\nUsing default_value_for 3.0.0\r\nUsing orm_adapter 0.5.0\r\nUsing warden 1.2.3\r\nUsing devise 3.0.4\r\nUsing devise-async 0.8.0\r\nUsing diff-lcs 1.2.5\r\nUsing diffy 3.0.3\r\nUsing dotenv 0.9.0\r\nUsing dropzonejs-rails 0.4.14\r\nUsing emoji 1.0.1\r\nUsing enumerize 0.7.0\r\nUsing equalizer 0.0.8\r\nUsing escape_utils 0.2.4\r\nUsing eventmachine 1.0.3\r\nUsing multipart-post 1.2.0\r\nUsing faraday 0.8.8\r\nUsing faraday_middleware 0.9.0\r\nUsing font-awesome-rails 3.2.1.3\r\nUsing foreman 0.63.0\r\nUsing rugged 0.19.0\r\nUsing gemnasium-gitlab-service 0.2.1\r\nUsing github-markup 1.1.0\r\nUsing posix-spawn 0.3.8\r\nUsing gitlab-grit 2.6.9\r\nUsing gitlab-flowdock-git-hook 0.4.2.2\r\nUsing gitlab-grack 2.0.0.pre\r\nUsing gitlab-linguist 3.0.0\r\nUsing gitlab_emoji 0.0.1.1\r\nUsing gitlab_git 6.0.0\r\nUsing gitlab_meta 7.0\r\nUsing net-ldap 0.3.1\r\nUsing hashie 2.0.5\r\nUsing omniauth 1.1.4\r\nUsing pyu-ruby-sasl 0.0.3.3\r\nUsing rubyntlm 0.1.1\r\nUsing gitlab_omniauth-ldap 1.0.4\r\nUsing mini_portile 0.6.0\r\nUsing nokogiri 1.6.2.1\r\nUsing rouge 1.3.3\r\nUsing sanitize 2.1.0\r\nUsing stringex 2.5.1\r\nUsing gollum-lib 3.0.0\r\nUsing gon 5.0.1\r\nUsing multi_xml 0.5.5\r\nUsing rack-accept 0.4.5\r\nUsing rack-mount 0.8.3\r\nUsing virtus 1.0.1\r\nUsing grape 0.6.1\r\nUsing grape-entity 0.4.2\r\nUsing haml 4.0.5\r\nUsing haml-rails 0.5.3\r\nUsing httparty 0.13.0\r\nUsing hipchat 0.14.0\r\nUsing http_parser.rb 0.5.3\r\nUsing httpauth 0.2.0\r\nUsing jquery-atwho-rails 0.3.3\r\nUsing jquery-rails 3.1.0\r\nUsing jquery-scrollto-rails 1.4.3\r\nUsing turbolinks 2.0.0\r\nUsing jquery-turbolinks 2.0.1\r\nUsing jquery-ui-rails 4.2.1\r\nUsing jwt 0.1.8\r\nUsing kaminari 0.15.1\r\nUsing kgio 2.8.1\r\nUsing libv8 3.16.14.3\r\nUsing nprogress-rails 0.1.2.3\r\nUsing oauth 0.4.7\r\nUsing oauth2 0.8.1\r\nUsing omniauth-oauth2 1.1.1\r\nUsing omniauth-github 1.1.1\r\nUsing omniauth-google-oauth2 0.2.1\r\nUsing omniauth-oauth 1.0.1\r\nUsing omniauth-twitter 1.0.1\r\nUsing rubypants 0.2.0\r\nUsing org-ruby 0.9.6\r\nUsing pg 0.15.1\r\nUsing protected_attributes 1.0.5\r\nUsing rack-attack 2.3.0\r\nUsing rack-cors 0.2.9\r\nUsing rack-protection 1.5.1\r\nUsing rails-observers 0.1.2\r\nUsing rails_autolink 1.1.6\r\nUsing raindrops 0.12.0\r\nUsing raphael-rails 2.1.2\r\nUsing redcarpet 2.2.2\r\nUsing redis 3.0.6\r\nUsing redis-store 1.1.4\r\nUsing redis-rack 1.5.0\r\nUsing redis-actionpack 4.0.0\r\nUsing redis-activesupport 4.0.0\r\nUsing redis-namespace 1.4.1\r\nUsing redis-rails 4.0.0\r\nUsing ref 1.0.5\r\nUsing sass-rails 4.0.3\r\nUsing seed-fu 2.3.1\r\nUsing select2-rails 3.5.2\r\nUsing semantic-ui-sass 0.16.1.0\r\nUsing settingslogic 2.0.9\r\nUsing sidekiq 2.17.0\r\nUsing simple_oauth 0.1.9\r\nUsing sinatra 1.4.4\r\nUsing six 0.2.0\r\nUsing slack-notifier 0.3.2\r\nUsing temple 0.6.7\r\nUsing slim 2.0.2\r\nUsing stamp 0.5.0\r\nUsing state_machine 1.2.0\r\nUsing therubyracer 0.12.0\r\nUsing twitter-stream 0.1.16\r\nUsing tinder 1.9.3\r\nUsing uglifier 2.3.2\r\nUsing underscore-rails 1.4.4\r\nUsing unicorn 4.6.3\r\nUsing unicorn-worker-killer 0.4.2\r\nUsing version_sorter 1.1.0\r\nBundle complete! 113 Gemfile dependencies, 166 gems now installed.\r\nGems in the groups development, test, mysql and aws were not installed.\r\nBundled gems are installed into ./vendor/cache.\r\n\r\n\r\n\r\n\r\n\r\n", "state": "closed", "created_at": "2015-09-21T17:39:56.721Z", "updated_at": "2017-11-21T14:09:16.646Z", "closed_at": "2017-11-21T14:09:16.597Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 253939, "name": "shishengyi", "username": "shishengyi", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/6237e07144075c588b7c899d7858a8f5?s=80&d=identicon", "web_url": "https://gitlab.com/shishengyi"}, "assignee": null, "user_notes_count": 3, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/27", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/27", "notes": "https://gitlab.com/api/v4/projects/14022/issues/27/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/27/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 2164775, "type": null, "body": "the gitlab-shell version is 1.9.6", "attachment": null, "author": {"id": 253939, "name": "shishengyi", "username": "shishengyi", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/6237e07144075c588b7c899d7858a8f5?s=80&d=identicon", "web_url": "https://gitlab.com/shishengyi"}, "created_at": "2015-09-21T17:46:16.131Z", "updated_at": "2015-09-21T17:46:16.131Z", "system": false, "noteable_id": 534085, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 27}, {"id": 2164870, "type": null, "body": "if i cd /home/git/gitlab-shell, no rake.  \r\nroot@iZ23q80ndryZ:/home/git/gitlab-shell# sudo -u git -H bundle install --path vendor/bundle  \r\nUsing addressable 2.3.2  \r\nUsing coderay 1.0.8  \r\nUsing colorize 0.5.8  \r\nUsing multi_json 1.6.1  \r\nUsing mime-types 1.21  \r\nUsing rest-client 1.6.7  \r\nUsing simplecov-html 0.7.1  \r\nUsing simplecov 0.7.1  \r\nUsing thor 0.16.0  \r\nUsing coveralls 0.6.2  \r\nUsing crack 0.3.1  \r\nUsing diff-lcs 1.1.3  \r\nUsing listen 0.5.3  \r\nUsing lumberjack 1.0.2  \r\nUsing method_source 0.8.1  \r\nUsing slop 3.3.3  \r\nUsing pry 0.9.10  \r\nUsing guard 1.5.4  \r\nUsing rspec-core 2.12.2  \r\nUsing rspec-expectations 2.12.1  \r\nUsing rspec-mocks 2.12.2  \r\nUsing rspec 2.12.0  \r\nUsing guard-rspec 2.1.2  \r\nUsing vcr 2.4.0  \r\nUsing webmock 1.9.0  \r\nUsing bundler 1.10.6  \r\n", "attachment": null, "author": {"id": 253939, "name": "shishengyi", "username": "shishengyi", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/6237e07144075c588b7c899d7858a8f5?s=80&d=identicon", "web_url": "https://gitlab.com/shishengyi"}, "created_at": "2015-09-21T18:02:50.546Z", "updated_at": "2015-09-21T18:02:50.546Z", "system": false, "noteable_id": 534085, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 27}], [{"id": 48150906, "type": null, "body": "gitlab-shell no longer needs any gems in production, so I am closing this issue.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-11-21T14:09:15.972Z", "updated_at": "2017-11-21T14:09:15.972Z", "system": false, "noteable_id": 534085, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 27}], [{"id": 48150907, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2017-11-21T14:09:16.639Z", "updated_at": "2017-11-21T14:09:16.639Z", "system": true, "noteable_id": 534085, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 27}]]}, {"id": 518314, "iid": 26, "project_id": 14022, "title": "gitlab-shell doesn't handle custom hooks path", "description": "Hi, I've found that gitlab-shell doesn't support custom hooks path, defined by gitlab_rails['gitlab_shell_hooks_path'] variable. In particular, script [create_hooks](bin/create_hooks) by default creates links to hooks under /opt/gitlab/embedded/service/gitlab-shell/hooks directory. That is because variable GLOBAL_HOOKS_DIRECTORY points to ROOT_PATH/hooks in the file [gitlab_projects.rb](lib/gitlab_projects.rb). This is not correct approach.   \r\n   \r\nWe have migrated from source installation type to omnibus package. Now gitlab is installed under /opt/gitlab, but we have repositories located under /home/git/repositories and custom update hook under /home/git/gitlab-shell/hooks. We used gitlab_rails['gitlab_shell_hooks_path'] variable to define path, and it works, except of new projects - their hooks are pointing to /opt/gitlab.... So now we have a problem:   \r\n1) If we copy our custom hooks to /opt/gitlab/embedded/service/gitlab-shell/hooks, it works, but we will lose our custom hooks on upgrade.   \r\n2) If we change GLOBAL_HOOKS_DIRECTORY directly in the lib/gitlab_projects.rb file, it'll work, but we still will lose our changes on upgrade.   \r\nThus, I've made a small change to define variable \"hooks_path\" in [config.yml](config.yml.example) and use it in [gitlab_projects.rb](lib/gitlab_projects.rb). My changes are commited in a fork of the project alivespirit/gitlab-shell@705b5967 . I really hope to see these changes released as soon as possible.\r\n\r\nThank you,   \r\nRoman", "state": "closed", "created_at": "2015-09-15T16:14:22.986Z", "updated_at": "2017-06-06T18:27:56.465Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 248125, "name": "Roman M.", "username": "alivespirit", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/b83341a5e40418a2113b36ad14a7b63a?s=80&d=identicon", "web_url": "https://gitlab.com/alivespirit"}, "assignee": null, "user_notes_count": 11, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/26", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/26", "notes": "https://gitlab.com/api/v4/projects/14022/issues/26/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/26/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 2160754, "type": null, "body": "Hi,  \r\nAny updates on this? Do I need to provide some details?\r\n\r\nThank you,  \r\nRoman", "attachment": null, "author": {"id": 248125, "name": "Roman M.", "username": "alivespirit", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/b83341a5e40418a2113b36ad14a7b63a?s=80&d=identicon", "web_url": "https://gitlab.com/alivespirit"}, "created_at": "2015-09-21T09:03:29.593Z", "updated_at": "2015-09-21T09:03:29.593Z", "system": false, "noteable_id": 518314, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 26}, {"id": 2198837, "type": null, "body": "Hi,\r\n\r\n@jacobvosmaer, @marin can you please take a look?\r\n\r\nThank you,\r\nRoman", "attachment": null, "author": {"id": 248125, "name": "Roman M.", "username": "alivespirit", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/b83341a5e40418a2113b36ad14a7b63a?s=80&d=identicon", "web_url": "https://gitlab.com/alivespirit"}, "created_at": "2015-09-25T12:18:48.325Z", "updated_at": "2015-09-25T12:18:48.325Z", "system": false, "noteable_id": 518314, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 26}, {"id": 2199049, "type": null, "body": "> custom update hook under /home/git/gitlab-shell/hooks\r\n\r\nNot sure if that is how that is supposed to work. Have you read http://doc.gitlab.com/ce/hooks/custom_hooks.html ?", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2015-09-25T12:43:11.346Z", "updated_at": "2015-09-25T12:43:11.346Z", "system": false, "noteable_id": 518314, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 26}, {"id": 2199171, "type": null, "body": "Yes, I've read it. By the logic of hooks, each project on creation links hooks from defined directory (/opt/gitlab/embedded/service/gitlab-shell/hooks for omnibus package) to the project directory. This logic is defined in [gitlab_projects.rb#L107](lib/gitlab_projects.rb#L107).  \r\n  \r\nBut we have an update hook, which has to be executed on each push to every repository. It is located under /home/git/gitlab-shell/hooks directory (we have migrated from source installation to omnibus). When we use gitlab_rails['gitlab_shell_hooks_path']='/home/git/gitlab-shell/hooks' variable, all the hooks are working as expected (gitlab-shell calls hooks from this dir). But for new projects hooks are linked to default location ROOT_PATH/hooks, which is not correct.  \r\n  \r\nWhat is expected - gitlab-shell should use gitlab_rails['gitlab_shell_hooks_path'] variable, if it is defined. ", "attachment": null, "author": {"id": 248125, "name": "Roman M.", "username": "alivespirit", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/b83341a5e40418a2113b36ad14a7b63a?s=80&d=identicon", "web_url": "https://gitlab.com/alivespirit"}, "created_at": "2015-09-25T12:55:35.859Z", "updated_at": "2015-09-25T13:47:21.680Z", "system": false, "noteable_id": 518314, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 26}, {"id": 2199517, "type": null, "body": "> What is expected - gitlab-shell should use gitlab_rails['gitlab_shell_hooks_path'] variable, if it is defined.\r\n\r\nNo. The gitlab-shell installation location is fixed: /opt/gitlab/embedded/service/gitlab-shell . You should not change the `gitlab_rails['gitlab_shell_hooks_path']` setting. The only reason it exists is to allow others to build custom packages that install GitLab somewhere else than `/opt/gitlab`. (@marin am I right here?)\r\n\r\nGitLab supports custom hooks per-project with the custom_hooks folder. There is no support for global custom hooks at this time.", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2015-09-25T13:27:12.972Z", "updated_at": "2015-09-25T13:27:12.972Z", "system": false, "noteable_id": 518314, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 26}, {"id": 2211977, "type": null, "body": "> The only reason it exists is to allow others to build custom packages that install GitLab somewhere else than /opt/gitlab. \r\n\r\n@jacobvosmaer Actually, this is a setting in gitlab.yml. It doesn't have anything to do with custom packages.\r\n", "attachment": null, "author": {"id": 116, "name": "Marin Jankovski", "username": "marin", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/5154f0b0eda3f798c8a254962d57192f?s=80&d=identicon", "web_url": "https://gitlab.com/marin"}, "created_at": "2015-09-28T08:59:53.113Z", "updated_at": "2015-09-28T08:59:53.113Z", "system": false, "noteable_id": 518314, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 26}, {"id": 2213091, "type": null, "body": "So, is there any possibility to use setting from gitlab.yml in gitlab-shell?", "attachment": null, "author": {"id": 248125, "name": "Roman M.", "username": "alivespirit", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/b83341a5e40418a2113b36ad14a7b63a?s=80&d=identicon", "web_url": "https://gitlab.com/alivespirit"}, "created_at": "2015-09-28T11:13:24.131Z", "updated_at": "2015-09-28T11:13:24.131Z", "system": false, "noteable_id": 518314, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 26}, {"id": 2213173, "type": null, "body": "@alivespirit no, the gitlab-shell global hooks are a crucial part of GitLab. They are part of gitlab-shell, as you can see by browsing this repository. If you replace the hooks that are in gitlab-shell with your own, you are essentially using a forked and unsupported version of gitlab-shell.\r\n", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2015-09-28T11:25:48.311Z", "updated_at": "2015-09-28T11:25:48.311Z", "system": false, "noteable_id": 518314, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 26}, {"id": 2213181, "type": null, "body": "Also, regarding why the 'gitlab_shell_hooks_path' setting exists in gitlab.yml: I think this is a leftover from GitLab 3.0 (or earlier), from when we still used Gitolite.", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2015-09-28T11:28:26.259Z", "updated_at": "2015-09-28T11:28:26.259Z", "system": false, "noteable_id": 518314, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 26}, {"id": 2213352, "type": null, "body": "Ok, then we'll need to manully edit sources after each upgrade of supported version...\r\n@jacobvosmaer, @marin: thank you for your responses.", "attachment": null, "author": {"id": 248125, "name": "Roman M.", "username": "alivespirit", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/b83341a5e40418a2113b36ad14a7b63a?s=80&d=identicon", "web_url": "https://gitlab.com/alivespirit"}, "created_at": "2015-09-28T11:51:51.340Z", "updated_at": "2015-09-28T11:51:51.340Z", "system": false, "noteable_id": 518314, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 26}, {"id": 2213353, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 248125, "name": "Roman M.", "username": "alivespirit", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/b83341a5e40418a2113b36ad14a7b63a?s=80&d=identicon", "web_url": "https://gitlab.com/alivespirit"}, "created_at": "2015-09-28T11:51:51.934Z", "updated_at": "2015-09-28T11:51:51.934Z", "system": true, "noteable_id": 518314, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 26}, {"id": 2213427, "type": null, "body": "@alivespirit you're welcome.\r\n\r\nIf global hooks is what you need, perhaps there is a feedback item you can vote for, or create your own: http://feedback.gitlab.com/forums/176466-general?query=hooks", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2015-09-28T12:02:41.857Z", "updated_at": "2015-09-28T12:02:41.857Z", "system": false, "noteable_id": 518314, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 26}]]}, {"id": 446295, "iid": 25, "project_id": 14022, "title": "node.js custom hook fails on fs.write", "description": "Custom hooks written in node.js fail with a strange error when using `fs.write`. Also other things don't work either, i.e. [node-java](https://github.com/joeferner/node-java/issues/240).\r\n\r\nReplicating the issue is easy. Use a sample `pre-receive` hook written in node.js located at `/var/opt/gitlab/git-data/repositories/<group>/<repo>.git/custom_hooks/pre-receive` that simply writes to a file:\r\n\r\n```sh\r\n#!/usr/bin/env node\r\n\r\nvar fs = require('fs');\r\nvar path = require('path');\r\n\r\nfs.open('test-fs-write.node.txt', 'w', function(err, fd) {\r\n  if (err) throw err;\r\n  fs.write(fd, \"test node fs.write\\n\", function(err) {});\r\n});\r\n```\r\n\r\nThis fails with:\r\n\r\n```sh\r\nfs.js:513\r\n  binding.write(fd, buffer, offset, length, position, wrapper);\r\n          ^\r\nTypeError: Not an integer\r\n    at Object.fs.write (fs.js:513:11)\r\n    at /var/opt/gitlab/git-data/repositories/group/repo.git/custom_hooks/pre-receive:10:6\r\n    at Object.oncomplete (fs.js:107:15)\r\n```\r\n\r\nEnvironment: Ubuntu 14.04.3 LTS, node 0.12.7, GitLab 7.13.5, GitLab Shell 2.6.3, Ruby 2.1.6p336, Rails 4.1.11.\r\n", "state": "closed", "created_at": "2015-08-14T09:48:54.735Z", "updated_at": "2018-01-12T15:19:24.766Z", "closed_at": "2018-01-12T15:19:24.761Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 101147, "name": "Calin", "username": "clns", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ad2bdd8c4d37364f52e6ab7aa92ef570?s=80&d=identicon", "web_url": "https://gitlab.com/clns"}, "assignee": null, "user_notes_count": 4, "merge_requests_count": 0, "upvotes": 2, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/25", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/25", "notes": "https://gitlab.com/api/v4/projects/14022/issues/25/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/25/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 1961101, "type": null, "body": "This is still an issue.", "attachment": null, "author": {"id": 101147, "name": "Calin", "username": "clns", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ad2bdd8c4d37364f52e6ab7aa92ef570?s=80&d=identicon", "web_url": "https://gitlab.com/clns"}, "created_at": "2015-08-24T16:29:36.878Z", "updated_at": "2015-08-24T16:29:36.878Z", "system": false, "noteable_id": 446295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 25}, {"id": 2194956, "type": null, "body": "I tried it on the latest GitLab 8.0.1, it's still an issue. Can anyone help?", "attachment": null, "author": {"id": 101147, "name": "Calin", "username": "clns", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ad2bdd8c4d37364f52e6ab7aa92ef570?s=80&d=identicon", "web_url": "https://gitlab.com/clns"}, "created_at": "2015-09-24T22:56:23.502Z", "updated_at": "2015-09-24T22:56:23.502Z", "system": false, "noteable_id": 446295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 25}, {"id": 3939866, "type": null, "body": "I encountered the exact same `TypeError: Not an integer` issue in completely [other code](https://travis-ci.org/SlexAxton/messageformat.js/builds/111603240) just now. Node.js 0.12 introduced a [new signature](https://nodejs.org/api/fs.html#fs_fs_write_fd_data_position_encoding_callback) of `fs.write` that's used here, `fs.write(fd, data[, position[, encoding]], callback)`. In Node.js 0.10 & earlier, the only signature that's [available](https://github.com/nodejs/node/blob/v0.10/doc/api/fs.markdown#fswritefd-buffer-offset-length-position-callback) is `fs.write(fd, buffer, offset, length, position, callback)`, and that's clearly being called in the above.\r\n\r\nSo, even though you claim your environment is node.0.12.7, are you quite sure that you're not running in node 0.10 after all?", "attachment": null, "author": {"id": 205435, "name": "Eemeli Aro", "username": "eemeli", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/14d91809a71ffc85a04f3c7b6975ef4d?s=80&d=identicon", "web_url": "https://gitlab.com/eemeli"}, "created_at": "2016-02-25T14:03:45.601Z", "updated_at": "2016-02-25T14:03:45.601Z", "system": false, "noteable_id": 446295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 25}], [{"id": 54340471, "type": null, "body": "The hooks are executed from a restricted environment. You can only really expect system-installed versions of ruby, node, etc, to work, and I believe this is the problem here, so I'll close this issue.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:19:24.221Z", "updated_at": "2018-01-12T15:19:24.221Z", "system": false, "noteable_id": 446295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 25}], [{"id": 54340472, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:19:24.805Z", "updated_at": "2018-01-12T15:19:24.805Z", "system": true, "noteable_id": 446295, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 25}]]}, {"id": 406162, "iid": 24, "project_id": 14022, "title": "git-annex-shell integration initializes repo before running git-annex-shell, breaking gcryptsetup", "description": "In line 70 of gitlab_shell.rb\u00b8I see:\r\n\r\n    # Make sure repository has git-annex enabled\r\n    init_git_annex(@repo_name)\r\n\r\nThis line is the root cause of the bug described at http://git-annex.branchable.com/gitlab_repos_cannot_use_gcrypt/\r\n\r\nSpecifically, to support gcrypt, git-annex-shell is run with the gcryptsetup parameter. When run with this parameter, it expects to find a repository that has not had git-annex initialized in it. But, gitlab-shell arranges for git-annex init to be run first, which prevents this from working as it's supposed to.\r\n\r\nIt may be that doing this manual git-annex init in gitlab-shell simplified the workflow described in gitlab-ee/doc/workflow/git_annex.md. While git-annex-shell will automatically initialize a repository for git-annex use, it only does this after a git-annex branch has been pushed to the repository. This can make the initial workflow a bit tricky, and is something I will investigate improving in git-annex-shell. See http://git-annex.branchable.com/todo/better_git-annex-shell_init_workflow/\r\n\r\nSo, I don't necessarily think you should remove the init_git_annex call.. Although that would fix this bug. A more nuanced fix would be to check if git-annex-shell is being run with a \"gcryptsetup\" parameter, and avoid calling init_git_annex in that case.", "state": "closed", "created_at": "2015-08-03T18:37:44.881Z", "updated_at": "2018-01-12T15:21:01.287Z", "closed_at": "2018-01-12T15:21:01.281Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 136405, "name": "Joey Hess", "username": "joeyh", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/136405/joeyicon.png", "web_url": "https://gitlab.com/joeyh"}, "assignee": null, "user_notes_count": 6, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/24", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/24", "notes": "https://gitlab.com/api/v4/projects/14022/issues/24/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/24/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 1794986, "type": null, "body": "Title changed from **git-annex-shell integration incorrectly initializes repo before running git-annex-shell** to **git-annex-shell integration incorrectly repo before running git-annex-shell, breaking gcryptsetup**", "attachment": null, "author": {"id": 136405, "name": "Joey Hess", "username": "joeyh", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/136405/joeyicon.png", "web_url": "https://gitlab.com/joeyh"}, "created_at": "2015-08-03T18:40:37.897Z", "updated_at": "2015-08-03T18:40:37.897Z", "system": true, "noteable_id": 406162, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 24}, {"id": 1794987, "type": null, "body": "Title changed from **git-annex-shell integration incorrectly repo before running git-annex-shell, breaking gcryptsetup** to **git-annex-shell integration initializes repo before running git-annex-shell, breaking gcryptsetup**", "attachment": null, "author": {"id": 136405, "name": "Joey Hess", "username": "joeyh", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/136405/joeyicon.png", "web_url": "https://gitlab.com/joeyh"}, "created_at": "2015-08-03T18:40:49.589Z", "updated_at": "2015-08-03T18:40:49.589Z", "system": true, "noteable_id": 406162, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 24}, {"id": 1808705, "type": null, "body": "> A more nuanced fix would be to check if git-annex-shell is being run with a \"gcryptsetup\" parameter, and avoid calling init_git_annex in that case.\r\n\r\nConsidering that we already parse the parameters to git-annex-shell in https://gitlab.com/gitlab-org/gitlab-shell/blob/3c97aea3e7cceaa5f212e72bfade28883685d21b/lib/gitlab_shell.rb#L97 , this would be doable. But I don't understand the consequences 'down the line' of skipping this step.", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2015-08-04T08:48:20.187Z", "updated_at": "2015-08-04T08:48:20.187Z", "system": false, "noteable_id": 406162, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 24}, {"id": 1813540, "type": null, "body": "Since git-annex-shell gcryptsetup does a similar repository initialization as does git-annex init, the repository would get initalized as intended, and there would be no further consequences of skipping the step.", "attachment": null, "author": {"id": 136405, "name": "Joey Hess", "username": "joeyh", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/136405/joeyicon.png", "web_url": "https://gitlab.com/joeyh"}, "created_at": "2015-08-04T15:09:04.511Z", "updated_at": "2015-08-04T15:09:04.511Z", "system": false, "noteable_id": 406162, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 24}, {"id": 1829457, "type": null, "body": "@joeyh OK so 'if gcryptsetup then skip git annex init' is sane.\r\n\r\nWhere in the argv array can we expect `gcryptsetup`? Is it `gcryptsetup` or `--gcryptsetup`? (Trying to understand how to spot it during command parsing.)", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2015-08-05T13:01:07.939Z", "updated_at": "2015-08-05T13:01:07.939Z", "system": false, "noteable_id": 406162, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 24}, {"id": 1829792, "type": null, "body": "\"gcryptsetup\" will be the first non-dashed-option parameter passed to git-annex-shell. Typically it's the first parameter. See http://git-annex.branchable.com/git-annex-shell/", "attachment": null, "author": {"id": 136405, "name": "Joey Hess", "username": "joeyh", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/136405/joeyicon.png", "web_url": "https://gitlab.com/joeyh"}, "created_at": "2015-08-05T13:46:19.260Z", "updated_at": "2015-08-05T13:46:19.260Z", "system": false, "noteable_id": 406162, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 24}, {"id": 1872842, "type": null, "body": "There is a MR with a fix as discussed above in !18.", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2015-08-11T15:59:09.201Z", "updated_at": "2015-08-11T15:59:09.201Z", "system": false, "noteable_id": 406162, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 24}], [{"id": 54340681, "type": null, "body": "!18 was merged and git-annex support has since been removed anyway: https://gitlab.com/gitlab-org/gitlab-ee/issues/1648 so I'll close this issue.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:21:00.359Z", "updated_at": "2018-01-12T15:21:00.359Z", "system": false, "noteable_id": 406162, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 24}], [{"id": 54340684, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:21:01.350Z", "updated_at": "2018-01-12T15:21:01.350Z", "system": true, "noteable_id": 406162, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 24}]]}, {"id": 250267, "iid": 23, "project_id": 14022, "title": "ssh logging is missing username and instead contains the key-#", "description": "The INFO logging messages from gitlab-shell do show the key-id instead of the usersname making extreamly hard to check the logs.\r\n\r\nThe key-id is useful only for debug purposes but the username is essential for log checking. \r\n\r\nPlease fix this by including the username:\r\n```\r\nINFO -- : gitlab-shell: executing git command <git-upload-pack ... for user JONHD (key-XXX).\r\n```", "state": "opened", "created_at": "2015-05-18T13:33:59.970Z", "updated_at": "2017-09-16T09:40:24.817Z", "closed_at": null, "closed_by": null, "labels": ["bug"], "milestone": null, "assignees": [], "author": {"id": 57300, "name": "Sorin Sbarnea", "username": "ssbarnea", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/63c50004c4f6eaf3235b9ea836f4b6cf?s=80&d=identicon", "web_url": "https://gitlab.com/ssbarnea"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/23", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/23", "notes": "https://gitlab.com/api/v4/projects/14022/issues/23/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/23/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 236806, "iid": 22, "project_id": 14022, "title": "Agent forwarding for mirroring", "description": "Hi,\r\n\r\nI'd like to not have the `no-agent-forward` option in the authorized_keys file. Adding a `git push` in the post-receive hook is useful for mirroring but requires credentials. I know there's no guarantee that the client has agent forwarding on but in a small team I can setup things correctly.\r\n\r\nI don't really see any reason to not always allow agent forwarding, but if you don't want to change the default perhaps there could be an option for it in the config file?", "state": "opened", "created_at": "2015-05-07T06:44:43.078Z", "updated_at": "2017-09-16T09:40:24.966Z", "closed_at": null, "closed_by": null, "labels": ["ssh"], "milestone": null, "assignees": [], "author": {"id": 35547, "name": "Pelle Johansson", "username": "perj", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/59aeda6ad8dea5965841953391441d7d?s=80&d=identicon", "web_url": "https://gitlab.com/perj"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/22", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/22", "notes": "https://gitlab.com/api/v4/projects/14022/issues/22/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/22/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 177107, "iid": 21, "project_id": 14022, "title": "create hooks fails after restore from different server where repo was in a different path", "description": "I moved from a non-omnibus install to an omnibus install on a different server and after restoring the backup the hooks point to a non existent directory (/home/git/...).\r\n\r\nrunning bin/create-hooks doesn't fix the issue.  In the log it says that hooks already exist for the location.  If I delete the hooks symlink in the repository it doesn't recreate them either.", "state": "closed", "created_at": "2015-03-26T13:14:50.401Z", "updated_at": "2019-04-04T14:36:48.841Z", "closed_at": "2019-04-04T14:36:48.815Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": [], "milestone": null, "assignees": [], "author": {"id": 15355, "name": "Jeremy Kolb", "username": "kjeremy", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ea644e1f8f5cecd4651d7140c65bcfce?s=80&d=identicon", "web_url": "https://gitlab.com/kjeremy"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/21", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/21", "notes": "https://gitlab.com/api/v4/projects/14022/issues/21/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/21/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 157467626, "type": null, "body": "Hooks are now in gitaly so I'll close this issue. We have automatic fixing of hooks these days, so hopefully this is now solved.", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:36:48.386Z", "updated_at": "2019-04-04T14:36:48.386Z", "system": false, "noteable_id": 177107, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 21}], [{"id": 157467630, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:36:48.864Z", "updated_at": "2019-04-04T14:36:48.864Z", "system": true, "noteable_id": 177107, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 21}]]}, {"id": 164409, "iid": 20, "project_id": 14022, "title": "Custom hook - continuous ouput", "description": "If my custom hook ouputs some information, everything is outputed **at once**. This is not a nice behavior, I used this to inform user abour deploy state (which may took up to 2 minutes). Waiting 2 minutes without knowing what's going on is quite bad. Custom hooks should be equivalent to the normal hooks.", "state": "closed", "created_at": "2015-03-15T08:29:02.866Z", "updated_at": "2019-08-07T08:04:09.244Z", "closed_at": "2019-04-04T14:36:13.440Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["Create [DEPRECATED]", "P4", "S4", "bug", "devops::create", "ssh"], "milestone": {"id": 490705, "iid": 14, "group_id": 9970, "title": "Backlog", "description": "Issues that we want to do but are not planned right now. Open for contribution from the community.", "state": "active", "created_at": "2018-03-22T13:09:23.767Z", "updated_at": "2018-10-30T14:56:54.069Z", "due_date": null, "start_date": null, "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/14"}, "assignees": [], "author": {"id": 7719, "name": "Jan \u0160kr\u00e1\u0161ek", "username": "hrach", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/1ba3953f6a6a459dcd4810a228ef4000?s=80&d=identicon", "web_url": "https://gitlab.com/hrach"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/20", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/20", "notes": "https://gitlab.com/api/v4/projects/14022/issues/20/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/20/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 1199600, "type": null, "body": "We have a counter in the pre-receive hook when you push to stable, supposed to let you cancel for 5 seconds before the push goes through. The waiting five seconds work but there's no output from the counter.", "attachment": null, "author": {"id": 35547, "name": "Pelle Johansson", "username": "perj", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/59aeda6ad8dea5965841953391441d7d?s=80&d=identicon", "web_url": "https://gitlab.com/perj"}, "created_at": "2015-05-07T06:47:56.506Z", "updated_at": "2015-05-07T06:47:56.506Z", "system": false, "noteable_id": 164409, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 20}, {"id": 1215069, "type": null, "body": "Thansk for reponse, but this is not about timeout, but about continuous outputting the hook's stdout.", "attachment": null, "author": {"id": 7719, "name": "Jan \u0160kr\u00e1\u0161ek", "username": "hrach", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/1ba3953f6a6a459dcd4810a228ef4000?s=80&d=identicon", "web_url": "https://gitlab.com/hrach"}, "created_at": "2015-05-10T19:54:18.300Z", "updated_at": "2015-05-10T19:54:18.300Z", "system": false, "noteable_id": 164409, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 20}], [{"id": 157467328, "type": null, "body": "changed milestone to %\"Backlog\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:36:05.164Z", "updated_at": "2019-04-04T14:36:05.164Z", "system": true, "noteable_id": 164409, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 20}], [{"id": 157467388, "type": null, "body": "moved to gitaly#1597", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:36:13.573Z", "updated_at": "2019-04-04T14:36:13.573Z", "system": true, "noteable_id": 164409, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 20}]]}, {"id": 158702, "iid": 19, "project_id": 14022, "title": "custom hooks should be provided at least the same information as a web hook", "description": "I submitted this via [github](https://github.com/gitlabhq/gitlab-shell/issues/218), but perhaps it should go here instead.\r\n\r\nI'm trying to implement a branch level permissions custom hook and have run into the problem of identifying who the authenticated user is.\r\n\r\nI've modified gitlab_shell.rb:exec_cmd to include the gitlab username in the environment, but I think that at least the same information as is provided to a web hook should be provided.", "state": "closed", "created_at": "2015-03-10T19:01:35.220Z", "updated_at": "2019-04-04T14:34:23.096Z", "closed_at": "2019-04-04T14:34:23.070Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": [], "milestone": null, "assignees": [], "author": {"id": 41712, "name": "Alan Young", "username": "harleypig", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d7a80273ea139cbfbe3d9ee7f178b62b?s=80&d=identicon", "web_url": "https://gitlab.com/harleypig"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/19", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/19", "notes": "https://gitlab.com/api/v4/projects/14022/issues/19/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/19/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 157466636, "type": null, "body": "Hooks are now in gitaly, and I know we've changed this recently, so I'll close this issue. Do feel free to reply letting me know, or just open a new issue in the gitaly project, if this is still a problem!", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:34:22.658Z", "updated_at": "2019-04-04T14:34:22.658Z", "system": false, "noteable_id": 158702, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 19}], [{"id": 157466638, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:34:23.132Z", "updated_at": "2019-04-04T14:34:23.132Z", "system": true, "noteable_id": 158702, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 19}]]}, {"id": 142872, "iid": 18, "project_id": 14022, "title": "post-receive hooks broken since 7.8", "description": "See https://gitlab.com/gitlab-org/omnibus-gitlab/issues/438", "state": "closed", "created_at": "2015-02-23T04:05:36.402Z", "updated_at": "2017-06-06T18:27:56.513Z", "closed_at": null, "closed_by": null, "labels": ["bug"], "milestone": null, "assignees": [], "author": {"id": 22926, "name": "Sam McLeod", "username": "sammcj", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/671ff5607feaa2cbea27cc06e3dc05b7?s=80&d=identicon", "web_url": "https://gitlab.com/sammcj"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/18", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/18", "notes": "https://gitlab.com/api/v4/projects/14022/issues/18/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/18/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 887296, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 22926, "name": "Sam McLeod", "username": "sammcj", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/671ff5607feaa2cbea27cc06e3dc05b7?s=80&d=identicon", "web_url": "https://gitlab.com/sammcj"}, "created_at": "2015-02-25T06:39:27.108Z", "updated_at": "2015-02-25T06:39:27.108Z", "system": true, "noteable_id": 142872, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 18}, {"id": 887297, "type": null, "body": "Confirmed fixed in 7.8.1", "attachment": null, "author": {"id": 22926, "name": "Sam McLeod", "username": "sammcj", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/671ff5607feaa2cbea27cc06e3dc05b7?s=80&d=identicon", "web_url": "https://gitlab.com/sammcj"}, "created_at": "2015-02-25T06:39:27.500Z", "updated_at": "2015-02-25T06:39:27.500Z", "system": false, "noteable_id": 142872, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 18}]]}, {"id": 125191, "iid": 17, "project_id": 14022, "title": "Error when push to master", "description": "I just upgraded to GitLab 7.4.2 and Gitlab shel 2.4.2 and I got this error on push:\r\n\r\n```\r\nremote: /home/git/gitlab-shell/lib/gitlab_net.rb:14:in `check_access': undefined method `join' for #<Enumerator:0x00000000d3cac0> (NoMethodError)\r\nremote:         from /home/git/gitlab-shell/lib/gitlab_access.rb:21:in `exec'\r\nremote:         from hooks/pre-receive:13:in `<main>'\r\n```", "state": "closed", "created_at": "2015-01-30T17:33:35.902Z", "updated_at": "2018-01-12T15:26:02.475Z", "closed_at": "2018-01-12T15:26:02.470Z", "closed_by": null, "labels": ["bug"], "milestone": null, "assignees": [], "author": {"id": 56721, "name": "Mois\u00e9s Maci\u00e1", "username": "mmacia", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/bda8302cf8bb9867e4732740d8a125f5?s=80&d=identicon", "web_url": "https://gitlab.com/mmacia"}, "assignee": null, "user_notes_count": 7, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/17", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/17", "notes": "https://gitlab.com/api/v4/projects/14022/issues/17/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/17/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 821221, "type": null, "body": "I downgraded to 2.4.1 and works fine ...", "attachment": null, "author": {"id": 56721, "name": "Mois\u00e9s Maci\u00e1", "username": "mmacia", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/bda8302cf8bb9867e4732740d8a125f5?s=80&d=identicon", "web_url": "https://gitlab.com/mmacia"}, "created_at": "2015-01-30T18:01:51.915Z", "updated_at": "2015-01-30T18:01:51.915Z", "system": false, "noteable_id": 125191, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 17}, {"id": 826240, "type": null, "body": "Same issue , same work arround ", "attachment": null, "author": {"id": 26777, "name": "Nassim", "username": "n4m", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/17de2dd2334570e54e23677d2cb29253?s=80&d=identicon", "web_url": "https://gitlab.com/n4m"}, "created_at": "2015-02-02T14:37:07.523Z", "updated_at": "2015-02-02T14:37:07.523Z", "system": false, "noteable_id": 125191, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 17}, {"id": 1006967, "type": null, "body": "I have the same issue after upgrading to gitlab-shell v2.6.0. Reverted back to v2.4.1 and no problems pushing code to gitlab.", "attachment": null, "author": {"id": 118978, "name": "Jurriaan Saathof", "username": "jsaathof", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/1d35a5157f52de946c9896de40dcefae?s=80&d=identicon", "web_url": "https://gitlab.com/jsaathof"}, "created_at": "2015-03-24T10:52:16.146Z", "updated_at": "2015-03-24T10:52:16.146Z", "system": false, "noteable_id": 125191, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 17}, {"id": 1007036, "type": null, "body": "@jsaathof  Are you using a ruby 1.9 or are you using rbenv?", "attachment": null, "author": {"id": 2900, "name": "Robert Schilling", "username": "razer6", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0adbac358390f76344618df9ef9e933e?s=80&d=identicon", "web_url": "https://gitlab.com/razer6"}, "created_at": "2015-03-24T11:14:40.679Z", "updated_at": "2015-03-24T11:14:51.647Z", "system": false, "noteable_id": 125191, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 17}, {"id": 1007088, "type": null, "body": "@razer6 ruby 2.1.3p242 (2014-09-19 revision 47630) [x86_64-linux] installed with rvm.", "attachment": null, "author": {"id": 118978, "name": "Jurriaan Saathof", "username": "jsaathof", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/1d35a5157f52de946c9896de40dcefae?s=80&d=identicon", "web_url": "https://gitlab.com/jsaathof"}, "created_at": "2015-03-24T11:33:19.617Z", "updated_at": "2015-03-24T11:33:19.617Z", "system": false, "noteable_id": 125191, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 17}, {"id": 1007274, "type": null, "body": "@jsaathof This is I think a duplicate of https://github.com/gitlabhq/gitlab-shell/issues/223", "attachment": null, "author": {"id": 2900, "name": "Robert Schilling", "username": "razer6", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0adbac358390f76344618df9ef9e933e?s=80&d=identicon", "web_url": "https://gitlab.com/razer6"}, "created_at": "2015-03-24T12:27:03.992Z", "updated_at": "2015-03-24T12:27:03.992Z", "system": false, "noteable_id": 125191, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 17}, {"id": 1017591, "type": null, "body": "Has been solved. I found out that the system ruby was being used instead of the rvm installed version. I sourced .rvm/environments/default in .bashrc and now it works.", "attachment": null, "author": {"id": 118978, "name": "Jurriaan Saathof", "username": "jsaathof", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/1d35a5157f52de946c9896de40dcefae?s=80&d=identicon", "web_url": "https://gitlab.com/jsaathof"}, "created_at": "2015-03-26T19:36:20.338Z", "updated_at": "2015-03-26T19:36:20.338Z", "system": false, "noteable_id": 125191, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 17}], [{"id": 54341375, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:26:02.547Z", "updated_at": "2018-01-12T15:26:02.547Z", "system": true, "noteable_id": 125191, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 17}]]}, {"id": 114233, "iid": 16, "project_id": 14022, "title": "git push/fetch fails with access denied", "description": "After upgrading to gitlab-shell 2.4.1 and gitlab 7.7.1 I can no longer fetch/push.\r\n\r\ngitlab-shell.log contains the following lines once per attempt:\r\n```\r\nD, [2015-01-24T21:40:21.476868 #475] DEBUG -- : Performing POST http://localhost:8080//api/v3/internal/allowed\r\nD, [2015-01-24T21:40:21.525283 #475] DEBUG -- : Received response 200 => <{\"status\":true,\"message\":\"\"}>.\r\nW, [2015-01-24T21:40:21.525374 #475]  WARN -- : gitlab-shell: Access denied for git command <git-receive-pack '/adminstuff/systemconfig.git'> by user with key key-1.\r\n```\r\n\r\nFor me that reads as if gitlab is OK with the access, but gitlab-shell does not understand that for some reason. Any ideas?\r\n\r\nAssigning to Dmitriy due to git blame output:-)", "state": "closed", "created_at": "2015-01-24T20:48:28.762Z", "updated_at": "2017-06-06T18:27:56.582Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 20113, "name": "Tobias Hunger", "username": "hunger", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a49cea1f2a9c4b6be813f4629c5f3619?s=80&d=identicon", "web_url": "https://gitlab.com/hunger"}, "assignee": null, "user_notes_count": 3, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/16", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/16", "notes": "https://gitlab.com/api/v4/projects/14022/issues/16/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/16/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 770307, "type": null, "body": "Reassigned to @dzaporozhets", "attachment": null, "author": {"id": 20113, "name": "Tobias Hunger", "username": "hunger", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a49cea1f2a9c4b6be813f4629c5f3619?s=80&d=identicon", "web_url": "https://gitlab.com/hunger"}, "created_at": "2015-01-24T20:50:41.719Z", "updated_at": "2015-01-24T20:50:41.719Z", "system": true, "noteable_id": 114233, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 16}, {"id": 787951, "type": null, "body": "@hunger uses ruby 2.2. So that's probably the issue.", "attachment": null, "author": {"id": 66948, "name": "Stefan Tatschner", "username": "rumpelsepp", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/66948/avatar.png", "web_url": "https://gitlab.com/rumpelsepp"}, "created_at": "2015-01-28T09:49:09.399Z", "updated_at": "2015-01-28T09:49:09.399Z", "system": false, "noteable_id": 114233, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 16}, {"id": 788194, "type": null, "body": "Assignee removed", "attachment": null, "author": {"id": 2900, "name": "Robert Schilling", "username": "razer6", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0adbac358390f76344618df9ef9e933e?s=80&d=identicon", "web_url": "https://gitlab.com/razer6"}, "created_at": "2015-01-28T11:33:00.640Z", "updated_at": "2015-01-28T11:33:00.640Z", "system": true, "noteable_id": 114233, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 16}, {"id": 788198, "type": null, "body": "That may be an issue. ruby 2.2 is not supported and is known to cause several issues. ", "attachment": null, "author": {"id": 2900, "name": "Robert Schilling", "username": "razer6", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0adbac358390f76344618df9ef9e933e?s=80&d=identicon", "web_url": "https://gitlab.com/razer6"}, "created_at": "2015-01-28T11:33:30.071Z", "updated_at": "2015-01-28T11:33:30.071Z", "system": false, "noteable_id": 114233, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 16}, {"id": 1271758, "type": null, "body": "I downgraded to ruby 2.1 and all is well, so you are probably right.\r\n\r\nLet's close this issue and sorry for the noise.", "attachment": null, "author": {"id": 20113, "name": "Tobias Hunger", "username": "hunger", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a49cea1f2a9c4b6be813f4629c5f3619?s=80&d=identicon", "web_url": "https://gitlab.com/hunger"}, "created_at": "2015-05-22T22:24:01.560Z", "updated_at": "2015-05-22T22:24:01.560Z", "system": false, "noteable_id": 114233, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 16}, {"id": 1271759, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 20113, "name": "Tobias Hunger", "username": "hunger", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/a49cea1f2a9c4b6be813f4629c5f3619?s=80&d=identicon", "web_url": "https://gitlab.com/hunger"}, "created_at": "2015-05-22T22:24:01.704Z", "updated_at": "2015-05-22T22:24:01.704Z", "system": true, "noteable_id": 114233, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 16}]]}, {"id": 111849, "iid": 15, "project_id": 14022, "title": "gitlab-projects list-projects -> permission error", "description": "I have gitlab omnibus 7.6.2 installed and when I run \r\n\r\n    sudo -u git -H /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab-projects list-projects \r\n\r\nI have the following error.\r\n\r\n```\r\n/opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_projects.rb:99:in `chdir': Permission denied @ dir_chdir - /root (Errno::EACCES)\r\n\tfrom /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_projects.rb:99:in `list_projects'\r\n\tfrom /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_projects.rb:44:in `exec'\r\n\tfrom /opt/gitlab/embedded/service/gitlab-shell/bin/gitlab-projects:31:in `<main>'\r\n```\r\n    \r\nrunning with\r\n\r\n    su /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab-projects list-projects \r\n\r\nshowed correct project lists", "state": "closed", "created_at": "2015-01-21T07:33:50.886Z", "updated_at": "2018-01-12T13:53:29.279Z", "closed_at": "2018-01-12T13:53:29.274Z", "closed_by": null, "labels": ["support"], "milestone": null, "assignees": [], "author": {"id": 87671, "name": "Tun Win Naing", "username": "tunwn-mdy", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3ab1d9940a0827332af4a07dc2c45838?s=80&d=identicon", "web_url": "https://gitlab.com/tunwn-mdy"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/15", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/15", "notes": "https://gitlab.com/api/v4/projects/14022/issues/15/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/15/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 54327946, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T13:53:29.356Z", "updated_at": "2018-01-12T13:53:29.356Z", "system": true, "noteable_id": 111849, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 15}], [{"id": 54327968, "type": null, "body": "Closing as gitlab-projects is being removed in !180", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T13:53:42.099Z", "updated_at": "2018-01-12T13:53:42.099Z", "system": false, "noteable_id": 111849, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 15}]]}, {"id": 109829, "iid": 14, "project_id": 14022, "title": "Knowledge of gitlab webapp invocation vs ssh invocation", "description": "I have a feature I have written for Gitlab CE, that allows merge on protected branch via web app MR, but blocks via SSH push.\r\n\r\n#### Given:  \r\n\r\nGitlab web app performs exact same permission checks that gitlab shell does.\r\n\r\n#### Proposal:\r\n\r\nHave gitlab shell avoid checking permissions when invoked via gitlab web app, otherwise permissions are checked as they are today.\r\n\r\n#### Implementation: \r\n\r\nI have a branch where I check for an environment variable that the webapp set to identify the invocation as webapp.  When ssh invokes, that environment variable is not set and normal permission checking continues.  I used an environment variable because that seemed to be the convention for gitlab shell. \r\n\r\nMy simple commit that enables this otherwise benign change.  It's benign because without my gitlab-ce patch, the execution path remains the same.\r\n\r\nhttps://gitlab.com/synaxin/gitlab-shell/commit/51d7a597ad49bd59723d12cceea750108acd22aa\r\n\r\n\r\nHaving this small change allows me to submit a merge request to gitlab-ce which sets this variable from within the web-app.  I have the complete implementation done on my own branches.\r\n\r\n\r\nPlease give me feedback", "state": "opened", "created_at": "2015-01-16T15:57:16.132Z", "updated_at": "2017-09-16T09:40:28.759Z", "closed_at": null, "closed_by": null, "labels": ["ssh"], "milestone": null, "assignees": [], "author": {"id": 31083, "name": "Jason J. Kushmaul", "username": "jkushmaul", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/31083/avatar.png", "web_url": "https://gitlab.com/jkushmaul"}, "assignee": null, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/14", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/14", "notes": "https://gitlab.com/api/v4/projects/14022/issues/14/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/14/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": []}, {"id": 92533, "iid": 13, "project_id": 14022, "title": "git-shell errors on v2.4.0", "description": "Making a pull with the latest version returns this error:\r\n\r\n```\r\ngit pull\r\n/usr/share/gems/gems/json-1.7.7/lib/json/common.rb:155:in `parse': 757: unexpected token at 'true' (JSON::ParserError)\r\n\tfrom /usr/share/gems/gems/json-1.7.7/lib/json/common.rb:155:in `parse'\r\n\tfrom /home/git/gitlab-shell/lib/gitlab_access_status.rb:13:in `create_from_json'\r\n\tfrom /home/git/gitlab-shell/lib/gitlab_net.rb:31:in `check_access'\r\n\tfrom /home/git/gitlab-shell/lib/gitlab_shell.rb:63:in `validate_access'\r\n\tfrom /home/git/gitlab-shell/lib/gitlab_shell.rb:24:in `exec'\r\n\tfrom /home/git/gitlab-shell/bin/gitlab-shell:16:in `<main>'\r\nfatal: Could not read from remote repository.\r\n\r\nPlease make sure you have the correct access rights\r\nand the repository exists.\r\n```\r\n\r\nIt seems to be from `/home/git/gitlab-shell/lib/gitlab_net.rb`\r\n\r\n```\r\n    resp = post(url, params)\r\n\r\n    if resp.code == '200'\r\n      GitAccessStatus.create_from_json(resp.body)\r\n    else\r\n      GitAccessStatus.new(false, \"API is not accesible\")\r\n    end\r\n```\r\n\r\nresp.body is not a json, but the word \"true\"\r\n", "state": "closed", "created_at": "2014-11-25T13:13:40.797Z", "updated_at": "2017-06-06T18:27:56.619Z", "closed_at": null, "closed_by": null, "labels": ["bug"], "milestone": null, "assignees": [], "author": {"id": 64221, "name": "Cristian Falcas", "username": "cristi-falcas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/31a485d626364d85bfc4d1cffb94c5a9?s=80&d=identicon", "web_url": "https://gitlab.com/cristi-falcas"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/13", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/13", "notes": "https://gitlab.com/api/v4/projects/14022/issues/13/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/13/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 662902, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 3585, "name": "Achilleas Pipinellis", "username": "axil", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3585/avatar.png", "web_url": "https://gitlab.com/axil"}, "created_at": "2014-12-10T06:50:18.236Z", "updated_at": "2014-12-10T06:50:18.236Z", "system": true, "noteable_id": 92533, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 13}, {"id": 662903, "type": null, "body": "This is caused if you use gitlab-shell 2.4.0 with GitLab 7.5. GitLab 7.5 needs gitlab-shell 2.2.0.", "attachment": null, "author": {"id": 3585, "name": "Achilleas Pipinellis", "username": "axil", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3585/avatar.png", "web_url": "https://gitlab.com/axil"}, "created_at": "2014-12-10T06:50:18.482Z", "updated_at": "2014-12-10T06:50:18.482Z", "system": false, "noteable_id": 92533, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 13}]]}, {"id": 91480, "iid": 12, "project_id": 14022, "title": "Update to v2.2.0 causes bin/check to fail", "description": "I just upgraded from gitlab 7.4.3 to 7.5.1 and now gitlab-shell fails the self check \r\n\r\njkolb@AGO-SVN:/home/git/gitlab-shell [(v2.2.0)]$ $ sudo -u git -H bin/check\r\nCheck GitLab API access: FAILED. code: 400\r\n\r\nIn the gitlab-shell.log I see:\r\n\r\n380661 E, [2014-11-21T16:29:08.737270 #6964] ERROR -- : API call <GET https://gitlab.ara.wan//api/v3/internal/check> failed: 400 => <Bad request (GET and HEAD requests may not contain a request body)>.\r\n\r\nSomething seems to have regressed.", "state": "closed", "created_at": "2014-11-21T21:31:12.727Z", "updated_at": "2017-06-06T18:27:56.671Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 15355, "name": "Jeremy Kolb", "username": "kjeremy", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ea644e1f8f5cecd4651d7140c65bcfce?s=80&d=identicon", "web_url": "https://gitlab.com/kjeremy"}, "assignee": null, "user_notes_count": 6, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/12", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/12", "notes": "https://gitlab.com/api/v4/projects/14022/issues/12/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/12/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 621869, "type": null, "body": "cp /home/git/gitlab/.gitlab_shell_secret /home/git/gitlab-shell/\r\n", "attachment": null, "author": {"id": 64221, "name": "Cristian Falcas", "username": "cristi-falcas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/31a485d626364d85bfc4d1cffb94c5a9?s=80&d=identicon", "web_url": "https://gitlab.com/cristi-falcas"}, "created_at": "2014-11-25T13:08:49.849Z", "updated_at": "2014-11-25T13:08:49.849Z", "system": false, "noteable_id": 91480, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 12}, {"id": 663345, "type": null, "body": "I also get a similiar exception after upgrading to v2.2.0 and gitlab 7.5.1\r\n\r\nHere's my error output if i do the GitLab Shell check\r\n\r\nE, [2014-12-10T12:07:08.586979 #29965] ERROR -- : API call <GET http://gitlab.**.local/api/v3/internal/check> failed: 400 => <Bad request (GET and HEAD requests may not contain a request body)>\r\n\r\n", "attachment": null, "author": {"id": 76438, "name": "Mike Penz", "username": "mike-penz", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/dc72d7f74062329a124aa4ec4a23746f?s=80&d=identicon", "web_url": "https://gitlab.com/mike-penz"}, "created_at": "2014-12-10T11:11:16.369Z", "updated_at": "2014-12-10T11:11:16.369Z", "system": false, "noteable_id": 91480, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 12}, {"id": 901130, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 2900, "name": "Robert Schilling", "username": "razer6", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0adbac358390f76344618df9ef9e933e?s=80&d=identicon", "web_url": "https://gitlab.com/razer6"}, "created_at": "2015-03-01T15:23:14.878Z", "updated_at": "2015-03-01T15:23:14.878Z", "system": true, "noteable_id": 91480, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 12}, {"id": 901131, "type": null, "body": "GitLab /GitLab-shell do not support ruby 2.2 yet.", "attachment": null, "author": {"id": 2900, "name": "Robert Schilling", "username": "razer6", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0adbac358390f76344618df9ef9e933e?s=80&d=identicon", "web_url": "https://gitlab.com/razer6"}, "created_at": "2015-03-01T15:23:14.996Z", "updated_at": "2015-03-01T15:23:14.996Z", "system": false, "noteable_id": 91480, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 12}, {"id": 904593, "type": null, "body": "@razer6 i still have this issue. The log states following:\r\n\r\n`API call <GET http://*/api/v3/internal/check> failed: 400 => <Bad request (GET and HEAD requests may not contain a request body)>`", "attachment": null, "author": {"id": 76438, "name": "Mike Penz", "username": "mike-penz", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/dc72d7f74062329a124aa4ec4a23746f?s=80&d=identicon", "web_url": "https://gitlab.com/mike-penz"}, "created_at": "2015-03-02T14:27:34.303Z", "updated_at": "2015-03-02T14:27:52.200Z", "system": false, "noteable_id": 91480, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 12}, {"id": 904611, "type": null, "body": "@mike-penz Are you on ruby 2.2?", "attachment": null, "author": {"id": 2900, "name": "Robert Schilling", "username": "razer6", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0adbac358390f76344618df9ef9e933e?s=80&d=identicon", "web_url": "https://gitlab.com/razer6"}, "created_at": "2015-03-02T14:31:48.841Z", "updated_at": "2015-03-02T14:31:48.841Z", "system": false, "noteable_id": 91480, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 12}, {"id": 904626, "type": null, "body": "@razer6 no `ruby -v` gives following output `ruby 2.1.2p95 (2014-05-08 revision 45877) [x86_64-linux]`", "attachment": null, "author": {"id": 76438, "name": "Mike Penz", "username": "mike-penz", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/dc72d7f74062329a124aa4ec4a23746f?s=80&d=identicon", "web_url": "https://gitlab.com/mike-penz"}, "created_at": "2015-03-02T14:33:29.259Z", "updated_at": "2015-03-02T14:33:29.259Z", "system": false, "noteable_id": 91480, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 12}]]}, {"id": 77899, "iid": 11, "project_id": 14022, "title": "secret token", "description": "Not sure if the issue belongs there or here\r\n\r\ngitlab-org/gitlab-ce#700\r\n", "state": "closed", "created_at": "2014-10-20T16:29:20.758Z", "updated_at": "2017-06-06T18:27:56.712Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 15756, "name": "Sergio Pieiga", "username": "nummy", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/c9a465293676a48e80f194b00070fefb?s=80&d=identicon", "web_url": "https://gitlab.com/nummy"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/11", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/11", "notes": "https://gitlab.com/api/v4/projects/14022/issues/11/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/11/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 318536, "type": null, "body": "Let's keep the other open and close this one", "attachment": null, "author": {"id": 2900, "name": "Robert Schilling", "username": "razer6", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0adbac358390f76344618df9ef9e933e?s=80&d=identicon", "web_url": "https://gitlab.com/razer6"}, "created_at": "2014-10-20T18:42:16.753Z", "updated_at": "2014-10-20T18:42:16.753Z", "system": false, "noteable_id": 77899, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 11}, {"id": 318537, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 2900, "name": "Robert Schilling", "username": "razer6", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/0adbac358390f76344618df9ef9e933e?s=80&d=identicon", "web_url": "https://gitlab.com/razer6"}, "created_at": "2014-10-20T18:42:18.091Z", "updated_at": "2014-10-20T18:42:18.091Z", "system": true, "noteable_id": 77899, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 11}]]}, {"id": 70683, "iid": 10, "project_id": 14022, "title": "GitlabPostReceive fails to create sidekiq job when pushing lots of tags", "description": "I want to import an existing project with more than 1,000 tags into gitlab.\r\n\r\nI create the project in gitlab, add the ssh URL as a new remote in my local copy, and try to push master and tags:\r\n\r\n```shell\r\ngit push --tags gitlab master\r\n```\r\n\r\nOutput contains:\r\n\r\n> **remote: GitLab: An unexpected error occurred (redis-cli returned 127).**     \r\n> To git@git.example.com:group/project.git\r\n> * [new branch]      master -> master\r\n> * [new tag]         tag1 -> tag1\r\n> *\u2026more than 1,000 other [new tag] stuff\u2026*\r\n\r\nI end up with an inconsistent project in gitlab.\r\n\r\nProject activity does not show *John Doe pushed new branch/tag\u2026* activities, and of the 4 numbers on the right, only *commits* is updated; *branches* *tags* and *size* are all 0:\r\n\r\n![activity](https://gitlab.com/uploads/gitlab-org/gitlab-shell/f3109bd773/activity.png)\r\n\r\nIn *Commits* section, tabs have the right numbers (1 branch and 1,230 tags), and *branch* tab displays master correctly, but *tags* tab is empty:\r\n\r\n![tags](https://gitlab.com/uploads/gitlab-org/gitlab-shell/abf0b31218/tags.png)\r\n\r\nIf I delete and recreate project, but only push master branch without tags, everything is fine: *John Doe pushed new branch\u2026* activities are created, numbers are correct\u2026\r\n\r\nI double-checked path to *redis-cli* in gitlab-shell/config.yml and it is correct (and it works anyway if I don't push tags).\r\n\r\nI set gitlab-shell logs to DEBUG level and did not see anything relevant.\r\n\r\nI changed */dev/null* to real files for *out* and *err* file descriptors for redis-cli call line 26 of lib/gitlab_post_receive.rb and didn't see anything.\r\n\r\nIs it the number of tags which breaks something, or could there be a tag with a name that breaks the command line?", "state": "closed", "created_at": "2014-09-26T13:30:52.158Z", "updated_at": "2017-06-06T18:27:56.744Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 57314, "name": "Jean-S\u00e9bastien Bour", "username": "sufflope", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3b832e4097777d0706a3b9aa8d1097f6?s=80&d=identicon", "web_url": "https://gitlab.com/sufflope"}, "assignee": null, "user_notes_count": 5, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/10", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/10", "notes": "https://gitlab.com/api/v4/projects/14022/issues/10/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/10/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 288270, "type": null, "body": "Sorry, I forgot to add version information\u2026\r\n\r\n* Server OS: Fedora 20\r\n* Client OS: OSX 10.9.5\r\n* Server git: 1.9.3\r\n* Client git: 1.9.3 (Apple Git-50)\r\n* GitLab: 7.3.1\r\n* GitLab Shell: 2.0.1\r\n* GitLab API: v3\r\n* Ruby: 2.0.0p353\r\n* Rails: 4.1.1\r\n* redis-cli: 2.6.16\r\n* redis-server: Redis server v=2.6.16 sha=00000000:0 malloc=tcmalloc-2.1 bits=64", "attachment": null, "author": {"id": 57314, "name": "Jean-S\u00e9bastien Bour", "username": "sufflope", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3b832e4097777d0706a3b9aa8d1097f6?s=80&d=identicon", "web_url": "https://gitlab.com/sufflope"}, "created_at": "2014-09-26T14:05:19.542Z", "updated_at": "2014-09-26T14:05:19.542Z", "system": false, "noteable_id": 70683, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 10}, {"id": 288313, "type": null, "body": "I just made a new test: push all tags one-by-one. I ran:\r\n\r\n```shell\r\nfor TAG in $(git tag -l); do echo $TAG && git push gitlab $TAG; done\r\n```\r\n\r\nThere were no errors and all 1,230 tags show up in gitlab, activities etc. are OK, so I would say that it's indeed the scheduling of job which is broken for too many tags.", "attachment": null, "author": {"id": 57314, "name": "Jean-S\u00e9bastien Bour", "username": "sufflope", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3b832e4097777d0706a3b9aa8d1097f6?s=80&d=identicon", "web_url": "https://gitlab.com/sufflope"}, "created_at": "2014-09-26T14:47:00.201Z", "updated_at": "2014-09-26T14:47:00.201Z", "system": false, "noteable_id": 70683, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 10}, {"id": 288791, "type": null, "body": "mentioned in merge request !4", "attachment": null, "author": {"id": 57314, "name": "Jean-S\u00e9bastien Bour", "username": "sufflope", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3b832e4097777d0706a3b9aa8d1097f6?s=80&d=identicon", "web_url": "https://gitlab.com/sufflope"}, "created_at": "2014-09-26T22:35:58.789Z", "updated_at": "2014-09-26T22:35:58.789Z", "system": true, "noteable_id": 70683, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 10}, {"id": 288793, "type": null, "body": "I can confirm it is indeed a problem with a too-long generated command line. I puts-debugged arguments passed to system() line 26 of lib/gitlab_post_receive.rb and with my setup and existing repository, it makes a whopping 140kB command-line when vanilla Linux will accept a maximum of 132kB-long argument lines.\r\n\r\nProposed a naive fix in !4.", "attachment": null, "author": {"id": 57314, "name": "Jean-S\u00e9bastien Bour", "username": "sufflope", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/3b832e4097777d0706a3b9aa8d1097f6?s=80&d=identicon", "web_url": "https://gitlab.com/sufflope"}, "created_at": "2014-09-26T22:44:24.833Z", "updated_at": "2014-09-26T22:44:24.833Z", "system": false, "noteable_id": 70683, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 10}, {"id": 2931781, "type": null, "body": "I also get this error when I tries to mirror some git repositories.\r\n```\r\n$ git clone --mirror https://gitlab.com/gitlab-org/gitlab-ce.git\r\n\r\n$ cd gitlab-ce.git\r\n\r\n$ git push --mirror git@gitlab.example.com:user/gitlab-ce.git\r\nCounting objects: 201252, done.\r\nDelta compression using up to 8 threads.\r\nCompressing objects: 100% (41906/41906), done.\r\nWriting objects: 100% (201252/201252), 101.59 MiB | 27.38 MiB/s, done.\r\nTotal 201252 (delta 156607), reused 201252 (delta 156607)\r\nremote: GitLab: An unexpected error occurred (redis-cli returned 127).\r\nTo git@gitlab.example.com:user/gitlab-ce.git\r\n * [new branch]      5-4-stable -> 5-4-stable\r\n * [new branch]      6-0-stable -> 6-0-stable\r\n --- snip ---\r\n```\r\nAfter it finished the project site shows:\r\n`0 commits 118 branches 0 tags 0.0 MB`\r\n\r\nThe upstream Gitlab says this:\r\n`21,522 commits 118 branches 235 tags 236.7 MB`", "attachment": null, "author": {"id": 348929, "name": "Kai Stian Olstad", "username": "kaistian", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/d6b1b9b50283f5bd3852cc098e9e0c39?s=80&d=identicon", "web_url": "https://gitlab.com/kaistian"}, "created_at": "2015-12-12T14:08:23.596Z", "updated_at": "2015-12-12T14:08:23.596Z", "system": false, "noteable_id": 70683, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 10}, {"id": 12119541, "type": null, "body": "I think this may be fixed via !59 and should be in GitLab 8.9.", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-05-27T18:44:32.220Z", "updated_at": "2016-05-27T18:44:32.220Z", "system": false, "noteable_id": 70683, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 10}, {"id": 12119542, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 64248, "name": "Stan Hu", "username": "stanhu", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/64248/stanhu.jpg", "web_url": "https://gitlab.com/stanhu"}, "created_at": "2016-05-27T18:44:32.365Z", "updated_at": "2016-05-27T18:44:32.365Z", "system": true, "noteable_id": 70683, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 10}]]}, {"id": 64284, "iid": 9, "project_id": 14022, "title": "Can't push when gitlab runs in thin", "description": "Requests from the hook/update within gitlab-shell to the \"allowed\" function time out when used from thin rather than Unicorn (starting gitlab with 'bundle exec rails s' rather than 'bundle exec foreman start').\r\n\r\nPerhaps not a big problem, but rails apps are usually container independent.", "state": "closed", "created_at": "2014-08-29T15:20:42.925Z", "updated_at": "2017-06-06T18:27:56.784Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 50854, "name": "Rusty Phillips", "username": "rusty.phillips", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/4682f75e22adc7b41ee22ede9b700416?s=80&d=identicon", "web_url": "https://gitlab.com/rusty.phillips"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/9", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/9", "notes": "https://gitlab.com/api/v4/projects/14022/issues/9/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/9/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 299892, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 50854, "name": "Rusty Phillips", "username": "rusty.phillips", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/4682f75e22adc7b41ee22ede9b700416?s=80&d=identicon", "web_url": "https://gitlab.com/rusty.phillips"}, "created_at": "2014-10-06T15:36:48.593Z", "updated_at": "2014-10-06T15:36:48.593Z", "system": true, "noteable_id": 64284, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 9}, {"id": 299928, "type": null, "body": "its because you need at least 2 workers to serve push over http. ", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2014-10-06T16:20:58.453Z", "updated_at": "2014-10-06T16:20:58.453Z", "system": false, "noteable_id": 64284, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 9}]]}, {"id": 54718, "iid": 8, "project_id": 14022, "title": "repos_path is case sensitive, giving faulty project names on post hook", "description": "I've installed gitlab-shell into my home directory (/Users/my-user/gitlab/gitlab-shell), but it won't parse my project names correctly. My projectnames still contain the full path to the base repositories (/Users/my-user/gitlab/repositories).\r\n\r\nMaking the gsub command in case sensitive resolves the issue.", "state": "closed", "created_at": "2014-08-07T16:26:27.923Z", "updated_at": "2017-06-06T18:27:56.831Z", "closed_at": null, "closed_by": null, "labels": ["bug"], "milestone": null, "assignees": [{"id": 10238, "name": "Jan-Willem", "username": "jewilmeer", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/10238/DSC02603_copy.jpg", "web_url": "https://gitlab.com/jewilmeer"}], "author": {"id": 10238, "name": "Jan-Willem", "username": "jewilmeer", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/10238/DSC02603_copy.jpg", "web_url": "https://gitlab.com/jewilmeer"}, "assignee": {"id": 10238, "name": "Jan-Willem", "username": "jewilmeer", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/10238/DSC02603_copy.jpg", "web_url": "https://gitlab.com/jewilmeer"}, "user_notes_count": 0, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/8", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/8", "notes": "https://gitlab.com/api/v4/projects/14022/issues/8/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/8/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 1255007, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 10238, "name": "Jan-Willem", "username": "jewilmeer", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/10238/DSC02603_copy.jpg", "web_url": "https://gitlab.com/jewilmeer"}, "created_at": "2015-05-19T21:04:39.206Z", "updated_at": "2015-05-19T21:04:39.206Z", "system": true, "noteable_id": 54718, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 8}]]}, {"id": 36030, "iid": 7, "project_id": 14022, "title": "sidekiq Permission denied when deleting SSH key using omnibus-gitlab package", "description": "Deleting a SSH key results into a \"Permission denied\" error in the sidekiq log:\r\n\r\n```\r\n2014-06-12_17:46:33.06070 /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_keys.rb:84:in `initialize': Permission denied - /opt/gitlab/embedded/service/gitlab-shell/authorized_keys.lock (Errno::EACCES)\r\n2014-06-12_17:46:33.06078       from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_keys.rb:84:in `open'\r\n2014-06-12_17:46:33.06079       from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_keys.rb:84:in `lock'\r\n2014-06-12_17:46:33.06080       from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_keys.rb:62:in `rm_key'\r\n2014-06-12_17:46:33.06084       from /opt/gitlab/embedded/service/gitlab-shell/lib/gitlab_keys.rb:20:in `exec'\r\n2014-06-12_17:46:33.06087       from /opt/gitlab/embedded/service/gitlab-shell//bin/gitlab-keys:25:in `<main>'\r\n```\r\n\r\nAnd the key isn't removed from /var/opt/gitlab/.ssh/authorized_keys.\r\nI think the path of authorized_keys.lock should be /var/opt/gitlab/.ssh/.\r\n\r\nBut there is an easy bug fix. :wink:", "state": "closed", "created_at": "2014-06-12T17:59:32.605Z", "updated_at": "2017-06-06T18:27:56.872Z", "closed_at": null, "closed_by": null, "labels": ["sidekiq", "ssh"], "milestone": null, "assignees": [], "author": {"id": 36741, "name": "CSchulz", "username": "cschulz", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/35c4fca93ae71eb4429af2efb2b00e56?s=80&d=identicon", "web_url": "https://gitlab.com/cschulz"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/7", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/7", "notes": "https://gitlab.com/api/v4/projects/14022/issues/7/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/7/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 129544, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 36741, "name": "CSchulz", "username": "cschulz", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/35c4fca93ae71eb4429af2efb2b00e56?s=80&d=identicon", "web_url": "https://gitlab.com/cschulz"}, "created_at": "2014-06-12T18:04:30.070Z", "updated_at": "2014-06-12T18:04:30.070Z", "system": true, "noteable_id": 36030, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 7}, {"id": 129545, "type": null, "body": "With 2c5d04deb2e9252b346e5701da81f62f28f800db the issue was fixed, it was detected by #4.", "attachment": null, "author": {"id": 36741, "name": "CSchulz", "username": "cschulz", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/35c4fca93ae71eb4429af2efb2b00e56?s=80&d=identicon", "web_url": "https://gitlab.com/cschulz"}, "created_at": "2014-06-12T18:05:06.194Z", "updated_at": "2014-06-12T18:05:06.194Z", "system": false, "noteable_id": 36030, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 7}]]}, {"id": 33596, "iid": 6, "project_id": 14022, "title": "gitlab:shell:setup rake command fails with v1.9.4", "description": "```\r\n...../var/lib/gitlab/gitlab-shell/lib/gitlab_keys.rb:87:in `block in lock': uninitialized constant GitlabKeys::Timeout (NameError)\r\n\tfrom /var/lib/gitlab/gitlab-shell/lib/gitlab_keys.rb:84:in `open'\r\n\tfrom /var/lib/gitlab/gitlab-shell/lib/gitlab_keys.rb:84:in `lock'\r\n\tfrom /var/lib/gitlab/gitlab-shell/lib/gitlab_keys.rb:39:in `batch_add_keys'\r\n\tfrom /var/lib/gitlab/gitlab-shell/lib/gitlab_keys.rb:19:in `exec'\r\n\tfrom /var/lib/gitlab/gitlab-shell//bin/gitlab-keys:21:in `<main>'\r\n```", "state": "closed", "created_at": "2014-05-31T01:41:28.247Z", "updated_at": "2017-06-06T18:27:56.916Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 35067, "name": "Travis Glenn Hansen", "username": "travisghansen", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/fe873705633da34d0623cd88fd96d217?s=80&d=identicon", "web_url": "https://gitlab.com/travisghansen"}, "assignee": null, "user_notes_count": 22, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/6", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/6", "notes": "https://gitlab.com/api/v4/projects/14022/issues/6/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/6/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 120196, "type": null, "body": "I have the same issue. Unfortunately this creates duplicate key entries in `authorized_keys` if the user re-uploads the same key. They then have to be removed manually for the key to work.", "attachment": null, "author": {"id": 35547, "name": "Pelle Johansson", "username": "perj", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/59aeda6ad8dea5965841953391441d7d?s=80&d=identicon", "web_url": "https://gitlab.com/perj"}, "created_at": "2014-06-03T10:31:39.151Z", "updated_at": "2014-06-03T10:31:39.151Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 120201, "type": null, "body": "Oh, my problem is with `gitlab-keys rm_key`, not this command. But line number is the same.", "attachment": null, "author": {"id": 35547, "name": "Pelle Johansson", "username": "perj", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/59aeda6ad8dea5965841953391441d7d?s=80&d=identicon", "web_url": "https://gitlab.com/perj"}, "created_at": "2014-06-03T10:33:56.274Z", "updated_at": "2014-06-03T10:33:56.274Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 120207, "type": null, "body": "Seems to be fixed by adding\r\n```\r\nrequire 'timeout'\r\n```\r\nto the top of the file.", "attachment": null, "author": {"id": 35547, "name": "Pelle Johansson", "username": "perj", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/59aeda6ad8dea5965841953391441d7d?s=80&d=identicon", "web_url": "https://gitlab.com/perj"}, "created_at": "2014-06-03T10:42:52.248Z", "updated_at": "2014-06-03T10:42:52.248Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 125171, "type": null, "body": "I am seeing a similar issue and the last comment helped me fix it.", "attachment": null, "author": {"id": 228, "name": "Vaidik Kapoor", "username": "kapoor.vaidik", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/9f2a1db7d95b36b91c2b97dab2941cf6?s=80&d=identicon", "web_url": "https://gitlab.com/kapoor.vaidik"}, "created_at": "2014-06-08T06:29:30.573Z", "updated_at": "2014-06-08T06:29:30.573Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 129542, "type": null, "body": "Seems to be fixed see 2c5d04deb2e9252b346e5701da81f62f28f800db.", "attachment": null, "author": {"id": 36741, "name": "CSchulz", "username": "cschulz", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/35c4fca93ae71eb4429af2efb2b00e56?s=80&d=identicon", "web_url": "https://gitlab.com/cschulz"}, "created_at": "2014-06-12T18:02:33.425Z", "updated_at": "2014-06-12T18:04:01.740Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 129600, "type": null, "body": "I updated to 1.9.5 and when that codepath is hit I get the same error.", "attachment": null, "author": {"id": 35067, "name": "Travis Glenn Hansen", "username": "travisghansen", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/fe873705633da34d0623cd88fd96d217?s=80&d=identicon", "web_url": "https://gitlab.com/travisghansen"}, "created_at": "2014-06-12T18:33:38.492Z", "updated_at": "2014-06-12T18:33:38.492Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 129602, "type": null, "body": "I have changed the file https://gitlab.com/gitlab-org/gitlab-shell/commit/2c5d04deb2e9252b346e5701da81f62f28f800db#6af2fbe76bf23f72337024b0793dfc26e04844e2_96_95 and it works for me.\r\n\r\nI don't know how you updated to 1.9.5 and so on, I don't know that process.", "attachment": null, "author": {"id": 36741, "name": "CSchulz", "username": "cschulz", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/35c4fca93ae71eb4429af2efb2b00e56?s=80&d=identicon", "web_url": "https://gitlab.com/cschulz"}, "created_at": "2014-06-12T18:37:04.041Z", "updated_at": "2014-06-12T18:37:04.041Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 129624, "type": null, "body": "@cschulz yeah I have situations that it works as well.  I'm not entirely sure what makes that block of code get hit but it's certainly an issue with: Timeout::timeout(timeout) { yield } (appears to be line 89 in 1.9.5)\r\n\r\nWhat's the aversion to simply adding the 'require 'timeout'' which apparently absolutely resolves the syntactical issue?", "attachment": null, "author": {"id": 35067, "name": "Travis Glenn Hansen", "username": "travisghansen", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/fe873705633da34d0623cd88fd96d217?s=80&d=identicon", "web_url": "https://gitlab.com/travisghansen"}, "created_at": "2014-06-12T19:41:53.157Z", "updated_at": "2014-06-12T19:41:53.157Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 129638, "type": null, "body": "What kind of issue? The same as above?\r\n\r\nI am setting up my own source vm for GitLab. :wink: ", "attachment": null, "author": {"id": 36741, "name": "CSchulz", "username": "cschulz", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/35c4fca93ae71eb4429af2efb2b00e56?s=80&d=identicon", "web_url": "https://gitlab.com/cschulz"}, "created_at": "2014-06-12T20:04:56.771Z", "updated_at": "2014-06-12T20:04:56.771Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 129639, "type": null, "body": "Yes, the exact same error mentioned above: uninitialized constant GitlabKeys::Timeout (NameError)\r\n\r\nAgain, is there is a reason we simply don't add the require and resolve the issue permanently?", "attachment": null, "author": {"id": 35067, "name": "Travis Glenn Hansen", "username": "travisghansen", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/fe873705633da34d0623cd88fd96d217?s=80&d=identicon", "web_url": "https://gitlab.com/travisghansen"}, "created_at": "2014-06-12T20:11:06.291Z", "updated_at": "2014-06-12T20:11:06.291Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 130506, "type": null, "body": "So I have installed a sourced GitLab instance and have no issues with gitlab:shell:setup neither with removing and adding keys.\r\n\r\nHow many keys do you have?", "attachment": null, "author": {"id": 36741, "name": "CSchulz", "username": "cschulz", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/35c4fca93ae71eb4429af2efb2b00e56?s=80&d=identicon", "web_url": "https://gitlab.com/cschulz"}, "created_at": "2014-06-13T17:38:43.855Z", "updated_at": "2014-06-13T17:38:43.855Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 130963, "type": null, "body": "One of my instances (the one that does not blow up when running the rake command) only has a single key.\r\n\r\nA second (the problem) instance simply has 5.  1 of which is a deploy key.\r\n\r\nPlease note that I've not tested adding/deleting keys from the interface itself in a number of releases so it may or may not be working fine.  This issue is specifically with the rake command.", "attachment": null, "author": {"id": 35067, "name": "Travis Glenn Hansen", "username": "travisghansen", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/fe873705633da34d0623cd88fd96d217?s=80&d=identicon", "web_url": "https://gitlab.com/travisghansen"}, "created_at": "2014-06-14T04:17:24.552Z", "updated_at": "2014-06-14T04:17:24.552Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 131049, "type": null, "body": "Do you have a \"special\" length for the keys?", "attachment": null, "author": {"id": 36741, "name": "CSchulz", "username": "cschulz", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/35c4fca93ae71eb4429af2efb2b00e56?s=80&d=identicon", "web_url": "https://gitlab.com/cschulz"}, "created_at": "2014-06-14T13:32:10.405Z", "updated_at": "2014-06-14T13:32:10.405Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 131088, "type": null, "body": "No.  The problem is resolved by adding the require.  It's clearly a syntactical issue so why don't we just add the require and move on?", "attachment": null, "author": {"id": 35067, "name": "Travis Glenn Hansen", "username": "travisghansen", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/fe873705633da34d0623cd88fd96d217?s=80&d=identicon", "web_url": "https://gitlab.com/travisghansen"}, "created_at": "2014-06-14T17:40:50.892Z", "updated_at": "2014-06-14T17:40:50.892Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 131090, "type": null, "body": "Because it isn't reproducible for me with 1.9.5", "attachment": null, "author": {"id": 36741, "name": "CSchulz", "username": "cschulz", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/35c4fca93ae71eb4429af2efb2b00e56?s=80&d=identicon", "web_url": "https://gitlab.com/cschulz"}, "created_at": "2014-06-14T17:43:59.692Z", "updated_at": "2014-06-14T17:43:59.692Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 131091, "type": null, "body": "Are you certain that you are hitting the same code path? (I'm in the irc channel as thansen if you'd prefer to chat there)", "attachment": null, "author": {"id": 35067, "name": "Travis Glenn Hansen", "username": "travisghansen", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/fe873705633da34d0623cd88fd96d217?s=80&d=identicon", "web_url": "https://gitlab.com/travisghansen"}, "created_at": "2014-06-14T17:45:24.461Z", "updated_at": "2014-06-14T17:45:24.461Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 131106, "type": null, "body": "~~@pelle Can you tell us something about your environment? How do you installed it and so on, thanks.~~", "attachment": null, "author": {"id": 36741, "name": "CSchulz", "username": "cschulz", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/35c4fca93ae71eb4429af2efb2b00e56?s=80&d=identicon", "web_url": "https://gitlab.com/cschulz"}, "created_at": "2014-06-14T19:01:26.264Z", "updated_at": "2014-06-14T19:28:07.032Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 131108, "type": null, "body": "@jacobvosmaer can you simply add the require for this?", "attachment": null, "author": {"id": 35067, "name": "Travis Glenn Hansen", "username": "travisghansen", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/fe873705633da34d0623cd88fd96d217?s=80&d=identicon", "web_url": "https://gitlab.com/travisghansen"}, "created_at": "2014-06-14T19:07:38.357Z", "updated_at": "2014-06-14T19:07:38.357Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 131554, "type": null, "body": "So striked through not sure if you want an answer or not. But here it is anyhow.\r\n\r\nI'm using CentOS 6 and ruby 1.9.3 from scl (yum install centos-release-SCL then yum install ruby193). I had to create a custom bash wrapper to get scl ruby activated by sshd but otherwise no changes.\r\n\r\nI'm thinking it might be a ruby version issue?", "attachment": null, "author": {"id": 35547, "name": "Pelle Johansson", "username": "perj", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/59aeda6ad8dea5965841953391441d7d?s=80&d=identicon", "web_url": "https://gitlab.com/perj"}, "created_at": "2014-06-15T21:45:59.917Z", "updated_at": "2014-06-15T21:45:59.917Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 131621, "type": null, "body": "@pelle I too bumped ruby on my problem server and it did not resolve the issue.  However, I did a full system update after bumping just ruby (note that I went from 193psomething to 193p484 so 193pX all along) and the issue went away.  It must be in one of the other related packages such a rake or bundler I'm guessing. For me:\r\n\r\n1. bundler 1.0.22 -> 1.3.5\r\n2. rake 0.9.2.2 -> 0.9.6\r\n3. rubygems 1.8.4 -> 2.0.3\r\n\r\nThere are others that got bumped as well but those *seem* the most likely.", "attachment": null, "author": {"id": 35067, "name": "Travis Glenn Hansen", "username": "travisghansen", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/fe873705633da34d0623cd88fd96d217?s=80&d=identicon", "web_url": "https://gitlab.com/travisghansen"}, "created_at": "2014-06-16T02:12:36.954Z", "updated_at": "2014-06-16T02:12:36.954Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 131780, "type": null, "body": "It is OK to use gitlab-shell 1.9.6 instead of 1.9.4. This issue should be fixed in 1.9.6.", "attachment": null, "author": {"id": 5302, "name": "Jacob Vosmaer", "username": "jacobvosmaer", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/e66d11c0eedf8c07b3b18fca46599807?s=80&d=identicon", "web_url": "https://gitlab.com/jacobvosmaer"}, "created_at": "2014-06-16T08:05:39.961Z", "updated_at": "2014-06-16T08:05:39.961Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 132181, "type": null, "body": "@jacobvosmaer excellent!  Thanks.  I'll close this out.", "attachment": null, "author": {"id": 35067, "name": "Travis Glenn Hansen", "username": "travisghansen", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/fe873705633da34d0623cd88fd96d217?s=80&d=identicon", "web_url": "https://gitlab.com/travisghansen"}, "created_at": "2014-06-16T15:33:47.684Z", "updated_at": "2014-06-16T15:33:47.684Z", "system": false, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}, {"id": 132182, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 35067, "name": "Travis Glenn Hansen", "username": "travisghansen", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/fe873705633da34d0623cd88fd96d217?s=80&d=identicon", "web_url": "https://gitlab.com/travisghansen"}, "created_at": "2014-06-16T15:33:51.591Z", "updated_at": "2014-06-16T15:33:51.591Z", "system": true, "noteable_id": 33596, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 6}]]}, {"id": 33356, "iid": 5, "project_id": 14022, "title": "Cant push branch or tag with German characters", "description": "If I try to push a repository with German characters like \u00e4\u00f6\u00fc\u00df I get an\r\n```\r\nremote: /usr/local/lib/ruby/2.1.0/json/common.rb:223:in `encode': \"\\xC3\" from ASCII-8BIT to UTF-8 (Encoding::UndefinedConversionError)\r\nremote:         from /usr/local/lib/ruby/2.1.0/json/common.rb:223:in `generate'\r\nremote:         from /usr/local/lib/ruby/2.1.0/json/common.rb:223:in `generate'\r\nremote:         from /usr/local/lib/ruby/2.1.0/json/common.rb:394:in `dump'\r\nremote:         from /export/home/git/gitlab-shell/lib/gitlab_update.rb:56:in `update_redis'\r\nremote:         from /export/home/git/gitlab-shell/lib/gitlab_update.rb:40:in `exec'\r\nremote:         from hooks/update:14:in `<main>'\r\n```\r\nThis is I big issue for us, because in old projects we have such tags and branches.", "state": "closed", "created_at": "2014-05-29T11:40:40.533Z", "updated_at": "2019-08-07T08:04:10.092Z", "closed_at": "2019-04-04T14:33:29.368Z", "closed_by": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "labels": ["Create [DEPRECATED]", "P3", "S3", "bug", "devops::create", "encoding", "needs investigation"], "milestone": {"id": 490705, "iid": 14, "group_id": 9970, "title": "Backlog", "description": "Issues that we want to do but are not planned right now. Open for contribution from the community.", "state": "active", "created_at": "2018-03-22T13:09:23.767Z", "updated_at": "2018-10-30T14:56:54.069Z", "due_date": null, "start_date": null, "web_url": "https://gitlab.com/groups/gitlab-org/-/milestones/14"}, "assignees": [], "author": {"id": 15350, "name": "niels", "username": "opensource21", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/15350/avatar.png", "web_url": "https://gitlab.com/opensource21"}, "assignee": null, "user_notes_count": 6, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/5", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/5", "notes": "https://gitlab.com/api/v4/projects/14022/issues/5/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/5/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 117797, "type": null, "body": "It looks like the branch/tag name is already using UTF-8 so the conversion fails interpreting the given UTF-8 string as ASCII-8BIT in order to convert it to UTF-8.\r\nAll the UTF-8 characters for the German special characters are 2 Bytes long with the first Byte being \"\\xC3\" (see below\r\n)\r\nGerman character => UTF-8 (HEX)\r\n* \u00c4 => C384\r\n* \u00d6 => C396\r\n* \u00dc => C39C\r\n* \u00df => C39F\r\n* \u00e4 => C3A4\r\n* \u00f6 => C3B6\r\n* \u00fc => C3BC", "attachment": null, "author": {"id": 15084, "name": "p-schneider", "username": "p-schneider", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/db4d5de92acbd5e9934c4d8278b47b8b?s=80&d=identicon", "web_url": "https://gitlab.com/p-schneider"}, "created_at": "2014-05-30T11:20:32.022Z", "updated_at": "2014-05-30T11:20:32.022Z", "system": false, "noteable_id": 33356, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 5}, {"id": 118060, "type": null, "body": "Well I run gitlab in an UTF-8 environment and as far as I know git use UTF-8 too. So yes it should be UTF-8 Strings, but how can I tell Ruby not to convert them?", "attachment": null, "author": {"id": 15350, "name": "niels", "username": "opensource21", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/15350/avatar.png", "web_url": "https://gitlab.com/opensource21"}, "created_at": "2014-05-30T15:54:59.986Z", "updated_at": "2014-05-30T15:54:59.986Z", "system": false, "noteable_id": 33356, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 5}, {"id": 237670, "type": null, "body": "I can confirm, that this bug is still present in latest stable 7.2.0. For now the workaround is to use HTTPS, but thats not really a good way to work.", "attachment": null, "author": {"id": 50046, "name": "loosi", "username": "looserpain02", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/92c83cc42d33b5c41915a83bf1a63b92?s=80&d=identicon", "web_url": "https://gitlab.com/looserpain02"}, "created_at": "2014-08-26T09:25:07.594Z", "updated_at": "2014-08-26T09:25:07.594Z", "system": false, "noteable_id": 33356, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 5}, {"id": 259403, "type": null, "body": "I fixed it locally with an update to the update hook. Its not really a clear and fine fix, so I wont make it a merge request. \r\n\r\n-```refname = ARGV[0]```\r\n\r\n+```refname = ARGV[0].dup.force_encoding(\"UTF-8\")```", "attachment": null, "author": {"id": 50046, "name": "loosi", "username": "looserpain02", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/92c83cc42d33b5c41915a83bf1a63b92?s=80&d=identicon", "web_url": "https://gitlab.com/looserpain02"}, "created_at": "2014-08-30T23:38:31.659Z", "updated_at": "2014-08-30T23:38:31.659Z", "system": false, "noteable_id": 33356, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 5}, {"id": 308902, "type": null, "body": "Any solution/update on this issue?\r\n\r\nRelated to https://gitlab.com/gitlab-org/gitlab-ce/issues/296", "attachment": null, "author": {"id": 15427, "name": "Anton Kochkov", "username": "XVilka", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/06e868d463cf663e8bfad6852831a1be?s=80&d=identicon", "web_url": "https://gitlab.com/XVilka"}, "created_at": "2014-10-13T09:42:16.470Z", "updated_at": "2014-10-13T09:43:07.155Z", "system": false, "noteable_id": 33356, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 5}], [{"id": 157466098, "type": null, "body": "We need to determine whether this is still happening", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:33:10.160Z", "updated_at": "2019-04-04T14:33:10.160Z", "system": false, "noteable_id": 33356, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 5}], [{"id": 157466191, "type": null, "body": "changed milestone to %\"Backlog\"", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:33:21.417Z", "updated_at": "2019-04-04T14:33:21.417Z", "system": true, "noteable_id": 33356, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 5}], [{"id": 157466251, "type": null, "body": "moved to gitaly#1596", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2019-04-04T14:33:29.494Z", "updated_at": "2019-04-04T14:33:29.494Z", "system": true, "noteable_id": 33356, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 5}]]}, {"id": 28567, "iid": 4, "project_id": 14022, "title": "Tag 1.9.4 doesn't exist in GitLab repo", "description": "1.9.4 exists in gitlabhq/gitlab-shell but not here. Is the repo out of sync?", "state": "closed", "created_at": "2014-05-02T18:18:46.000Z", "updated_at": "2017-06-10T03:34:34.395Z", "closed_at": null, "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 13356, "name": "Drew Blessing", "username": "dblessing", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/13356/avatar.png", "web_url": "https://gitlab.com/dblessing"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/4", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/4", "notes": "https://gitlab.com/api/v4/projects/14022/issues/4/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/4/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 108711, "type": null, "body": "Fixed", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2014-05-20T09:20:02.049Z", "updated_at": "2014-05-20T09:20:02.049Z", "system": false, "noteable_id": 28567, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 4}, {"id": 108712, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 444, "name": "Dmitriy Zaporozhets", "username": "dzaporozhets", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/444/avatar.png", "web_url": "https://gitlab.com/dzaporozhets"}, "created_at": "2014-05-20T09:20:03.918Z", "updated_at": "2014-05-20T09:20:03.918Z", "system": true, "noteable_id": 28567, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 4}, {"id": 129546, "type": null, "body": "mentioned in issue #7", "attachment": null, "author": {"id": 36741, "name": "CSchulz", "username": "cschulz", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/35c4fca93ae71eb4429af2efb2b00e56?s=80&d=identicon", "web_url": "https://gitlab.com/cschulz"}, "created_at": "2014-06-12T18:05:06.253Z", "updated_at": "2014-06-12T18:05:06.253Z", "system": true, "noteable_id": 28567, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 4}]]}, {"id": 26238, "iid": 3, "project_id": 14022, "title": "Create git-daemon-export-ok file on repository creation", "description": "Hi,\r\n\r\nwe sharing the repository as read-only with the git:// protocol for old project deploy compatibility. I would like to know how can create that file on project creation, at the moment I have to manually create that file to export project via git://\r\n\r\nRegards\r\n\r\nFranco", "state": "closed", "created_at": "2014-04-18T08:20:24.000Z", "updated_at": "2017-06-10T03:34:34.505Z", "closed_at": null, "closed_by": null, "labels": ["support"], "milestone": null, "assignees": [{"id": 1, "name": "Sid Sijbrandij", "username": "sytses", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/78b060780d36f51a6763ac9831a4f022?s=80&d=identicon", "web_url": "https://gitlab.com/sytses"}], "author": {"id": 19891, "name": "Franco", "username": "Tampieri", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/168436516842885d8de22fbb09960575?s=80&d=identicon", "web_url": "https://gitlab.com/Tampieri"}, "assignee": {"id": 1, "name": "Sid Sijbrandij", "username": "sytses", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/78b060780d36f51a6763ac9831a4f022?s=80&d=identicon", "web_url": "https://gitlab.com/sytses"}, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/3", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/3", "notes": "https://gitlab.com/api/v4/projects/14022/issues/3/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/3/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 89778, "type": null, "body": "Assignee removed", "attachment": null, "author": {"id": 19891, "name": "Franco", "username": "Tampieri", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/168436516842885d8de22fbb09960575?s=80&d=identicon", "web_url": "https://gitlab.com/Tampieri"}, "created_at": "2014-04-23T15:34:56.000Z", "updated_at": "2014-04-23T15:34:56.000Z", "system": true, "noteable_id": 26238, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 3}, {"id": 89779, "type": null, "body": "Reassigned to @sytses", "attachment": null, "author": {"id": 19891, "name": "Franco", "username": "Tampieri", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/168436516842885d8de22fbb09960575?s=80&d=identicon", "web_url": "https://gitlab.com/Tampieri"}, "created_at": "2014-04-23T15:34:59.000Z", "updated_at": "2014-04-23T15:34:59.000Z", "system": true, "noteable_id": 26238, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 3}, {"id": 89782, "type": null, "body": "Thanks for your interest in GitLab. We don't use the issue tracker for support requests and configuration questions. Please use the [support forum](https://groups.google.com/forum/#!forum/gitlabhq), [Stack Overflow](http://stackoverflow.com/questions/tagged/gitlab), the #gitlab IRC channel on Freenode or the http://www.gitlab.com paid services for this purpose. Have a look at the [contribution guidelines](https://gitlab.com/gitlab-org/gitlab-ce/blob/master/CONTRIBUTING.md) for more information.", "attachment": null, "author": {"id": 1, "name": "Sid Sijbrandij", "username": "sytses", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/78b060780d36f51a6763ac9831a4f022?s=80&d=identicon", "web_url": "https://gitlab.com/sytses"}, "created_at": "2014-04-23T15:36:17.000Z", "updated_at": "2014-04-23T15:36:17.000Z", "system": false, "noteable_id": 26238, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 3}, {"id": 89783, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 1, "name": "Sid Sijbrandij", "username": "sytses", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/78b060780d36f51a6763ac9831a4f022?s=80&d=identicon", "web_url": "https://gitlab.com/sytses"}, "created_at": "2014-04-23T15:36:19.000Z", "updated_at": "2014-04-23T15:36:19.000Z", "system": true, "noteable_id": 26238, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 3}, {"id": 1224512, "type": null, "body": "@ssbarnea I agree that there is no clear way to ask for a feature and someone else build it. This is an open source project, if you want a feature you can contribute it or pay for someone else to contribute it. Just asking is welcome but there are no guaranties it gets build.", "attachment": null, "author": {"id": 1, "name": "Sid Sijbrandij", "username": "sytses", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/78b060780d36f51a6763ac9831a4f022?s=80&d=identicon", "web_url": "https://gitlab.com/sytses"}, "created_at": "2015-05-12T15:57:41.047Z", "updated_at": "2015-05-12T15:57:41.047Z", "system": false, "noteable_id": 26238, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 3}]]}, {"id": 23560, "iid": 2, "project_id": 14022, "title": "gitlab-shell self-check failed after upgrade", "description": "- After upgrading gitlab from 6.6-stable to 6.7-stable I got the error mentioned in the subject. I am currently using apache2 in a Debian Wheezy Server. I followed the instructions step by step. I couldn't solved that problem.\r\n\r\nCould you guys help me please?", "state": "closed", "created_at": "2014-04-09T14:18:42.000Z", "updated_at": "2017-06-10T03:34:34.561Z", "closed_at": null, "closed_by": null, "labels": ["bug"], "milestone": null, "assignees": [], "author": {"id": 25891, "name": "V\u00edctor Hugo Valle Castillo", "username": "victouk", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/90e0660dd1b63834c76ac290045effa8?s=80&d=identicon", "web_url": "https://gitlab.com/victouk"}, "assignee": null, "user_notes_count": 2, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/2", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/2", "notes": "https://gitlab.com/api/v4/projects/14022/issues/2/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/2/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 80117, "type": null, "body": "Thanks for your interest in GitLab. We don't use the issue tracker for support requests and configuration questions. Please use the [support forum](https://groups.google.com/forum/#!forum/gitlabhq), [Stack Overflow](http://stackoverflow.com/questions/tagged/gitlab), the #gitlab IRC channel on Freenode or the http://www.gitlab.com paid services for this purpose. Have a look at the [contribution guidelines](https://gitlab.com/gitlab-org/gitlab-ce/blob/master/CONTRIBUTING.md) for more information. /cc @razer6 ", "attachment": null, "author": {"id": 1164, "name": "Jeroen van Baarsen", "username": "jvanbaarsen", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1164/avatar.png", "web_url": "https://gitlab.com/jvanbaarsen"}, "created_at": "2014-04-09T14:22:35.000Z", "updated_at": "2014-04-09T14:22:35.000Z", "system": false, "noteable_id": 23560, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 2}, {"id": 80118, "type": null, "body": "Assignee removed", "attachment": null, "author": {"id": 1164, "name": "Jeroen van Baarsen", "username": "jvanbaarsen", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/1164/avatar.png", "web_url": "https://gitlab.com/jvanbaarsen"}, "created_at": "2014-04-09T14:22:39.000Z", "updated_at": "2014-04-09T14:22:39.000Z", "system": true, "noteable_id": 23560, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 2}, {"id": 80127, "type": null, "body": "@jacobvosmaer Thanks a lot for your advice.", "attachment": null, "author": {"id": 25891, "name": "V\u00edctor Hugo Valle Castillo", "username": "victouk", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/90e0660dd1b63834c76ac290045effa8?s=80&d=identicon", "web_url": "https://gitlab.com/victouk"}, "created_at": "2014-04-09T14:35:00.000Z", "updated_at": "2014-04-09T14:35:00.000Z", "system": false, "noteable_id": 23560, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 2}, {"id": 80128, "type": null, "body": "Status changed to closed", "attachment": null, "author": {"id": 25891, "name": "V\u00edctor Hugo Valle Castillo", "username": "victouk", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/90e0660dd1b63834c76ac290045effa8?s=80&d=identicon", "web_url": "https://gitlab.com/victouk"}, "created_at": "2014-04-09T14:35:18.000Z", "updated_at": "2014-04-09T14:35:18.000Z", "system": true, "noteable_id": 23560, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 2}]]}, {"id": 14291, "iid": 1, "project_id": 14022, "title": "Install gitlab-shell outside homedir", "description": "Hey guys.\r\n\r\nIs it possible to install gitlab-shell outside of /home/git folder? I have all my files in /opt. I noticed that in gitlab configuration you can specify path to gitlab-shell. Even that I specified it, if I try fetch code from gitlab (over ssh), I receive message that gitlab-shell could not be found in /home/git/gitlab-shell/bin/gitlab-shell. Any ideas?", "state": "closed", "created_at": "2014-01-22T13:26:03.000Z", "updated_at": "2018-01-12T15:26:47.464Z", "closed_at": "2018-01-12T15:26:47.459Z", "closed_by": null, "labels": [], "milestone": null, "assignees": [], "author": {"id": 15260, "name": "Jozef Vaclavik", "username": "jozef", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/eb0f93a9dbb7303e5ba7550573a9d526?s=80&d=identicon", "web_url": "https://gitlab.com/jozef"}, "assignee": null, "user_notes_count": 1, "merge_requests_count": 0, "upvotes": 0, "downvotes": 0, "due_date": null, "confidential": false, "discussion_locked": null, "web_url": "https://gitlab.com/gitlab-org/gitlab-shell/issues/1", "time_stats": {"time_estimate": 0, "total_time_spent": 0, "human_time_estimate": null, "human_total_time_spent": null}, "task_completion_status": {"count": 0, "completed_count": 0}, "has_tasks": false, "_links": {"self": "https://gitlab.com/api/v4/projects/14022/issues/1", "notes": "https://gitlab.com/api/v4/projects/14022/issues/1/notes", "award_emoji": "https://gitlab.com/api/v4/projects/14022/issues/1/award_emoji", "project": "https://gitlab.com/api/v4/projects/14022"}, "weight": null, "epic_iid": null, "discussion": [[{"id": 47804, "type": null, "body": "Have you checked https://gitlab.com/gitlab-org/gitlab-recipes/tree/master/misc/change-git-home-directory ?", "attachment": null, "author": {"id": 3585, "name": "Achilleas Pipinellis", "username": "axil", "state": "active", "avatar_url": "https://assets.gitlab-static.net/uploads/-/system/user/avatar/3585/avatar.png", "web_url": "https://gitlab.com/axil"}, "created_at": "2014-02-06T23:01:45.000Z", "updated_at": "2014-02-06T23:01:45.000Z", "system": false, "noteable_id": 14291, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 1}], [{"id": 54341501, "type": null, "body": "closed", "attachment": null, "author": {"id": 572018, "name": "Nick Thomas", "username": "nick.thomas", "state": "active", "avatar_url": "https://secure.gravatar.com/avatar/ffef5c344b3fc4ee332a47d47ac2f42c?s=80&d=identicon", "web_url": "https://gitlab.com/nick.thomas"}, "created_at": "2018-01-12T15:26:47.526Z", "updated_at": "2018-01-12T15:26:47.526Z", "system": true, "noteable_id": 14291, "noteable_type": "Issue", "resolvable": false, "noteable_iid": 1}]]}]